(self.webpackChunkmfe_USERS_CRUD=self.webpackChunkmfe_USERS_CRUD||[]).push([[609],{6609:(B,D,m)=>{m.r(D),m.d(D,{AUTH0_CONFIG:()=>co,Auth0ApiService:()=>Vt,AuthService:()=>Ui,CoreServicesComponent:()=>zs,CoreServicesService:()=>R,EventBusService:()=>Di,OrganizationService:()=>Fs,ProductCategory:()=>Re,RoleManagementService:()=>Gs,RoleService:()=>Hs,STORAGE_CONFIG:()=>Pe,STORAGE_KEYS:()=>Ce,SalesDataService:()=>Js,SalesStatus:()=>ve,SystemRole:()=>ji,TeamService:()=>Vs,UserRole:()=>ue,UserService:()=>Bs,getStorageItem:()=>At,removeStorageItem:()=>io,setStorageItem:()=>oo});var S=m(4332);let R=(()=>{class n{constructor(){}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var d=m(467),w=m(3425);function x(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]])}return e}"function"==typeof SuppressedError&&SuppressedError;var C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},E={},I={};Object.defineProperty(I,"__esModule",{value:!0});var O=function(){function n(){var t=this;this.locked=new Map,this.addToLocked=function(e,r){var o=t.locked.get(e);void 0===o?t.locked.set(e,void 0===r?[]:[r]):void 0!==r&&(o.unshift(r),t.locked.set(e,o))},this.isLocked=function(e){return t.locked.has(e)},this.lock=function(e){return new Promise(function(r,o){t.isLocked(e)?t.addToLocked(e,r):(t.addToLocked(e),r())})},this.unlock=function(e){var r=t.locked.get(e);if(void 0!==r&&0!==r.length){var o=r.pop();t.locked.set(e,r),void 0!==o&&setTimeout(o,0)}else t.locked.delete(e)}}return n.getInstance=function(){return void 0===n.instance&&(n.instance=new n),n.instance},n}();I.default=function(){return O.getInstance()};var L=C&&C.__awaiter||function(n,t,e,r){return new(e||(e=Promise))(function(o,i){function a(l){try{c(r.next(l))}catch(u){i(u)}}function s(l){try{c(r.throw(l))}catch(u){i(u)}}function c(l){l.done?o(l.value):new e(function(u){u(l.value)}).then(a,s)}c((r=r.apply(n,t||[])).next())})},M=C&&C.__generator||function(n,t){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(c){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(n,a)}catch(h){u=[6,h],r=0}finally{e=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([c,l])}}},Q=C;Object.defineProperty(E,"__esModule",{value:!0});var ae=I,fe={key:function(n){return L(Q,void 0,void 0,function(){return M(this,function(t){throw new Error("Unsupported")})})},getItem:function(n){return L(Q,void 0,void 0,function(){return M(this,function(t){throw new Error("Unsupported")})})},clear:function(){return L(Q,void 0,void 0,function(){return M(this,function(n){return[2,window.localStorage.clear()]})})},removeItem:function(n){return L(Q,void 0,void 0,function(){return M(this,function(t){throw new Error("Unsupported")})})},setItem:function(n,t){return L(Q,void 0,void 0,function(){return M(this,function(e){throw new Error("Unsupported")})})},keySync:function(n){return window.localStorage.key(n)},getItemSync:function(n){return window.localStorage.getItem(n)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(n){return window.localStorage.removeItem(n)},setItemSync:function(n,t){return window.localStorage.setItem(n,t)}};function Ze(n){return new Promise(function(t){return setTimeout(t,n)})}function Ke(n){for(var e="",r=0;r<n;r++)e+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"[Math.floor(61*Math.random())];return e}var Xe=function(){function n(t){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+Ke(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=t,void 0===n.waiters&&(n.waiters=[])}return n.prototype.acquireLock=function(t,e){return void 0===e&&(e=5e3),L(this,void 0,void 0,function(){var r,o,i,a,s,c,l;return M(this,function(u){switch(u.label){case 0:r=Date.now()+Ke(4),o=Date.now()+e,i="browser-tabs-lock-key-"+t,a=void 0===this.storageHandler?fe:this.storageHandler,u.label=1;case 1:return Date.now()<o?[4,Ze(30)]:[3,8];case 2:return u.sent(),null!==a.getItemSync(i)?[3,5]:(s=this.id+"-"+t+"-"+r,[4,Ze(Math.floor(25*Math.random()))]);case 3:return u.sent(),a.setItemSync(i,JSON.stringify({id:this.id,iat:r,timeoutKey:s,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,Ze(30)];case 4:return u.sent(),null!==(c=a.getItemSync(i))&&(l=JSON.parse(c)).id===this.id&&l.iat===r?(this.acquiredIatSet.add(r),this.refreshLockWhileAcquired(i,r),[2,!0]):[3,7];case 5:return n.lockCorrector(void 0===this.storageHandler?fe:this.storageHandler),[4,this.waitForSomethingToChange(o)];case 6:u.sent(),u.label=7;case 7:return r=Date.now()+Ke(4),[3,1];case 8:return[2,!1]}})})},n.prototype.refreshLockWhileAcquired=function(t,e){return L(this,void 0,void 0,function(){var r=this;return M(this,function(o){return setTimeout(function(){return L(r,void 0,void 0,function(){var i,a,s;return M(this,function(c){switch(c.label){case 0:return[4,ae.default().lock(e)];case 1:return c.sent(),this.acquiredIatSet.has(e)?null===(a=(i=void 0===this.storageHandler?fe:this.storageHandler).getItemSync(t))?(ae.default().unlock(e),[2]):((s=JSON.parse(a)).timeRefreshed=Date.now(),i.setItemSync(t,JSON.stringify(s)),ae.default().unlock(e),this.refreshLockWhileAcquired(t,e),[2]):(ae.default().unlock(e),[2])}})})},1e3),[2]})})},n.prototype.waitForSomethingToChange=function(t){return L(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return[4,new Promise(function(r){var o=!1,i=Date.now(),a=!1;function s(){if(a||(window.removeEventListener("storage",s),n.removeFromWaiting(s),clearTimeout(c),a=!0),!o){o=!0;var l=50-(Date.now()-i);l>0?setTimeout(r,l):r(null)}}window.addEventListener("storage",s),n.addToWaiting(s);var c=setTimeout(s,Math.max(0,t-Date.now()))})];case 1:return e.sent(),[2]}})})},n.addToWaiting=function(t){this.removeFromWaiting(t),void 0!==n.waiters&&n.waiters.push(t)},n.removeFromWaiting=function(t){void 0!==n.waiters&&(n.waiters=n.waiters.filter(function(e){return e!==t}))},n.notifyWaiters=function(){void 0!==n.waiters&&n.waiters.slice().forEach(function(t){return t()})},n.prototype.releaseLock=function(t){return L(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return[4,this.releaseLock__private__(t)];case 1:return[2,e.sent()]}})})},n.prototype.releaseLock__private__=function(t){return L(this,void 0,void 0,function(){var e,r,o,i;return M(this,function(a){switch(a.label){case 0:return null===(o=(e=void 0===this.storageHandler?fe:this.storageHandler).getItemSync(r="browser-tabs-lock-key-"+t))?[2]:(i=JSON.parse(o)).id!==this.id?[3,2]:[4,ae.default().lock(i.iat)];case 1:a.sent(),this.acquiredIatSet.delete(i.iat),e.removeItemSync(r),ae.default().unlock(i.iat),n.notifyWaiters(),a.label=2;case 2:return[2]}})})},n.lockCorrector=function(t){for(var e=Date.now()-5e3,r=t,o=[],i=0;;){var a=r.keySync(i);if(null===a)break;o.push(a),i++}for(var s=!1,c=0;c<o.length;c++){var l=o[c];if(l.includes("browser-tabs-lock-key")){var u=r.getItemSync(l);if(null!==u){var h=JSON.parse(u);(void 0===h.timeRefreshed&&h.timeAcquired<e||void 0!==h.timeRefreshed&&h.timeRefreshed<e)&&(r.removeItemSync(l),s=!0)}}}s&&n.notifyWaiters()},n.waiters=void 0,n}(),lt=E.default=Xe;const Ye={timeoutInSeconds:60},z={name:"auth0-spa-js",version:"2.13.0"},Z=()=>Date.now();class W extends Error{constructor(t,e){super(e),this.error=t,this.error_description=e,Object.setPrototypeOf(this,W.prototype)}static fromPayload(t){let{error:e,error_description:r}=t;return new W(e,r)}}class Me extends W{constructor(t,e,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(t,e),this.state=r,this.appState=o,Object.setPrototypeOf(this,Me.prototype)}}class dt extends W{constructor(t,e,r,o){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(t,e),this.connection=r,this.state=o,this.appState=i,Object.setPrototypeOf(this,dt.prototype)}}class ht extends W{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,ht.prototype)}}class bn extends ht{constructor(t){super(),this.popup=t,Object.setPrototypeOf(this,bn.prototype)}}class An extends W{constructor(t){super("cancelled","Popup closed"),this.popup=t,Object.setPrototypeOf(this,An.prototype)}}class Sn extends W{constructor(){super("popup_open","Unable to open a popup for loginWithPopup - window.open returned `null`"),Object.setPrototypeOf(this,Sn.prototype)}}class St extends W{constructor(t,e,r,o){super(t,e),this.mfa_token=r,this.mfa_requirements=o,Object.setPrototypeOf(this,St.prototype)}}class Bt extends W{constructor(t,e){super("missing_refresh_token","Missing Refresh Token (audience: '".concat(Zt(t,["default"]),"', scope: '").concat(Zt(e),"')")),this.audience=t,this.scope=e,Object.setPrototypeOf(this,Bt.prototype)}}class En extends W{constructor(t,e){super("missing_scopes","Missing requested scopes after refresh (audience: '".concat(Zt(t,["default"]),"', missing scope: '").concat(Zt(e),"')")),this.audience=t,this.scope=e,Object.setPrototypeOf(this,En.prototype)}}class Gt extends W{constructor(t){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=t,Object.setPrototypeOf(this,Gt.prototype)}}function Zt(n){return n&&!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).includes(n)?n:""}const Xt=()=>window.crypto,Et=()=>{let t="";return Array.from(Xt().getRandomValues(new Uint8Array(43))).forEach(e=>t+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~."[e%66]),t},kn=n=>btoa(n),Mi=[{key:"name",type:["string"]},{key:"version",type:["string","number"]},{key:"env",type:["object"]}],uo=function(n){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object.keys(n).reduce((e,r)=>{if(t&&"env"===r)return e;const o=Mi.find(i=>i.key===r);return o&&o.type.includes(typeof n[r])&&(e[r]=n[r]),e},{})},Tn=n=>{var r,{clientId:t}=n,e=x(n,["clientId"]);return new URLSearchParams((r=Object.assign({client_id:t},e),Object.keys(r).filter(o=>void 0!==r[o]).reduce((o,i)=>Object.assign(Object.assign({},o),{[i]:r[i]}),{}))).toString()},lo=function(){var n=(0,d.A)(function*(t){return yield Xt().subtle.digest({name:"SHA-256"},(new TextEncoder).encode(t))});return function(e){return n.apply(this,arguments)}}(),ho=n=>{return t=n.replace(/_/g,"/").replace(/-/g,"+"),decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));var t},po=n=>{const t=new Uint8Array(n);return(e=>{const r={"+":"-","/":"_","=":""};return e.replace(/[+/=]/g,o=>r[o])})(window.btoa(String.fromCharCode(...Array.from(t))))},Ni=new TextEncoder,Wi=new TextDecoder;function kt(n){return"string"==typeof n?Ni.encode(n):Wi.decode(n)}function mo(n){if("number"!=typeof n.modulusLength||n.modulusLength<2048)throw new Hi(`${n.name} modulusLength must be at least 2048 bits`)}function xn(){return(xn=(0,d.A)(function*(n,t,e){if(!1===e.usages.includes("sign"))throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const r=`${Tt(kt(JSON.stringify(n)))}.${Tt(kt(JSON.stringify(t)))}`;return`${r}.${Tt(yield crypto.subtle.sign(function(o){switch(o.algorithm.name){case"ECDSA":return{name:o.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return mo(o.algorithm),{name:o.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return mo(o.algorithm),{name:o.algorithm.name};case"Ed25519":return{name:o.algorithm.name}}throw new $e}(e),e,kt(r)))}`})).apply(this,arguments)}let In;function Tt(n){return In(n)}In=Uint8Array.prototype.toBase64?n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):t=>{t instanceof ArrayBuffer&&(t=new Uint8Array(t));const e=[];for(let r=0;r<t.byteLength;r+=32768)e.push(String.fromCharCode.apply(null,t.subarray(r,r+32768)));return btoa(e.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};class $e extends Error{constructor(t){var e;super(t??"operation not supported"),this.name=this.constructor.name,null===(e=Error.captureStackTrace)||void 0===e||e.call(Error,this,this.constructor)}}class Hi extends Error{constructor(t){var e;super(t),this.name=this.constructor.name,null===(e=Error.captureStackTrace)||void 0===e||e.call(Error,this,this.constructor)}}function Ji(n){switch(n.algorithm.name){case"RSA-PSS":return function(t){if("SHA-256"===t.algorithm.hash.name)return"PS256";throw new $e("unsupported RsaHashedKeyAlgorithm hash name")}(n);case"RSASSA-PKCS1-v1_5":return function(t){if("SHA-256"===t.algorithm.hash.name)return"RS256";throw new $e("unsupported RsaHashedKeyAlgorithm hash name")}(n);case"ECDSA":return function(t){if("P-256"===t.algorithm.namedCurve)return"ES256";throw new $e("unsupported EcKeyAlgorithm namedCurve")}(n);case"Ed25519":return"Ed25519";default:throw new $e("unsupported CryptoKey algorithm name")}}function fo(n){return n instanceof CryptoKey}function go(n){return fo(n)&&"public"===n.type}function Pn(){return Pn=(0,d.A)(function*(n,t,e,r,o,i){const a=n?.privateKey,s=n?.publicKey;if(!fo(c=a)||"private"!==c.type)throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var c;if(!go(s))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(!0!==s.extractable)throw new TypeError('"keypair.publicKey.extractable" must be true');if("string"!=typeof t)throw new TypeError('"htu" must be a string');if("string"!=typeof e)throw new TypeError('"htm" must be a string');if(void 0!==r&&"string"!=typeof r)throw new TypeError('"nonce" must be a string or undefined');if(void 0!==o&&"string"!=typeof o)throw new TypeError('"accessToken" must be a string or undefined');if(void 0!==i&&("object"!=typeof i||null===i||Array.isArray(i)))throw new TypeError('"additional" must be an object');return function zi(n,t,e){return xn.apply(this,arguments)}({alg:Ji(a),typ:"dpop+jwt",jwk:yield yo(s)},Object.assign(Object.assign({},i),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:e,nonce:r,htu:t,ath:o?Tt(yield crypto.subtle.digest("SHA-256",kt(o))):void 0}),a)}),Pn.apply(this,arguments)}function yo(n){return Cn.apply(this,arguments)}function Cn(){return(Cn=(0,d.A)(function*(n){const{kty:t,e,n:r,x:o,y:i,crv:a}=yield crypto.subtle.exportKey("jwk",n);return{kty:t,crv:a,e,n:r,x:o,y:i}})).apply(this,arguments)}const Vi=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange","http://auth0.com/oauth/grant-type/mfa-oob","http://auth0.com/oauth/grant-type/mfa-otp","http://auth0.com/oauth/grant-type/mfa-recovery-code"];const Xi=function(){var n=(0,d.A)(function*(t,e){const r=yield fetch(t,e);return{ok:r.ok,json:yield r.json(),headers:(o=r.headers,[...o].reduce((i,a)=>{let[s,c]=a;return i[s]=c,i},{}))};var o});return function(e,r){return n.apply(this,arguments)}}(),Yi=function(){var n=(0,d.A)(function*(t,e,r){const o=new AbortController;let i;return e.signal=o.signal,Promise.race([Xi(t,e),new Promise((a,s)=>{i=setTimeout(()=>{o.abort(),s(new Error("Timeout when executing 'fetch'"))},r)})]).finally(()=>{clearTimeout(i)})});return function(e,r,o){return n.apply(this,arguments)}}(),$i=function(){var n=(0,d.A)(function*(t,e,r,o,i,a,s,c){return l={auth:{audience:e,scope:r},timeout:i,fetchUrl:t,fetchOptions:o,useFormData:s,useMrrt:c},u=a,new Promise(function(h,g){const p=new MessageChannel;p.port1.onmessage=function(y){y.data.error?g(new Error(y.data.error)):h(y.data),p.port1.close()},u.postMessage(l,[p.port2])});var l,u});return function(e,r,o,i,a,s,c,l){return n.apply(this,arguments)}}(),qi=function(){var n=(0,d.A)(function*(t,e,r,o,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4;return i?$i(t,e,r,o,s,i,a,arguments.length>7?arguments[7]:void 0):Yi(t,o,s)});return function(e,r,o,i,a,s){return n.apply(this,arguments)}}();function _o(n,t,e,r,o,i,a,s,c,l){return Rn.apply(this,arguments)}function Rn(){return(Rn=(0,d.A)(function*(n,t,e,r,o,i,a,s,c,l){if(c){const T=yield c.generateProof({url:n,method:o.method||"GET",nonce:yield c.getNonce()});o.headers=Object.assign(Object.assign({},o.headers),{dpop:T})}let u,h=null;for(let T=0;T<3;T++)try{u=yield qi(n,e,r,o,i,a,t,s),h=null;break}catch(U){h=U}if(h)throw h;const g=u.json,{error:p,error_description:y}=g,v=x(g,["error","error_description"]),{headers:f,ok:_}=u;let b;if(c&&(b=f["dpop-nonce"],b&&(yield c.setNonce(b))),!_){const T=y||"HTTP error. Unable to fetch ".concat(n);if("mfa_required"===p)throw new St(p,T,v.mfa_token,v.mfa_requirements);if("missing_refresh_token"===p)throw new Bt(e,r);if("use_dpop_nonce"===p){if(!c||!b||l)throw new Gt(b);return _o(n,t,e,r,o,i,a,s,c,!0)}throw new W(p||"request_error",T)}return v})).apply(this,arguments)}function On(){return(On=(0,d.A)(function*(n,t){var{baseUrl:e,timeout:r,audience:o,scope:i,auth0Client:a,useFormData:s,useMrrt:c,dpop:l}=n,u=x(n,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);const h="urn:ietf:params:oauth:grant-type:token-exchange"===u.grant_type,g="refresh_token"===u.grant_type&&c,p=Object.assign(Object.assign(Object.assign(Object.assign({},u),h&&o&&{audience:o}),h&&i&&{scope:i}),g&&{audience:o,scope:i}),y=s?Tn(p):JSON.stringify(p),v=Vi.includes(u.grant_type);return yield _o("".concat(e,"/oauth/token"),r,o||"default",i,{method:"POST",body:y,headers:{"Content-Type":s?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(uo(a||z)))}},t,s,c,v?l:void 0)})).apply(this,arguments)}const Yt=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return(n=>Array.from(new Set(n)))(t.filter(Boolean).join(" ").trim().split(/\s+/)).join(" ")},$t=(n,t,e)=>{let r;return e&&(r=n[e]),r||(r=n.default),Yt(r,t)};class ge{constructor(t){let r=arguments.length>2?arguments[2]:void 0;this.prefix=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"@@auth0spajs@@",this.suffix=r,this.clientId=t.clientId,this.scope=t.scope,this.audience=t.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(t){const[e,r,o,i]=t.split("::");return new ge({clientId:r,scope:i,audience:o},e)}static fromCacheEntry(t){const{scope:e,audience:r,client_id:o}=t;return new ge({scope:e,audience:r,clientId:o})}}class ta{set(t,e){localStorage.setItem(t,JSON.stringify(e))}get(t){const e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch{return}}remove(t){localStorage.removeItem(t)}allKeys(){return Object.keys(window.localStorage).filter(t=>t.startsWith("@@auth0spajs@@"))}}class vo{constructor(){this.enclosedCache=function(){let t={};return{set(e,r){t[e]=r},get(e){const r=t[e];if(r)return r},remove(e){delete t[e]},allKeys:()=>Object.keys(t)}}()}}class na{constructor(t,e,r){this.cache=t,this.keyManifest=e,this.nowProvider=r||Z}setIdToken(t,e,r){var o=this;return(0,d.A)(function*(){var i;const a=o.getIdTokenCacheKey(t);yield o.cache.set(a,{id_token:e,decodedToken:r}),yield null===(i=o.keyManifest)||void 0===i?void 0:i.add(a)})()}getIdToken(t){var e=this;return(0,d.A)(function*(){const r=yield e.cache.get(e.getIdTokenCacheKey(t.clientId));if(!r&&t.scope&&t.audience){const o=yield e.get(t);return o&&o.id_token&&o.decodedToken?{id_token:o.id_token,decodedToken:o.decodedToken}:void 0}if(r)return{id_token:r.id_token,decodedToken:r.decodedToken}})()}get(t){var e=arguments,r=this;return(0,d.A)(function*(){let o=e.length>1&&void 0!==e[1]?e[1]:0,i=e.length>2&&void 0!==e[2]&&e[2],a=e.length>3?e[3]:void 0;var s;let c=yield r.cache.get(t.toKey());if(!c){const h=yield r.getCacheKeys();if(!h)return;const g=r.matchExistingCacheKey(t,h);if(g&&(c=yield r.cache.get(g)),!c&&i&&"cache-only"!==a)return r.getEntryWithRefreshToken(t,h)}if(!c)return;const l=yield r.nowProvider(),u=Math.floor(l/1e3);return c.expiresAt-o<u?c.body.refresh_token?r.modifiedCachedEntry(c,t):(yield r.cache.remove(t.toKey()),void(yield null===(s=r.keyManifest)||void 0===s?void 0:s.remove(t.toKey()))):c.body})()}modifiedCachedEntry(t,e){var r=this;return(0,d.A)(function*(){return t.body={refresh_token:t.body.refresh_token,audience:t.body.audience,scope:t.body.scope},yield r.cache.set(e.toKey(),t),{refresh_token:t.body.refresh_token,audience:t.body.audience,scope:t.body.scope}})()}set(t){var e=this;return(0,d.A)(function*(){var r;const o=new ge({clientId:t.client_id,scope:t.scope,audience:t.audience}),i=yield e.wrapCacheEntry(t);yield e.cache.set(o.toKey(),i),yield null===(r=e.keyManifest)||void 0===r?void 0:r.add(o.toKey())})()}remove(t,e,r){var o=this;return(0,d.A)(function*(){const i=new ge({clientId:t,scope:r,audience:e});yield o.cache.remove(i.toKey())})()}clear(t){var e=this;return(0,d.A)(function*(){var r;const o=yield e.getCacheKeys();o&&(yield o.filter(i=>!t||i.includes(t)).reduce(function(){var i=(0,d.A)(function*(a,s){yield a,yield e.cache.remove(s)});return function(a,s){return i.apply(this,arguments)}}(),Promise.resolve()),yield null===(r=e.keyManifest)||void 0===r?void 0:r.clear())})()}wrapCacheEntry(t){var e=this;return(0,d.A)(function*(){const r=yield e.nowProvider();return{body:t,expiresAt:Math.floor(r/1e3)+t.expires_in}})()}getCacheKeys(){var t=this;return(0,d.A)(function*(){var e;return t.keyManifest?null===(e=yield t.keyManifest.get())||void 0===e?void 0:e.keys:t.cache.allKeys?t.cache.allKeys():void 0})()}getIdTokenCacheKey(t){return new ge({clientId:t},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(t,e){return e.filter(r=>{var o;const i=ge.fromKey(r),a=new Set(i.scope&&i.scope.split(" ")),s=(null===(o=t.scope)||void 0===o?void 0:o.split(" "))||[],c=i.scope&&s.reduce((l,u)=>l&&a.has(u),!0);return"@@auth0spajs@@"===i.prefix&&i.clientId===t.clientId&&i.audience===t.audience&&c})[0]}getEntryWithRefreshToken(t,e){var r=this;return(0,d.A)(function*(){var o;for(const i of e){const a=ge.fromKey(i);if("@@auth0spajs@@"===a.prefix&&a.clientId===t.clientId){const s=yield r.cache.get(i);if(null!==(o=s?.body)&&void 0!==o&&o.refresh_token)return r.modifiedCachedEntry(s,t)}}})()}updateEntry(t,e){var r=this;return(0,d.A)(function*(){var o;const i=yield r.getCacheKeys();if(i)for(const a of i){const s=yield r.cache.get(a);if((null===(o=s?.body)||void 0===o?void 0:o.refresh_token)===t){const c=Object.assign(Object.assign({},s.body),{refresh_token:e});yield r.set(c)}}})()}}class ra{constructor(t,e,r){this.storage=t,this.clientId=e,this.cookieDomain=r,this.storageKey="".concat("a0.spajs.txs",".").concat(this.clientId)}create(t){this.storage.save(this.storageKey,t,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const xt=n=>"number"==typeof n,oa=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"];var It=C&&C.__assign||function(){return It=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},It.apply(this,arguments)};function Pt(n,t){if(!t)return"";var e="; "+n;return!0===t?e:e+"="+t}function wo(n,t,e){document.cookie=function aa(n,t,e){return encodeURIComponent(n).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(t).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(r){if("number"==typeof r.expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*r.expires),r.expires=o}return Pt("Expires",r.expires?r.expires.toUTCString():"")+Pt("Domain",r.domain)+Pt("Path",r.path)+Pt("Secure",r.secure)+Pt("SameSite",r.sameSite)}(e)}(n,t,It({path:"/"},e))}var bo=wo,Ao=function(n,t){wo(n,"",It(It({},t),{expires:-1}))};const pt={get(n){const t=function(n){return function sa(){return function(n){for(var t={},e=n?n.split("; "):[],r=/(%[\dA-F]{2})+/gi,o=0;o<e.length;o++){var i=e[o].split("="),a=i.slice(1).join("=");'"'===a.charAt(0)&&(a=a.slice(1,-1));try{t[i[0].replace(r,decodeURIComponent)]=a.replace(r,decodeURIComponent)}catch{}}return t}(document.cookie)}()[n]}(n);if(void 0!==t)return JSON.parse(t)},save(n,t,e){let r={};"https:"===window.location.protocol&&(r={secure:!0,sameSite:"none"}),e?.daysUntilExpire&&(r.expires=e.daysUntilExpire),e?.cookieDomain&&(r.domain=e.cookieDomain),bo(n,JSON.stringify(t),r)},remove(n,t){let e={};t?.cookieDomain&&(e.domain=t.cookieDomain),Ao(n,e)}},ua={get:n=>pt.get(n)||pt.get("".concat("_legacy_").concat(n)),save(n,t,e){let r={};"https:"===window.location.protocol&&(r={secure:!0}),e?.daysUntilExpire&&(r.expires=e.daysUntilExpire),e?.cookieDomain&&(r.domain=e.cookieDomain),bo("".concat("_legacy_").concat(n),JSON.stringify(t),r),pt.save(n,t,e)},remove(n,t){let e={};t?.cookieDomain&&(e.domain=t.cookieDomain),Ao(n,e),pt.remove(n,t),pt.remove("".concat("_legacy_").concat(n),t)}},la={get(n){if(typeof sessionStorage>"u")return;const t=sessionStorage.getItem(n);return null!=t?JSON.parse(t):void 0},save(n,t){sessionStorage.setItem(n,JSON.stringify(t))},remove(n){sessionStorage.removeItem(n)}};var qe,n;(n=qe||(qe={})).Code="code",n.ConnectCode="connect_code";var Dn,ha=function(n){return Dn=Dn||function da(n,t,e){var r=void 0===t?null:t,o=function(c,l){var u=atob(c);if(l){for(var h=new Uint8Array(u.length),g=0,p=u.length;g<p;++g)h[g]=u.charCodeAt(g);return String.fromCharCode.apply(null,new Uint16Array(h.buffer))}return u}(n,void 0!==e&&e),i=o.indexOf("\n",10)+1,a=o.substring(i)+(r?"//# sourceMappingURL="+r:""),s=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(s)}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHQpe2xldHtlcnJvcjpyLGVycm9yX2Rlc2NyaXB0aW9uOnN9PXQ7cmV0dXJuIG5ldyBlKHIscyl9fWNsYXNzIHQgZXh0ZW5kcyBle2NvbnN0cnVjdG9yKGUscyl7c3VwZXIoIm1pc3NpbmdfcmVmcmVzaF90b2tlbiIsIk1pc3NpbmcgUmVmcmVzaCBUb2tlbiAoYXVkaWVuY2U6ICciLmNvbmNhdChyKGUsWyJkZWZhdWx0Il0pLCInLCBzY29wZTogJyIpLmNvbmNhdChyKHMpLCInKSIpKSx0aGlzLmF1ZGllbmNlPWUsdGhpcy5zY29wZT1zLE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLHQucHJvdG90eXBlKX19ZnVuY3Rpb24gcihlKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06W107cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+IiIuY29uY2F0KGUsInwiKS5jb25jYXQodCk7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jIGU9PntsZXQgcixjLHtkYXRhOnt0aW1lb3V0OmksYXV0aDphLGZldGNoVXJsOmYsZmV0Y2hPcHRpb25zOmwsdXNlRm9ybURhdGE6cCx1c2VNcnJ0Omh9LHBvcnRzOlt1XX09ZSxkPXt9O2NvbnN0e2F1ZGllbmNlOmcsc2NvcGU6eX09YXx8e307dHJ5e2NvbnN0IGU9cD8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShsLmJvZHkpOkpTT04ucGFyc2UobC5ib2R5KTtpZighZS5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1lLmdyYW50X3R5cGUpe2lmKGM9KChlLHQpPT5vW24oZSx0KV0pKGcseSksIWMmJmgpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKCIiLmNvbmNhdChlLCJ8IikpKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxnKTtlJiYhdCYmKGM9ZSl9aWYoIWMpdGhyb3cgbmV3IHQoZyx5KTtsLmJvZHk9cD9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpfWxldCBhLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGE9bmV3IEFib3J0Q29udHJvbGxlcixsLnNpZ25hbD1hLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoaj1pLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsaikpKSksZmV0Y2goZixPYmplY3QuYXNzaWduKHt9LGwpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHUucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBhJiZhLmFib3J0KCksdm9pZCB1LnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO189ay5oZWFkZXJzLGQ9Wy4uLl9dLnJlZHVjZSgoKGUsdCk9PntsZXRbcixzXT10O3JldHVybiBlW3JdPXMsZX0pLHt9KSxyPWF3YWl0IGsuanNvbigpLHIucmVmcmVzaF90b2tlbj8oaCYmKG8ubGF0ZXN0X3JlZnJlc2hfdG9rZW49ci5yZWZyZXNoX3Rva2VuLE89YyxiPXIucmVmcmVzaF90b2tlbixPYmplY3QuZW50cmllcyhvKS5mb3JFYWNoKChlPT57bGV0W3Qscl09ZTtyPT09TyYmKG9bdF09Yil9KSkpLCgoZSx0LHIpPT57b1tuKHQscildPWV9KShyLnJlZnJlc2hfdG9rZW4sZyx5KSxkZWxldGUgci5yZWZyZXNoX3Rva2VuKTooKGUsdCk9PntkZWxldGUgb1tuKGUsdCldfSkoZyx5KSx1LnBvc3RNZXNzYWdlKHtvazprLm9rLGpzb246cixoZWFkZXJzOmR9KX1jYXRjaChlKXt1LnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcjplLmVycm9yLGVycm9yX2Rlc2NyaXB0aW9uOmUubWVzc2FnZX0saGVhZGVyczpkfSl9dmFyIE8sYixfLGp9KSl9KCk7Cgo=",null,!1),new Worker(Dn,n)};const Un={},To=function(){var n=(0,d.A)(function*(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let r=0;r<e;r++)if(yield t())return!0;return!1});return function(e){return n.apply(this,arguments)}}();class pa{constructor(t,e){this.cache=t,this.clientId=e,this.manifestKey=this.createManifestKeyFrom(this.clientId)}add(t){var e=this;return(0,d.A)(function*(){var r;const o=new Set((null===(r=yield e.cache.get(e.manifestKey))||void 0===r?void 0:r.keys)||[]);o.add(t),yield e.cache.set(e.manifestKey,{keys:[...o]})})()}remove(t){var e=this;return(0,d.A)(function*(){const r=yield e.cache.get(e.manifestKey);if(r){const o=new Set(r.keys);return o.delete(t),o.size>0?yield e.cache.set(e.manifestKey,{keys:[...o]}):yield e.cache.remove(e.manifestKey)}})()}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(t){return"".concat("@@auth0spajs@@","::").concat(t)}}const ma={memory:()=>(new vo).enclosedCache,localstorage:()=>new ta},xo=n=>ma[n],Io=n=>{const{openUrl:t,onRedirect:e}=n,r=x(n,["openUrl","onRedirect"]);return Object.assign(Object.assign({},r),{openUrl:!1===t||t?t:e})},Po=(n,t)=>{const e=t?.split(" ")||[];return(n?.split(" ")||[]).every(r=>e.includes(r))},Qe={NONCE:"nonce",KEYPAIR:"keypair"};class fa{constructor(t){this.clientId=t}getVersion(){return 1}createDbHandle(){const t=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((e,r)=>{t.onupgradeneeded=()=>Object.values(Qe).forEach(o=>t.result.createObjectStore(o)),t.onerror=()=>r(t.error),t.onsuccess=()=>e(t.result)})}getDbHandle(){var t=this;return(0,d.A)(function*(){return t.dbHandle||(t.dbHandle=yield t.createDbHandle()),t.dbHandle})()}executeDbRequest(t,e,r){var o=this;return(0,d.A)(function*(){const i=r((yield o.getDbHandle()).transaction(t,e).objectStore(t));return new Promise((a,s)=>{i.onsuccess=()=>a(i.result),i.onerror=()=>s(i.error)})})()}buildKey(t){const e=t?"_".concat(t):"auth0";return"".concat(this.clientId,"::").concat(e)}setNonce(t,e){return this.save(Qe.NONCE,this.buildKey(e),t)}setKeyPair(t){return this.save(Qe.KEYPAIR,this.buildKey(),t)}save(t,e,r){var o=this;return(0,d.A)(function*(){yield o.executeDbRequest(t,"readwrite",i=>i.put(r,e))})()}findNonce(t){return this.find(Qe.NONCE,this.buildKey(t))}findKeyPair(){return this.find(Qe.KEYPAIR,this.buildKey())}find(t,e){return this.executeDbRequest(t,"readonly",r=>r.get(e))}deleteBy(t,e){var r=this;return(0,d.A)(function*(){const o=yield r.executeDbRequest(t,"readonly",i=>i.getAllKeys());o?.filter(e).map(i=>r.executeDbRequest(t,"readwrite",a=>a.delete(i)))})()}deleteByClientId(t,e){return this.deleteBy(t,r=>"string"==typeof r&&r.startsWith("".concat(e,"::")))}clearNonces(){return this.deleteByClientId(Qe.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(Qe.KEYPAIR,this.clientId)}}class ga{constructor(t){this.storage=new fa(t)}getNonce(t){return this.storage.findNonce(t)}setNonce(t,e){return this.storage.setNonce(t,e)}getOrGenerateKeyPair(){var t=this;return(0,d.A)(function*(){let e=yield t.storage.findKeyPair();return e||(e=yield function Bi(){return(n=(0,d.A)(function*(t,e){var r;let o;if("string"!=typeof t||0===t.length)throw new TypeError('"alg" must be a non-empty string');switch(t){case"PS256":o={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":o={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":o={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":o={name:"Ed25519"};break;default:throw new $e}return crypto.subtle.generateKey(o,null!==(r=e?.extractable)&&void 0!==r&&r,["sign","verify"])}),function(t,e){return n.apply(this,arguments)})("ES256",{extractable:!1});var n}(),yield t.storage.setKeyPair(e)),e})()}generateProof(t){var e=this;return(0,d.A)(function*(){const r=yield e.getOrGenerateKeyPair();return function Zi(n){let{keyPair:t,url:e,method:r,nonce:o,accessToken:i}=n;return function Fi(n,t,e,r,o,i){return Pn.apply(this,arguments)}(t,function(s){const c=new URL(s);return c.search="",c.hash="",c.href}(e),r,o,i)}(Object.assign({keyPair:r},t))})()}calculateThumbprint(){var t=this;return(0,d.A)(function*(){return function Gi(n){return(t=(0,d.A)(function*(e){if(!go(e))throw new TypeError('"publicKey" must be a public CryptoKey');if(!0!==e.extractable)throw new TypeError('"publicKey.extractable" must be true');const r=yield yo(e);let o;switch(r.kty){case"EC":o={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":o={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":o={e:r.e,kty:r.kty,n:r.n};break;default:throw new $e("unsupported JWK kty")}return Tt(yield crypto.subtle.digest({name:"SHA-256"},kt(JSON.stringify(o))))}),function(e){return t.apply(this,arguments)})(n.publicKey);var t}(yield t.getOrGenerateKeyPair())})()}clear(){var t=this;return(0,d.A)(function*(){yield Promise.all([t.storage.clearNonces(),t.storage.clearKeyPairs()])})()}}var mt;!function(n){n.Bearer="Bearer",n.DPoP="DPoP"}(mt||(mt={}));class ya{constructor(t,e){this.hooks=e,this.config=Object.assign(Object.assign({},t),{fetch:t.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(t){return/^(https?:)?\/\//i.test(t)}buildUrl(t,e){if(e){if(this.isAbsoluteUrl(e))return e;if(t)return"".concat(t.replace(/\/?\/$/,""),"/").concat(e.replace(/^\/+/,""))}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(t){return this.config.getAccessToken?this.config.getAccessToken(t):this.hooks.getAccessToken(t)}extractUrl(t){return"string"==typeof t?t:t instanceof URL?t.href:t.url}buildBaseRequest(t,e){if(!this.config.baseUrl)return new Request(t,e);const r=this.buildUrl(this.config.baseUrl,this.extractUrl(t)),o=t instanceof Request?new Request(r,t):r;return new Request(o,e)}setAuthorizationHeader(t,e){t.headers.set("authorization","".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:mt.Bearer," ").concat(e))}setDpopProofHeader(t,e){var r=this;return(0,d.A)(function*(){if(!r.config.dpopNonceId)return;const o=yield r.hooks.getDpopNonce(),i=yield r.hooks.generateDpopProof({accessToken:e,method:t.method,nonce:o,url:t.url});t.headers.set("dpop",i)})()}prepareRequest(t,e){var r=this;return(0,d.A)(function*(){const o=yield r.getAccessToken(e);let i,a;"string"==typeof o?(i=r.config.dpopNonceId?mt.DPoP:mt.Bearer,a=o):(i=o.token_type,a=o.access_token),r.setAuthorizationHeader(t,a,i),i===mt.DPoP&&(yield r.setDpopProofHeader(t,a))})()}getHeader(t,e){return Array.isArray(t)?new Headers(t).get(e)||"":"function"==typeof t.get?t.get(e)||"":t[e]||""}hasUseDpopNonceError(t){if(401!==t.status)return!1;const e=this.getHeader(t.headers,"www-authenticate");return e.includes("invalid_dpop_nonce")||e.includes("use_dpop_nonce")}handleResponse(t,e){var r=this;return(0,d.A)(function*(){const o=r.getHeader(t.headers,"dpop-nonce");if(o&&(yield r.hooks.setDpopNonce(o)),!r.hasUseDpopNonceError(t))return t;if(!o||!e.onUseDpopNonceError)throw new Gt(o);return e.onUseDpopNonceError()})()}internalFetchWithAuth(t,e,r,o){var i=this;return(0,d.A)(function*(){const a=i.buildBaseRequest(t,e);yield i.prepareRequest(a,o);const s=yield i.config.fetch(a);return i.handleResponse(s,r)})()}fetchWithAuth(t,e,r){const o={onUseDpopNonceError:()=>this.internalFetchWithAuth(t,e,Object.assign(Object.assign({},o),{onUseDpopNonceError:void 0}),r)};return this.internalFetchWithAuth(t,e,o,r)}}class _a{constructor(t,e){this.myAccountFetcher=t,this.apiBase=e}connectAccount(t){var e=this;return(0,d.A)(function*(){const r=yield e.myAccountFetcher.fetchWithAuth("".concat(e.apiBase,"v1/connected-accounts/connect"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return e._handleResponse(r)})()}completeAccount(t){var e=this;return(0,d.A)(function*(){const r=yield e.myAccountFetcher.fetchWithAuth("".concat(e.apiBase,"v1/connected-accounts/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return e._handleResponse(r)})()}_handleResponse(t){return(0,d.A)(function*(){let e;try{e=yield t.text(),e=JSON.parse(e)}catch(r){throw new qt({type:"invalid_json",status:t.status,title:"Invalid JSON response",detail:e||String(r)})}if(t.ok)return e;throw new qt(e)})()}}class qt extends Error{constructor(t){let{type:e,status:r,title:o,detail:i,validation_errors:a}=t;super(i),this.name="MyAccountApiError",this.type=e,this.status=r,this.title=o,this.detail=i,this.validation_errors=a,Object.setPrototypeOf(this,qt.prototype)}}const va={otp:{authenticatorTypes:["otp"]},sms:{authenticatorTypes:["oob"],oobChannels:["sms"]},email:{authenticatorTypes:["oob"],oobChannels:["email"]},push:{authenticatorTypes:["oob"],oobChannels:["auth0"]},voice:{authenticatorTypes:["oob"],oobChannels:["voice"]}};function Co(n,t){this.v=n,this.k=t}function Y(n,t,e){if("function"==typeof n?n===t:n.has(t))return arguments.length<3?t:e;throw new TypeError("Private element is not present on this object")}function Sa(n){return new Co(n,0)}function Ro(n,t){if(t.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function k(n,t){return n.get(Y(n,t))}function ee(n,t,e){Ro(n,t),t.set(n,e)}function X(n,t,e){return n.set(Y(n,t),e),e}function P(n,t,e){return(t="symbol"==typeof(o=function(i){if("object"!=typeof i||!i)return i;var s=i[Symbol.toPrimitive];if(void 0!==s){var c=s.call(i,"string");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(t))?o:o+"")in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n;var o}function Oo(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),e.push.apply(e,r)}return e}function j(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?Oo(Object(e),!0).forEach(function(r){P(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Oo(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function Do(n,t){if(null==n)return{};var e,r,o=function(a,s){if(null==a)return{};var c={};for(var l in a)if({}.hasOwnProperty.call(a,l)){if(-1!==s.indexOf(l))continue;c[l]=a[l]}return c}(n,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)-1===t.indexOf(e=i[r])&&{}.propertyIsEnumerable.call(n,e)&&(o[e]=n[e])}return o}function Ct(n){var t,e;function r(i,a){try{var s=n[i](a),c=s.value,l=c instanceof Co;Promise.resolve(l?c.v:c).then(function(u){if(l){var h="return"===i?"return":"next";if(!c.k||u.done)return r(h,u);u=n[h](u).value}o(s.done?"return":"normal",u)},function(u){r("throw",u)})}catch(u){o("throw",u)}}function o(i,a){switch(i){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):e=null}this._invoke=function(i,a){return new Promise(function(s,c){var l={key:i,arg:a,resolve:s,reject:c,next:null};e?e=e.next=l:(t=e=l,r(i,a))})},"function"!=typeof n.return&&(this.return=void 0)}var Qt,jn;let Ln;function ft(n,t){if(null==n)return!1;try{return n instanceof t||Object.getPrototypeOf(n)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}function F(n,t,e){const r=new TypeError(n,{cause:e});return Object.assign(r,{code:t}),r}Ct.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Ct.prototype.next=function(n){return this._invoke("next",n)},Ct.prototype.throw=function(n){return this._invoke("throw",n)},Ct.prototype.return=function(n){return this._invoke("return",n)},(typeof navigator>"u"||null===(Qt=navigator.userAgent)||void 0===Qt||null===(jn=Qt.startsWith)||void 0===jn||!jn.call(Qt,"Mozilla/5.0 "))&&(Ln="".concat("oauth4webapi","/").concat("v3.8.3"));const ye=Symbol(),Kn=Symbol(),Mn=Symbol(),we=Symbol(),ka=Symbol(),Ee=Symbol(),Ta=new TextEncoder,xa=new TextDecoder;function gt(n){return"string"==typeof n?Ta.encode(n):xa.decode(n)}let Nn,Uo;function et(n){return"string"==typeof n?Uo(n):Nn(n)}Nn=Uint8Array.prototype.toBase64?n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):t=>{t instanceof ArrayBuffer&&(t=new Uint8Array(t));const e=[];for(let r=0;r<t.byteLength;r+=32768)e.push(String.fromCharCode.apply(null,t.subarray(r,r+32768)));return btoa(e.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},Uo=Uint8Array.fromBase64?n=>{try{return Uint8Array.fromBase64(n,{alphabet:"base64url"})}catch(t){throw F("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",t)}}:n=>{try{const t=atob(n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}catch(t){throw F("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",t)}};class he extends Error{constructor(t,e){var r;super(t,e),P(this,"code",void 0),this.name=this.constructor.name,this.code=nr,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}class Wn extends Error{constructor(t,e){var r;super(t,e),P(this,"code",void 0),this.name=this.constructor.name,null!=e&&e.code&&(this.code=e?.code),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}function K(n,t,e){return new Wn(n,{code:t,cause:e})}function en(n){return null!==n&&"object"==typeof n&&!Array.isArray(n)}function tn(n){ft(n,Headers)&&(n=Object.fromEntries(n.entries()));const t=new Headers(n??{});if(Ln&&!t.has("user-agent")&&t.set("user-agent",Ln),t.has("authorization"))throw F('"options.headers" must not include the "authorization" header name',"ERR_INVALID_ARG_VALUE");return t}function jo(n,t){if(void 0!==t){if("function"==typeof t&&(t=t(n.href)),!(t instanceof AbortSignal))throw F('"options.signal" must return or be an instance of AbortSignal',"ERR_INVALID_ARG_TYPE");return t}}function Lo(n){return n.includes("//")?n.replace("//","/"):n}function zn(){return zn=(0,d.A)(function*(n,t){return(e=(0,d.A)(function*(r,o,i,a){if(!(r instanceof URL))throw F('"'.concat(o,'" must be an instance of URL'),"ERR_INVALID_ARG_TYPE");Jn(r,!0!==a?.[ye]);const s=i(new URL(r.href)),c=tn(a?.headers);return c.set("accept","application/json"),(a?.[we]||fetch)(s.href,{body:void 0,headers:Object.fromEntries(c.entries()),method:"GET",redirect:"manual",signal:jo(s,a?.signal)})}),function(r,o,i,a){return e.apply(this,arguments)})(n,"issuerIdentifier",e=>{switch(t?.algorithm){case void 0:case"oidc":(r=e).pathname=Lo("".concat(r.pathname,"/").concat(".well-known/openid-configuration"));break;case"oauth2":!function(r,o){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r.pathname="/"===r.pathname?o:Lo("".concat(o,"/").concat(i?r.pathname:r.pathname.replace(/(\/)$/,"")))}(e,".well-known/oauth-authorization-server");break;default:throw F('"options.algorithm" must be "oidc" (default), or "oauth2"',"ERR_INVALID_ARG_VALUE")}var r;return e},t);var e}),zn.apply(this,arguments)}function Ne(n,t,e,r,o){try{if("number"!=typeof n||!Number.isFinite(n))throw F("".concat(e," must be a number"),"ERR_INVALID_ARG_TYPE",o);if(n>0)return;if(t){if(0!==n)throw F("".concat(e," must be a non-negative number"),"ERR_INVALID_ARG_VALUE",o);return}throw F("".concat(e," must be a positive number"),"ERR_INVALID_ARG_VALUE",o)}catch(i){throw r?K(i.message,r,o):i}}function $(n,t,e,r){try{if("string"!=typeof n)throw F("".concat(t," must be a string"),"ERR_INVALID_ARG_TYPE",r);if(0===n.length)throw F("".concat(t," must not be empty"),"ERR_INVALID_ARG_VALUE",r)}catch(o){throw e?K(o.message,e,r):o}}function Ko(n){!function(t,e){if(Jo(t)!==e)throw function(r){let o='"response" content-type must be ';for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];if(a.length>2){const c=a.pop();o+="".concat(a.join(", "),", or ").concat(c)}else o+=2===a.length?"".concat(a[0]," or ").concat(a[1]):a[0];return K(o,Bo,r)}(t,e)}(n,"application/json")}function Mo(){return et(crypto.getRandomValues(new Uint8Array(32)))}function Ca(n){switch(n.algorithm.name){case"RSA-PSS":return function(t){switch(t.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new he("unsupported RsaHashedKeyAlgorithm hash name",{cause:t})}}(n);case"RSASSA-PKCS1-v1_5":return function(t){switch(t.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new he("unsupported RsaHashedKeyAlgorithm hash name",{cause:t})}}(n);case"ECDSA":return function(t){switch(t.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new he("unsupported EcKeyAlgorithm namedCurve",{cause:t})}}(n);case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return n.algorithm.name;case"EdDSA":return"Ed25519";default:throw new he("unsupported CryptoKey algorithm name",{cause:n})}}function nn(n){const t=n?.[Kn];return"number"==typeof t&&Number.isFinite(t)?t:0}function Hn(n){const t=n?.[Mn];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function rn(){return Math.floor(Date.now()/1e3)}function be(n){if("object"!=typeof n||null===n)throw F('"as" must be an object',"ERR_INVALID_ARG_TYPE");$(n.issuer,'"as.issuer"')}function Ae(n){if("object"!=typeof n||null===n)throw F('"client" must be an object',"ERR_INVALID_ARG_TYPE");$(n.client_id,'"client.client_id"')}function No(n){return $(n,'"clientSecret"'),(t,e,r,o)=>{r.set("client_id",e.client_id),r.set("client_secret",n)}}const Oa=URL.parse?(n,t)=>URL.parse(n,t):(n,t)=>{try{return new URL(n,t)}catch{return null}};function Jn(n,t){if(t&&"https:"!==n.protocol)throw K("only requests to HTTPS are allowed",Go,n);if("https:"!==n.protocol&&"http:"!==n.protocol)throw K("only HTTP and HTTPS requests are allowed",Zo,n)}function Rt(n,t,e,r){return function Wo(n,t,e,r){let o;if("string"!=typeof n||!(o=Oa(n)))throw K("authorization server metadata does not contain a valid ".concat(e?'"as.mtls_endpoint_aliases.'.concat(t,'"'):'"as.'.concat(t,'"')),void 0===n?Ga:Za,{attribute:e?"mtls_endpoint_aliases.".concat(t):t});return Jn(o,r),o}(e&&n.mtls_endpoint_aliases&&t in n.mtls_endpoint_aliases?n.mtls_endpoint_aliases[t]:n[t],t,e,r)}class on extends Error{constructor(t,e){var r;super(t,e),P(this,"cause",void 0),P(this,"code",void 0),P(this,"error",void 0),P(this,"status",void 0),P(this,"error_description",void 0),P(this,"response",void 0),this.name=this.constructor.name,this.code=Va,this.cause=e.cause,this.error=e.cause.error,this.status=e.response.status,this.error_description=e.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:e.response}),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}class zo extends Error{constructor(t,e){var r,o;super(t,e),P(this,"cause",void 0),P(this,"code",void 0),P(this,"error",void 0),P(this,"error_description",void 0),this.name=this.constructor.name,this.code=Ba,this.cause=e.cause,this.error=e.cause.get("error"),this.error_description=null!==(r=e.cause.get("error_description"))&&void 0!==r?r:void 0,null===(o=Error.captureStackTrace)||void 0===o||o.call(Error,this,this.constructor)}}class Fn extends Error{constructor(t,e){var r;super(t,e),P(this,"cause",void 0),P(this,"code",void 0),P(this,"response",void 0),P(this,"status",void 0),this.name=this.constructor.name,this.code=Fa,this.cause=e.cause,this.status=e.response.status,this.response=e.response,Object.defineProperty(this,"response",{enumerable:!1}),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}const Ua=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)"),ja=new RegExp('^[,\\s]*([a-zA-Z0-9!#$%&\\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),La=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)[,\\s]*(.*)"),Ka=new RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");function Vn(n,t,e){return Bn.apply(this,arguments)}function Bn(){return Bn=(0,d.A)(function*(n,t,e){if(n.status!==t){let o;var r;throw function(i){let a;if(a=function(s){if(!ft(s,Response))throw F('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");const c=s.headers.get("www-authenticate");if(null===c)return;const l=[];let u=c;for(;u;){var h;let g=u.match(Ua);const p=null===(h=g)||void 0===h?void 0:h[1].toLowerCase();if(!p)return;const y=u.substring(g[0].length);if(y&&!y.match(/^[\s,]/))return;const v=y.match(/^\s+(.*)$/);u=v?v[1]:void 0;const _={};let b;if(v)for(;u;){let U,A;if(g=u.match(ja)){if([,U,A,u]=g,A.includes("\\"))try{A=JSON.parse('"'.concat(A,'"'))}catch{}_[U.toLowerCase()]=A}else{if(!(g=u.match(La))){if(g=u.match(Ka)){if(Object.keys(_).length)break;[,b,u]=g;break}return}[,U,A,u]=g,_[U.toLowerCase()]=A}}else u=y||void 0;const T={scheme:p,parameters:_};b&&(T.token68=b),l.push(T)}return l.length?l:void 0}(i))throw new Fn("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:a,response:i})}(n),(o=yield(i=(0,d.A)(function*(a){if(a.status>399&&a.status<500){Ut(a),Ko(a);try{const s=yield a.clone().json();if(en(s)&&"string"==typeof s.error&&s.error.length)return s}catch{}}}),function(a){return i.apply(this,arguments)})(n))?(yield null===(r=n.body)||void 0===r?void 0:r.cancel(),new on("server responded with an error in the response body",{cause:o,response:n})):K('"response" is not a conform '.concat(e," response (unexpected HTTP status code)"),rr,n)}var i}),Bn.apply(this,arguments)}function Ho(n){if(!qn.has(n))throw F('"options.DPoP" is not a valid DPoPHandle',"ERR_INVALID_ARG_VALUE")}function Jo(n){var t;return null===(t=n.headers.get("content-type"))||void 0===t?void 0:t.split(";")[0]}function Gn(n,t,e,r,o,i,a){return Zn.apply(this,arguments)}function Zn(){return Zn=(0,d.A)(function*(n,t,e,r,o,i,a){return yield e(n,t,o,i),i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(a?.[we]||fetch)(r.href,{body:o,headers:Object.fromEntries(i.entries()),method:"POST",redirect:"manual",signal:jo(r,a?.signal)})}),Zn.apply(this,arguments)}function Ot(n,t,e,r,o,i){return Xn.apply(this,arguments)}function Xn(){return Xn=(0,d.A)(function*(n,t,e,r,o,i){var a;const s=Rt(n,"token_endpoint",t.use_mtls_endpoint_aliases,!0!==i?.[ye]);o.set("grant_type",r);const c=tn(i?.headers);c.set("accept","application/json"),void 0!==i?.DPoP&&(Ho(i.DPoP),yield i.DPoP.addProof(s,c,"POST"));const l=yield Gn(n,t,e,s,o,c,i);return null==i||null===(a=i.DPoP)||void 0===a||a.cacheNonce(l,s),l}),Xn.apply(this,arguments)}const Fo=new WeakMap,Ma=new WeakMap;function Yn(n){if(!n.id_token)return;const t=Fo.get(n);if(!t)throw F('"ref" was already garbage collected or did not resolve from the proper sources',"ERR_INVALID_ARG_VALUE");return t}function yt(n,t,e,r,o,i){return $n.apply(this,arguments)}function $n(){return $n=(0,d.A)(function*(n,t,e,r,o,i){if(be(n),Ae(t),!ft(e,Response))throw F('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield Vn(e,200,"Token Endpoint"),Ut(e);const a=yield sn(e);if($(a.access_token,'"response" body "access_token" property',H,{body:a}),$(a.token_type,'"response" body "token_type" property',H,{body:a}),a.token_type=a.token_type.toLowerCase(),void 0!==a.expires_in){let s="number"!=typeof a.expires_in?parseFloat(a.expires_in):a.expires_in;Ne(s,!0,'"response" body "expires_in" property',H,{body:a}),a.expires_in=s}if(void 0!==a.refresh_token&&$(a.refresh_token,'"response" body "refresh_token" property',H,{body:a}),void 0!==a.scope&&"string"!=typeof a.scope)throw K('"response" body "scope" property must be a string',H,{body:a});if(void 0!==a.id_token){$(a.id_token,'"response" body "id_token" property',H,{body:a});const s=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&s.push("auth_time"),void 0!==t.default_max_age&&(Ne(t.default_max_age,!0,'"client.default_max_age"'),s.push("auth_time")),null!=r&&r.length&&s.push(...r);const{claims:c,jwt:l}=yield(u=(0,d.A)(function*(h,g,p,y,v){let f,_,{0:b,1:T,length:U}=h.split(".");if(5===U){if(void 0===v)throw new he("JWE decryption is not configured",{cause:h});h=yield v(h),({0:b,1:T,length:U}=h.split("."))}if(3!==U)throw K("Invalid JWT",H,h);try{f=JSON.parse(gt(et(b)))}catch(N){throw K("failed to parse JWT Header body as base64url encoded JSON",an,N)}if(!en(f))throw K("JWT Header must be a top level object",H,h);if(g(f),void 0!==f.crit)throw new he('no JWT "crit" header parameter extensions are supported',{cause:{header:f}});try{_=JSON.parse(gt(et(T)))}catch(N){throw K("failed to parse JWT Payload body as base64url encoded JSON",an,N)}if(!en(_))throw K("JWT Payload must be a top level object",H,h);const A=rn()+p;if(void 0!==_.exp){if("number"!=typeof _.exp)throw K('unexpected JWT "exp" (expiration time) claim type',H,{claims:_});if(_.exp<=A-y)throw K('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',Dt,{claims:_,now:A,tolerance:y,claim:"exp"})}if(void 0!==_.iat&&"number"!=typeof _.iat)throw K('unexpected JWT "iat" (issued at) claim type',H,{claims:_});if(void 0!==_.iss&&"string"!=typeof _.iss)throw K('unexpected JWT "iss" (issuer) claim type',H,{claims:_});if(void 0!==_.nbf){if("number"!=typeof _.nbf)throw K('unexpected JWT "nbf" (not before) claim type',H,{claims:_});if(_.nbf>A+y)throw K('unexpected JWT "nbf" (not before) claim value',Dt,{claims:_,now:A,tolerance:y,claim:"nbf"})}if(void 0!==_.aud&&"string"!=typeof _.aud&&!Array.isArray(_.aud))throw K('unexpected JWT "aud" (audience) claim type',H,{claims:_});return{header:f,claims:_,jwt:h}}),function(h,g,p,y,v){return u.apply(this,arguments)})(a.id_token,$a.bind(void 0,t.id_token_signed_response_alg,n.id_token_signing_alg_values_supported,"RS256"),nn(t),Hn(t),o).then(Ha.bind(void 0,s)).then(Wa.bind(void 0,n)).then(Na.bind(void 0,t.client_id));if(Array.isArray(c.aud)&&1!==c.aud.length){if(void 0===c.azp)throw K('ID Token "aud" (audience) claim includes additional untrusted audiences',De,{claims:c,claim:"aud"});if(c.azp!==t.client_id)throw K('unexpected ID Token "azp" (authorized party) claim value',De,{expected:t.client_id,claims:c,claim:"azp"})}void 0!==c.auth_time&&Ne(c.auth_time,!0,'ID Token "auth_time" (authentication time)',H,{claims:c}),Ma.set(e,l),Fo.set(a,c)}var u;if(void 0!==i?.[a.token_type])i[a.token_type](e,a);else if("dpop"!==a.token_type&&"bearer"!==a.token_type)throw new he("unsupported `token_type` value",{cause:{body:a}});return a}),$n.apply(this,arguments)}function Na(n,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(n))throw K('unexpected JWT "aud" (audience) claim value',De,{expected:n,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==n)throw K('unexpected JWT "aud" (audience) claim value',De,{expected:n,claims:t.claims,claim:"aud"});return t}function Wa(n,t){var e,r;const o=null!==(e=null===(r=n[Yo])||void 0===r?void 0:r.call(n,t))&&void 0!==e?e:n.issuer;if(t.claims.iss!==o)throw K('unexpected JWT "iss" (issuer) claim value',De,{expected:o,claims:t.claims,claim:"iss"});return t}const qn=new WeakSet,Vo=Symbol(),za={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function Ha(n,t){for(const e of n)if(void 0===t.claims[e])throw K('JWT "'.concat(e,'" (').concat(za[e],") claim missing"),H,{claims:t.claims});return t}const Qn=Symbol(),er=Symbol();function tr(){return tr=(0,d.A)(function*(n,t,e,r){return"string"==typeof r?.expectedNonce||"number"==typeof r?.maxAge||null!=r&&r.requireIdToken?(o=(0,d.A)(function*(i,a,s,c,l,u,h){const g=[];switch(c){case void 0:c=Qn;break;case Qn:break;default:$(c,'"expectedNonce" argument'),g.push("nonce")}switch(null!=l||(l=a.default_max_age),l){case void 0:l=er;break;case er:break;default:Ne(l,!0,'"maxAge" argument'),g.push("auth_time")}const p=yield yt(i,a,s,g,u,h);$(p.id_token,'"response" body "id_token" property',H,{body:p});const y=Yn(p);if(l!==er){const v=rn()+nn(a),f=Hn(a);if(y.auth_time+l<v-f)throw K("too much time has elapsed since the last End-User authentication",Dt,{claims:y,now:v,tolerance:f,claim:"auth_time"})}if(c===Qn){if(void 0!==y.nonce)throw K('unexpected ID Token "nonce" claim value',De,{expected:void 0,claims:y,claim:"nonce"})}else if(y.nonce!==c)throw K('unexpected ID Token "nonce" claim value',De,{expected:c,claims:y,claim:"nonce"});return p}),function(i,a,s,c,l,u,h){return o.apply(this,arguments)})(n,t,e,r.expectedNonce,r.maxAge,r[Ee],r.recognizedTokenTypes):function(){var o=(0,d.A)(function*(i,a,s,c,l){const u=yield yt(i,a,s,void 0,c,l),h=Yn(u);if(h){if(void 0!==a.default_max_age){Ne(a.default_max_age,!0,'"client.default_max_age"');const g=rn()+nn(a),p=Hn(a);if(h.auth_time+a.default_max_age<g-p)throw K("too much time has elapsed since the last End-User authentication",Dt,{claims:h,now:g,tolerance:p,claim:"auth_time"})}if(void 0!==h.nonce)throw K('unexpected ID Token "nonce" claim value',De,{expected:void 0,claims:h,claim:"nonce"})}return u});return function(i,a,s,c,l){return o.apply(this,arguments)}}()(n,t,e,r?.[Ee],r?.recognizedTokenTypes);var o}),tr.apply(this,arguments)}const Fa="OAUTH_WWW_AUTHENTICATE_CHALLENGE",Va="OAUTH_RESPONSE_BODY_ERROR",nr="OAUTH_UNSUPPORTED_OPERATION",Ba="OAUTH_AUTHORIZATION_RESPONSE_ERROR",an="OAUTH_PARSE_ERROR",H="OAUTH_INVALID_RESPONSE",Bo="OAUTH_RESPONSE_IS_NOT_JSON",rr="OAUTH_RESPONSE_IS_NOT_CONFORM",Go="OAUTH_HTTP_REQUEST_FORBIDDEN",Zo="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",Dt="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",De="OAUTH_JWT_CLAIM_COMPARISON_FAILED",or="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",Ga="OAUTH_MISSING_SERVER_METADATA",Za="OAUTH_INVALID_SERVER_METADATA";function Ut(n){if(n.bodyUsed)throw F('"response" body has been used already',"ERR_INVALID_ARG_VALUE")}function Xo(n){const{algorithm:t}=n;if("number"!=typeof t.modulusLength||t.modulusLength<2048)throw new he("unsupported ".concat(t.name," modulusLength"),{cause:n})}function Xa(n){const{algorithm:t}=n;switch(t.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new he("unsupported ECDSA namedCurve",{cause:n})}}function ir(){return ir=(0,d.A)(function*(n){if("POST"!==n.method)throw F("form_post responses are expected to use the POST method","ERR_INVALID_ARG_VALUE",{cause:n});if("application/x-www-form-urlencoded"!==Jo(n))throw F("form_post responses are expected to use the application/x-www-form-urlencoded content-type","ERR_INVALID_ARG_VALUE",{cause:n});return(t=(0,d.A)(function*(e){if(e.bodyUsed)throw F("form_post Request instances must contain a readable body","ERR_INVALID_ARG_VALUE",{cause:e});return e.text()}),function(e){return t.apply(this,arguments)})(n);var t}),ir.apply(this,arguments)}function $a(n,t,e,r){if(void 0===n)if(Array.isArray(t)){if(!t.includes(r.alg))throw K('unexpected JWT "alg" header parameter',H,{header:r,expected:t,reason:"authorization server metadata"})}else{if(void 0===e)throw K('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:n,issuer:t,fallback:e});if("string"==typeof e?r.alg!==e:"function"==typeof e?!e(r.alg):!e.includes(r.alg))throw K('unexpected JWT "alg" header parameter',H,{header:r,expected:e,reason:"default value"})}else if("string"==typeof n?r.alg!==n:!n.includes(r.alg))throw K('unexpected JWT "alg" header parameter',H,{header:r,expected:n,reason:"client configuration"})}function tt(n,t){const{0:e,length:r}=n.getAll(t);if(r>1)throw K('"'.concat(t,'" parameter must be provided only once'),H);return e}const qa=Symbol(),Qa=Symbol();function sn(n){return ar.apply(this,arguments)}function ar(){return ar=(0,d.A)(function*(n){let t,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ko;try{t=yield n.json()}catch(r){throw e(n),K('failed to parse "response" body as JSON',an,r)}if(!en(t))throw K('"response" body must be a top level object',H,{body:t});return t}),ar.apply(this,arguments)}const sr=Symbol(),Yo=Symbol(),$o=new TextEncoder,jt=new TextDecoder;function cr(n){const t=new Uint8Array(n.length);for(let e=0;e<n.length;e++){const r=n.charCodeAt(e);if(r>127)throw new TypeError("non-ASCII string encountered in encode()");t[e]=r}return t}function qo(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(n);const t=atob(n),e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function Lt(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof n?n:jt.decode(n),{alphabet:"base64url"});let t=n;t instanceof Uint8Array&&(t=jt.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return qo(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}class re extends Error{constructor(t,e){var r;super(t,e),P(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}P(re,"code","ERR_JOSE_GENERIC");class Se extends re{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(t,{cause:{claim:r,reason:o,payload:e}}),P(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),P(this,"claim",void 0),P(this,"reason",void 0),P(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=e}}P(Se,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class ur extends re{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(t,{cause:{claim:r,reason:o,payload:e}}),P(this,"code","ERR_JWT_EXPIRED"),P(this,"claim",void 0),P(this,"reason",void 0),P(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=e}}P(ur,"code","ERR_JWT_EXPIRED");class Qo extends re{constructor(){super(...arguments),P(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}P(Qo,"code","ERR_JOSE_ALG_NOT_ALLOWED");class pe extends re{constructor(){super(...arguments),P(this,"code","ERR_JOSE_NOT_SUPPORTED")}}P(pe,"code","ERR_JOSE_NOT_SUPPORTED"),P(class extends re{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"decryption operation failed",arguments.length>1?arguments[1]:void 0),P(this,"code","ERR_JWE_DECRYPTION_FAILED")}},"code","ERR_JWE_DECRYPTION_FAILED"),P(class extends re{constructor(){super(...arguments),P(this,"code","ERR_JWE_INVALID")}},"code","ERR_JWE_INVALID");class te extends re{constructor(){super(...arguments),P(this,"code","ERR_JWS_INVALID")}}P(te,"code","ERR_JWS_INVALID");class lr extends re{constructor(){super(...arguments),P(this,"code","ERR_JWT_INVALID")}}P(lr,"code","ERR_JWT_INVALID"),P(class extends re{constructor(){super(...arguments),P(this,"code","ERR_JWK_INVALID")}},"code","ERR_JWK_INVALID");class dr extends re{constructor(){super(...arguments),P(this,"code","ERR_JWKS_INVALID")}}P(dr,"code","ERR_JWKS_INVALID");class hr extends re{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no applicable key found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),P(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}P(hr,"code","ERR_JWKS_NO_MATCHING_KEY");class ei extends re{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"multiple matching keys found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),P(this,Symbol.asyncIterator,void 0),P(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}P(ei,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class ti extends re{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"request timed out",arguments.length>1?arguments[1]:void 0),P(this,"code","ERR_JWKS_TIMEOUT")}}P(ti,"code","ERR_JWKS_TIMEOUT");class ni extends re{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"signature verification failed",arguments.length>1?arguments[1]:void 0),P(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}P(ni,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const ke=function(n){return new TypeError("CryptoKey does not support this operation, its ".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"algorithm.name"," must be ").concat(n))},_t=(n,t)=>n.name===t;function pr(n){return parseInt(n.name.slice(4),10)}function ri(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];if((r=r.filter(Boolean)).length>2){const a=r.pop();n+="one of type ".concat(r.join(", "),", or ").concat(a,".")}else n+=2===r.length?"one of type ".concat(r[0]," or ").concat(r[1],"."):"of type ".concat(r[0],".");if(null==t)n+=" Received ".concat(t);else if("function"==typeof t&&t.name)n+=" Received function ".concat(t.name);else if("object"==typeof t&&null!=t){var i;null!==(i=t.constructor)&&void 0!==i&&i.name&&(n+=" Received an instance of ".concat(t.constructor.name))}return n}const oi=function(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];return ri("Key for the ".concat(n," algorithm must be "),t,...r)},ii=n=>{if("CryptoKey"===n?.[Symbol.toStringTag])return!0;try{return n instanceof CryptoKey}catch{return!1}},ai=n=>"KeyObject"===n?.[Symbol.toStringTag],si=n=>ii(n)||ai(n);function We(n){if("object"!=typeof(t=n)||null===t||"[object Object]"!==Object.prototype.toString.call(n))return!1;var t;if(null===Object.getPrototypeOf(n))return!0;let e=n;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const mr=(n,t)=>{if(n.byteLength!==t.length)return!1;for(let e=0;e<n.byteLength;e++)if(n[e]!==t[e])return!1;return!0},Kt=n=>{const t=n.data[n.pos++];if(128&t){const e=127&t;let r=0;for(let o=0;o<e;o++)r=r<<8|n.data[n.pos++];return r}return t},Mt=(n,t,e)=>{if(n.data[n.pos++]!==t)throw new Error(e)},ci=(n,t)=>{const e=n.data.subarray(n.pos,n.pos+t);return n.pos+=t,e},rs=function(){var n=(0,d.A)(function*(t,e,r,o){var i;let a,s;const c="spki"===t,l=()=>c?["verify"]:["sign"];switch(r){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:"SHA-".concat(r.slice(-3))},s=l();break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(r.slice(-3))},s=l();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(r.slice(-3),10)||1)},s=c?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":a={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[r]},s=l();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{const u=o.getNamedCurve(e);a="X25519"===u?{name:"X25519"}:{name:"ECDH",namedCurve:u}}catch{throw new pe("Invalid or unsupported key format")}s=c?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":a={name:"Ed25519"},s=l();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":a={name:r},s=l();break;default:throw new pe('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(t,e,a,null!==(i=o?.extractable)&&void 0!==i?i:!!c,s)});return function(e,r,o,i){return n.apply(this,arguments)}}(),os=(n,t,e)=>{var r;const o=qo(n.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""));let i=e;return null!=t&&null!==(r=t.startsWith)&&void 0!==r&&r.call(t,"ECDH-ES")&&(i||(i={}),i.getNamedCurve=a=>{const s={data:a,pos:0};return function(c){Mt(c,48,"Invalid PKCS#8 structure"),Kt(c),Mt(c,2,"Expected version field");const l=Kt(c);c.pos+=l,Mt(c,48,"Expected algorithm identifier"),Kt(c)}(s),(n=>{const t=(o=>{Mt(o,6,"Expected algorithm OID");const i=Kt(o);return ci(o,i)})(n);if(mr(t,[43,101,110]))return"X25519";if(!mr(t,[42,134,72,206,61,2,1]))throw new Error("Unsupported key algorithm");Mt(n,6,"Expected curve OID");const e=Kt(n),r=ci(n,e);for(const{name:o,oid:i}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(mr(r,i))return o;throw new Error("Unsupported named curve")})(s)}),rs("pkcs8",o,t,i)};function cn(n){return fr.apply(this,arguments)}function fr(){return fr=(0,d.A)(function*(n){var t,e;if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:r,keyUsages:o}=function(a){let s,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":s={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:"SHA-".concat(a.alg.slice(-3))},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(a.alg.slice(-3))},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(a.alg.slice(-3),10)||1)},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":s={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":s={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new pe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:s,keyUsages:c}}(n),i=j({},n);return"AKP"!==i.kty&&delete i.alg,delete i.use,crypto.subtle.importKey("jwk",i,r,null!==(t=n.ext)&&void 0!==t?t:!n.d&&!n.priv,null!==(e=n.key_ops)&&void 0!==e?e:o)}),fr.apply(this,arguments)}const gr=n=>We(n)&&"string"==typeof n.kty;let ze;const ui=function(){var n=(0,d.A)(function*(t,e,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];ze||(ze=new WeakMap);let i=ze.get(t);if(null!=i&&i[r])return i[r];const a=yield cn(j(j({},e),{},{alg:r}));return o&&Object.freeze(t),i?i[r]=a:ze.set(t,{[r]:a}),a});return function(e,r,o){return n.apply(this,arguments)}}();function yr(){return yr=(0,d.A)(function*(n,t){if(n instanceof Uint8Array||ii(n))return n;if(ai(n)){if("secret"===n.type)return n.export();if("toCryptoKey"in n&&"function"==typeof n.toCryptoKey)try{return((r,o)=>{ze||(ze=new WeakMap);let i=ze.get(r);if(null!=i&&i[o])return i[o];const a="public"===r.type,s=!!a;let c;if("x25519"===r.asymmetricKeyType){switch(o){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}c=r.toCryptoKey(r.asymmetricKeyType,s,a?[]:["deriveBits"])}if("ed25519"===r.asymmetricKeyType){if("EdDSA"!==o&&"Ed25519"!==o)throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,s,[a?"verify":"sign"])}switch(r.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(o!==r.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,s,[a?"verify":"sign"])}if("rsa"===r.asymmetricKeyType){let u;switch(o){case"RSA-OAEP":u="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":u="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":u="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":u="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(o.startsWith("RSA-OAEP"))return r.toCryptoKey({name:"RSA-OAEP",hash:u},s,a?["encrypt"]:["decrypt"]);c=r.toCryptoKey({name:o.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:u},s,[a?"verify":"sign"])}if("ec"===r.asymmetricKeyType){var l;const u=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(null===(l=r.asymmetricKeyDetails)||void 0===l?void 0:l.namedCurve);if(!u)throw new TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===o&&"P-256"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),"ES384"===o&&"P-384"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),"ES512"===o&&"P-521"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),o.startsWith("ECDH-ES")&&(c=r.toCryptoKey({name:"ECDH",namedCurve:u},s,a?[]:["deriveBits"]))}if(!c)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return i?i[o]=c:ze.set(r,{[o]:c}),c})(n,t)}catch(r){if(r instanceof TypeError)throw r}let e=n.export({format:"jwk"});return ui(n,e,t)}if(gr(n))return n.k?Lt(n.k):ui(n,n,t,!0);throw new Error("unreachable")}),yr.apply(this,arguments)}const vt=n=>n?.[Symbol.toStringTag],_r=(n,t,e)=>{if(void 0!==t.use){let i;switch(e){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc"}if(t.use!==i)throw new TypeError('Invalid key for this operation, its "use" must be "'.concat(i,'" when present'))}if(void 0!==t.alg&&t.alg!==n)throw new TypeError('Invalid key for this operation, its "alg" must be "'.concat(n,'" when present'));if(Array.isArray(t.key_ops)){var r,o;let i;switch(!0){case"sign"===e||"verify"===e:case"dir"===n:case n.includes("CBC-HS"):i=e;break;case n.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(n):i=!n.includes("GCM")&&n.endsWith("KW")?"encrypt"===e?"wrapKey":"unwrapKey":e;break;case"encrypt"===e&&n.startsWith("RSA"):i="wrapKey";break;case"decrypt"===e:i=n.startsWith("RSA")?"unwrapKey":"deriveBits"}if(i&&!1===(null===(r=t.key_ops)||void 0===r||null===(o=r.includes)||void 0===o?void 0:o.call(r,i)))throw new TypeError('Invalid key for this operation, its "key_ops" must include "'.concat(i,'" when present'))}return!0};var un,vr;let Te,li;(typeof navigator>"u"||null===(un=navigator.userAgent)||void 0===un||null===(vr=un.startsWith)||void 0===vr||!vr.call(un,"Mozilla/5.0 "))&&(li="".concat("openid-client","/").concat("v6.8.1"),Te={"user-agent":li});const oe=n=>ln.get(n);let ln,dn;function di(n){return void 0!==n?No(n):(dn||(dn=new WeakMap),(t,e,r,o)=>{let i;return(i=dn.get(e))||(function(a,s){if("string"!=typeof a)throw xe("".concat(s," must be a string"),Wt);if(0===a.length)throw xe("".concat(s," must not be empty"),Nt)}(e.client_secret,'"metadata.client_secret"'),i=No(e.client_secret),dn.set(e,i)),i(t,e,r,o)})}const He=we,Nt="ERR_INVALID_ARG_VALUE",Wt="ERR_INVALID_ARG_TYPE";function xe(n,t,e){const r=new TypeError(n,{cause:e});return Object.assign(r,{code:t}),r}class hn extends Error{constructor(t,e){var r;super(t,e),P(this,"code",void 0),this.name=this.constructor.name,this.code=e?.code,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}function se(n,t,e){return new hn(n,{cause:t,code:e})}function ce(n){if(n instanceof TypeError||n instanceof hn||n instanceof on||n instanceof zo||n instanceof Fn)throw n;if(n instanceof Wn)switch(n.code){case Go:throw se("only requests to HTTPS are allowed",n,n.code);case Zo:throw se("only requests to HTTP or HTTPS are allowed",n,n.code);case rr:throw se("unexpected HTTP response status code",n.cause,n.code);case Bo:throw se("unexpected response content-type",n.cause,n.code);case an:throw se("parsing error occured",n,n.code);case H:throw se("invalid response encountered",n,n.code);case De:throw se("unexpected JWT claim value encountered",n,n.code);case or:throw se("unexpected JSON attribute value encountered",n,n.code);case Dt:throw se("JWT timestamp claim value failed validation",n,n.code);default:throw se(n.message,n,n.code)}if(n instanceof he)throw se("unsupported operation",n,n.code);if(n instanceof DOMException)switch(n.name){case"OperationError":throw se("runtime operation error",n,nr);case"NotSupportedError":throw se("runtime unsupported operation",n,nr);case"TimeoutError":throw se("operation timed out",n,"OAUTH_TIMEOUT");case"AbortError":throw se("operation aborted",n,"OAUTH_ABORT")}throw new hn("something went wrong",{cause:n})}function wr(){return wr=(0,d.A)(function*(n,t,e,r,o){const i=yield(c=(0,d.A)(function*(l,u){var h,g;if(!(l instanceof URL))throw xe('"server" must be an instance of URL',Wt);const p=!l.href.includes("/.well-known/"),y=null!==(h=u?.timeout)&&void 0!==h?h:30,v=AbortSignal.timeout(1e3*y),f=yield(p?function Pa(n,t){return zn.apply(this,arguments)}(l,{algorithm:u?.algorithm,[we]:u?.[He],[ye]:null==u||null===(g=u.execute)||void 0===g?void 0:g.includes(yi),signal:v,headers:new Headers(Te)}):(u?.[He]||fetch)((Jn(l,null==u||null===(_=u.execute)||void 0===_||!_.includes(yi)),l.href),{headers:Object.fromEntries(new Headers(j({accept:"application/json"},Te)).entries()),body:void 0,method:"GET",redirect:"manual",signal:v})).then(b=>{return(T=(0,d.A)(function*(U,A){const N=U;if(!(N instanceof URL)&&N!==sr)throw F('"expectedIssuerIdentifier" must be an instance of URL',"ERR_INVALID_ARG_TYPE");if(!ft(A,Response))throw F('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");if(200!==A.status)throw K('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',rr,A);Ut(A);const J=yield sn(A);if($(J.issuer,'"response" body "issuer" property',H,{body:J}),N!==sr&&new URL(J.issuer).href!==N.href)throw K('"response" body "issuer" property does not match the expected value',or,{expected:N.href,body:J,attribute:"issuer"});return J}),function(U,A){return T.apply(this,arguments)})(sr,b);var T}).catch(ce);var _,U;return p&&new URL(f.issuer).href!==l.href&&(U=u,!("https://login.microsoftonline.com"!==l.origin||null!=U&&U.algorithm&&"oidc"!==U.algorithm||(f[hi]=!0,0))||function(b,T){return!(!b.hostname.endsWith(".b2clogin.com")||null!=T&&T.algorithm&&"oidc"!==T.algorithm)}(l,u)||(()=>{throw new hn("discovered metadata issuer does not match the expected issuer",{code:or,cause:{expected:l.href,body:f,attribute:"issuer"}})})()),f}),function(l,u){return c.apply(this,arguments)})(n,o),a=new pn(i,t,e,r);var c;let s=oe(a);if(null!=o&&o[He]&&(s.fetch=o[He]),null!=o&&o.timeout&&(s.timeout=o.timeout),null!=o&&o.execute)for(const c of o.execute)c(a);return a}),wr.apply(this,arguments)}new TextDecoder;const hi=Symbol();class pn{constructor(t,e,r,o){var i,a,s,c,l;if("string"!=typeof e||!e.length)throw xe('"clientId" must be a non-empty string',Wt);if("string"==typeof r&&(r={client_secret:r}),void 0!==(null===(i=r)||void 0===i?void 0:i.client_id)&&e!==r.client_id)throw xe('"clientId" and "metadata.client_id" must be the same',Nt);const u=j(j({},structuredClone(r)),{},{client_id:e});let h;u[Kn]=null!==(a=null===(s=r)||void 0===s?void 0:s[Kn])&&void 0!==a?a:0,u[Mn]=null!==(c=null===(l=r)||void 0===l?void 0:l[Mn])&&void 0!==c?c:30,h=o||("string"==typeof u.client_secret&&u.client_secret.length?di(u.client_secret):(v,f,_,b)=>{_.set("client_id",f.client_id)});let g=Object.freeze(u);const p=structuredClone(t);hi in t&&(p[Yo]=v=>{let{claims:{tid:f}}=v;return t.issuer.replace("{tenantid}",f)});let y=Object.freeze(p);ln||(ln=new WeakMap),ln.set(this,{__proto__:null,as:y,c:g,auth:h,tlsOnly:!0,jwksCache:{}})}serverMetadata(){const t=structuredClone(oe(this).as);return e=t,Object.defineProperties(e,function(r){return{supportsPKCE:{__proto__:null,value(){var o;return!0===(null===(o=r.code_challenge_methods_supported)||void 0===o?void 0:o.includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"S256"))}}}}(e)),t;var e}clientMetadata(){return structuredClone(oe(this).c)}get timeout(){return oe(this).timeout}set timeout(t){oe(this).timeout=t}get[He](){return oe(this).fetch}set[He](t){oe(this).fetch=t}}function zt(n){Object.defineProperties(n,function(t){let e;if(void 0!==t.expires_in){const r=new Date;r.setSeconds(r.getSeconds()+t.expires_in),e=r.getTime()}return{expiresIn:{__proto__:null,value(){if(e){const r=Date.now();return e>r?Math.floor((e-r)/1e3):0}}},claims:{__proto__:null,value(){try{return Yn(this)}catch{return}}}}}(n))}function pi(n,t,e){return br.apply(this,arguments)}function br(){return br=(0,d.A)(function*(n,t,e){var r;let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=null===(r=n.headers.get("retry-after"))||void 0===r?void 0:r.trim();if(void 0===i)return;let a;if(/^\d+$/.test(i))a=parseInt(i,10);else{const s=new Date(i);if(Number.isFinite(s.getTime())){const c=new Date,l=s.getTime()-c.getTime();l>0&&(a=Math.ceil(l/1e3))}}if(o&&!Number.isFinite(a))throw new Wn("invalid Retry-After header value",{cause:n});a>t&&(yield mi(a-t,e))}),br.apply(this,arguments)}function mi(n,t){return new Promise((e,r)=>{const o=i=>{try{t.throwIfAborted()}catch(s){return void r(s)}if(i<=0)return void e();const a=Math.min(i,5);setTimeout(()=>o(i-a),1e3*a)};o(n)})}function fi(n,t){return Ar.apply(this,arguments)}function Ar(){return Ar=(0,d.A)(function*(n,t){Ue(n);const{as:e,c:r,auth:o,fetch:i,tlsOnly:a,timeout:s}=oe(n);return(c=(0,d.A)(function*(l,u,h,g,p){be(l),Ae(u);const y=Rt(l,"backchannel_authentication_endpoint",u.use_mtls_endpoint_aliases,!0!==p?.[ye]),v=new URLSearchParams(g);v.set("client_id",u.client_id);const f=tn(p?.headers);return f.set("accept","application/json"),Gn(l,u,h,y,v,f,p)}),function(l,u,h,g,p){return c.apply(this,arguments)})(e,r,o,t,{[we]:i,[ye]:!a,headers:new Headers(Te),signal:nt(s)}).then(c=>{return(l=(0,d.A)(function*(u,h,g){if(be(u),Ae(h),!ft(g,Response))throw F('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield Vn(g,200,"Backchannel Authentication Endpoint"),Ut(g);const p=yield sn(g);$(p.auth_req_id,'"response" body "auth_req_id" property',H,{body:p});let y="number"!=typeof p.expires_in?parseFloat(p.expires_in):p.expires_in;return Ne(y,!0,'"response" body "expires_in" property',H,{body:p}),p.expires_in=y,void 0!==p.interval&&Ne(p.interval,!1,'"response" body "interval" property',H,{body:p}),p}),function(u,h,g){return l.apply(this,arguments)})(e,r,c);var l}).catch(ce);var c}),Ar.apply(this,arguments)}function gi(n,t,e,r){return Sr.apply(this,arguments)}function Sr(){return Sr=(0,d.A)(function*(n,t,e,r){var o,i;Ue(n),e=new URLSearchParams(e);let a=null!==(o=t.interval)&&void 0!==o?o:5;const s=null!==(i=r?.signal)&&void 0!==i?i:AbortSignal.timeout(1e3*t.expires_in);try{yield mi(a,s)}catch(A){ce(A)}const{as:c,c:l,auth:u,fetch:h,tlsOnly:g,nonRepudiation:p,timeout:y,decrypt:v}=oe(n),f=(A,N)=>gi(n,j(j({},t),{},{interval:A}),e,j(j({},r),{},{signal:s,flag:N})),_=yield(A=(0,d.A)(function*(N,J,me,ne,Oe){be(N),Ae(J),$(ne,'"authReqId"');const le=new URLSearchParams(Oe?.additionalParameters);return le.set("auth_req_id",ne),Ot(N,J,me,"urn:openid:params:grant-type:ciba",le,Oe)}),function(N,J,me,ne,Oe){return A.apply(this,arguments)})(c,l,u,t.auth_req_id,{[we]:h,[ye]:!g,additionalParameters:e,DPoP:r?.DPoP,headers:new Headers(Te),signal:s.aborted?s:nt(y)}).catch(ce);var A,b;if(503===_.status&&_.headers.has("retry-after"))return yield pi(_,a,s,!0),yield null===(b=_.body)||void 0===b?void 0:b.cancel(),f(a);const T=function(){var A=(0,d.A)(function*(N,J,me,ne){return yt(N,J,me,void 0,ne?.[Ee],ne?.recognizedTokenTypes)});return function(N,J,me,ne){return A.apply(this,arguments)}}()(c,l,_,{[Ee]:v});let U;try{U=yield T}catch(A){if(Ht(A,r))return f(a,Je);if(A instanceof on)switch(A.error){case"slow_down":a+=5;case"authorization_pending":return yield pi(A.response,a,s),f(a)}ce(A)}return U.id_token&&(yield p?.(_)),zt(U),U}),Sr.apply(this,arguments)}function yi(n){oe(n).tlsOnly=!1}function _i(n,t,e,r,o){return Er.apply(this,arguments)}function Er(){return Er=(0,d.A)(function*(n,t,e,r,o){if(Ue(n),!(o?.flag===Je||t instanceof URL||function(A){try{return"Request"===Object.getPrototypeOf(A)[Symbol.toStringTag]}catch{return!1}}(t)))throw xe('"currentUrl" must be an instance of URL, or Request',Wt);let i,a;const{as:s,c,auth:l,fetch:u,tlsOnly:h,jarm:g,hybrid:p,nonRepudiation:y,timeout:v,decrypt:f,implicit:_}=oe(n);if(o?.flag===Je)i=o.authResponse,a=o.redirectUri;else{if(!(t instanceof URL)){const A=t;switch(t=new URL(t.url),A.method){case"GET":break;case"POST":const N=new URLSearchParams(yield function Ya(n){return ir.apply(this,arguments)}(A));if(p)t.hash=N.toString();else for(const[J,me]of N.entries())t.searchParams.append(J,me);break;default:throw xe("unexpected Request HTTP method",Nt)}}switch(A=t,(A=new URL(A)).search="",A.hash="",a=A.href,!0){case!!g:i=yield g(t,e?.expectedState);break;case!!p:i=yield p(t,e?.expectedNonce,e?.expectedState,e?.maxAge);break;case!!_:throw new TypeError("authorizationCodeGrant() cannot be used by response_type=id_token clients");default:try{i=function es(n,t,e,r){if(be(n),Ae(t),e instanceof URL&&(e=e.searchParams),!(e instanceof URLSearchParams))throw F('"parameters" must be an instance of URLSearchParams, or URL',"ERR_INVALID_ARG_TYPE");if(tt(e,"response"))throw K('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',H,{parameters:e});const o=tt(e,"iss"),i=tt(e,"state");if(!o&&n.authorization_response_iss_parameter_supported)throw K('response parameter "iss" (issuer) missing',H,{parameters:e});if(o&&o!==n.issuer)throw K('unexpected "iss" (issuer) response parameter value',H,{expected:n.issuer,parameters:e});switch(r){case void 0:case Qa:if(void 0!==i)throw K('unexpected "state" response parameter encountered',H,{expected:void 0,parameters:e});break;case qa:break;default:if($(r,'"expectedState" argument'),i!==r)throw K(void 0===i?'response parameter "state" missing':'unexpected "state" response parameter value',H,{expected:r,parameters:e})}if(tt(e,"error"))throw new zo("authorization response from the server is an error",{cause:e});const a=tt(e,"id_token"),s=tt(e,"token");if(void 0!==a||void 0!==s)throw new he("implicit and hybrid flows are not supported");return c=new URLSearchParams(e),qn.add(c),c;var c}(s,c,t.searchParams,e?.expectedState)}catch(A){ce(A)}}}var A;const b=yield function(){var A=(0,d.A)(function*(N,J,me,ne,Oe,le,ut){if(be(N),Ae(J),!qn.has(ne))throw F('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',"ERR_INVALID_ARG_VALUE");$(Oe,'"redirectUri"');const Li=tt(ne,"code");if(!Li)throw K('no authorization code in "callbackParameters"',H);const wn=new URLSearchParams(ut?.additionalParameters);return wn.set("redirect_uri",Oe),wn.set("code",Li),le!==Vo&&($(le,'"codeVerifier"'),wn.set("code_verifier",le)),Ot(N,J,me,"authorization_code",wn,ut)});return function(N,J,me,ne,Oe,le,ut){return A.apply(this,arguments)}}()(s,c,l,i,a,e?.pkceCodeVerifier||Vo,{additionalParameters:r,[we]:u,[ye]:!h,DPoP:o?.DPoP,headers:new Headers(Te),signal:nt(v)}).catch(ce);"string"!=typeof e?.expectedNonce&&"number"!=typeof e?.maxAge||(e.idTokenExpected=!0);const T=function Ja(n,t,e,r){return tr.apply(this,arguments)}(s,c,b,{expectedNonce:e?.expectedNonce,maxAge:e?.maxAge,requireIdToken:e?.idTokenExpected,[Ee]:f});let U;try{U=yield T}catch(A){if(Ht(A,o))return _i(n,void 0,e,r,j(j({},o),{},{flag:Je,authResponse:i,redirectUri:a}));ce(A)}return U.id_token&&(yield y?.(b)),zt(U),U}),Er.apply(this,arguments)}function vi(n,t,e,r){return kr.apply(this,arguments)}function kr(){return kr=(0,d.A)(function*(n,t,e,r){Ue(n),e=new URLSearchParams(e);const{as:o,c:i,auth:a,fetch:s,tlsOnly:c,nonRepudiation:l,timeout:u,decrypt:h}=oe(n),g=yield(v=(0,d.A)(function*(f,_,b,T,U){be(f),Ae(_),$(T,'"refreshToken"');const A=new URLSearchParams(U?.additionalParameters);return A.set("refresh_token",T),Ot(f,_,b,"refresh_token",A,U)}),function(f,_,b,T,U){return v.apply(this,arguments)})(o,i,a,t,{[we]:s,[ye]:!c,additionalParameters:e,DPoP:r?.DPoP,headers:new Headers(Te),signal:nt(u)}).catch(ce),p=function(){var v=(0,d.A)(function*(f,_,b,T){return yt(f,_,b,void 0,T?.[Ee],T?.recognizedTokenTypes)});return function(f,_,b,T){return v.apply(this,arguments)}}()(o,i,g,{[Ee]:h});var v;let y;try{y=yield p}catch(v){if(Ht(v,r))return vi(n,t,e,j(j({},r),{},{flag:Je}));ce(v)}return y.id_token&&(yield l?.(g)),zt(y),y}),kr.apply(this,arguments)}function wi(n,t,e){return Tr.apply(this,arguments)}function Tr(){return Tr=(0,d.A)(function*(n,t,e){Ue(n),t=new URLSearchParams(t);const{as:r,c:o,auth:i,fetch:a,tlsOnly:s,timeout:c}=oe(n),l=yield(g=(0,d.A)(function*(p,y,v,f,_){return be(p),Ae(y),Ot(p,y,v,"client_credentials",new URLSearchParams(f),_)}),function(p,y,v,f,_){return g.apply(this,arguments)})(r,o,i,t,{[we]:a,[ye]:!s,DPoP:e?.DPoP,headers:new Headers(Te),signal:nt(c)}).catch(ce),u=function(){var g=(0,d.A)(function*(p,y,v,f){return yt(p,y,v,void 0,f?.[Ee],f?.recognizedTokenTypes)});return function(p,y,v,f){return g.apply(this,arguments)}}()(r,o,l);var g;let h;try{h=yield u}catch(g){if(Ht(g,e))return wi(n,t,j(j({},e),{},{flag:Je}));ce(g)}return zt(h),h}),Tr.apply(this,arguments)}function xr(n,t){Ue(n);const{as:e,c:r,tlsOnly:o,hybrid:i,jarm:a,implicit:s}=oe(n),c=Rt(e,"authorization_endpoint",!1,o);if((t=new URLSearchParams(t)).has("client_id")||t.set("client_id",r.client_id),!t.has("request_uri")&&!t.has("request")){if(t.has("response_type")||t.set("response_type",i?"code id_token":s?"id_token":"code"),s&&!t.has("nonce"))throw xe("response_type=id_token clients must provide a nonce parameter in their authorization request parameters",Nt);a&&t.set("response_mode","jwt")}for(const[l,u]of t.entries())c.searchParams.append(l,u);return c}function bi(n,t,e){return Ir.apply(this,arguments)}function Ir(){return Ir=(0,d.A)(function*(n,t,e){Ue(n);const r=xr(n,t),{as:o,c:i,auth:a,fetch:s,tlsOnly:c,timeout:l}=oe(n),u=yield(p=(0,d.A)(function*(y,v,f,_,b){var T;be(y),Ae(v);const U=Rt(y,"pushed_authorization_request_endpoint",v.use_mtls_endpoint_aliases,!0!==b?.[ye]),A=new URLSearchParams(_);A.set("client_id",v.client_id);const N=tn(b?.headers);N.set("accept","application/json"),void 0!==b?.DPoP&&(Ho(b.DPoP),yield b.DPoP.addProof(U,N,"POST"));const J=yield Gn(y,v,f,U,A,N,b);return null==b||null===(T=b.DPoP)||void 0===T||T.cacheNonce(J,U),J}),function(y,v,f,_,b){return p.apply(this,arguments)})(o,i,a,r.searchParams,{[we]:s,[ye]:!c,DPoP:e?.DPoP,headers:new Headers(Te),signal:nt(l)}).catch(ce),h=function(){var p=(0,d.A)(function*(y,v,f){if(be(y),Ae(v),!ft(f,Response))throw F('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield Vn(f,201,"Pushed Authorization Request Endpoint"),Ut(f);const _=yield sn(f);$(_.request_uri,'"response" body "request_uri" property',H,{body:_});let b="number"!=typeof _.expires_in?parseFloat(_.expires_in):_.expires_in;return Ne(b,!0,'"response" body "expires_in" property',H,{body:_}),_.expires_in=b,_});return function(y,v,f){return p.apply(this,arguments)}}()(o,i,u);var p;let g;try{g=yield h}catch(p){if(Ht(p,e))return bi(n,t,j(j({},e),{},{flag:Je}));ce(p)}return xr(n,{request_uri:g.request_uri})}),Ir.apply(this,arguments)}function Ue(n){if(!(n instanceof pn))throw xe('"config" must be an instance of Configuration',Wt);if(Object.getPrototypeOf(n)!==pn.prototype)throw xe("subclassing Configuration is not allowed",Nt)}function nt(n){return n?AbortSignal.timeout(1e3*n):void 0}function Ht(n,t){return!(null==t||!t.DPoP||t.flag===Je)&&function(e){if(e instanceof Fn){const{0:r,length:o}=e.cause;return 1===o&&"dpop"===r.scheme&&"use_dpop_nonce"===r.parameters.error}return e instanceof on&&"use_dpop_nonce"===e.error}(n)}Object.freeze(pn.prototype);const Je=Symbol();function Pr(n,t,e,r){return Cr.apply(this,arguments)}function Cr(){return Cr=(0,d.A)(function*(n,t,e,r){Ue(n);const{as:o,c:i,auth:a,fetch:s,tlsOnly:c,timeout:l,decrypt:u}=oe(n),h=yield(g=(0,d.A)(function*(p,y,v,f,_,b){return be(p),Ae(y),$(f,'"grantType"'),Ot(p,y,v,f,new URLSearchParams(_),b)}),function(p,y,v,f,_,b){return g.apply(this,arguments)})(o,i,a,t,new URLSearchParams(e),{[we]:s,[ye]:!c,DPoP:r?.DPoP,headers:new Headers(Te),signal:nt(l)}).then(g=>{let p;return"urn:ietf:params:oauth:grant-type:token-exchange"===t&&(p={n_a:()=>{}}),(y=(0,d.A)(function*(v,f,_,b){return yt(v,f,_,void 0,b?.[Ee],b?.recognizedTokenTypes)}),function(v,f,_,b){return y.apply(this,arguments)})(o,i,g,{[Ee]:u,recognizedTokenTypes:p});var y}).catch(ce);var g;return zt(h),h}),Cr.apply(this,arguments)}function Rr(){return Rr=(0,d.A)(function*(n,t,e){if(t instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(function(r){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return ri("Key must be ",r,...i)}(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:"SHA-".concat(n.slice(-3)),name:"HMAC"},!1,[e])}return function ts(n,t,e){switch(t){case"HS256":case"HS384":case"HS512":{if(!_t(n.algorithm,"HMAC"))throw ke("HMAC");const r=parseInt(t.slice(2),10);if(pr(n.algorithm.hash)!==r)throw ke("SHA-".concat(r),"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!_t(n.algorithm,"RSASSA-PKCS1-v1_5"))throw ke("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(pr(n.algorithm.hash)!==r)throw ke("SHA-".concat(r),"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!_t(n.algorithm,"RSA-PSS"))throw ke("RSA-PSS");const r=parseInt(t.slice(2),10);if(pr(n.algorithm.hash)!==r)throw ke("SHA-".concat(r),"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!_t(n.algorithm,"Ed25519"))throw ke("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!_t(n.algorithm,t))throw ke(t);break;case"ES256":case"ES384":case"ES512":{if(!_t(n.algorithm,"ECDSA"))throw ke("ECDSA");const r=function(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(n.algorithm.namedCurve!==r)throw ke(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}!function(r,o){if(o&&!r.usages.includes(o))throw new TypeError("CryptoKey does not support this operation, its usages must include ".concat(o,"."))}(n,e)}(t,n,e),t}),Rr.apply(this,arguments)}function Or(){return Or=(0,d.A)(function*(n,t,e,r){const o=yield function ls(n,t,e){return Rr.apply(this,arguments)}(n,t,"verify");!function(a,s){if(a.startsWith("RS")||a.startsWith("PS")){const{modulusLength:c}=s.algorithm;if("number"!=typeof c||c<2048)throw new TypeError("".concat(a," requires key modulusLength to be 2048 bits or larger"))}}(n,o);const i=function(a,s){const c="SHA-".concat(a.slice(-3));switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:s.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new pe("alg ".concat(a," is not supported either by JOSE or your javascript runtime"))}}(n,o.algorithm);try{return yield crypto.subtle.verify(i,o,e,r)}catch{return!1}}),Or.apply(this,arguments)}function Dr(){return Dr=(0,d.A)(function*(n,t,e){if(!We(n))throw new te("Flattened JWS must be an object");if(void 0===n.protected&&void 0===n.header)throw new te('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==n.protected&&"string"!=typeof n.protected)throw new te("JWS Protected Header incorrect type");if(void 0===n.payload)throw new te("JWS Payload missing");if("string"!=typeof n.signature)throw new te("JWS Signature missing or incorrect type");if(void 0!==n.header&&!We(n.header))throw new te("JWS Unprotected Header incorrect type");let r={};if(n.protected)try{const v=Lt(n.protected);r=JSON.parse(jt.decode(v))}catch{throw new te("JWS Protected Header is invalid")}if(!function(){for(var v=arguments.length,f=new Array(v),_=0;_<v;_++)f[_]=arguments[_];const b=f.filter(Boolean);if(0===b.length||1===b.length)return!0;let T;for(const U of b){const A=Object.keys(U);if(T&&0!==T.size)for(const N of A){if(T.has(N))return!1;T.add(N)}else T=new Set(A)}return!0}(r,n.header))throw new te("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o=j(j({},r),n.header);let a=!0;if(function(v,f,_,b,T){if(void 0!==T.crit&&void 0===b?.crit)throw new v('"crit" (Critical) Header Parameter MUST be integrity protected');if(!b||void 0===b.crit)return new Set;if(!Array.isArray(b.crit)||0===b.crit.length||b.crit.some(A=>"string"!=typeof A||0===A.length))throw new v('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let U;U=void 0!==_?new Map([...Object.entries(_),...f.entries()]):f;for(const A of b.crit){if(!U.has(A))throw new pe('Extension Header Parameter "'.concat(A,'" is not recognized'));if(void 0===T[A])throw new v('Extension Header Parameter "'.concat(A,'" is missing'));if(U.get(A)&&void 0===b[A])throw new v('Extension Header Parameter "'.concat(A,'" MUST be integrity protected'))}return new Set(b.crit)}(te,new Map([["b64",!0]]),e?.crit,r,o).has("b64")&&(a=r.b64,"boolean"!=typeof a))throw new te('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:s}=o;if("string"!=typeof s||!s)throw new te('JWS "alg" (Algorithm) Header Parameter missing or invalid');const c=e&&function(v,f){if(void 0!==f&&(!Array.isArray(f)||f.some(_=>"string"!=typeof _)))throw new TypeError('"'.concat("algorithms",'" option must be an array of strings'));if(f)return new Set(f)}(0,e.algorithms);if(c&&!c.has(s))throw new Qo('"alg" (Algorithm) Header Parameter value not allowed');if(a){if("string"!=typeof n.payload)throw new te("JWS Payload must be a string")}else if("string"!=typeof n.payload&&!(n.payload instanceof Uint8Array))throw new te("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof t&&(t=yield t(r,n),l=!0),function as(n,t,e){switch(n.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((r,o,i)=>{if(!(o instanceof Uint8Array)){if(gr(o)){if("oct"===(a=o).kty&&"string"==typeof a.k&&_r(r,o,i))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!si(o))throw new TypeError(oi(r,o,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==o.type)throw new TypeError("".concat(vt(o),' instances for symmetric algorithms must be of type "secret"'))}var a})(n,t,e);break;default:((r,o,i)=>{if(gr(o))switch(i){case"decrypt":case"sign":if("oct"!==(a=o).kty&&("AKP"===a.kty&&"string"==typeof a.priv||"string"==typeof a.d)&&_r(r,o,i))return;throw new TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if((a=>"oct"!==a.kty&&void 0===a.d&&void 0===a.priv)(o)&&_r(r,o,i))return;throw new TypeError("JSON Web Key for this operation must be a public JWK")}var a;if(!si(o))throw new TypeError(oi(r,o,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===o.type)throw new TypeError("".concat(vt(o),' instances for asymmetric algorithms must not be of type "secret"'));if("public"===o.type)switch(i){case"sign":throw new TypeError("".concat(vt(o),' instances for asymmetric algorithm signing must be of type "private"'));case"decrypt":throw new TypeError("".concat(vt(o),' instances for asymmetric algorithm decryption must be of type "private"'))}if("private"===o.type)switch(i){case"verify":throw new TypeError("".concat(vt(o),' instances for asymmetric algorithm verifying must be of type "public"'));case"encrypt":throw new TypeError("".concat(vt(o),' instances for asymmetric algorithm encryption must be of type "public"'))}})(n,t,e)}}(s,t,"verify");const u=function(){for(var v=arguments.length,f=new Array(v),_=0;_<v;_++)f[_]=arguments[_];const b=f.reduce((A,N)=>{let{length:J}=N;return A+J},0),T=new Uint8Array(b);let U=0;for(const A of f)T.set(A,U),U+=A.length;return T}(void 0!==n.protected?cr(n.protected):new Uint8Array,cr("."),"string"==typeof n.payload?a?cr(n.payload):$o.encode(n.payload):n.payload);let h;try{h=Lt(n.signature)}catch{throw new te("Failed to base64url decode the signature")}const g=yield function is(n,t){return yr.apply(this,arguments)}(t,s);if(!(yield function ds(n,t,e,r){return Or.apply(this,arguments)}(s,g,h,u)))throw new ni;let p;if(a)try{p=Lt(n.payload)}catch{throw new te("Failed to base64url decode the payload")}else p="string"==typeof n.payload?$o.encode(n.payload):n.payload;const y={payload:p};return void 0!==n.protected&&(y.protectedHeader=r),void 0!==n.header&&(y.unprotectedHeader=n.header),l?j(j({},y),{},{key:g}):y}),Dr.apply(this,arguments)}const ms=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function Ai(n){const t=ms.exec(n);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const e=parseFloat(t[2]);let r;switch(t[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(e);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(60*e);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(3600*e);break;case"day":case"days":case"d":r=Math.round(86400*e);break;case"week":case"weeks":case"w":r=Math.round(604800*e);break;default:r=Math.round(31557600*e)}return"-"===t[1]||"ago"===t[4]?-r:r}const Si=n=>n.includes("/")?n.toLowerCase():"application/".concat(n.toLowerCase());function Ur(){return Ur=(0,d.A)(function*(n,t,e){var r;const o=yield(s=(0,d.A)(function*(c,l,u){if(c instanceof Uint8Array&&(c=jt.decode(c)),"string"!=typeof c)throw new te("Compact JWS must be a string or Uint8Array");const{0:h,1:g,2:p,length:y}=c.split(".");if(3!==y)throw new te("Invalid Compact JWS");const v=yield function hs(n,t,e){return Dr.apply(this,arguments)}({payload:g,protected:h,signature:p},l,u),f={payload:v.payload,protectedHeader:v.protectedHeader};return"function"==typeof l?j(j({},f),{},{key:v.key}):f}),function(c,l,u){return s.apply(this,arguments)})(n,t,e);var s;if(null!==(r=o.protectedHeader.crit)&&void 0!==r&&r.includes("b64")&&!1===o.protectedHeader.b64)throw new lr("JWTs MUST NOT use unencoded payload");const i=function(s,c){let l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{l=JSON.parse(jt.decode(c))}catch{}if(!We(l))throw new lr("JWT Claims Set must be a top-level JSON object");const{typ:h}=u;if(h&&("string"!=typeof s.typ||Si(s.typ)!==Si(h)))throw new Se('unexpected "typ" JWT header value',l,"typ","check_failed");const{requiredClaims:g=[],issuer:p,subject:y,audience:v,maxTokenAge:f}=u,_=[...g];void 0!==f&&_.push("iat"),void 0!==v&&_.push("aud"),void 0!==y&&_.push("sub"),void 0!==p&&_.push("iss");for(const A of new Set(_.reverse()))if(!(A in l))throw new Se('missing required "'.concat(A,'" claim'),l,A,"missing");if(p&&!(Array.isArray(p)?p:[p]).includes(l.iss))throw new Se('unexpected "iss" claim value',l,"iss","check_failed");if(y&&l.sub!==y)throw new Se('unexpected "sub" claim value',l,"sub","check_failed");if(v&&!((n,t)=>"string"==typeof n?t.includes(n):!!Array.isArray(n)&&t.some(Set.prototype.has.bind(new Set(n))))(l.aud,"string"==typeof v?[v]:v))throw new Se('unexpected "aud" claim value',l,"aud","check_failed");let b;switch(typeof u.clockTolerance){case"string":b=Ai(u.clockTolerance);break;case"number":b=u.clockTolerance;break;case"undefined":b=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:T}=u,U=(n=>Math.floor(n.getTime()/1e3))(T||new Date);if((void 0!==l.iat||f)&&"number"!=typeof l.iat)throw new Se('"iat" claim must be a number',l,"iat","invalid");if(void 0!==l.nbf){if("number"!=typeof l.nbf)throw new Se('"nbf" claim must be a number',l,"nbf","invalid");if(l.nbf>U+b)throw new Se('"nbf" claim timestamp check failed',l,"nbf","check_failed")}if(void 0!==l.exp){if("number"!=typeof l.exp)throw new Se('"exp" claim must be a number',l,"exp","invalid");if(l.exp<=U-b)throw new ur('"exp" claim timestamp check failed',l,"exp","check_failed")}if(f){const A=U-l.iat;if(A-b>("number"==typeof f?f:Ai(f)))throw new ur('"iat" claim timestamp check failed (too far in the past)',l,"iat","check_failed");if(A<0-b)throw new Se('"iat" claim timestamp check failed (it should be in the past)',l,"iat","check_failed")}return l}(o.protectedHeader,o.payload,e),a={payload:i,protectedHeader:o.protectedHeader};return"function"==typeof t?j(j({},a),{},{key:o.key}):a}),Ur.apply(this,arguments)}function ys(n){return We(n)}var mn,jr,fn=new WeakMap,Lr=new WeakMap;class _s{constructor(t){if(ee(this,fn,void 0),ee(this,Lr,new WeakMap),!((e=t)&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(ys)))throw new dr("JSON Web Key Set malformed");var e;X(fn,this,structuredClone(t))}jwks(){return k(fn,this)}getKey(t,e){var r=this;return(0,d.A)(function*(){const{alg:o,kid:i}=j(j({},t),e?.header),a=function(u){switch("string"==typeof u&&u.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new pe('Unsupported "alg" value for a JSON Web Key Set')}}(o),s=k(fn,r).keys.filter(u=>{let h=a===u.kty;if(h&&"string"==typeof i&&(h=i===u.kid),!h||"string"!=typeof u.alg&&"AKP"!==a||(h=o===u.alg),h&&"string"==typeof u.use&&(h="sig"===u.use),h&&Array.isArray(u.key_ops)&&(h=u.key_ops.includes("verify")),h)switch(o){case"ES256":h="P-256"===u.crv;break;case"ES384":h="P-384"===u.crv;break;case"ES512":h="P-521"===u.crv;break;case"Ed25519":case"EdDSA":h="Ed25519"===u.crv}return h}),{0:c,length:l}=s;if(0===l)throw new hr;if(1!==l){const u=new ei,h=k(Lr,r);throw u[Symbol.asyncIterator]=function Ea(n){return function(){return new Ct(n.apply(this,arguments))}}(function*(){for(const g of s)try{yield yield Sa(Ei(h,g,o))}catch{}}),u}return Ei(k(Lr,r),c,o)})()}}function Ei(n,t,e){return Kr.apply(this,arguments)}function Kr(){return Kr=(0,d.A)(function*(n,t,e){const r=n.get(t)||n.set(t,{}).get(t);if(void 0===r[e]){const o=yield(i=(0,d.A)(function*(a,s,c){var l;if(!We(a))throw new TypeError("JWK must be an object");let u;switch(null!=s||(s=a.alg),null!=u||(u=null!==(l=c?.extractable)&&void 0!==l?l:a.ext),a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Lt(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new pe('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return cn(j(j({},a),{},{alg:s,ext:u}));case"AKP":if("string"!=typeof a.alg||!a.alg)throw new TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==s&&s!==a.alg)throw new TypeError("JWK alg and alg option value mismatch");return cn(j(j({},a),{},{ext:u}));case"EC":case"OKP":return cn(j(j({},a),{},{alg:s,ext:u}));default:throw new pe('Unsupported "kty" (Key Type) Parameter value')}}),function(a,s,c){return i.apply(this,arguments)})(j(j({},t),{},{ext:!0}),e);if(o instanceof Uint8Array||"public"!==o.type)throw new dr("JSON Web Key Set members must be public keys");r[e]=o}var i;return r[e]}),Kr.apply(this,arguments)}function ki(n){const t=new _s(n),e=function(){var r=(0,d.A)(function*(o,i){return t.getKey(o,i)});return function(i,a){return r.apply(this,arguments)}}();return Object.defineProperties(e,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),e}let Mr;(typeof navigator>"u"||null===(mn=navigator.userAgent)||void 0===mn||null===(jr=mn.startsWith)||void 0===jr||!jr.call(mn,"Mozilla/5.0 "))&&(Mr="".concat("jose","/").concat("v6.1.3"));const Ti=Symbol(),Nr=Symbol();var Wr=new WeakMap,zr=new WeakMap,Hr=new WeakMap,gn=new WeakMap,rt=new WeakMap,je=new WeakMap,Fe=new WeakMap,Jr=new WeakMap,ot=new WeakMap,it=new WeakMap;class vs{constructor(t,e){if(ee(this,Wr,void 0),ee(this,zr,void 0),ee(this,Hr,void 0),ee(this,gn,void 0),ee(this,rt,void 0),ee(this,je,void 0),ee(this,Fe,void 0),ee(this,Jr,void 0),ee(this,ot,void 0),ee(this,it,void 0),!(t instanceof URL))throw new TypeError("url must be an instance of URL");var r,o;X(Wr,this,new URL(t.href)),X(zr,this,"number"==typeof e?.timeoutDuration?e?.timeoutDuration:5e3),X(Hr,this,"number"==typeof e?.cooldownDuration?e?.cooldownDuration:3e4),X(gn,this,"number"==typeof e?.cacheMaxAge?e?.cacheMaxAge:6e5),X(Fe,this,new Headers(e?.headers)),Mr&&!k(Fe,this).has("User-Agent")&&k(Fe,this).set("User-Agent",Mr),k(Fe,this).has("accept")||(k(Fe,this).set("accept","application/json"),k(Fe,this).append("accept","application/jwk-set+json")),X(Jr,this,e?.[Ti]),void 0!==e?.[Nr]&&(X(it,this,e?.[Nr]),r=e?.[Nr],o=k(gn,this),"object"==typeof r&&null!==r&&"uat"in r&&"number"==typeof r.uat&&!(Date.now()-r.uat>=o)&&"jwks"in r&&We(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,We)&&(X(rt,this,k(it,this).uat),X(ot,this,ki(k(it,this).jwks))))}pendingFetch(){return!!k(je,this)}coolingDown(){return"number"==typeof k(rt,this)&&Date.now()<k(rt,this)+k(Hr,this)}fresh(){return"number"==typeof k(rt,this)&&Date.now()<k(rt,this)+k(gn,this)}jwks(){var t;return null===(t=k(ot,this))||void 0===t?void 0:t.jwks()}getKey(t,e){var r=this;return(0,d.A)(function*(){k(ot,r)&&r.fresh()||(yield r.reload());try{return yield k(ot,r).call(r,t,e)}catch(o){if(o instanceof hr&&!1===r.coolingDown())return yield r.reload(),k(ot,r).call(r,t,e);throw o}})()}reload(){var t=this;return(0,d.A)(function*(){var e;k(je,t)&&(typeof WebSocketPair<"u"||typeof navigator<"u"&&"Cloudflare-Workers"===navigator.userAgent||typeof EdgeRuntime<"u"&&"vercel"===EdgeRuntime)&&X(je,t,void 0),k(je,t)||X(je,t,(e=(0,d.A)(function*(r,o,i){const s=yield(arguments.length>3&&void 0!==arguments[3]?arguments[3]:fetch)(r,{method:"GET",signal:i,redirect:"manual",headers:o}).catch(c=>{throw"TimeoutError"===c.name?new ti:c});if(200!==s.status)throw new re("Expected 200 OK from the JSON Web Key Set HTTP response");try{return yield s.json()}catch{throw new re("Failed to parse the JSON Web Key Set HTTP response as JSON")}}),function(r,o,i){return e.apply(this,arguments)})(k(Wr,t).href,k(Fe,t),AbortSignal.timeout(k(zr,t)),k(Jr,t)).then(e=>{X(ot,t,ki(e)),k(it,t)&&(k(it,t).uat=Date.now(),k(it,t).jwks=e),X(rt,t,Date.now()),X(je,t,void 0)}).catch(e=>{throw X(je,t,void 0),e})),yield k(je,t)})()}}const ws=["mfaToken"],bs=["mfaToken"];var at,yn,st,Ve,wt,G,Jt,q,xi=class extends Error{constructor(n,t){super(t),P(this,"code",void 0),this.name="NotSupportedError",this.code=n}},Le=class extends Error{constructor(n,t,e){super(t),P(this,"cause",void 0),P(this,"code",void 0),this.code=n,this.cause=e&&{error:e.error,error_description:e.error_description,message:e.message}}},As=class extends Le{constructor(n,t){super("token_by_code_error",n,t),this.name="TokenByCodeError"}},Ss=class extends Le{constructor(n,t){super("token_by_client_credentials_error",n,t),this.name="TokenByClientCredentialsError"}},Es=class extends Le{constructor(n,t){super("token_by_refresh_token_error",n,t),this.name="TokenByRefreshTokenError"}},Fr=class extends Le{constructor(n,t){super("token_for_connection_error",n,t),this.name="TokenForConnectionErrorCode"}},Ie=class extends Le{constructor(n,t){super("token_exchange_error",n,t),this.name="TokenExchangeError"}},Be=class extends Error{constructor(n){super(n),P(this,"code","verify_logout_token_error"),this.name="VerifyLogoutTokenError"}},Vr=class extends Le{constructor(n){super("backchannel_authentication_error","There was an error when trying to use Client-Initiated Backchannel Authentication.",n),P(this,"code","backchannel_authentication_error"),this.name="BackchannelAuthenticationError"}},ks=class extends Le{constructor(n){super("build_authorization_url_error","There was an error when trying to build the authorization URL.",n),this.name="BuildAuthorizationUrlError"}},Ts=class extends Le{constructor(n){super("build_link_user_url_error","There was an error when trying to build the Link User URL.",n),this.name="BuildLinkUserUrlError"}},xs=class extends Le{constructor(n){super("build_unlink_user_url_error","There was an error when trying to build the Unlink User URL.",n),this.name="BuildUnlinkUserUrlError"}},Is=class extends Error{constructor(){super("The client secret or client assertion signing key must be provided."),P(this,"code","missing_client_auth_error"),this.name="MissingClientAuthError"}};function Br(n){return Object.entries(n).filter(t=>{let[,e]=t;return void 0!==e}).reduce((t,e)=>j(j({},t),{},{[e[0]]:e[1]}),{})}var _n=class extends Error{constructor(n,t,e){super(t),P(this,"cause",void 0),P(this,"code",void 0),this.code=n,this.cause=e&&{error:e.error,error_description:e.error_description,message:e.message}}},Ii=class extends _n{constructor(n,t){super("mfa_list_authenticators_error",n,t),this.name="MfaListAuthenticatorsError"}},Pi=class extends _n{constructor(n,t){super("mfa_enrollment_error",n,t),this.name="MfaEnrollmentError"}},Ps=class extends _n{constructor(n,t){super("mfa_delete_authenticator_error",n,t),this.name="MfaDeleteAuthenticatorError"}},Ci=class extends _n{constructor(n,t){super("mfa_challenge_error",n,t),this.name="MfaChallengeError"}};function Cs(n){return{id:n.id,authenticatorType:n.authenticator_type,active:n.active,name:n.name,oobChannels:n.oob_channels,type:n.type}}var Rs=(at=new WeakMap,yn=new WeakMap,st=new WeakMap,class{constructor(n){var t;ee(this,at,void 0),ee(this,yn,void 0),ee(this,st,void 0),X(at,this,"https://".concat(n.domain)),X(yn,this,n.clientId),X(st,this,null!==(t=n.customFetch)&&void 0!==t?t:function(){return fetch(...arguments)})}listAuthenticators(n){var t=this;return(0,d.A)(function*(){const e="".concat(k(at,t),"/mfa/authenticators"),{mfaToken:r}=n,o=yield k(st,t).call(t,e,{method:"GET",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!o.ok){const i=yield o.json();throw new Ii(i.error_description||"Failed to list authenticators",i)}return(yield o.json()).map(Cs)})()}enrollAuthenticator(n){var t=this;return(0,d.A)(function*(){const e="".concat(k(at,t),"/mfa/associate"),{mfaToken:r}=n,o=Do(n,ws),i={authenticator_types:o.authenticatorTypes};"oobChannels"in o&&(i.oob_channels=o.oobChannels),"phoneNumber"in o&&o.phoneNumber&&(i.phone_number=o.phoneNumber),"email"in o&&o.email&&(i.email=o.email);const a=yield k(st,t).call(t,e,{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){const s=yield a.json();throw new Pi(s.error_description||"Failed to enroll authenticator",s)}return function(s){if("otp"===s.authenticator_type)return{authenticatorType:"otp",secret:s.secret,barcodeUri:s.barcode_uri,recoveryCodes:s.recovery_codes,id:s.id};if("oob"===s.authenticator_type)return{authenticatorType:"oob",oobChannel:s.oob_channel,oobCode:s.oob_code,bindingMethod:s.binding_method,id:s.id};throw new Error("Unexpected authenticator type: ".concat(s.authenticator_type))}(yield a.json())})()}deleteAuthenticator(n){var t=this;return(0,d.A)(function*(){const{authenticatorId:e,mfaToken:r}=n,o="".concat(k(at,t),"/mfa/authenticators/").concat(encodeURIComponent(e)),i=yield k(st,t).call(t,o,{method:"DELETE",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!i.ok){const a=yield i.json();throw new Ps(a.error_description||"Failed to delete authenticator",a)}})()}challengeAuthenticator(n){var t=this;return(0,d.A)(function*(){const e="".concat(k(at,t),"/mfa/challenge"),{mfaToken:r}=n,o=Do(n,bs),i={mfa_token:r,client_id:k(yn,t),challenge_type:o.challengeType};o.authenticatorId&&(i.authenticator_id=o.authenticatorId);const a=yield k(st,t).call(t,e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){const s=yield a.json();throw new Ci(s.error_description||"Failed to challenge authenticator",s)}return function(s){const c={challengeType:s.challenge_type};return void 0!==s.oob_code&&(c.oobCode=s.oob_code),void 0!==s.binding_method&&(c.bindingMethod=s.binding_method),c}(yield a.json())})()}}),ct=class Ki{constructor(t,e,r,o,i,a,s){P(this,"accessToken",void 0),P(this,"idToken",void 0),P(this,"refreshToken",void 0),P(this,"expiresAt",void 0),P(this,"scope",void 0),P(this,"claims",void 0),P(this,"authorizationDetails",void 0),P(this,"tokenType",void 0),P(this,"issuedTokenType",void 0),this.accessToken=t,this.idToken=r,this.refreshToken=o,this.expiresAt=e,this.scope=i,this.claims=a,this.authorizationDetails=s}static fromTokenEndpointResponse(t){const e=t.id_token?t.claims():void 0,r=new Ki(t.access_token,Math.floor(Date.now()/1e3)+Number(t.expires_in),t.id_token,t.refresh_token,t.scope,e,t.authorization_details);return r.tokenType=t.token_type,r.issuedTokenType=t.issued_token_type,r}},Gr="openid profile email offline_access",Os=Object.freeze(new Set(["grant_type","client_id","client_secret","client_assertion","client_assertion_type","subject_token","subject_token_type","requested_token_type","actor_token","actor_token_type","audience","aud","resource","resources","resource_indicator","scope","connection","login_hint","organization","assertion"]));function Ri(n){if(null==n)throw new Ie("subject_token is required");if("string"!=typeof n)throw new Ie("subject_token must be a string");if(0===n.trim().length)throw new Ie("subject_token cannot be blank or whitespace");if(n!==n.trim())throw new Ie("subject_token must not include leading or trailing whitespace");if(/^bearer\s+/i.test(n))throw new Ie("subject_token must not include the 'Bearer ' prefix")}function Oi(n,t){if(t)for(const[e,r]of Object.entries(t))if(!Os.has(e))if(Array.isArray(r)){if(r.length>20)throw new Ie("Parameter '".concat(e,"' exceeds maximum array size of ").concat(20));r.forEach(o=>{n.append(e,o)})}else n.append(e,r)}var Ds=(Ve=new WeakMap,wt=new WeakMap,G=new WeakMap,Jt=new WeakMap,q=new WeakSet,class{constructor(n){if(Ro(this,e=q),e.add(this),ee(this,Ve,void 0),ee(this,wt,void 0),ee(this,G,void 0),ee(this,Jt,void 0),P(this,"mfa",void 0),X(G,this,n),n.useMtls&&!n.customFetch)throw new xi("mtls_without_custom_fetch_not_supported","Using mTLS without a custom fetch implementation is not supported");var e;this.mfa=new Rs({domain:k(G,this).domain,clientId:k(G,this).clientId,customFetch:k(G,this).customFetch})}buildAuthorizationUrl(n){var t=this;return(0,d.A)(function*(){const{serverMetadata:e}=yield Y(q,t,_e).call(t);if(null!=n&&n.pushedAuthorizationRequests&&!e.pushed_authorization_request_endpoint)throw new xi("par_not_supported_error","The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par");try{return yield Y(q,t,qr).call(t,n)}catch(r){throw new ks(r)}})()}buildLinkUserUrl(n){var t=this;return(0,d.A)(function*(){try{const e=yield Y(q,t,qr).call(t,{authorizationParams:j(j({},n.authorizationParams),{},{requested_connection:n.connection,requested_connection_scope:n.connectionScope,scope:"openid link_account offline_access",id_token_hint:n.idToken})});return{linkUserUrl:e.authorizationUrl,codeVerifier:e.codeVerifier}}catch(e){throw new Ts(e)}})()}buildUnlinkUserUrl(n){var t=this;return(0,d.A)(function*(){try{const e=yield Y(q,t,qr).call(t,{authorizationParams:j(j({},n.authorizationParams),{},{requested_connection:n.connection,scope:"openid unlink_account",id_token_hint:n.idToken})});return{unlinkUserUrl:e.authorizationUrl,codeVerifier:e.codeVerifier}}catch(e){throw new xs(e)}})()}backchannelAuthentication(n){var t=this;return(0,d.A)(function*(){const{configuration:e,serverMetadata:r}=yield Y(q,t,_e).call(t),o=Br(j(j({},k(G,t).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(j(j({scope:Gr},o),{},{client_id:k(G,t).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:r.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&i.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&i.append("authorization_details",JSON.stringify(n.authorizationDetails));try{const a=yield fi(e,i),s=yield gi(e,a);return ct.fromTokenEndpointResponse(s)}catch(a){throw new Vr(a)}})()}initiateBackchannelAuthentication(n){var t=this;return(0,d.A)(function*(){const{configuration:e,serverMetadata:r}=yield Y(q,t,_e).call(t),o=Br(j(j({},k(G,t).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(j(j({scope:Gr},o),{},{client_id:k(G,t).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:r.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&i.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&i.append("authorization_details",JSON.stringify(n.authorizationDetails));try{const a=yield fi(e,i);return{authReqId:a.auth_req_id,expiresIn:a.expires_in,interval:a.interval}}catch(a){throw new Vr(a)}})()}backchannelAuthenticationGrant(n){var t=this;return(0,d.A)(function*(){let{authReqId:e}=n;const{configuration:r}=yield Y(q,t,_e).call(t),o=new URLSearchParams({auth_req_id:e});try{const i=yield Pr(r,"urn:openid:params:grant-type:ciba",o);return ct.fromTokenEndpointResponse(i)}catch(i){throw new Vr(i)}})()}getTokenForConnection(n){var t=this;return(0,d.A)(function*(){var e;if(n.refreshToken&&n.accessToken)throw new Fr("Either a refresh or access token should be specified, but not both.");const r=null!==(e=n.accessToken)&&void 0!==e?e:n.refreshToken;if(!r)throw new Fr("Either a refresh or access token must be specified.");try{return yield t.exchangeToken({connection:n.connection,subjectToken:r,subjectTokenType:n.accessToken?"urn:ietf:params:oauth:token-type:access_token":"urn:ietf:params:oauth:token-type:refresh_token",loginHint:n.loginHint})}catch(o){throw o instanceof Ie?new Fr(o.message,o.cause):o}})()}exchangeToken(n){var t=this;return(0,d.A)(function*(){return"connection"in n?Y(q,t,Us).call(t,n):Y(q,t,js).call(t,n)})()}getTokenByCode(n,t){var e=this;return(0,d.A)(function*(){const{configuration:r}=yield Y(q,e,_e).call(e);try{const o=yield _i(r,n,{pkceCodeVerifier:t.codeVerifier});return ct.fromTokenEndpointResponse(o)}catch(o){throw new As("There was an error while trying to request a token.",o)}})()}getTokenByRefreshToken(n){var t=this;return(0,d.A)(function*(){const{configuration:e}=yield Y(q,t,_e).call(t);try{const r=yield vi(e,n.refreshToken);return ct.fromTokenEndpointResponse(r)}catch(r){throw new Es("The access token has expired and there was an error while trying to refresh it.",r)}})()}getTokenByClientCredentials(n){var t=this;return(0,d.A)(function*(){const{configuration:e}=yield Y(q,t,_e).call(t);try{const r=new URLSearchParams({audience:n.audience});n.organization&&r.append("organization",n.organization);const o=yield wi(e,r);return ct.fromTokenEndpointResponse(o)}catch(r){throw new Ss("There was an error while trying to request a token.",r)}})()}buildLogoutUrl(n){var t=this;return(0,d.A)(function*(){const{configuration:e,serverMetadata:r}=yield Y(q,t,_e).call(t);if(!r.end_session_endpoint){const o=new URL("https://".concat(k(G,t).domain,"/v2/logout"));return o.searchParams.set("returnTo",n.returnTo),o.searchParams.set("client_id",k(G,t).clientId),o}return function(o,i){Ue(o);const{as:a,c:s,tlsOnly:c}=oe(o),l=Rt(a,"end_session_endpoint",!1,c);(i=new URLSearchParams(i)).has("client_id")||i.set("client_id",s.client_id);for(const[u,h]of i.entries())l.searchParams.append(u,h);return l}(e,{post_logout_redirect_uri:n.returnTo})})()}verifyLogoutToken(n){var t=this;return(0,d.A)(function*(){const{serverMetadata:e}=yield Y(q,t,_e).call(t);k(Jt,t)||X(Jt,t,function(o,i){const a=new vs(o,i),s=function(){var c=(0,d.A)(function*(l,u){return a.getKey(l,u)});return function(u,h){return c.apply(this,arguments)}}();return Object.defineProperties(s,{coolingDown:{get:()=>a.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>a.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>a.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>a.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>a.jwks(),enumerable:!0,configurable:!1,writable:!1}}),s}(new URL(e.jwks_uri),{[Ti]:k(G,t).customFetch}));const{payload:r}=yield function gs(n,t,e){return Ur.apply(this,arguments)}(n.logoutToken,k(Jt,t),{issuer:e.issuer,audience:k(G,t).clientId,algorithms:["RS256"],requiredClaims:["iat"]});if(!("sid"in r)&&!("sub"in r))throw new Be('either "sid" or "sub" (or both) claims must be present');if("sid"in r&&"string"!=typeof r.sid)throw new Be('"sid" claim must be a string');if("sub"in r&&"string"!=typeof r.sub)throw new Be('"sub" claim must be a string');if("nonce"in r)throw new Be('"nonce" claim is prohibited');if(!("events"in r))throw new Be('"events" claim is missing');if("object"!=typeof r.events||null===r.events)throw new Be('"events" claim must be an object');if(!("http://schemas.openid.net/event/backchannel-logout"in r.events))throw new Be('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim');if("object"!=typeof r.events["http://schemas.openid.net/event/backchannel-logout"])throw new Be('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object');return{sid:r.sid,sub:r.sub}})()}});function _e(){return Zr.apply(this,arguments)}function Zr(){return Zr=(0,d.A)(function*(){if(k(Ve,this)&&k(wt,this))return{configuration:k(Ve,this),serverMetadata:k(wt,this)};const n=yield Y(q,this,Ls).call(this);return X(Ve,this,yield function us(n,t,e,r,o){return wr.apply(this,arguments)}(new URL("https://".concat(k(G,this).domain)),k(G,this).clientId,{use_mtls_endpoint_aliases:k(G,this).useMtls},n,{[He]:k(G,this).customFetch})),X(wt,this,k(Ve,this).serverMetadata()),k(Ve,this)[He]=k(G,this).customFetch||fetch,{configuration:k(Ve,this),serverMetadata:k(wt,this)}}),Zr.apply(this,arguments)}function Us(n){return Xr.apply(this,arguments)}function Xr(){return Xr=(0,d.A)(function*(n){var t,e;const{configuration:r}=yield Y(q,this,_e).call(this);if("audience"in n||"resource"in n)throw new Ie("audience and resource parameters are not supported for Token Vault exchanges");Ri(n.subjectToken);const o=new URLSearchParams({connection:n.connection,subject_token:n.subjectToken,subject_token_type:null!==(t=n.subjectTokenType)&&void 0!==t?t:"urn:ietf:params:oauth:token-type:access_token",requested_token_type:null!==(e=n.requestedTokenType)&&void 0!==e?e:"http://auth0.com/oauth/token-type/federated-connection-access-token"});n.loginHint&&o.append("login_hint",n.loginHint),n.scope&&o.append("scope",n.scope),Oi(o,n.extra);try{const i=yield Pr(r,"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",o);return ct.fromTokenEndpointResponse(i)}catch(i){throw new Ie("Failed to exchange token for connection '".concat(n.connection,"'."),i)}}),Xr.apply(this,arguments)}function js(n){return Yr.apply(this,arguments)}function Yr(){return Yr=(0,d.A)(function*(n){const{configuration:t}=yield Y(q,this,_e).call(this);Ri(n.subjectToken);const e=new URLSearchParams({subject_token_type:n.subjectTokenType,subject_token:n.subjectToken});n.audience&&e.append("audience",n.audience),n.scope&&e.append("scope",n.scope),n.requestedTokenType&&e.append("requested_token_type",n.requestedTokenType),n.organization&&e.append("organization",n.organization),Oi(e,n.extra);try{const r=yield Pr(t,"urn:ietf:params:oauth:grant-type:token-exchange",e);return ct.fromTokenEndpointResponse(r)}catch(r){throw new Ie("Failed to exchange token of type '".concat(n.subjectTokenType,"'").concat(n.audience?" for audience '".concat(n.audience,"'"):"","."),r)}}),Yr.apply(this,arguments)}function Ls(){return $r.apply(this,arguments)}function $r(){return $r=(0,d.A)(function*(){if(!k(G,this).clientSecret&&!k(G,this).clientAssertionSigningKey&&!k(G,this).useMtls)throw new Is;if(k(G,this).useMtls)return(t,e,r,o)=>{r.set("client_id",e.client_id)};let n=k(G,this).clientAssertionSigningKey;return!n||n instanceof CryptoKey||(n=yield(t=(0,d.A)(function*(e,r,o){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return os(e,r,o)}),function(e,r,o){return t.apply(this,arguments)})(n,k(G,this).clientAssertionSigningAlg||"RS256")),n?function(t){return function Ra(n,t){const{key:e,kid:r}=(o=n)instanceof CryptoKey?{key:o}:o?.key instanceof CryptoKey?(void 0!==o.kid&&$(o.kid,'"kid"'),{key:o.key,kid:o.kid}):{};var o;return function Ia(n,t){if(function(e,r){if(!(e instanceof CryptoKey))throw F("".concat(r," must be a CryptoKey"),"ERR_INVALID_ARG_TYPE")}(n,t),"private"!==n.type)throw F("".concat(t," must be a private CryptoKey"),"ERR_INVALID_ARG_VALUE")}(e,'"clientPrivateKey.key"'),function(){var i=(0,d.A)(function*(a,s,c,l){var u;const h={alg:Ca(e),kid:r},g=function(p,y){const v=rn()+nn(y);return{jti:Mo(),aud:p.issuer,exp:v+60,iat:v,nbf:v,iss:y.client_id,sub:y.client_id}}(a,s);var p;null==t||null===(u=t[ka])||void 0===u||u.call(t,h,g),c.set("client_id",s.client_id),c.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),c.set("client_assertion",yield(p=(0,d.A)(function*(y,v,f){if(!f.usages.includes("sign"))throw F('CryptoKey instances used for signing assertions must include "sign" in their "usages"',"ERR_INVALID_ARG_VALUE");const _="".concat(et(gt(JSON.stringify(y))),".").concat(et(gt(JSON.stringify(v)))),b=et(yield crypto.subtle.sign(function(T){switch(T.algorithm.name){case"ECDSA":return{name:T.algorithm.name,hash:Xa(T)};case"RSA-PSS":switch(Xo(T),T.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:T.algorithm.name,saltLength:parseInt(T.algorithm.hash.name.slice(-3),10)>>3};default:throw new he("unsupported RSA-PSS hash name",{cause:T})}case"RSASSA-PKCS1-v1_5":return Xo(T),T.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return T.algorithm.name}throw new he("unsupported CryptoKey algorithm name",{cause:T})}(f),f,gt(_)));return"".concat(_,".").concat(b)}),function(y,v,f){return p.apply(this,arguments)})(h,g,e))});return function(a,s,c,l){return i.apply(this,arguments)}}()}(t,void 0)}(n):di(k(G,this).clientSecret);var t}),$r.apply(this,arguments)}function qr(n){return Qr.apply(this,arguments)}function Qr(){return Qr=(0,d.A)(function*(n){const{configuration:t}=yield Y(q,this,_e).call(this),e=function cs(){return Mo()}(),r=yield function ss(n){return(t=(0,d.A)(function*(e){return $(e,"codeVerifier"),et(yield crypto.subtle.digest("SHA-256",gt(e)))}),function(e){return t.apply(this,arguments)})(n);var t}(e),o=Br(j(j({},k(G,this).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(j(j({scope:Gr},o),{},{client_id:k(G,this).clientId,code_challenge:r,code_challenge_method:"S256"}));return{authorizationUrl:null!=n&&n.pushedAuthorizationRequests?yield bi(t,i):yield xr(t,i),codeVerifier:e}}),Qr.apply(this,arguments)}class Ge extends W{constructor(t,e){super(t,e),Object.setPrototypeOf(this,Ge.prototype)}static fromPayload(t){let{error:e,error_description:r}=t;return new Ge(e,r)}}class vn extends Ge{constructor(t,e){super(t,e),Object.setPrototypeOf(this,vn.prototype)}}class eo extends Ge{constructor(t,e){super(t,e),Object.setPrototypeOf(this,eo.prototype)}}class to extends Ge{constructor(t,e){super(t,e),Object.setPrototypeOf(this,to.prototype)}}class bt extends Ge{constructor(t,e){super(t,e),Object.setPrototypeOf(this,bt.prototype)}}class no extends Ge{constructor(t,e){super(t,e),Object.setPrototypeOf(this,no.prototype)}}class Ks{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e5;this.contexts=new Map,this.ttlMs=t}set(t,e){this.cleanup(),this.contexts.set(t,Object.assign(Object.assign({},e),{createdAt:Date.now()}))}get(t){const e=this.contexts.get(t);if(e){if(!(Date.now()-e.createdAt>this.ttlMs))return e;this.contexts.delete(t)}}remove(t){this.contexts.delete(t)}cleanup(){const t=Date.now();for(const[e,r]of this.contexts)t-r.createdAt>this.ttlMs&&this.contexts.delete(e)}get size(){return this.contexts.size}}class Ms{constructor(t,e){this.authJsMfaClient=t,this.auth0Client=e,this.contextManager=new Ks}setMFAAuthDetails(t,e,r,o){this.contextManager.set(t,{scope:e,audience:r,mfaRequirements:o})}getAuthenticators(t){var e=this;return(0,d.A)(function*(){var r,o;const i=e.contextManager.get(t);if(null===(r=i?.mfaRequirements)||void 0===r||!r.challenge||0===i.mfaRequirements.challenge.length)throw new vn("invalid_request","challengeType is required and must contain at least one challenge type, please check mfa_required error payload");const a=i.mfaRequirements.challenge.map(s=>s.type);try{return(yield e.authJsMfaClient.listAuthenticators({mfaToken:t})).filter(s=>!!s.type&&a.includes(s.type))}catch(s){throw s instanceof Ii?new vn(null===(o=s.cause)||void 0===o?void 0:o.error,s.message):s}})()}enroll(t){var e=this;return(0,d.A)(function*(){var r;const o=function(i){const a=va[i.factorType];return Object.assign(Object.assign(Object.assign({mfaToken:i.mfaToken,authenticatorTypes:a.authenticatorTypes},a.oobChannels&&{oobChannels:a.oobChannels}),"phoneNumber"in i&&{phoneNumber:i.phoneNumber}),"email"in i&&{email:i.email})}(t);try{return yield e.authJsMfaClient.enrollAuthenticator(o)}catch(i){throw i instanceof Pi?new eo(null===(r=i.cause)||void 0===r?void 0:r.error,i.message):i}})()}challenge(t){var e=this;return(0,d.A)(function*(){var r;try{const o={challengeType:t.challengeType,mfaToken:t.mfaToken};return t.authenticatorId&&(o.authenticatorId=t.authenticatorId),yield e.authJsMfaClient.challengeAuthenticator(o)}catch(o){throw o instanceof Ci?new to(null===(r=o.cause)||void 0===r?void 0:r.error,o.message):o}})()}getEnrollmentFactors(t){var e=this;return(0,d.A)(function*(){const r=e.contextManager.get(t);if(!r||!r.mfaRequirements)throw new no("mfa_context_not_found","MFA context not found for this MFA token. Please retry the original request to get a new MFA token.");return r.mfaRequirements.enroll&&0!==r.mfaRequirements.enroll.length?r.mfaRequirements.enroll:[]})()}verify(t){var e=this;return(0,d.A)(function*(){const r=e.contextManager.get(t.mfaToken);if(!r)throw new bt("mfa_context_not_found","MFA context not found for this MFA token. Please retry the original request to get a new MFA token.");const o="otp"in(s=t)&&s.otp?"http://auth0.com/oauth/grant-type/mfa-otp":"oobCode"in s&&s.oobCode?"http://auth0.com/oauth/grant-type/mfa-oob":"recoveryCode"in s&&s.recoveryCode?"http://auth0.com/oauth/grant-type/mfa-recovery-code":void 0;var s;if(!o)throw new bt("invalid_request","Unable to determine grant type. Provide one of: otp, oobCode, or recoveryCode.");const i=r.scope,a=r.audience;try{const s=yield e.auth0Client._requestTokenForMfa({grant_type:o,mfaToken:t.mfaToken,scope:i,audience:a,otp:t.otp,oob_code:t.oobCode,binding_code:t.bindingCode,recovery_code:t.recoveryCode});return e.contextManager.remove(t.mfaToken),s}catch(s){if(s instanceof St)e.setMFAAuthDetails(s.mfa_token,i,a,s.mfa_requirements);else if(s instanceof bt)throw new bt(s.error,s.error_description);throw s}})()}}const Ft=new lt;class Ns{constructor(t){var e=this;let r,o;if(this.userCache=(new vo).enclosedCache,this.activeLockKeys=new Set,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=(0,d.A)(function*(){const u=Array.from(e.activeLockKeys);for(const h of u)yield Ft.releaseLock(h);e.activeLockKeys.clear(),window.removeEventListener("pagehide",e._releaseLockOnPageHide)}),this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),t),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),t.authorizationParams)}),typeof window<"u"&&(()=>{if(!Xt())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(void 0===Xt().subtle)throw new Error("\n      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.\n    ")})(),t.cache&&t.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),t.cache)o=t.cache;else{if(r=t.cacheLocation||"memory",!xo(r))throw new Error('Invalid cache location "'.concat(r,'"'));o=xo(r)()}this.httpTimeoutMs=t.httpTimeoutInSeconds?1e3*t.httpTimeoutInSeconds:1e4,this.cookieStorage=!1===t.legacySameSiteCookie?pt:ua,this.orgHintCookieName="auth0.".concat(this.options.clientId,".organization_hint"),this.isAuthenticatedCookieName=(()=>"auth0.".concat(this.options.clientId,".is.authenticated"))(),this.sessionCheckExpiryDays=t.sessionCheckExpiryDays||1;const a=t.useCookiesForTransactions?this.cookieStorage:la;var s,u,h;this.scope=function(u,h){for(var g=arguments.length,p=new Array(g>2?g-2:0),y=2;y<g;y++)p[y-2]=arguments[y];if("object"!=typeof u)return{default:Yt(h,u,...p)};let v={default:Yt(h,...p)};return Object.keys(u).forEach(f=>{v[f]=Yt(h,u[f],...p)}),v}(this.options.authorizationParams.scope,"openid",this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new ra(a,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||Z,this.cacheManager=new na(o,o.allKeys?void 0:new pa(o,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new ga(this.options.clientId):void 0,this.domainUrl=/^https?:\/\//.test(s=this.options.domain)?s:"https://".concat(s),this.tokenIssuer=(h=this.domainUrl,(u=this.options.issuer)?u.startsWith("https://")?u:"https://".concat(u,"/"):"".concat(h,"/"));const c="".concat(this.domainUrl,"/me/"),l=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:c},detailedResponse:!0})}));this.myAccountApi=new _a(l,c),this.authJsClient=new Ds({domain:this.options.domain,clientId:this.options.clientId}),this.mfa=new Ms(this.authJsClient.mfa,this),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&"memory"===r&&(this.worker=this.options.workerUrl?new Worker(this.options.workerUrl):new ha)}getConfiguration(){return Object.freeze({domain:this.options.domain,clientId:this.options.clientId})}_url(t){const r=uo(this.options.auth0Client||z,!0),o=encodeURIComponent(btoa(JSON.stringify(r)));return"".concat(this.domainUrl).concat(t,"&auth0Client=").concat(o)}_authorizeUrl(t){return this._url("/authorize?".concat(Tn(t)))}_verifyIdToken(t,e,r){var o=this;return(0,d.A)(function*(){const i=yield o.nowProvider();return(n=>{if(!n.id_token)throw new Error("ID token is required but missing");const t=(i=>{const a=i.split("."),[s,c,l]=a;if(3!==a.length||!s||!c||!l)throw new Error("ID token could not be decoded");const u=JSON.parse(ho(c)),h={__raw:i},g={};return Object.keys(u).forEach(p=>{h[p]=u[p],oa.includes(p)||(g[p]=u[p])}),{encoded:{header:s,payload:c,signature:l},header:JSON.parse(ho(s)),claims:h,user:g}})(n.id_token);if(!t.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(t.claims.iss!==n.iss)throw new Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(n.iss,'", found "').concat(t.claims.iss,'"'));if(!t.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==t.header.alg)throw new Error('Signature algorithm of "'.concat(t.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!t.claims.aud||"string"!=typeof t.claims.aud&&!Array.isArray(t.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(n.aud))throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but was not one of "').concat(t.claims.aud.join(", "),'"'));if(t.claims.aud.length>1){if(!t.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(t.claims.azp!==n.aud)throw new Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(n.aud,'", found "').concat(t.claims.azp,'"'))}}else if(t.claims.aud!==n.aud)throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but found "').concat(t.claims.aud,'"'));if(n.nonce){if(!t.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(t.claims.nonce!==n.nonce)throw new Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(n.nonce,'", found "').concat(t.claims.nonce,'"'))}if(n.max_age&&!xt(t.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(null==t.claims.exp||!xt(t.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!xt(t.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const e=n.leeway||60,r=new Date(n.now||Date.now()),o=new Date(0);if(o.setUTCSeconds(t.claims.exp+e),r>o)throw new Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(null!=t.claims.nbf&&xt(t.claims.nbf)){const i=new Date(0);if(i.setUTCSeconds(t.claims.nbf-e),r<i)throw new Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (".concat(r,") is before ").concat(i))}if(null!=t.claims.auth_time&&xt(t.claims.auth_time)){const i=new Date(0);if(i.setUTCSeconds(parseInt(t.claims.auth_time)+n.max_age+e),r>i)throw new Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (".concat(r,") is after last auth at ").concat(i))}if(n.organization){const i=n.organization.trim();if(i.startsWith("org_")){const a=i;if(!t.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(a!==t.claims.org_id)throw new Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(a,'", found "').concat(t.claims.org_id,'"'))}else{const a=i.toLowerCase();if(!t.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(a!==t.claims.org_name)throw new Error('Organization Name (org_name) claim mismatch in the ID token; expected "'.concat(a,'", found "').concat(t.claims.org_name,'"'))}}return t})({iss:o.tokenIssuer,aud:o.options.clientId,id_token:t,nonce:e,organization:r,leeway:o.options.leeway,max_age:(a=o.options.authorizationParams.max_age,"string"!=typeof a?a:parseInt(a,10)||void 0),now:i});var a})()}_processOrgHint(t){t?this.cookieStorage.save(this.orgHintCookieName,t,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}_prepareAuthorizeUrl(t,e,r){var o=this;return(0,d.A)(function*(){var i;const a=kn(Et()),s=kn(Et()),c=Et(),l=yield lo(c),u=po(l),h=yield null===(i=o.dpop)||void 0===i?void 0:i.calculateThumbprint(),g=(y=o.options,v=o.scope,f=t,_=a,b=s,T=u,U=t.redirect_uri||o.options.authorizationParams.redirect_uri||r,A=e?.response_mode,N=h,Object.assign(Object.assign(Object.assign({client_id:y.clientId},y.authorizationParams),f),{scope:$t(v,f.scope,f.audience),response_type:"code",response_mode:A||"query",state:_,nonce:b,redirect_uri:U||y.authorizationParams.redirect_uri,code_challenge:T,code_challenge_method:"S256",dpop_jkt:N})),p=o._authorizeUrl(g);var y,v,f,_,b,T,U,A,N;return{nonce:s,code_verifier:c,scope:g.scope,audience:g.audience||"default",redirect_uri:g.redirect_uri,state:a,url:p}})()}loginWithPopup(t,e){var r=this;return(0,d.A)(function*(){var o;if(t=t||{},!(e=e||{}).popup&&(e.popup=(()=>{const l=window.screenX+(window.innerWidth-400)/2,u=window.screenY+(window.innerHeight-600)/2;return window.open("","auth0:authorize:popup","left=".concat(l,",top=").concat(u,",width=").concat(400,",height=").concat(600,",resizable,scrollbars=yes,status=1"))})(),!e.popup))throw new Sn;const i=yield r._prepareAuthorizeUrl(t.authorizationParams||{},{response_mode:"web_message"},window.location.origin);e.popup.location.href=i.url;const a=yield(c=Object.assign(Object.assign({},e),{timeoutInSeconds:e.timeoutInSeconds||r.options.authorizeTimeoutInSeconds||60}),new Promise((l,u)=>{let h;const g=setInterval(()=>{c.popup&&c.popup.closed&&(clearInterval(g),clearTimeout(p),window.removeEventListener("message",h,!1),u(new An(c.popup)))},1e3),p=setTimeout(()=>{clearInterval(g),u(new bn(c.popup)),window.removeEventListener("message",h,!1)},1e3*(c.timeoutInSeconds||60));h=function(y){if(y.data&&"authorization_response"===y.data.type){if(clearTimeout(p),clearInterval(g),window.removeEventListener("message",h,!1),!1!==c.closePopup&&c.popup.close(),y.data.response.error)return u(W.fromPayload(y.data.response));l(y.data.response)}},window.addEventListener("message",h)}));var c;if(i.state!==a.state)throw new W("state_mismatch","Invalid state");const s=(null===(o=t.authorizationParams)||void 0===o?void 0:o.organization)||r.options.authorizationParams.organization;yield r._requestToken({audience:i.audience,scope:i.scope,code_verifier:i.code_verifier,grant_type:"authorization_code",code:a.code,redirect_uri:i.redirect_uri},{nonceIn:i.nonce,organization:s})})()}getUser(){var t=this;return(0,d.A)(function*(){var e;const r=yield t._getIdTokenFromCache();return null===(e=r?.decodedToken)||void 0===e?void 0:e.user})()}getIdTokenClaims(){var t=this;return(0,d.A)(function*(){var e;const r=yield t._getIdTokenFromCache();return null===(e=r?.decodedToken)||void 0===e?void 0:e.claims})()}loginWithRedirect(){var t=arguments,e=this;return(0,d.A)(function*(){var r;const o=Io(t.length>0&&void 0!==t[0]?t[0]:{}),{openUrl:i,fragment:a,appState:s}=o,c=x(o,["openUrl","fragment","appState"]),l=(null===(r=c.authorizationParams)||void 0===r?void 0:r.organization)||e.options.authorizationParams.organization,u=yield e._prepareAuthorizeUrl(c.authorizationParams||{}),{url:h}=u,g=x(u,["url"]);e.transactionManager.create(Object.assign(Object.assign(Object.assign({},g),{appState:s,response_type:qe.Code}),l&&{organization:l}));const p=a?"".concat(h,"#").concat(a):h;i?yield i(p):window.location.assign(p)})()}handleRedirectCallback(){var t=arguments,e=this;return(0,d.A)(function*(){const r=(t.length>0&&void 0!==t[0]?t[0]:window.location.href).split("?").slice(1);if(0===r.length)throw new Error("There are no query params available for parsing.");const o=e.transactionManager.get();if(!o)throw new W("missing_transaction","Invalid state");e.transactionManager.remove();const i=(a=>{a.indexOf("#")>-1&&(a=a.substring(0,a.indexOf("#")));const s=new URLSearchParams(a);return{state:s.get("state"),code:s.get("code")||void 0,connect_code:s.get("connect_code")||void 0,error:s.get("error")||void 0,error_description:s.get("error_description")||void 0}})(r.join(""));return o.response_type===qe.ConnectCode?e._handleConnectAccountRedirectCallback(i,o):e._handleLoginRedirectCallback(i,o)})()}_handleLoginRedirectCallback(t,e){var r=this;return(0,d.A)(function*(){const{code:o,state:i,error:a,error_description:s}=t;if(a)throw new Me(a,s||a,i,e.appState);if(!e.code_verifier||e.state&&e.state!==i)throw new W("state_mismatch","Invalid state");const c=e.organization,l=e.nonce,u=e.redirect_uri;return yield r._requestToken(Object.assign({audience:e.audience,scope:e.scope,code_verifier:e.code_verifier,grant_type:"authorization_code",code:o},u?{redirect_uri:u}:{}),{nonceIn:l,organization:c}),{appState:e.appState,response_type:qe.Code}})()}_handleConnectAccountRedirectCallback(t,e){var r=this;return(0,d.A)(function*(){const{connect_code:o,state:i,error:a,error_description:s}=t;if(a)throw new dt(a,s||a,e.connection,i,e.appState);if(!o)throw new W("missing_connect_code","Missing connect code");if(!(e.code_verifier&&e.state&&e.auth_session&&e.redirect_uri&&e.state===i))throw new W("state_mismatch","Invalid state");const c=yield r.myAccountApi.completeAccount({auth_session:e.auth_session,connect_code:o,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier});return Object.assign(Object.assign({},c),{appState:e.appState,response_type:qe.ConnectCode})})()}checkSession(t){var e=this;return(0,d.A)(function*(){if(!e.cookieStorage.get(e.isAuthenticatedCookieName)){if(!e.cookieStorage.get("auth0.is.authenticated"))return;e.cookieStorage.save(e.isAuthenticatedCookieName,!0,{daysUntilExpire:e.sessionCheckExpiryDays,cookieDomain:e.options.cookieDomain}),e.cookieStorage.remove("auth0.is.authenticated")}try{yield e.getTokenSilently(t)}catch{}})()}getTokenSilently(){var t=arguments,e=this;return(0,d.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{};var o,i;const a=Object.assign(Object.assign({cacheMode:"on"},r),{authorizationParams:Object.assign(Object.assign(Object.assign({},e.options.authorizationParams),r.authorizationParams),{scope:$t(e.scope,null===(o=r.authorizationParams)||void 0===o?void 0:o.scope,(null===(i=r.authorizationParams)||void 0===i?void 0:i.audience)||e.options.authorizationParams.audience)})}),s=yield((c,l)=>{let u=Un[l];return u||(u=e._getTokenSilently(a).finally(()=>{delete Un[l],u=null}),Un[l]=u),u})(0,"".concat(e.options.clientId,"::").concat(a.authorizationParams.audience,"::").concat(a.authorizationParams.scope));return r.detailedResponse?s:s?.access_token})()}_getTokenSilently(t){var e=this;return(0,d.A)(function*(){const{cacheMode:r}=t,o=x(t,["cacheMode"]);if("off"!==r){const c=yield e._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:e.options.clientId,cacheMode:r});if(c)return c}if("cache-only"===r)return;const i=(a=e.options.clientId,s=o.authorizationParams.audience||"default","".concat("auth0.lock.getTokenSilently",".").concat(a,".").concat(s));var a,s;if(!(yield To(()=>Ft.acquireLock(i,5e3),10)))throw new ht;e.activeLockKeys.add(i),1===e.activeLockKeys.size&&window.addEventListener("pagehide",e._releaseLockOnPageHide);try{if("off"!==r){const y=yield e._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:e.options.clientId});if(y)return y}const c=e.options.useRefreshTokens?yield e._getTokenUsingRefreshToken(o):yield e._getTokenFromIFrame(o),{id_token:l,token_type:u,access_token:h,oauthTokenScope:g,expires_in:p}=c;return Object.assign(Object.assign({id_token:l,token_type:u,access_token:h},g?{scope:g}:null),{expires_in:p})}finally{yield Ft.releaseLock(i),e.activeLockKeys.delete(i),0===e.activeLockKeys.size&&window.removeEventListener("pagehide",e._releaseLockOnPageHide)}})()}getTokenWithPopup(){var t=arguments,e=this;return(0,d.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{},o=t.length>1&&void 0!==t[1]?t[1]:{};var i,a;const s=Object.assign(Object.assign({},r),{authorizationParams:Object.assign(Object.assign(Object.assign({},e.options.authorizationParams),r.authorizationParams),{scope:$t(e.scope,null===(i=r.authorizationParams)||void 0===i?void 0:i.scope,(null===(a=r.authorizationParams)||void 0===a?void 0:a.audience)||e.options.authorizationParams.audience)})});return o=Object.assign(Object.assign({},Ye),o),yield e.loginWithPopup(s,o),(yield e.cacheManager.get(new ge({scope:s.authorizationParams.scope,audience:s.authorizationParams.audience||"default",clientId:e.options.clientId}),void 0,e.options.useMrrt)).access_token})()}isAuthenticated(){var t=this;return(0,d.A)(function*(){return!!(yield t.getUser())})()}_buildLogoutUrl(t){null!==t.clientId?t.clientId=t.clientId||this.options.clientId:delete t.clientId;const e=t.logoutParams||{},{federated:r}=e,o=x(e,["federated"]),i=r?"&federated":"";return this._url("/v2/logout?".concat(Tn(Object.assign({clientId:t.clientId},o))))+i}logout(){var t=arguments,e=this;return(0,d.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{};var o;const i=Io(r),{openUrl:a}=i,s=x(i,["openUrl"]);null===r.clientId?yield e.cacheManager.clear():yield e.cacheManager.clear(r.clientId||e.options.clientId),e.cookieStorage.remove(e.orgHintCookieName,{cookieDomain:e.options.cookieDomain}),e.cookieStorage.remove(e.isAuthenticatedCookieName,{cookieDomain:e.options.cookieDomain}),e.userCache.remove("@@user@@"),yield null===(o=e.dpop)||void 0===o?void 0:o.clear();const c=e._buildLogoutUrl(s);a?yield a(c):!1!==a&&window.location.assign(c)})()}_getTokenFromIFrame(t){var e=this;return(0,d.A)(function*(){const r=(o=e.options.clientId,"".concat("auth0.lock.getTokenFromIFrame",".").concat(o));var o;if(!(yield To(()=>Ft.acquireLock(r,5e3),10)))throw new ht;try{const i=Object.assign(Object.assign({},t.authorizationParams),{prompt:"none"}),a=e.cookieStorage.get(e.orgHintCookieName);a&&!i.organization&&(i.organization=a);const{url:s,state:c,nonce:l,code_verifier:u,redirect_uri:h,scope:g,audience:p}=yield e._prepareAuthorizeUrl(i,{response_mode:"web_message"},window.location.origin);if(window.crossOriginIsolated)throw new W("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const y=t.timeoutInSeconds||e.options.authorizeTimeoutInSeconds;let v;try{v=new URL(e.domainUrl).origin}catch{v=e.domainUrl}const f=yield function(b,T){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return new Promise((A,N)=>{const J=window.document.createElement("iframe");J.setAttribute("width","0"),J.setAttribute("height","0"),J.style.display="none";const me=()=>{window.document.body.contains(J)&&(window.document.body.removeChild(J),window.removeEventListener("message",ne,!1))};let ne;const Oe=setTimeout(()=>{N(new ht),me()},1e3*U);ne=function(le){if(le.origin!=T||!le.data||"authorization_response"!==le.data.type)return;const ut=le.source;ut&&ut.close(),le.data.response.error?N(W.fromPayload(le.data.response)):A(le.data.response),clearTimeout(Oe),window.removeEventListener("message",ne,!1),setTimeout(me,2e3)},window.addEventListener("message",ne,!1),window.document.body.appendChild(J),J.setAttribute("src",b)})}(s,v,y);if(c!==f.state)throw new W("state_mismatch","Invalid state");const _=yield e._requestToken(Object.assign(Object.assign({},t.authorizationParams),{code_verifier:u,code:f.code,grant_type:"authorization_code",redirect_uri:h,timeout:t.authorizationParams.timeout||e.httpTimeoutMs}),{nonceIn:l,organization:i.organization});return Object.assign(Object.assign({},_),{scope:g,oauthTokenScope:_.scope,audience:p})}catch(i){throw"login_required"===i.error&&e.logout({openUrl:!1}),i}finally{yield Ft.releaseLock(r)}})()}_getTokenUsingRefreshToken(t){var e=this;return(0,d.A)(function*(){var r,o;const i=yield e.cacheManager.get(new ge({scope:t.authorizationParams.scope,audience:t.authorizationParams.audience||"default",clientId:e.options.clientId}),void 0,e.options.useMrrt);if(!(i&&i.refresh_token||e.worker)){if(e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);throw new Bt(t.authorizationParams.audience||"default",t.authorizationParams.scope)}const a=t.authorizationParams.redirect_uri||e.options.authorizationParams.redirect_uri||window.location.origin,s="number"==typeof t.timeoutInSeconds?1e3*t.timeoutInSeconds:null,c=((p,y,v,f)=>{var _;if(p&&v&&f){if(y.audience!==v)return y.scope;const b=f.split(" "),T=(null===(_=y.scope)||void 0===_?void 0:_.split(" "))||[],U=T.every(A=>b.includes(A));return b.length>=T.length&&U?f:y.scope}return y.scope})(e.options.useMrrt,t.authorizationParams,i?.audience,i?.scope);try{const p=yield e._requestToken(Object.assign(Object.assign(Object.assign({},t.authorizationParams),{grant_type:"refresh_token",refresh_token:i&&i.refresh_token,redirect_uri:a}),s&&{timeout:s}),{scopesToRequest:c});if(p.refresh_token&&i?.refresh_token&&(yield e.cacheManager.updateEntry(i.refresh_token,p.refresh_token)),e.options.useMrrt&&(l=i?.audience,u=i?.scope,!(l===t.authorizationParams.audience&&Po(t.authorizationParams.scope,u)||Po(c,p.scope)))){if(e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);yield e.cacheManager.remove(e.options.clientId,t.authorizationParams.audience,t.authorizationParams.scope);const y=((v,f)=>{const _=v?.split(" ")||[],b=f?.split(" ")||[];return _.filter(T=>-1==b.indexOf(T)).join(",")})(c,p.scope);throw new En(t.authorizationParams.audience||"default",y)}return Object.assign(Object.assign({},p),{scope:t.authorizationParams.scope,oauthTokenScope:p.scope,audience:t.authorizationParams.audience||"default"})}catch(p){if((p.message.indexOf("Missing Refresh Token")>-1||p.message&&p.message.indexOf("invalid refresh token")>-1)&&e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);throw p instanceof St&&e.mfa.setMFAAuthDetails(p.mfa_token,null===(r=t.authorizationParams)||void 0===r?void 0:r.scope,null===(o=t.authorizationParams)||void 0===o?void 0:o.audience,p.mfa_requirements),p}var l,u})()}_saveEntryInCache(t){var e=this;return(0,d.A)(function*(){const{id_token:r,decodedToken:o}=t,i=x(t,["id_token","decodedToken"]);e.userCache.set("@@user@@",{id_token:r,decodedToken:o}),yield e.cacheManager.setIdToken(e.options.clientId,t.id_token,t.decodedToken),yield e.cacheManager.set(i)})()}_getIdTokenFromCache(){var t=this;return(0,d.A)(function*(){const e=t.options.authorizationParams.audience||"default",r=t.scope[e],o=yield t.cacheManager.getIdToken(new ge({clientId:t.options.clientId,audience:e,scope:r})),i=t.userCache.get("@@user@@");return o&&o.id_token===i?.id_token?i:(t.userCache.set("@@user@@",o),o)})()}_getEntryFromCache(t){var e=this;return(0,d.A)(function*(){let{scope:r,audience:o,clientId:i,cacheMode:a}=t;const s=yield e.cacheManager.get(new ge({scope:r,audience:o,clientId:i}),60,e.options.useMrrt,a);if(s&&s.access_token){const{token_type:c,access_token:l,oauthTokenScope:u,expires_in:h}=s,g=yield e._getIdTokenFromCache();return g&&Object.assign(Object.assign({id_token:g.id_token,token_type:c||"Bearer",access_token:l},u?{scope:u}:null),{expires_in:h})}})()}_requestToken(t,e){var r=this;return(0,d.A)(function*(){var o,i;const{nonceIn:a,organization:s,scopesToRequest:c}=e||{},l=yield function Qi(n,t){return On.apply(this,arguments)}(Object.assign(Object.assign({baseUrl:r.domainUrl,client_id:r.options.clientId,auth0Client:r.options.auth0Client,useFormData:r.options.useFormData,timeout:r.httpTimeoutMs,useMrrt:r.options.useMrrt,dpop:r.dpop},t),{scope:c||t.scope}),r.worker),u=yield r._verifyIdToken(l.id_token,a,s);if("authorization_code"===t.grant_type){const h=yield r._getIdTokenFromCache();null!==(i=null===(o=h?.decodedToken)||void 0===o?void 0:o.claims)&&void 0!==i&&i.sub&&h.decodedToken.claims.sub!==u.claims.sub&&(yield r.cacheManager.clear(r.options.clientId),r.userCache.remove("@@user@@"))}return yield r._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},l),{decodedToken:u,scope:t.scope,audience:t.audience||"default"}),l.scope?{oauthTokenScope:l.scope}:null),{client_id:r.options.clientId})),r.cookieStorage.save(r.isAuthenticatedCookieName,!0,{daysUntilExpire:r.sessionCheckExpiryDays,cookieDomain:r.options.cookieDomain}),r._processOrgHint(s||u.claims.org_id),Object.assign(Object.assign({},l),{decodedToken:u})})()}exchangeToken(t){var e=this;return(0,d.A)(function*(){return e._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:t.subject_token,subject_token_type:t.subject_token_type,scope:$t(e.scope,t.scope,t.audience||e.options.authorizationParams.audience),audience:t.audience||e.options.authorizationParams.audience,organization:t.organization||e.options.authorizationParams.organization})})()}_assertDpop(t){if(!t)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(t){return this._assertDpop(this.dpop),this.dpop.getNonce(t)}setDpopNonce(t,e){return this._assertDpop(this.dpop),this.dpop.setNonce(t,e)}generateDpopProof(t){return this._assertDpop(this.dpop),this.dpop.generateProof(t)}createFetcher(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ya(t,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:e=>{var r;return this.getTokenSilently({authorizationParams:{scope:null===(r=e?.scope)||void 0===r?void 0:r.join(" "),audience:e?.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(t.dpopNonceId),setDpopNonce:e=>this.setDpopNonce(e,t.dpopNonceId),generateDpopProof:e=>this.generateDpopProof(e)})}connectAccountWithRedirect(t){var e=this;return(0,d.A)(function*(){const{openUrl:r,appState:o,connection:i,scopes:a,authorization_params:s,redirectUri:c=e.options.authorizationParams.redirect_uri||window.location.origin}=t;if(!i)throw new Error("connection is required");const l=kn(Et()),u=Et(),h=yield lo(u),g=po(h),{connect_uri:p,connect_params:y,auth_session:v}=yield e.myAccountApi.connectAccount({connection:i,scopes:a,redirect_uri:c,state:l,code_challenge:g,code_challenge_method:"S256",authorization_params:s});e.transactionManager.create({state:l,code_verifier:u,auth_session:v,redirect_uri:c,appState:o,connection:i,response_type:qe.ConnectCode});const f=new URL(p);f.searchParams.set("ticket",y.ticket),r?yield r(f.toString()):window.location.assign(f)})()}_requestTokenForMfa(t,e){var r=this;return(0,d.A)(function*(){const{mfaToken:o}=t,i=x(t,["mfaToken"]);return r._requestToken(Object.assign(Object.assign({},i),{mfa_token:o}),e)})()}}function ro(){return ro=(0,d.A)(function*(n){const t=new Ns(n);return yield t.checkSession(),t}),ro.apply(this,arguments)}const ie={domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"lT0H33rFRamTUtbbXwPwO7M0SdT8Qq26",redirectUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",logoutUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",scope:"openid profile email",audience:void 0,connection:void 0},Pe={TOKEN_STORAGE:"sessionStorage",USER_INFO_STORAGE:"sessionStorage"},Ce={ACCESS_TOKEN:"auth0_access_token",USER_INFO:"auth0_user_info"};function At(n,t){return("localStorage"===t?localStorage:sessionStorage).getItem(n)}function oo(n,t,e){("localStorage"===e?localStorage:sessionStorage).setItem(n,t)}function io(n,t){("localStorage"===t?localStorage:sessionStorage).removeItem(n)}var ao=m(4230);let Di=(()=>{class n{constructor(){this.eventSubject=new w.Subject,this.events$=this.eventSubject.asObservable(),console.log("[EventBusService] Event bus initialized")}sendEvent(e){this.eventSubject.next(e)}getEvents(){return this.events$}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ui=(()=>{class n{constructor(e,r){this.http=e,this.eventBus=r,this.id="auth of pokemon",this.STANDARD_JWT_CLAIMS=["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at","iss","aud","exp","iat","auth_time","nonce","acr","amr","azp","at_hash","c_hash"],this.auth0Client=null,this.userSubject=new w.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("[AuthService - USERS_CRUD MFE] Initializing Auth0 authentication service"),console.log("[AuthService - USERS_CRUD MFE] This is the USERS_CRUD version, different from shell"),this.initializationPromise=this.initializeAuth0()}initializeAuth0(){var e=this;return(0,d.A)(function*(){try{if(console.log("[AuthService] Starting Auth0 client initialization..."),!ie||"object"!=typeof ie)throw new Error("[AuthService] AUTH0_CONFIG is not defined or invalid");if(!ie.domain||!ie.clientId)throw new Error("[AuthService] AUTH0_CONFIG is missing required fields (domain, clientId)");e.auth0Client=yield function Ws(n){return ro.apply(this,arguments)}({domain:ie.domain,clientId:ie.clientId,authorizationParams:{redirect_uri:ie.redirectUri,scope:ie.scope,...ie.audience&&{audience:ie.audience}},cacheLocation:"memory",useRefreshTokens:!0}),console.log("[AuthService] Auth0 client initialized successfully")}catch(r){throw console.error("[AuthService] Failed to initialize Auth0 client:",r),r}})()}ensureInitialized(){var e=this;return(0,d.A)(function*(){if(yield e.initializationPromise,!e.auth0Client)throw new Error("[AuthService] Auth0 client failed to initialize")})()}login(e,r){var o=this;return(0,d.A)(function*(){e&&console.log(`[AuthService] Logging in: ${e}`);try{let s;if(yield o.ensureInitialized(),!window.location.pathname.includes("auth-callback")&&window.location.search){const l=window.location.search;s={returnTo:l},console.log("[AuthService] Preserving URL parameters through auth flow:",l)}const c={redirect_uri:ie.redirectUri,scope:ie.scope,...ie.audience&&{audience:ie.audience},...ie.connection&&{connection:ie.connection}};r?.invitation&&(c.invitation=r.invitation,console.log("[AuthService] Including invitation parameter:",r.invitation)),r?.organization&&(c.organization=r.organization,console.log("[AuthService] Including organization parameter:",r.organization)),console.log("[AuthService] Starting Auth0 login redirect..."),yield o.auth0Client.loginWithRedirect({authorizationParams:c,...s&&{appState:s}})}catch(i){throw console.error("[AuthService] Login failed:",i),i}})()}handleCallback(){var e=this;return(0,d.A)(function*(){try{console.log("[AuthService] Processing Auth0 callback..."),yield e.ensureInitialized();const r=yield e.auth0Client.handleRedirectCallback();console.log("[AuthService] Callback processed successfully"),r.appState?console.log("[AuthService] Restored appState from auth flow:",JSON.stringify(r.appState)):console.log("[AuthService] No appState restored (user may not have started from invitation link)");const o=yield e.auth0Client.getUser();if(!o)return console.warn("[AuthService] No user info returned from Auth0"),{success:!1};e.logUserClaims(o),e.setUserInfo(o);const i=yield e.auth0Client.getTokenSilently();return e.setToken(i),console.log("[AuthService] Authentication successful"),{success:!0,appState:r.appState}}catch(r){return console.error("[AuthService] Error processing callback:",r),console.error("[AuthService] Error details:",JSON.stringify(r,null,2)),{success:!1}}})()}logUserClaims(e){console.log("=".repeat(80)),console.log("[AuthService] \u{1f50d} AUTH0 ID TOKEN - ALL CLAIMS:"),console.log("=".repeat(80)),this.logStandardClaims(e);const r=this.getCustomClaims(e);this.logClaims("\n\u{1f511} Custom Claims (Auth0):",r,e);const o=this.getAdditionalClaims(e);this.logClaims("\n\u{1f527} Additional Claims:",o,e),console.log("\n\u{1f4e6} Complete User Object (JSON):"),console.log(JSON.stringify(e,null,2)),console.log("=".repeat(80))}logStandardClaims(e){console.log("\n\u{1f4cb} Standard OIDC Claims:"),["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at"].forEach(o=>{console.log(`  \u2022 ${"sub"===o?`${o} (Subject/User ID)`:o}:`,e[o])})}logClaims(e,r,o){console.log(e),0!==r.length?r.forEach(i=>{const a=o[i],s="object"==typeof a?JSON.stringify(a,null,2):a;console.log(`  \u2022 ${i}:`,s)}):console.log("  No custom claims found")}getCustomClaims(e){return Object.keys(e).filter(r=>!this.STANDARD_JWT_CLAIMS.includes(r)&&this.isNamespacedClaim(r))}getAdditionalClaims(e){return Object.keys(e).filter(r=>!this.STANDARD_JWT_CLAIMS.includes(r)&&!this.isNamespacedClaim(r))}isNamespacedClaim(e){return e.startsWith("http://")||e.startsWith("https://")}logout(){var e=this;return(0,d.A)(function*(){io(Ce.ACCESS_TOKEN,Pe.TOKEN_STORAGE),io(Ce.USER_INFO,Pe.USER_INFO_STORAGE),e.userSubject.next(null),e.emitAuthEvent("logout",null),console.log("[AuthService] User logged out, clearing Auth0 session");try{yield e.ensureInitialized(),yield e.auth0Client.logout({logoutParams:{returnTo:ie.logoutUri}})}catch(r){console.error("[AuthService] Error during Auth0 logout:",r)}})()}getToken(){var e=this;return(0,d.A)(function*(){const r=At(Ce.ACCESS_TOKEN,Pe.TOKEN_STORAGE);if(r)return r;try{yield e.ensureInitialized();const o=yield e.auth0Client.getTokenSilently();return e.setToken(o),o}catch(o){return console.error("[AuthService] Error getting token from Auth0:",o),null}})()}getTokenSync(){return At(Ce.ACCESS_TOKEN,Pe.TOKEN_STORAGE)}setToken(e){oo(Ce.ACCESS_TOKEN,e,Pe.TOKEN_STORAGE),this.emitAuthEvent("token_updated",{token:e})}isAuthenticated(){var e=this;return(0,d.A)(function*(){try{return yield e.ensureInitialized(),yield e.auth0Client.isAuthenticated()}catch(r){return console.error("[AuthService] Error checking authentication status:",r),!!At(Ce.ACCESS_TOKEN,Pe.TOKEN_STORAGE)}})()}isAuthenticatedSync(){return!!At(Ce.ACCESS_TOKEN,Pe.TOKEN_STORAGE)}getUser(){return this.userSubject.value}getUserData(){const e=this.getUser();if(!e)return null;const r=this.extractClaimValue(e,"role","user"),o=this.extractClaimValue(e,["org","organization"],"default");return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:r,org:o}}extractClaimValue(e,r,o){const i=Array.isArray(r)?r:[r];for(const s of i){const c=e[s];if(c)return c}const a=this.getCustomClaims(e);for(const s of i){const c=a.find(l=>l.toLowerCase().includes(s.toLowerCase()));if(c&&e[c]){const l=e[c];return Array.isArray(l)?l[0]:l}}return o}getUserInfoFromStorage(){const e=At(Ce.USER_INFO,Pe.USER_INFO_STORAGE);return e?JSON.parse(e):null}setUserInfo(e){oo(Ce.USER_INFO,JSON.stringify(e),Pe.USER_INFO_STORAGE),this.userSubject.next(e),console.log("[AuthService] \u{1f4be} User info stored in sessionStorage:"),console.log("  Standard claims:",{sub:e.sub,name:e.name,email:e.email,email_verified:e.email_verified});const r=this.getCustomClaims(e);r.length>0&&(console.log("  Custom claims stored:"),r.forEach(o=>{console.log(`    \u2022 ${o}:`,e[o])})),this.emitAuthEvent("user_info_updated",e)}emitAuthEvent(e,r){const o={type:`auth:${e}`,payload:r,timestamp:(new Date).toISOString()};this.eventBus.sendEvent(JSON.stringify(o)),console.log("[AuthService] Auth event emitted:",o.type)}static{this.\u0275fac=function(r){return new(r||n)(S.\u0275\u0275inject(ao.HttpClient),S.\u0275\u0275inject(Di))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),zs=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=S.\u0275\u0275defineComponent({type:n,selectors:[["org-core-services"]],standalone:!0,features:[S.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(r,o){1&r&&(S.\u0275\u0275elementStart(0,"p"),S.\u0275\u0275text(1," core-services works! "),S.\u0275\u0275elementEnd())}})}}return n})();var ue=function(n){return n.SUPER_ADMIN="super-admin",n.ORG_ADMIN="org-admin",n.TEAM_LEAD="team-lead",n.SALES_EXECUTIVE="sales-executive",n}(ue||{});let Hs=(()=>{class n{constructor(e){this.currentUserSubject=new w.BehaviorSubject(this.getDummyUser()),this.currentUser$=this.currentUserSubject.asObservable(),this.dataService=e}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(e){this.currentUserSubject.next(e)}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){const r=this.getCurrentUser();return!!r&&e.includes(r.role)}isAdmin(){return this.hasAnyRole([ue.SUPER_ADMIN,ue.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([ue.SUPER_ADMIN,ue.ORG_ADMIN,ue.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:ue.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:ue.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:ue.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:ue.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:ue.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:ue.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const r=this.getAllUsers();return this.isTeamLeadOrHigher()?r.filter(o=>o.role===ue.SALES_EXECUTIVE||o.id===e.id):r.filter(o=>o.id===e.id)}getDummyUser(){return{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:ue.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}}static{this.\u0275fac=function(r){return new(r||n)(S.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var so=m(3103),ve=function(n){return n.COMPLETED="completed",n.PENDING="pending",n.CANCELLED="cancelled",n}(ve||{}),Re=function(n){return n.ELECTRONICS="Electronics",n.SOFTWARE="Software",n.SERVICES="Services",n.HARDWARE="Hardware",n}(Re||{});let Js=(()=>{class n{constructor(e){this.dummySalesData=this.generateDummyData(),this.dataService=e}getSalesHistory(e,r,o){if(this.dataService)return this.dataService.getSalesHistory(e,r,o);let i=this.dummySalesData.filter(a=>a.salesExecutiveId===e);return r&&(i=i.filter(a=>a.date>=r)),o&&(i=i.filter(a=>a.date<=o)),(0,w.of)(i).pipe((0,so.c)(300))}getSalesSummary(e){if(this.dataService)return this.dataService.getSalesSummary(e);const r=this.dummySalesData.filter(i=>i.salesExecutiveId===e),o={totalSales:r.filter(i=>i.status===ve.COMPLETED).reduce((i,a)=>i+a.amount,0),totalCommission:r.filter(i=>i.status===ve.COMPLETED).reduce((i,a)=>i+a.commission,0),completedCount:r.filter(i=>i.status===ve.COMPLETED).length,pendingCount:r.filter(i=>i.status===ve.PENDING).length,cancelledCount:r.filter(i=>i.status===ve.CANCELLED).length};return(0,w.of)(o).pipe((0,so.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,w.of)(this.dummySalesData).pipe((0,so.c)(300))}generateDummyData(){const e=[{name:"Enterprise Software License",category:Re.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:Re.SERVICES,basePrice:25e3},{name:"Server Hardware",category:Re.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:Re.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:Re.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:Re.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:Re.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:Re.HARDWARE,basePrice:6e4}],r=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],o=["North","South","East","West","Central"],i=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],a=[ve.COMPLETED,ve.COMPLETED,ve.COMPLETED,ve.PENDING,ve.CANCELLED],s=[];let c=1;for(let l=0;l<50;l++){const u=i[l%i.length],h=e[Math.floor(Math.random()*e.length)],g=r[Math.floor(Math.random()*r.length)],p=o[Math.floor(Math.random()*o.length)],y=a[Math.floor(Math.random()*a.length)],v=h.basePrice+(1e4*Math.random()-5e3),f=.05*v,_=new Date;_.setDate(_.getDate()-Math.floor(180*Math.random())),s.push({id:"sale-"+c++,salesExecutiveId:u.id,salesExecutiveName:u.name,productName:h.name,productCategory:h.category,amount:Math.round(v),commission:Math.round(f),status:y,date:_,clientName:g,region:p})}return s.sort((l,u)=>u.date.getTime()-l.date.getTime())}static{this.\u0275fac=function(r){return new(r||n)(S.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ji=function(n){return n.SUPER_ADMIN="super-admin",n.ORG_ADMIN="org-admin",n.TEAM_LEAD="team-lead",n.MEMBER="member",n}(ji||{}),de=m(6354),V=m(9437);const co={useRealAuth0:!1,domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"lT0H33rFRamTUtbbXwPwO7M0SdT8Qq26",redirectUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",scope:"openid profile email",audience:void 0,managementApiAudience:void 0};let Vt=(()=>{class n{get domain(){return co.domain}get managementApiUrl(){return`https://${this.domain}/api/v2`}constructor(e,r){this.http=e,this.authService=r}getHeaders(){const e=this.authService.getTokenSync();return new ao.HttpHeaders({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}getCurrentUser(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}getUserInfo(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}listUsers(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/users?${r}`:`${this.managementApiUrl}/users`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}getUserById(e){return this.http.get(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}createUser(e){return this.http.post(`${this.managementApiUrl}/users`,e,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}updateUser(e,r){return this.http.patch(`${this.managementApiUrl}/users/${e}`,r,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}deleteUser(e){return this.http.delete(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}blockUser(e,r=!0){return this.http.patch(`${this.managementApiUrl}/users/${e}`,{blocked:r},{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}listOrganizations(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/organizations?${r}`:`${this.managementApiUrl}/organizations`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}getOrganizationById(e){return this.http.get(`${this.managementApiUrl}/organizations/${e}`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}createOrganization(e){return this.http.post(`${this.managementApiUrl}/organizations`,e,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}updateOrganization(e,r){return this.http.patch(`${this.managementApiUrl}/organizations/${e}`,r,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}listRoles(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/roles?${r}`:`${this.managementApiUrl}/roles`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}getRoleById(e){return this.http.get(`${this.managementApiUrl}/roles/${e}`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}createRole(e){return this.http.post(`${this.managementApiUrl}/roles`,e,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}updateRole(e,r){return this.http.patch(`${this.managementApiUrl}/roles/${e}`,r,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}listUserRoles(e){return this.http.get(`${this.managementApiUrl}/users/${e}/roles`,{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}assignRolesToUser(e,r){return this.http.post(`${this.managementApiUrl}/users/${e}/roles`,{roles:r},{headers:this.getHeaders()}).pipe((0,V.W)(this.handleError))}handleError(e){return console.error("Auth0 API Error:",e),(0,w.throwError)(()=>e)}static{this.\u0275fac=function(r){return new(r||n)(S.\u0275\u0275inject(ao.HttpClient),S.\u0275\u0275inject(Ui))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Fs=(()=>{class n{constructor(e){this.auth0Api=e,this.organizationsCache=[],this.organizationsSubject=new w.BehaviorSubject([]),this.organizations$=this.organizationsSubject.asObservable(),this.loadOrganizations()}loadOrganizations(){this.auth0Api.listOrganizations().pipe((0,de.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,V.W)(e=>(console.error("Error loading organizations from Auth0:",e),(0,w.of)([])))).subscribe(e=>{e&&e.length>0&&(this.organizationsCache=e,this.organizationsSubject.next(this.organizationsCache))})}mapAuth0OrgsToOrganizations(e){return e&&Array.isArray(e)?e.map(r=>({id:r.id,name:r.name,description:r.display_name||r.name,createdAt:r.created_at?new Date(r.created_at):new Date,updatedAt:r.updated_at?new Date(r.updated_at):new Date,isActive:!0,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}})):[]}getAll(){return this.auth0Api.listOrganizations().pipe((0,de.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,V.W)(e=>(console.error("Error getting organizations:",e),(0,w.of)(this.organizationsCache))))}getById(e){return this.getAll().pipe((0,de.T)(r=>r.find(o=>o.id===e)))}create(e){return this.auth0Api.createOrganization({name:e.name,display_name:e.description}).pipe((0,de.T)(o=>{const i={id:o.id,name:o.name,description:o.display_name||o.name,createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at||o.created_at),isActive:!0,settings:e.settings||{timezone:"UTC",currency:"USD",locale:"en-US"}};return this.organizationsCache.push(i),this.organizationsSubject.next(this.organizationsCache),i}),(0,V.W)(o=>{console.error("Creating organizations in Auth0 requires admin privileges:",o);const i={...e,id:`org-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return(0,w.of)(i)}))}update(e,r){const o={};return r.name&&(o.name=r.name),r.description&&(o.display_name=r.description),this.auth0Api.updateOrganization(e,o).pipe((0,de.T)(i=>{const a=this.organizationsCache.findIndex(s=>s.id===e);return-1!==a?(this.organizationsCache[a]={...this.organizationsCache[a],...r,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),this.organizationsCache[a]):null}),(0,V.W)(i=>{console.warn("Updating organizations in Auth0 requires specific permissions:",i);const a=this.organizationsCache.findIndex(s=>s.id===e);return-1!==a?(this.organizationsCache[a]={...this.organizationsCache[a],...r,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),(0,w.of)(this.organizationsCache[a])):(0,w.of)(null)}))}delete(e){return console.warn("Deleting organizations should be done with caution and may not be supported via Auth0 API"),(0,w.of)(!1)}static{this.\u0275fac=function(r){return new(r||n)(S.\u0275\u0275inject(Vt))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Vs=(()=>{class n{constructor(e){this.auth0Api=e,this.teamsCache=[],this.teamsSubject=new w.BehaviorSubject([]),this.teams$=this.teamsSubject.asObservable(),this.loadTeams()}loadTeams(){this.teamsCache=this.getDummyTeams(),this.teamsSubject.next(this.teamsCache)}getDummyTeams(){return[{id:"team1",name:"Engineering",description:"Engineering team",organizationId:"org1",leadId:"1",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team2",name:"Product",description:"Product team",organizationId:"org1",leadId:"2",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team3",name:"Design",description:"Design team",organizationId:"org2",leadId:"3",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0}]}getAll(){return(0,w.of)(this.teamsCache)}getByOrganization(e){return this.getAll().pipe((0,de.T)(r=>r.filter(o=>o.organizationId===e)))}getById(e){const r=this.teamsCache.find(o=>o.id===e);return(0,w.of)(r)}create(e){const r={id:`team-${Date.now()}`,name:e.name,description:e.description,organizationId:e.organizationId,leadId:e.leadId,createdAt:new Date,updatedAt:new Date,isActive:!0};return this.teamsCache.push(r),this.teamsSubject.next(this.teamsCache),(0,w.of)(r)}update(e,r){const o=this.teamsCache.findIndex(i=>i.id===e);return-1!==o?(this.teamsCache[o]={...this.teamsCache[o],...r,updatedAt:new Date},this.teamsSubject.next(this.teamsCache),(0,w.of)(this.teamsCache[o])):(0,w.of)(null)}delete(e){const r=this.teamsCache.findIndex(o=>o.id===e);return-1!==r?(this.teamsCache[r].isActive=!1,this.teamsCache[r].updatedAt=new Date,this.teamsSubject.next(this.teamsCache),(0,w.of)(!0)):(0,w.of)(!1)}static{this.\u0275fac=function(r){return new(r||n)(S.\u0275\u0275inject(Vt))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Bs=(()=>{class n{constructor(e){this.auth0Api=e,this.usersCache=[],this.usersSubject=new w.BehaviorSubject([]),this.users$=this.usersSubject.asObservable(),this.currentAuth0User=null,this.loadUsers()}loadUsers(){if(!co.useRealAuth0)return this.usersCache=this.getDummyUsers(),void this.usersSubject.next(this.usersCache);(0,w.forkJoin)({authUser:this.auth0Api.getCurrentUser().pipe((0,V.W)(()=>(0,w.of)(null))),userInfo:this.auth0Api.getUserInfo().pipe((0,V.W)(()=>(0,w.of)(null)))}).subscribe(({authUser:e,userInfo:r})=>{const o=this.getDummyUsers();if(e||r){const i=this.mapAuth0UserToUser(e||r);this.currentAuth0User=i,this.usersCache=[i,...o.slice(1)]}else console.log("Could not fetch real user from Auth0 API, using dummy data"),this.usersCache=o;this.usersSubject.next(this.usersCache)})}getDummyUsers(){return[{id:"1",name:"John Doe",email:"john.doe@example.com",organizationId:"org1",teamId:"team1",roleId:"super-admin",isActive:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"2",name:"Jane Smith",email:"jane.smith@example.com",organizationId:"org1",teamId:"team2",roleId:"org-admin",isActive:!0,createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-02-10")},{id:"3",name:"Bob Johnson",email:"bob.johnson@example.com",organizationId:"org2",teamId:"team3",roleId:"team-lead",isActive:!0,createdAt:new Date("2024-03-05"),updatedAt:new Date("2024-03-05")},{id:"4",name:"Alice Brown",email:"alice.brown@example.com",organizationId:"org1",teamId:"team1",roleId:"member",isActive:!1,createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-05-10")}]}mapAuth0UserToUser(e){return e?{id:e.user_id||e.sub||"1",name:this.extractUserName(e),email:e.email||"user@example.com",organizationId:e.org_id||"default-org",teamId:"default-team",roleId:"member",isActive:!e.blocked,createdAt:e.created_at?new Date(e.created_at):new Date,updatedAt:e.updated_at?new Date(e.updated_at):new Date,auth0UserId:e.user_id||e.sub}:this.getDummyUsers()[0]}extractUserName(e){return e.name?e.name:e.nickname?e.nickname:`${e.given_name||""} ${e.family_name||""}`.trim()||(e.email?e.email.split("@")[0]:`User ${e.user_id||e.sub}`)}mapAuth0UsersToUsers(e){return e&&Array.isArray(e)?e.map(r=>({id:r.user_id,name:this.extractUserName(r),email:r.email||"",organizationId:r.org_id||"default-org",teamId:"default-team",roleId:"default-role",isActive:!r.blocked,createdAt:r.created_at?new Date(r.created_at):new Date,updatedAt:r.updated_at?new Date(r.updated_at):new Date,auth0UserId:r.user_id})):[]}mapUserToAuth0Format(e){return{email:e.email,name:e.name,nickname:e.name,blocked:!e.isActive,connection:"Username-Password-Authentication",email_verified:!1,user_metadata:{organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId}}}getAll(){return(0,w.of)(this.usersCache)}getCurrentAuth0User(){return this.currentAuth0User}getByOrganization(e){return this.getAll().pipe((0,de.T)(r=>r.filter(o=>o.organizationId===e)))}getByTeam(e){return this.getAll().pipe((0,de.T)(r=>r.filter(o=>o.teamId===e)))}getById(e){const r=this.usersCache.find(o=>o.id===e);return r?(0,w.of)(r):this.auth0Api.getUserById(e).pipe((0,de.T)(o=>{const i=this.mapAuth0UsersToUsers([o]);return i.length>0?i[0]:void 0}),(0,V.W)(o=>(console.error("Error getting user by ID (Management API not available):",o),(0,w.of)(void 0))))}create(e){const r=this.mapUserToAuth0Format(e);return this.auth0Api.createUser(r).pipe((0,de.T)(o=>{const i={id:o.user_id||`user-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date,auth0UserId:o.user_id};return this.usersCache.push(i),this.usersSubject.next(this.usersCache),i}),(0,V.W)(o=>{console.error("Error creating user (Management API not available):",o);const i={id:`local-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date};return this.usersCache.push(i),this.usersSubject.next(this.usersCache),(0,w.of)(i)}))}update(e,r){const o=this.mapUserToAuth0Format(r);return this.auth0Api.updateUser(e,o).pipe((0,de.T)(i=>{const a=this.usersCache.findIndex(s=>s.id===e);return-1!==a?(this.usersCache[a]={...this.usersCache[a],...r,updatedAt:new Date},this.usersSubject.next(this.usersCache),this.usersCache[a]):null}),(0,V.W)(i=>{console.error("Error updating user (Management API not available):",i);const a=this.usersCache.findIndex(s=>s.id===e);return-1!==a?(this.usersCache[a]={...this.usersCache[a],...r,updatedAt:new Date},this.usersSubject.next(this.usersCache),(0,w.of)(this.usersCache[a])):(0,w.of)(null)}))}delete(e){return this.auth0Api.blockUser(e,!0).pipe((0,de.T)(()=>{const r=this.usersCache.findIndex(o=>o.id===e);return-1!==r&&(this.usersCache[r].isActive=!1,this.usersCache[r].updatedAt=new Date,this.usersSubject.next(this.usersCache),!0)}),(0,V.W)(r=>{console.error("Error deleting user (Management API not available):",r);const o=this.usersCache.findIndex(i=>i.id===e);return-1!==o&&(this.usersCache[o].isActive=!1,this.usersCache[o].updatedAt=new Date,this.usersSubject.next(this.usersCache)),(0,w.of)(!0)}))}static{this.\u0275fac=function(r){return new(r||n)(S.\u0275\u0275inject(Vt))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Gs=(()=>{class n{constructor(e){this.auth0Api=e,this.systemRoles=[{id:"role-1",name:"Super Admin",description:"Full system access",permissions:["*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-2",name:"Organization Admin",description:"Full access within organization",permissions:["org:*","team:*","user:*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-3",name:"Team Lead",description:"Manage team and team members",permissions:["team:read","team:update","user:read","user:update"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-4",name:"Member",description:"Basic member access",permissions:["user:read"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.rolesCache=[...this.systemRoles],this.rolesSubject=new w.BehaviorSubject(this.rolesCache),this.roles$=this.rolesSubject.asObservable(),this.loadCustomRoles()}loadCustomRoles(){this.auth0Api.listRoles().pipe((0,de.T)(e=>this.mapAuth0RolesToRoles(e)),(0,V.W)(e=>(console.error("Error loading custom roles from Auth0:",e),(0,w.of)([])))).subscribe(e=>{this.rolesCache=[...this.systemRoles,...e],this.rolesSubject.next(this.rolesCache)})}mapAuth0RolesToRoles(e){return e&&Array.isArray(e)?e.map(r=>({id:r.id,name:r.name,description:r.description||"",permissions:[],isSystemRole:!1,createdAt:new Date,updatedAt:new Date})):[]}getAll(){return(0,w.of)(this.rolesCache)}getById(e){const r=this.rolesCache.find(o=>o.id===e);return(0,w.of)(r)}getSystemRoles(){const e=this.rolesCache.filter(r=>r.isSystemRole);return(0,w.of)(e)}getCustomRoles(){const e=this.rolesCache.filter(r=>!r.isSystemRole);return(0,w.of)(e)}create(e){return this.auth0Api.createRole({name:e.name,description:e.description}).pipe((0,de.T)(o=>{const i={id:o.id,name:o.name,description:o.description||"",permissions:e.permissions,isSystemRole:!1,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(i),this.rolesSubject.next(this.rolesCache),i}),(0,V.W)(o=>{console.error("Error creating role in Auth0:",o);const i={...e,id:`role-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(i),this.rolesSubject.next(this.rolesCache),(0,w.of)(i)}))}update(e,r){const o=this.rolesCache.findIndex(i=>i.id===e);return-1===o||this.rolesCache[o].isSystemRole?(0,w.of)(null):(this.rolesCache[o]={...this.rolesCache[o],...r,updatedAt:new Date},this.rolesSubject.next(this.rolesCache),(0,w.of)(this.rolesCache[o]))}delete(e){const r=this.rolesCache.findIndex(o=>o.id===e);return-1===r||this.rolesCache[r].isSystemRole?(0,w.of)(!1):(this.rolesCache.splice(r,1),this.rolesSubject.next(this.rolesCache),(0,w.of)(!0))}static{this.\u0275fac=function(r){return new(r||n)(S.\u0275\u0275inject(Vt))}}static{this.\u0275prov=S.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()},8399:(B,D,m)=>{m.d(D,{_:()=>R});var S=m(6129);class R{constructor(w,x=R.now){this.schedulerActionCtor=w,this.now=x}schedule(w,x=0,C){return new this.schedulerActionCtor(this,w).schedule(C,x)}}R.now=S.U.now},2688:(B,D,m)=>{m.d(D,{x:()=>w});var S=m(9131),R=m(9326),d=m(9724);function w(...x){return(0,S.K)()((0,d.H)(x,(0,R.lI)(x)))}},983:(B,D,m)=>{m.d(D,{I:()=>d,w:()=>R});var S=m(1985);const R=new S.c(x=>x.complete());function d(x){return x?function w(x){return new S.c(C=>x.schedule(()=>C.complete()))}(x):R}},9724:(B,D,m)=>{m.d(D,{H:()=>d});var S=m(5894),R=m(8750);function d(w,x){return x?(0,S.c)(w,x):(0,R.Tg)(w)}},1807:(B,D,m)=>{m.d(D,{O:()=>x});var S=m(1985),R=m(3236),d=m(9470),w=m(8211);function x(C=0,E,I=R.b){let O=-1;return null!=E&&((0,d.m)(E)?I=E:O=E),new S.c(L=>{let M=(0,w.v)(C)?+C-I.now():C;M<0&&(M=0);let Q=0;return I.schedule(function(){L.closed||(L.next(Q++),0<=O?this.schedule(void 0,O):L.complete())},M)})}},9437:(B,D,m)=>{m.d(D,{W:()=>w});var S=m(8750),R=m(4360),d=m(9974);function w(x){return(0,d.N)((C,E)=>{let L,I=null,O=!1;I=C.subscribe((0,R._)(E,void 0,void 0,M=>{L=(0,S.Tg)(x(M,w(x)(C))),I?(I.unsubscribe(),I=null,L.subscribe(E)):O=!0})),O&&(I.unsubscribe(),I=null,L.subscribe(E))})}},9131:(B,D,m)=>{m.d(D,{K:()=>R});var S=m(6365);function R(){return(0,S.U)(1)}},3103:(B,D,m)=>{m.d(D,{c:()=>w});var S=m(3236),R=m(3183),d=m(1807);function w(x,C=S.E){const E=(0,d.O)(x,C);return(0,R.o)(()=>E)}},3183:(B,D,m)=>{m.d(D,{o:()=>E});var S=m(2688),R=m(6697),d=m(3557),w=m(3703),x=m(3028),C=m(8750);function E(I,O){return O?L=>(0,S.x)(O.pipe((0,R.s)(1),(0,d.w)()),L.pipe(E(I))):(0,x.Z)((L,M)=>(0,C.Tg)(I(L,M)).pipe((0,R.s)(1),(0,w.u)(L)))}},3557:(B,D,m)=>{m.d(D,{w:()=>w});var S=m(9974),R=m(4360),d=m(5343);function w(){return(0,S.N)((x,C)=>{x.subscribe((0,R._)(C,d.l))})}},3703:(B,D,m)=>{m.d(D,{u:()=>R});var S=m(6354);function R(d){return(0,S.T)(()=>d)}},6365:(B,D,m)=>{m.d(D,{U:()=>d});var S=m(3028),R=m(3669);function d(w=1/0){return(0,S.Z)(R.D,w)}},5412:(B,D,m)=>{m.d(D,{h:()=>w});var S=m(8750),R=m(5225),d=m(4360);function w(x,C,E,I,O,L,M,Q){const ae=[];let fe=0,Ze=0,Ke=!1;const Xe=()=>{Ke&&!ae.length&&!fe&&C.complete()},lt=z=>fe<I?Ye(z):ae.push(z),Ye=z=>{L&&C.next(z),fe++;let Z=!1;(0,S.Tg)(E(z,Ze++)).subscribe((0,d._)(C,W=>{O?.(W),L?lt(W):C.next(W)},()=>{Z=!0},void 0,()=>{if(Z)try{for(fe--;ae.length&&fe<I;){const W=ae.shift();M?(0,R.N)(C,M,()=>Ye(W)):Ye(W)}Xe()}catch(W){C.error(W)}}))};return x.subscribe((0,d._)(C,lt,()=>{Ke=!0,Xe()})),()=>{Q?.()}}},3028:(B,D,m)=>{m.d(D,{Z:()=>C});var S=m(6354),R=m(8750),d=m(9974),w=m(5412),x=m(8071);function C(E,I,O=1/0){return(0,x.T)(I)?C((L,M)=>(0,S.T)((Q,ae)=>I(L,Q,M,ae))((0,R.Tg)(E(L,M))),O):("number"==typeof I&&(O=I),(0,d.N)((L,M)=>(0,w.h)(L,M,E,O)))}},941:(B,D,m)=>{m.d(D,{Q:()=>w});var S=m(5225),R=m(9974),d=m(4360);function w(x,C=0){return(0,R.N)((E,I)=>{E.subscribe((0,d._)(I,O=>(0,S.N)(I,x,()=>I.next(O),C),()=>(0,S.N)(I,x,()=>I.complete(),C),O=>(0,S.N)(I,x,()=>I.error(O),C)))})}},6745:(B,D,m)=>{m.d(D,{_:()=>R});var S=m(9974);function R(d,w=0){return(0,S.N)((x,C)=>{C.add(d.schedule(()=>x.subscribe(C),w))})}},6697:(B,D,m)=>{m.d(D,{s:()=>w});var S=m(983),R=m(9974),d=m(4360);function w(x){return x<=0?()=>S.w:(0,R.N)((C,E)=>{let I=0;C.subscribe((0,d._)(E,O=>{++I<=x&&(E.next(O),x<=I&&E.complete())}))})}},7119:(B,D,m)=>{m.d(D,{S:()=>x});var S=m(1985),R=m(4761),d=m(8071),w=m(5225);function x(C,E){return new S.c(I=>{let O;return(0,w.N)(I,E,()=>{O=C[R.l](),(0,w.N)(I,E,()=>{let L,M;try{({value:L,done:M}=O.next())}catch(Q){return void I.error(Q)}M?I.complete():I.next(L)},0,!0)}),()=>(0,d.T)(O?.return)&&O.return()})}},5894:(B,D,m)=>{m.d(D,{c:()=>Ye});var S=m(8750),R=m(941),d=m(6745),C=m(1985),I=m(7119),O=m(5225);function L(z,Z){if(!z)throw new Error("Iterable cannot be null");return new C.c(W=>{(0,O.N)(W,Z,()=>{const Me=z[Symbol.asyncIterator]();(0,O.N)(W,Z,()=>{Me.next().then(dt=>{dt.done?W.complete():W.next(dt.value)})},0,!0)})})}var M=m(5055),Q=m(9858),ae=m(7441),fe=m(5397),Ze=m(7953),Ke=m(591),Xe=m(5196);function Ye(z,Z){if(null!=z){if((0,M.l)(z))return function w(z,Z){return(0,S.Tg)(z).pipe((0,d._)(Z),(0,R.Q)(Z))}(z,Z);if((0,ae.X)(z))return function E(z,Z){return new C.c(W=>{let Me=0;return Z.schedule(function(){Me===z.length?W.complete():(W.next(z[Me++]),W.closed||this.schedule())})})}(z,Z);if((0,Q.y)(z))return function x(z,Z){return(0,S.Tg)(z).pipe((0,d._)(Z),(0,R.Q)(Z))}(z,Z);if((0,Ze.T)(z))return L(z,Z);if((0,fe.x)(z))return(0,I.S)(z,Z);if((0,Xe.U)(z))return function lt(z,Z){return L((0,Xe.C)(z),Z)}(z,Z)}throw(0,Ke.L)(z)}},6780:(B,D,m)=>{m.d(D,{R:()=>x});var S=m(3961);class R extends S.yU{constructor(E,I){super()}schedule(E,I=0){return this}}const d={setInterval(C,E,...I){const{delegate:O}=d;return O?.setInterval?O.setInterval(C,E,...I):setInterval(C,E,...I)},clearInterval(C){const{delegate:E}=d;return(E?.clearInterval||clearInterval)(C)},delegate:void 0};var w=m(7908);class x extends R{constructor(E,I){super(E,I),this.scheduler=E,this.work=I,this.pending=!1}schedule(E,I=0){var O;if(this.closed)return this;this.state=E;const L=this.id,M=this.scheduler;return null!=L&&(this.id=this.recycleAsyncId(M,L,I)),this.pending=!0,this.delay=I,this.id=null!==(O=this.id)&&void 0!==O?O:this.requestAsyncId(M,this.id,I),this}requestAsyncId(E,I,O=0){return d.setInterval(E.flush.bind(E,this),O)}recycleAsyncId(E,I,O=0){if(null!=O&&this.delay===O&&!1===this.pending)return I;null!=I&&d.clearInterval(I)}execute(E,I){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const O=this._execute(E,I);if(O)return O;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(E,I){let L,O=!1;try{this.work(E)}catch(M){O=!0,L=M||new Error("Scheduled action threw falsy error")}if(O)return this.unsubscribe(),L}unsubscribe(){if(!this.closed){const{id:E,scheduler:I}=this,{actions:O}=I;this.work=this.state=this.scheduler=null,this.pending=!1,(0,w.o)(O,this),null!=E&&(this.id=this.recycleAsyncId(I,E,null)),this.delay=null,super.unsubscribe()}}}},707:(B,D,m)=>{m.d(D,{q:()=>R});var S=m(8399);class R extends S._{constructor(w,x=S._.now){super(w,x),this.actions=[],this._active=!1}flush(w){const{actions:x}=this;if(this._active)return void x.push(w);let C;this._active=!0;do{if(C=w.execute(w.state,w.delay))break}while(w=x.shift());if(this._active=!1,C){for(;w=x.shift();)w.unsubscribe();throw C}}}},3236:(B,D,m)=>{m.d(D,{E:()=>d,b:()=>w});var S=m(6780);const d=new(m(707).q)(S.R),w=d},6129:(B,D,m)=>{m.d(D,{U:()=>S});const S={now:()=>(S.delegate||Date).now(),delegate:void 0}},9326:(B,D,m)=>{m.d(D,{R0:()=>C,lI:()=>x,ms:()=>w});var S=m(8071),R=m(9470);function d(E){return E[E.length-1]}function w(E){return(0,S.T)(d(E))?E.pop():void 0}function x(E){return(0,R.m)(d(E))?E.pop():void 0}function C(E,I){return"number"==typeof d(E)?E.pop():I}},5225:(B,D,m)=>{function S(R,d,w,x=0,C=!1){const E=d.schedule(function(){w(),C?R.add(this.schedule(null,x)):this.unsubscribe()},x);if(R.add(E),!C)return E}m.d(D,{N:()=>S})},8211:(B,D,m)=>{function S(R){return R instanceof Date&&!isNaN(R)}m.d(D,{v:()=>S})},9470:(B,D,m)=>{m.d(D,{m:()=>R});var S=m(8071);function R(d){return d&&(0,S.T)(d.schedule)}},467:(B,D,m)=>{function S(d,w,x,C,E,I,O){try{var L=d[I](O),M=L.value}catch(Q){return void x(Q)}L.done?w(M):Promise.resolve(M).then(C,E)}function R(d){return function(){var w=this,x=arguments;return new Promise(function(C,E){var I=d.apply(w,x);function O(M){S(I,C,E,O,L,"next",M)}function L(M){S(I,C,E,O,L,"throw",M)}O(void 0)})}}m.d(D,{A:()=>R})}}]);