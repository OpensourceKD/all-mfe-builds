(self.webpackChunkmfe_USERS_CRUD=self.webpackChunkmfe_USERS_CRUD||[]).push([[609],{6609:(Y,D,h)=>{h.r(D),h.d(D,{AUTH0_CONFIG:()=>bo,Auth0ApiService:()=>yn,AuthService:()=>Ni,CoreServicesComponent:()=>zs,CoreServicesService:()=>P,EventBusService:()=>Wi,OrganizationService:()=>Fs,ProductCategory:()=>ot,RoleManagementService:()=>Gs,RoleService:()=>Hs,STORAGE_CONFIG:()=>nt,STORAGE_KEYS:()=>rt,SalesDataService:()=>Js,SalesStatus:()=>Je,SystemRole:()=>zi,TeamService:()=>Bs,UserRole:()=>Re,UserService:()=>Vs,getStorageItem:()=>Gt,removeStorageItem:()=>_o,setStorageItem:()=>go});var w=h(4332);let P=(()=>{class n{constructor(){}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var l=h(467),g=h(3425);function C(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]])}return e}"function"==typeof SuppressedError&&SuppressedError;var j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},R={},U={};Object.defineProperty(U,"__esModule",{value:!0});var K=function(){function n(){var t=this;this.locked=new Map,this.addToLocked=function(e,r){var o=t.locked.get(e);void 0===o?t.locked.set(e,void 0===r?[]:[r]):void 0!==r&&(o.unshift(r),t.locked.set(e,o))},this.isLocked=function(e){return t.locked.has(e)},this.lock=function(e){return new Promise(function(r,o){t.isLocked(e)?t.addToLocked(e,r):(t.addToLocked(e),r())})},this.unlock=function(e){var r=t.locked.get(e);if(void 0!==r&&0!==r.length){var o=r.pop();t.locked.set(e,r),void 0!==o&&setTimeout(o,0)}else t.locked.delete(e)}}return n.getInstance=function(){return void 0===n.instance&&(n.instance=new n),n.instance},n}();U.default=function(){return K.getInstance()};var H=j&&j.__awaiter||function(n,t,e,r){return new(e||(e=Promise))(function(o,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function s(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?o(d.value):new e(function(u){u(d.value)}).then(a,s)}c((r=r.apply(n,t||[])).next())})},V=j&&j.__generator||function(n,t){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(c){return function(d){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(n,a)}catch(p){u=[6,p],r=0}finally{e=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([c,d])}}},Z=j;Object.defineProperty(R,"__esModule",{value:!0});var ue=U,q={key:function(n){return H(Z,void 0,void 0,function(){return V(this,function(t){throw new Error("Unsupported")})})},getItem:function(n){return H(Z,void 0,void 0,function(){return V(this,function(t){throw new Error("Unsupported")})})},clear:function(){return H(Z,void 0,void 0,function(){return V(this,function(n){return[2,window.localStorage.clear()]})})},removeItem:function(n){return H(Z,void 0,void 0,function(){return V(this,function(t){throw new Error("Unsupported")})})},setItem:function(n,t){return H(Z,void 0,void 0,function(){return V(this,function(e){throw new Error("Unsupported")})})},keySync:function(n){return window.localStorage.key(n)},getItemSync:function(n){return window.localStorage.getItem(n)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(n){return window.localStorage.removeItem(n)},setItemSync:function(n,t){return window.localStorage.setItem(n,t)}};function se(n){return new Promise(function(t){return setTimeout(t,n)})}function fe(n){for(var e="",r=0;r<n;r++)e+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"[Math.floor(61*Math.random())];return e}var de=function(){function n(t){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+fe(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=t,void 0===n.waiters&&(n.waiters=[])}return n.prototype.acquireLock=function(t,e){return void 0===e&&(e=5e3),H(this,void 0,void 0,function(){var r,o,i,a,s,c,d;return V(this,function(u){switch(u.label){case 0:r=Date.now()+fe(4),o=Date.now()+e,i="browser-tabs-lock-key-"+t,a=void 0===this.storageHandler?q:this.storageHandler,u.label=1;case 1:return Date.now()<o?[4,se(30)]:[3,8];case 2:return u.sent(),null!==a.getItemSync(i)?[3,5]:(s=this.id+"-"+t+"-"+r,[4,se(Math.floor(25*Math.random()))]);case 3:return u.sent(),a.setItemSync(i,JSON.stringify({id:this.id,iat:r,timeoutKey:s,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,se(30)];case 4:return u.sent(),null!==(c=a.getItemSync(i))&&(d=JSON.parse(c)).id===this.id&&d.iat===r?(this.acquiredIatSet.add(r),this.refreshLockWhileAcquired(i,r),[2,!0]):[3,7];case 5:return n.lockCorrector(void 0===this.storageHandler?q:this.storageHandler),[4,this.waitForSomethingToChange(o)];case 6:u.sent(),u.label=7;case 7:return r=Date.now()+fe(4),[3,1];case 8:return[2,!1]}})})},n.prototype.refreshLockWhileAcquired=function(t,e){return H(this,void 0,void 0,function(){var r=this;return V(this,function(o){return setTimeout(function(){return H(r,void 0,void 0,function(){var i,a,s;return V(this,function(c){switch(c.label){case 0:return[4,ue.default().lock(e)];case 1:return c.sent(),this.acquiredIatSet.has(e)?null===(a=(i=void 0===this.storageHandler?q:this.storageHandler).getItemSync(t))?(ue.default().unlock(e),[2]):((s=JSON.parse(a)).timeRefreshed=Date.now(),i.setItemSync(t,JSON.stringify(s)),ue.default().unlock(e),this.refreshLockWhileAcquired(t,e),[2]):(ue.default().unlock(e),[2])}})})},1e3),[2]})})},n.prototype.waitForSomethingToChange=function(t){return H(this,void 0,void 0,function(){return V(this,function(e){switch(e.label){case 0:return[4,new Promise(function(r){var o=!1,i=Date.now(),a=!1;function s(){if(a||(window.removeEventListener("storage",s),n.removeFromWaiting(s),clearTimeout(c),a=!0),!o){o=!0;var d=50-(Date.now()-i);d>0?setTimeout(r,d):r(null)}}window.addEventListener("storage",s),n.addToWaiting(s);var c=setTimeout(s,Math.max(0,t-Date.now()))})];case 1:return e.sent(),[2]}})})},n.addToWaiting=function(t){this.removeFromWaiting(t),void 0!==n.waiters&&n.waiters.push(t)},n.removeFromWaiting=function(t){void 0!==n.waiters&&(n.waiters=n.waiters.filter(function(e){return e!==t}))},n.notifyWaiters=function(){void 0!==n.waiters&&n.waiters.slice().forEach(function(t){return t()})},n.prototype.releaseLock=function(t){return H(this,void 0,void 0,function(){return V(this,function(e){switch(e.label){case 0:return[4,this.releaseLock__private__(t)];case 1:return[2,e.sent()]}})})},n.prototype.releaseLock__private__=function(t){return H(this,void 0,void 0,function(){var e,r,o,i;return V(this,function(a){switch(a.label){case 0:return null===(o=(e=void 0===this.storageHandler?q:this.storageHandler).getItemSync(r="browser-tabs-lock-key-"+t))?[2]:(i=JSON.parse(o)).id!==this.id?[3,2]:[4,ue.default().lock(i.iat)];case 1:a.sent(),this.acquiredIatSet.delete(i.iat),e.removeItemSync(r),ue.default().unlock(i.iat),n.notifyWaiters(),a.label=2;case 2:return[2]}})})},n.lockCorrector=function(t){for(var e=Date.now()-5e3,r=t,o=[],i=0;;){var a=r.keySync(i);if(null===a)break;o.push(a),i++}for(var s=!1,c=0;c<o.length;c++){var d=o[c];if(d.includes("browser-tabs-lock-key")){var u=r.getItemSync(d);if(null!==u){var p=JSON.parse(u);(void 0===p.timeRefreshed&&p.timeAcquired<e||void 0!==p.timeRefreshed&&p.timeRefreshed<e)&&(r.removeItemSync(d),s=!0)}}}s&&n.notifyWaiters()},n.waiters=void 0,n}(),pe=R.default=de;const Te={timeoutInSeconds:60},Q={name:"auth0-spa-js",version:"2.13.0"},z=()=>Date.now();class N extends Error{constructor(t,e){super(e),this.error=t,this.error_description=e,Object.setPrototypeOf(this,N.prototype)}static fromPayload(t){let{error:e,error_description:r}=t;return new N(e,r)}}class oe extends N{constructor(t,e,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(t,e),this.state=r,this.appState=o,Object.setPrototypeOf(this,oe.prototype)}}class Pe extends N{constructor(t,e,r,o){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(t,e),this.connection=r,this.state=o,this.appState=i,Object.setPrototypeOf(this,Pe.prototype)}}class Ke extends N{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,Ke.prototype)}}class lt extends Ke{constructor(t){super(),this.popup=t,Object.setPrototypeOf(this,lt.prototype)}}class Fe extends N{constructor(t){super("cancelled","Popup closed"),this.popup=t,Object.setPrototypeOf(this,Fe.prototype)}}class Zt extends N{constructor(){super("popup_open","Unable to open a popup for loginWithPopup - window.open returned `null`"),Object.setPrototypeOf(this,Zt.prototype)}}class wt extends N{constructor(t,e,r,o){super(t,e),this.mfa_token=r,this.mfa_requirements=o,Object.setPrototypeOf(this,wt.prototype)}}class Ut extends N{constructor(t,e){super("missing_refresh_token","Missing Refresh Token (audience: '".concat(Lt(t,["default"]),"', scope: '").concat(Lt(e),"')")),this.audience=t,this.scope=e,Object.setPrototypeOf(this,Ut.prototype)}}class Xt extends N{constructor(t,e){super("missing_scopes","Missing requested scopes after refresh (audience: '".concat(Lt(t,["default"]),"', missing scope: '").concat(Lt(e),"')")),this.audience=t,this.scope=e,Object.setPrototypeOf(this,Xt.prototype)}}class jt extends N{constructor(t){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=t,Object.setPrototypeOf(this,jt.prototype)}}function Lt(n){return n&&!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).includes(n)?n:""}const Mt=()=>window.crypto,bt=()=>{let t="";return Array.from(Mt().getRandomValues(new Uint8Array(43))).forEach(e=>t+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~."[e%66]),t},Yt=n=>btoa(n),Ao=[{key:"name",type:["string"]},{key:"version",type:["string","number"]},{key:"env",type:["object"]}],f=function(n){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object.keys(n).reduce((e,r)=>{if(t&&"env"===r)return e;const o=Ao.find(i=>i.key===r);return o&&o.type.includes(typeof n[r])&&(e[r]=n[r]),e},{})},y=n=>{var r,{clientId:t}=n,e=C(n,["clientId"]);return new URLSearchParams((r=Object.assign({client_id:t},e),Object.keys(r).filter(o=>void 0!==r[o]).reduce((o,i)=>Object.assign(Object.assign({},o),{[i]:r[i]}),{}))).toString()},_=function(){var n=(0,l.A)(function*(t){return yield Mt().subtle.digest({name:"SHA-256"},(new TextEncoder).encode(t))});return function(e){return n.apply(this,arguments)}}(),v=n=>{return t=n.replace(/_/g,"/").replace(/-/g,"+"),decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));var t},I=n=>{const t=new Uint8Array(n);return(e=>{const r={"+":"-","/":"_","=":""};return e.replace(/[+/=]/g,o=>r[o])})(window.btoa(String.fromCharCode(...Array.from(t))))},x=new TextEncoder,B=new TextDecoder;function te(n){return"string"==typeof n?x.encode(n):B.decode(n)}function we(n){if("number"!=typeof n.modulusLength||n.modulusLength<2048)throw new Ie(`${n.name} modulusLength must be at least 2048 bits`)}function le(){return(le=(0,l.A)(function*(n,t,e){if(!1===e.usages.includes("sign"))throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const r=`${Be(te(JSON.stringify(n)))}.${Be(te(JSON.stringify(t)))}`;return`${r}.${Be(yield crypto.subtle.sign(function(o){switch(o.algorithm.name){case"ECDSA":return{name:o.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return we(o.algorithm),{name:o.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return we(o.algorithm),{name:o.algorithm.name};case"Ed25519":return{name:o.algorithm.name}}throw new ne}(e),e,te(r)))}`})).apply(this,arguments)}let me;function Be(n){return me(n)}me=Uint8Array.prototype.toBase64?n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):t=>{t instanceof ArrayBuffer&&(t=new Uint8Array(t));const e=[];for(let r=0;r<t.byteLength;r+=32768)e.push(String.fromCharCode.apply(null,t.subarray(r,r+32768)));return btoa(e.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};class ne extends Error{constructor(t){var e;super(t??"operation not supported"),this.name=this.constructor.name,null===(e=Error.captureStackTrace)||void 0===e||e.call(Error,this,this.constructor)}}class Ie extends Error{constructor(t){var e;super(t),this.name=this.constructor.name,null===(e=Error.captureStackTrace)||void 0===e||e.call(Error,this,this.constructor)}}function Ue(n){switch(n.algorithm.name){case"RSA-PSS":return function(t){if("SHA-256"===t.algorithm.hash.name)return"PS256";throw new ne("unsupported RsaHashedKeyAlgorithm hash name")}(n);case"RSASSA-PKCS1-v1_5":return function(t){if("SHA-256"===t.algorithm.hash.name)return"RS256";throw new ne("unsupported RsaHashedKeyAlgorithm hash name")}(n);case"ECDSA":return function(t){if("P-256"===t.algorithm.namedCurve)return"ES256";throw new ne("unsupported EcKeyAlgorithm namedCurve")}(n);case"Ed25519":return"Ed25519";default:throw new ne("unsupported CryptoKey algorithm name")}}function We(n){return n instanceof CryptoKey}function Ye(n){return We(n)&&"public"===n.type}function zn(){return zn=(0,l.A)(function*(n,t,e,r,o,i){const a=n?.privateKey,s=n?.publicKey;if(!We(c=a)||"private"!==c.type)throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var c;if(!Ye(s))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(!0!==s.extractable)throw new TypeError('"keypair.publicKey.extractable" must be true');if("string"!=typeof t)throw new TypeError('"htu" must be a string');if("string"!=typeof e)throw new TypeError('"htm" must be a string');if(void 0!==r&&"string"!=typeof r)throw new TypeError('"nonce" must be a string or undefined');if(void 0!==o&&"string"!=typeof o)throw new TypeError('"accessToken" must be a string or undefined');if(void 0!==i&&("object"!=typeof i||null===i||Array.isArray(i)))throw new TypeError('"additional" must be an object');return function X(n,t,e){return le.apply(this,arguments)}({alg:Ue(a),typ:"dpop+jwt",jwk:yield Eo(s)},Object.assign(Object.assign({},i),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:e,nonce:r,htu:t,ath:o?Be(yield crypto.subtle.digest("SHA-256",te(o))):void 0}),a)}),zn.apply(this,arguments)}function Eo(n){return Hn.apply(this,arguments)}function Hn(){return(Hn=(0,l.A)(function*(n){const{kty:t,e,n:r,x:o,y:i,crv:a}=yield crypto.subtle.exportKey("jwk",n);return{kty:t,crv:a,e,n:r,x:o,y:i}})).apply(this,arguments)}const Bi=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange","http://auth0.com/oauth/grant-type/mfa-oob","http://auth0.com/oauth/grant-type/mfa-otp","http://auth0.com/oauth/grant-type/mfa-recovery-code"];const Xi=function(){var n=(0,l.A)(function*(t,e){const r=yield fetch(t,e);return{ok:r.ok,json:yield r.json(),headers:(o=r.headers,[...o].reduce((i,a)=>{let[s,c]=a;return i[s]=c,i},{}))};var o});return function(e,r){return n.apply(this,arguments)}}(),Yi=function(){var n=(0,l.A)(function*(t,e,r){const o=new AbortController;let i;return e.signal=o.signal,Promise.race([Xi(t,e),new Promise((a,s)=>{i=setTimeout(()=>{o.abort(),s(new Error("Timeout when executing 'fetch'"))},r)})]).finally(()=>{clearTimeout(i)})});return function(e,r,o){return n.apply(this,arguments)}}(),$i=function(){var n=(0,l.A)(function*(t,e,r,o,i,a,s,c){return d={auth:{audience:e,scope:r},timeout:i,fetchUrl:t,fetchOptions:o,useFormData:s,useMrrt:c},u=a,new Promise(function(p,A){const m=new MessageChannel;m.port1.onmessage=function(E){E.data.error?A(new Error(E.data.error)):p(E.data),m.port1.close()},u.postMessage(d,[m.port2])});var d,u});return function(e,r,o,i,a,s,c,d){return n.apply(this,arguments)}}(),Qi=function(){var n=(0,l.A)(function*(t,e,r,o,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4;return i?$i(t,e,r,o,s,i,a,arguments.length>7?arguments[7]:void 0):Yi(t,o,s)});return function(e,r,o,i,a,s){return n.apply(this,arguments)}}();function So(n,t,e,r,o,i,a,s,c,d){return Jn.apply(this,arguments)}function Jn(){return(Jn=(0,l.A)(function*(n,t,e,r,o,i,a,s,c,d){if(c){const M=yield c.generateProof({url:n,method:o.method||"GET",nonce:yield c.getNonce()});o.headers=Object.assign(Object.assign({},o.headers),{dpop:M})}let u,p=null;for(let M=0;M<3;M++)try{u=yield Qi(n,e,r,o,i,a,t,s),p=null;break}catch(J){p=J}if(p)throw p;const A=u.json,{error:m,error_description:E}=A,k=C(A,["error","error_description"]),{headers:b,ok:S}=u;let T;if(c&&(T=b["dpop-nonce"],T&&(yield c.setNonce(T))),!S){const M=E||"HTTP error. Unable to fetch ".concat(n);if("mfa_required"===m)throw new wt(m,M,k.mfa_token,k.mfa_requirements);if("missing_refresh_token"===m)throw new Ut(e,r);if("use_dpop_nonce"===m){if(!c||!T||d)throw new jt(T);return So(n,t,e,r,o,i,a,s,c,!0)}throw new N(m||"request_error",M)}return k})).apply(this,arguments)}function Fn(){return(Fn=(0,l.A)(function*(n,t){var{baseUrl:e,timeout:r,audience:o,scope:i,auth0Client:a,useFormData:s,useMrrt:c,dpop:d}=n,u=C(n,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);const p="urn:ietf:params:oauth:grant-type:token-exchange"===u.grant_type,A="refresh_token"===u.grant_type&&c,m=Object.assign(Object.assign(Object.assign(Object.assign({},u),p&&o&&{audience:o}),p&&i&&{scope:i}),A&&{audience:o,scope:i}),E=s?y(m):JSON.stringify(m),k=Bi.includes(u.grant_type);return yield So("".concat(e,"/oauth/token"),r,o||"default",i,{method:"POST",body:E,headers:{"Content-Type":s?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(f(a||Q)))}},t,s,c,k?d:void 0)})).apply(this,arguments)}const gn=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return(n=>Array.from(new Set(n)))(t.filter(Boolean).join(" ").trim().split(/\s+/)).join(" ")},_n=(n,t,e)=>{let r;return e&&(r=n[e]),r||(r=n.default),gn(r,t)};class Ne{constructor(t){let r=arguments.length>2?arguments[2]:void 0;this.prefix=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"@@auth0spajs@@",this.suffix=r,this.clientId=t.clientId,this.scope=t.scope,this.audience=t.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(t){const[e,r,o,i]=t.split("::");return new Ne({clientId:r,scope:i,audience:o},e)}static fromCacheEntry(t){const{scope:e,audience:r,client_id:o}=t;return new Ne({scope:e,audience:r,clientId:o})}}class ta{set(t,e){localStorage.setItem(t,JSON.stringify(e))}get(t){const e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch{return}}remove(t){localStorage.removeItem(t)}allKeys(){return Object.keys(window.localStorage).filter(t=>t.startsWith("@@auth0spajs@@"))}}class ko{constructor(){this.enclosedCache=function(){let t={};return{set(e,r){t[e]=r},get(e){const r=t[e];if(r)return r},remove(e){delete t[e]},allKeys:()=>Object.keys(t)}}()}}class na{constructor(t,e,r){this.cache=t,this.keyManifest=e,this.nowProvider=r||z}setIdToken(t,e,r){var o=this;return(0,l.A)(function*(){var i;const a=o.getIdTokenCacheKey(t);yield o.cache.set(a,{id_token:e,decodedToken:r}),yield null===(i=o.keyManifest)||void 0===i?void 0:i.add(a)})()}getIdToken(t){var e=this;return(0,l.A)(function*(){const r=yield e.cache.get(e.getIdTokenCacheKey(t.clientId));if(!r&&t.scope&&t.audience){const o=yield e.get(t);return o&&o.id_token&&o.decodedToken?{id_token:o.id_token,decodedToken:o.decodedToken}:void 0}if(r)return{id_token:r.id_token,decodedToken:r.decodedToken}})()}get(t){var e=arguments,r=this;return(0,l.A)(function*(){let o=e.length>1&&void 0!==e[1]?e[1]:0,i=e.length>2&&void 0!==e[2]&&e[2],a=e.length>3?e[3]:void 0;var s;let c=yield r.cache.get(t.toKey());if(!c){const p=yield r.getCacheKeys();if(!p)return;const A=r.matchExistingCacheKey(t,p);if(A&&(c=yield r.cache.get(A)),!c&&i&&"cache-only"!==a)return r.getEntryWithRefreshToken(t,p)}if(!c)return;const d=yield r.nowProvider(),u=Math.floor(d/1e3);return c.expiresAt-o<u?c.body.refresh_token?r.modifiedCachedEntry(c,t):(yield r.cache.remove(t.toKey()),void(yield null===(s=r.keyManifest)||void 0===s?void 0:s.remove(t.toKey()))):c.body})()}modifiedCachedEntry(t,e){var r=this;return(0,l.A)(function*(){return t.body={refresh_token:t.body.refresh_token,audience:t.body.audience,scope:t.body.scope},yield r.cache.set(e.toKey(),t),{refresh_token:t.body.refresh_token,audience:t.body.audience,scope:t.body.scope}})()}set(t){var e=this;return(0,l.A)(function*(){var r;const o=new Ne({clientId:t.client_id,scope:t.scope,audience:t.audience}),i=yield e.wrapCacheEntry(t);yield e.cache.set(o.toKey(),i),yield null===(r=e.keyManifest)||void 0===r?void 0:r.add(o.toKey())})()}remove(t,e,r){var o=this;return(0,l.A)(function*(){const i=new Ne({clientId:t,scope:r,audience:e});yield o.cache.remove(i.toKey())})()}clear(t){var e=this;return(0,l.A)(function*(){var r;const o=yield e.getCacheKeys();o&&(yield o.filter(i=>!t||i.includes(t)).reduce(function(){var i=(0,l.A)(function*(a,s){yield a,yield e.cache.remove(s)});return function(a,s){return i.apply(this,arguments)}}(),Promise.resolve()),yield null===(r=e.keyManifest)||void 0===r?void 0:r.clear())})()}wrapCacheEntry(t){var e=this;return(0,l.A)(function*(){const r=yield e.nowProvider();return{body:t,expiresAt:Math.floor(r/1e3)+t.expires_in}})()}getCacheKeys(){var t=this;return(0,l.A)(function*(){var e;return t.keyManifest?null===(e=yield t.keyManifest.get())||void 0===e?void 0:e.keys:t.cache.allKeys?t.cache.allKeys():void 0})()}getIdTokenCacheKey(t){return new Ne({clientId:t},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(t,e){return e.filter(r=>{var o;const i=Ne.fromKey(r),a=new Set(i.scope&&i.scope.split(" ")),s=(null===(o=t.scope)||void 0===o?void 0:o.split(" "))||[],c=i.scope&&s.reduce((d,u)=>d&&a.has(u),!0);return"@@auth0spajs@@"===i.prefix&&i.clientId===t.clientId&&i.audience===t.audience&&c})[0]}getEntryWithRefreshToken(t,e){var r=this;return(0,l.A)(function*(){var o;for(const i of e){const a=Ne.fromKey(i);if("@@auth0spajs@@"===a.prefix&&a.clientId===t.clientId){const s=yield r.cache.get(i);if(null!==(o=s?.body)&&void 0!==o&&o.refresh_token)return r.modifiedCachedEntry(s,t)}}})()}updateEntry(t,e){var r=this;return(0,l.A)(function*(){var o;const i=yield r.getCacheKeys();if(i)for(const a of i){const s=yield r.cache.get(a);if((null===(o=s?.body)||void 0===o?void 0:o.refresh_token)===t){const c=Object.assign(Object.assign({},s.body),{refresh_token:e});yield r.set(c)}}})()}}class ra{constructor(t,e,r){this.storage=t,this.clientId=e,this.cookieDomain=r,this.storageKey="".concat("a0.spajs.txs",".").concat(this.clientId)}create(t){this.storage.save(this.storageKey,t,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const $t=n=>"number"==typeof n,oa=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"];var Qt=j&&j.__assign||function(){return Qt=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},Qt.apply(this,arguments)};function qt(n,t){if(!t)return"";var e="; "+n;return!0===t?e:e+"="+t}function To(n,t,e){document.cookie=function aa(n,t,e){return encodeURIComponent(n).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(t).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(r){if("number"==typeof r.expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*r.expires),r.expires=o}return qt("Expires",r.expires?r.expires.toUTCString():"")+qt("Domain",r.domain)+qt("Path",r.path)+qt("Secure",r.secure)+qt("SameSite",r.sameSite)}(e)}(n,t,Qt({path:"/"},e))}var Po=To,Io=function(n,t){To(n,"",Qt(Qt({},t),{expires:-1}))};const Kt={get(n){const t=function(n){return function sa(){return function(n){for(var t={},e=n?n.split("; "):[],r=/(%[\dA-F]{2})+/gi,o=0;o<e.length;o++){var i=e[o].split("="),a=i.slice(1).join("=");'"'===a.charAt(0)&&(a=a.slice(1,-1));try{t[i[0].replace(r,decodeURIComponent)]=a.replace(r,decodeURIComponent)}catch{}}return t}(document.cookie)}()[n]}(n);if(void 0!==t)return JSON.parse(t)},save(n,t,e){let r={};"https:"===window.location.protocol&&(r={secure:!0,sameSite:"none"}),e?.daysUntilExpire&&(r.expires=e.daysUntilExpire),e?.cookieDomain&&(r.domain=e.cookieDomain),Po(n,JSON.stringify(t),r)},remove(n,t){let e={};t?.cookieDomain&&(e.domain=t.cookieDomain),Io(n,e)}},ua={get:n=>Kt.get(n)||Kt.get("".concat("_legacy_").concat(n)),save(n,t,e){let r={};"https:"===window.location.protocol&&(r={secure:!0}),e?.daysUntilExpire&&(r.expires=e.daysUntilExpire),e?.cookieDomain&&(r.domain=e.cookieDomain),Po("".concat("_legacy_").concat(n),JSON.stringify(t),r),Kt.save(n,t,e)},remove(n,t){let e={};t?.cookieDomain&&(e.domain=t.cookieDomain),Io(n,e),Kt.remove(n,t),Kt.remove("".concat("_legacy_").concat(n),t)}},la={get(n){if(typeof sessionStorage>"u")return;const t=sessionStorage.getItem(n);return null!=t?JSON.parse(t):void 0},save(n,t){sessionStorage.setItem(n,JSON.stringify(t))},remove(n){sessionStorage.removeItem(n)}};var At,n;(n=At||(At={})).Code="code",n.ConnectCode="connect_code";var Bn,ha=function(n){return Bn=Bn||function da(n,t,e){var r=void 0===t?null:t,o=function(c,d){var u=atob(c);if(d){for(var p=new Uint8Array(u.length),A=0,m=u.length;A<m;++A)p[A]=u.charCodeAt(A);return String.fromCharCode.apply(null,new Uint16Array(p.buffer))}return u}(n,void 0!==e&&e),i=o.indexOf("\n",10)+1,a=o.substring(i)+(r?"//# sourceMappingURL="+r:""),s=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(s)}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHQpe2xldHtlcnJvcjpyLGVycm9yX2Rlc2NyaXB0aW9uOnN9PXQ7cmV0dXJuIG5ldyBlKHIscyl9fWNsYXNzIHQgZXh0ZW5kcyBle2NvbnN0cnVjdG9yKGUscyl7c3VwZXIoIm1pc3NpbmdfcmVmcmVzaF90b2tlbiIsIk1pc3NpbmcgUmVmcmVzaCBUb2tlbiAoYXVkaWVuY2U6ICciLmNvbmNhdChyKGUsWyJkZWZhdWx0Il0pLCInLCBzY29wZTogJyIpLmNvbmNhdChyKHMpLCInKSIpKSx0aGlzLmF1ZGllbmNlPWUsdGhpcy5zY29wZT1zLE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLHQucHJvdG90eXBlKX19ZnVuY3Rpb24gcihlKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06W107cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+IiIuY29uY2F0KGUsInwiKS5jb25jYXQodCk7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jIGU9PntsZXQgcixjLHtkYXRhOnt0aW1lb3V0OmksYXV0aDphLGZldGNoVXJsOmYsZmV0Y2hPcHRpb25zOmwsdXNlRm9ybURhdGE6cCx1c2VNcnJ0Omh9LHBvcnRzOlt1XX09ZSxkPXt9O2NvbnN0e2F1ZGllbmNlOmcsc2NvcGU6eX09YXx8e307dHJ5e2NvbnN0IGU9cD8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShsLmJvZHkpOkpTT04ucGFyc2UobC5ib2R5KTtpZighZS5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1lLmdyYW50X3R5cGUpe2lmKGM9KChlLHQpPT5vW24oZSx0KV0pKGcseSksIWMmJmgpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKCIiLmNvbmNhdChlLCJ8IikpKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxnKTtlJiYhdCYmKGM9ZSl9aWYoIWMpdGhyb3cgbmV3IHQoZyx5KTtsLmJvZHk9cD9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpfWxldCBhLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGE9bmV3IEFib3J0Q29udHJvbGxlcixsLnNpZ25hbD1hLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoaj1pLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsaikpKSksZmV0Y2goZixPYmplY3QuYXNzaWduKHt9LGwpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHUucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBhJiZhLmFib3J0KCksdm9pZCB1LnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO189ay5oZWFkZXJzLGQ9Wy4uLl9dLnJlZHVjZSgoKGUsdCk9PntsZXRbcixzXT10O3JldHVybiBlW3JdPXMsZX0pLHt9KSxyPWF3YWl0IGsuanNvbigpLHIucmVmcmVzaF90b2tlbj8oaCYmKG8ubGF0ZXN0X3JlZnJlc2hfdG9rZW49ci5yZWZyZXNoX3Rva2VuLE89YyxiPXIucmVmcmVzaF90b2tlbixPYmplY3QuZW50cmllcyhvKS5mb3JFYWNoKChlPT57bGV0W3Qscl09ZTtyPT09TyYmKG9bdF09Yil9KSkpLCgoZSx0LHIpPT57b1tuKHQscildPWV9KShyLnJlZnJlc2hfdG9rZW4sZyx5KSxkZWxldGUgci5yZWZyZXNoX3Rva2VuKTooKGUsdCk9PntkZWxldGUgb1tuKGUsdCldfSkoZyx5KSx1LnBvc3RNZXNzYWdlKHtvazprLm9rLGpzb246cixoZWFkZXJzOmR9KX1jYXRjaChlKXt1LnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcjplLmVycm9yLGVycm9yX2Rlc2NyaXB0aW9uOmUubWVzc2FnZX0saGVhZGVyczpkfSl9dmFyIE8sYixfLGp9KSl9KCk7Cgo=",null,!1),new Worker(Bn,n)};const Vn={},Co=function(){var n=(0,l.A)(function*(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let r=0;r<e;r++)if(yield t())return!0;return!1});return function(e){return n.apply(this,arguments)}}();class pa{constructor(t,e){this.cache=t,this.clientId=e,this.manifestKey=this.createManifestKeyFrom(this.clientId)}add(t){var e=this;return(0,l.A)(function*(){var r;const o=new Set((null===(r=yield e.cache.get(e.manifestKey))||void 0===r?void 0:r.keys)||[]);o.add(t),yield e.cache.set(e.manifestKey,{keys:[...o]})})()}remove(t){var e=this;return(0,l.A)(function*(){const r=yield e.cache.get(e.manifestKey);if(r){const o=new Set(r.keys);return o.delete(t),o.size>0?yield e.cache.set(e.manifestKey,{keys:[...o]}):yield e.cache.remove(e.manifestKey)}})()}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(t){return"".concat("@@auth0spajs@@","::").concat(t)}}const fa={memory:()=>(new ko).enclosedCache,localstorage:()=>new ta},Do=n=>fa[n],Uo=n=>{const{openUrl:t,onRedirect:e}=n,r=C(n,["openUrl","onRedirect"]);return Object.assign(Object.assign({},r),{openUrl:!1===t||t?t:e})},jo=(n,t)=>{const e=t?.split(" ")||[];return(n?.split(" ")||[]).every(r=>e.includes(r))},Et={NONCE:"nonce",KEYPAIR:"keypair"};class ma{constructor(t){this.clientId=t}getVersion(){return 1}createDbHandle(){const t=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((e,r)=>{t.onupgradeneeded=()=>Object.values(Et).forEach(o=>t.result.createObjectStore(o)),t.onerror=()=>r(t.error),t.onsuccess=()=>e(t.result)})}getDbHandle(){var t=this;return(0,l.A)(function*(){return t.dbHandle||(t.dbHandle=yield t.createDbHandle()),t.dbHandle})()}executeDbRequest(t,e,r){var o=this;return(0,l.A)(function*(){const i=r((yield o.getDbHandle()).transaction(t,e).objectStore(t));return new Promise((a,s)=>{i.onsuccess=()=>a(i.result),i.onerror=()=>s(i.error)})})()}buildKey(t){const e=t?"_".concat(t):"auth0";return"".concat(this.clientId,"::").concat(e)}setNonce(t,e){return this.save(Et.NONCE,this.buildKey(e),t)}setKeyPair(t){return this.save(Et.KEYPAIR,this.buildKey(),t)}save(t,e,r){var o=this;return(0,l.A)(function*(){yield o.executeDbRequest(t,"readwrite",i=>i.put(r,e))})()}findNonce(t){return this.find(Et.NONCE,this.buildKey(t))}findKeyPair(){return this.find(Et.KEYPAIR,this.buildKey())}find(t,e){return this.executeDbRequest(t,"readonly",r=>r.get(e))}deleteBy(t,e){var r=this;return(0,l.A)(function*(){const o=yield r.executeDbRequest(t,"readonly",i=>i.getAllKeys());o?.filter(e).map(i=>r.executeDbRequest(t,"readwrite",a=>a.delete(i)))})()}deleteByClientId(t,e){return this.deleteBy(t,r=>"string"==typeof r&&r.startsWith("".concat(e,"::")))}clearNonces(){return this.deleteByClientId(Et.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(Et.KEYPAIR,this.clientId)}}class ya{constructor(t){this.storage=new ma(t)}getNonce(t){return this.storage.findNonce(t)}setNonce(t,e){return this.storage.setNonce(t,e)}getOrGenerateKeyPair(){var t=this;return(0,l.A)(function*(){let e=yield t.storage.findKeyPair();return e||(e=yield function Vi(){return(n=(0,l.A)(function*(t,e){var r;let o;if("string"!=typeof t||0===t.length)throw new TypeError('"alg" must be a non-empty string');switch(t){case"PS256":o={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":o={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":o={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":o={name:"Ed25519"};break;default:throw new ne}return crypto.subtle.generateKey(o,null!==(r=e?.extractable)&&void 0!==r&&r,["sign","verify"])}),function(t,e){return n.apply(this,arguments)})("ES256",{extractable:!1});var n}(),yield t.storage.setKeyPair(e)),e})()}generateProof(t){var e=this;return(0,l.A)(function*(){const r=yield e.getOrGenerateKeyPair();return function Zi(n){let{keyPair:t,url:e,method:r,nonce:o,accessToken:i}=n;return function Fi(n,t,e,r,o,i){return zn.apply(this,arguments)}(t,function(s){const c=new URL(s);return c.search="",c.hash="",c.href}(e),r,o,i)}(Object.assign({keyPair:r},t))})()}calculateThumbprint(){var t=this;return(0,l.A)(function*(){return function Gi(n){return(t=(0,l.A)(function*(e){if(!Ye(e))throw new TypeError('"publicKey" must be a public CryptoKey');if(!0!==e.extractable)throw new TypeError('"publicKey.extractable" must be true');const r=yield Eo(e);let o;switch(r.kty){case"EC":o={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":o={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":o={e:r.e,kty:r.kty,n:r.n};break;default:throw new ne("unsupported JWK kty")}return Be(yield crypto.subtle.digest({name:"SHA-256"},te(JSON.stringify(o))))}),function(e){return t.apply(this,arguments)})(n.publicKey);var t}(yield t.getOrGenerateKeyPair())})()}clear(){var t=this;return(0,l.A)(function*(){yield Promise.all([t.storage.clearNonces(),t.storage.clearKeyPairs()])})()}}var Wt;!function(n){n.Bearer="Bearer",n.DPoP="DPoP"}(Wt||(Wt={}));class ga{constructor(t,e){this.hooks=e,this.config=Object.assign(Object.assign({},t),{fetch:t.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(t){return/^(https?:)?\/\//i.test(t)}buildUrl(t,e){if(e){if(this.isAbsoluteUrl(e))return e;if(t)return"".concat(t.replace(/\/?\/$/,""),"/").concat(e.replace(/^\/+/,""))}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(t){return this.config.getAccessToken?this.config.getAccessToken(t):this.hooks.getAccessToken(t)}extractUrl(t){return"string"==typeof t?t:t instanceof URL?t.href:t.url}buildBaseRequest(t,e){if(!this.config.baseUrl)return new Request(t,e);const r=this.buildUrl(this.config.baseUrl,this.extractUrl(t)),o=t instanceof Request?new Request(r,t):r;return new Request(o,e)}setAuthorizationHeader(t,e){t.headers.set("authorization","".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Wt.Bearer," ").concat(e))}setDpopProofHeader(t,e){var r=this;return(0,l.A)(function*(){if(!r.config.dpopNonceId)return;const o=yield r.hooks.getDpopNonce(),i=yield r.hooks.generateDpopProof({accessToken:e,method:t.method,nonce:o,url:t.url});t.headers.set("dpop",i)})()}prepareRequest(t,e){var r=this;return(0,l.A)(function*(){const o=yield r.getAccessToken(e);let i,a;"string"==typeof o?(i=r.config.dpopNonceId?Wt.DPoP:Wt.Bearer,a=o):(i=o.token_type,a=o.access_token),r.setAuthorizationHeader(t,a,i),i===Wt.DPoP&&(yield r.setDpopProofHeader(t,a))})()}getHeader(t,e){return Array.isArray(t)?new Headers(t).get(e)||"":"function"==typeof t.get?t.get(e)||"":t[e]||""}hasUseDpopNonceError(t){if(401!==t.status)return!1;const e=this.getHeader(t.headers,"www-authenticate");return e.includes("invalid_dpop_nonce")||e.includes("use_dpop_nonce")}handleResponse(t,e){var r=this;return(0,l.A)(function*(){const o=r.getHeader(t.headers,"dpop-nonce");if(o&&(yield r.hooks.setDpopNonce(o)),!r.hasUseDpopNonceError(t))return t;if(!o||!e.onUseDpopNonceError)throw new jt(o);return e.onUseDpopNonceError()})()}internalFetchWithAuth(t,e,r,o){var i=this;return(0,l.A)(function*(){const a=i.buildBaseRequest(t,e);yield i.prepareRequest(a,o);const s=yield i.config.fetch(a);return i.handleResponse(s,r)})()}fetchWithAuth(t,e,r){const o={onUseDpopNonceError:()=>this.internalFetchWithAuth(t,e,Object.assign(Object.assign({},o),{onUseDpopNonceError:void 0}),r)};return this.internalFetchWithAuth(t,e,o,r)}}class _a{constructor(t,e){this.myAccountFetcher=t,this.apiBase=e}connectAccount(t){var e=this;return(0,l.A)(function*(){const r=yield e.myAccountFetcher.fetchWithAuth("".concat(e.apiBase,"v1/connected-accounts/connect"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return e._handleResponse(r)})()}completeAccount(t){var e=this;return(0,l.A)(function*(){const r=yield e.myAccountFetcher.fetchWithAuth("".concat(e.apiBase,"v1/connected-accounts/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return e._handleResponse(r)})()}_handleResponse(t){return(0,l.A)(function*(){let e;try{e=yield t.text(),e=JSON.parse(e)}catch(r){throw new vn({type:"invalid_json",status:t.status,title:"Invalid JSON response",detail:e||String(r)})}if(t.ok)return e;throw new vn(e)})()}}class vn extends Error{constructor(t){let{type:e,status:r,title:o,detail:i,validation_errors:a}=t;super(i),this.name="MyAccountApiError",this.type=e,this.status=r,this.title=o,this.detail=i,this.validation_errors=a,Object.setPrototypeOf(this,vn.prototype)}}const va={otp:{authenticatorTypes:["otp"]},sms:{authenticatorTypes:["oob"],oobChannels:["sms"]},email:{authenticatorTypes:["oob"],oobChannels:["email"]},push:{authenticatorTypes:["oob"],oobChannels:["auth0"]},voice:{authenticatorTypes:["oob"],oobChannels:["voice"]}};function Lo(n,t){this.v=n,this.k=t}function ye(n,t,e){if("function"==typeof n?n===t:n.has(t))return arguments.length<3?t:e;throw new TypeError("Private element is not present on this object")}function Ea(n){return new Lo(n,0)}function Mo(n,t){if(t.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function L(n,t){return n.get(ye(n,t))}function ve(n,t,e){Mo(n,t),t.set(n,e)}function he(n,t,e){return n.set(ye(n,t),e),e}function W(n,t,e){return(t="symbol"==typeof(o=function(i){if("object"!=typeof i||!i)return i;var s=i[Symbol.toPrimitive];if(void 0!==s){var c=s.call(i,"string");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(t))?o:o+"")in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n;var o}function Ko(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),e.push.apply(e,r)}return e}function F(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?Ko(Object(e),!0).forEach(function(r){W(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Ko(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function Wo(n,t){if(null==n)return{};var e,r,o=function(a,s){if(null==a)return{};var c={};for(var d in a)if({}.hasOwnProperty.call(a,d)){if(-1!==s.indexOf(d))continue;c[d]=a[d]}return c}(n,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)-1===t.indexOf(e=i[r])&&{}.propertyIsEnumerable.call(n,e)&&(o[e]=n[e])}return o}function en(n){var t,e;function r(i,a){try{var s=n[i](a),c=s.value,d=c instanceof Lo;Promise.resolve(d?c.v:c).then(function(u){if(d){var p="return"===i?"return":"next";if(!c.k||u.done)return r(p,u);u=n[p](u).value}o(s.done?"return":"normal",u)},function(u){r("throw",u)})}catch(u){o("throw",u)}}function o(i,a){switch(i){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):e=null}this._invoke=function(i,a){return new Promise(function(s,c){var d={key:i,arg:a,resolve:s,reject:c,next:null};e?e=e.next=d:(t=e=d,r(i,a))})},"function"!=typeof n.return&&(this.return=void 0)}var wn,Gn;let Zn;function Nt(n,t){if(null==n)return!1;try{return n instanceof t||Object.getPrototypeOf(n)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}function ie(n,t,e){const r=new TypeError(n,{cause:e});return Object.assign(r,{code:t}),r}en.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},en.prototype.next=function(n){return this._invoke("next",n)},en.prototype.throw=function(n){return this._invoke("throw",n)},en.prototype.return=function(n){return this._invoke("return",n)},(typeof navigator>"u"||null===(wn=navigator.userAgent)||void 0===wn||null===(Gn=wn.startsWith)||void 0===Gn||!Gn.call(wn,"Mozilla/5.0 "))&&(Zn="".concat("oauth4webapi","/").concat("v3.8.3"));const ze=Symbol(),Xn=Symbol(),Yn=Symbol(),Ve=Symbol(),ka=Symbol(),$e=Symbol(),Ta=new TextEncoder,Pa=new TextDecoder;function zt(n){return"string"==typeof n?Ta.encode(n):Pa.decode(n)}let $n,No;function St(n){return"string"==typeof n?No(n):$n(n)}$n=Uint8Array.prototype.toBase64?n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):t=>{t instanceof ArrayBuffer&&(t=new Uint8Array(t));const e=[];for(let r=0;r<t.byteLength;r+=32768)e.push(String.fromCharCode.apply(null,t.subarray(r,r+32768)));return btoa(e.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},No=Uint8Array.fromBase64?n=>{try{return Uint8Array.fromBase64(n,{alphabet:"base64url"})}catch(t){throw ie("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",t)}}:n=>{try{const t=atob(n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}catch(t){throw ie("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",t)}};class je extends Error{constructor(t,e){var r;super(t,e),W(this,"code",void 0),this.name=this.constructor.name,this.code=fr,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}class Qn extends Error{constructor(t,e){var r;super(t,e),W(this,"code",void 0),this.name=this.constructor.name,null!=e&&e.code&&(this.code=e?.code),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}function G(n,t,e){return new Qn(n,{code:t,cause:e})}function bn(n){return null!==n&&"object"==typeof n&&!Array.isArray(n)}function An(n){Nt(n,Headers)&&(n=Object.fromEntries(n.entries()));const t=new Headers(n??{});if(Zn&&!t.has("user-agent")&&t.set("user-agent",Zn),t.has("authorization"))throw ie('"options.headers" must not include the "authorization" header name',"ERR_INVALID_ARG_VALUE");return t}function zo(n,t){if(void 0!==t){if("function"==typeof t&&(t=t(n.href)),!(t instanceof AbortSignal))throw ie('"options.signal" must return or be an instance of AbortSignal',"ERR_INVALID_ARG_TYPE");return t}}function Ho(n){return n.includes("//")?n.replace("//","/"):n}function qn(){return qn=(0,l.A)(function*(n,t){return(e=(0,l.A)(function*(r,o,i,a){if(!(r instanceof URL))throw ie('"'.concat(o,'" must be an instance of URL'),"ERR_INVALID_ARG_TYPE");tr(r,!0!==a?.[ze]);const s=i(new URL(r.href)),c=An(a?.headers);return c.set("accept","application/json"),(a?.[Ve]||fetch)(s.href,{body:void 0,headers:Object.fromEntries(c.entries()),method:"GET",redirect:"manual",signal:zo(s,a?.signal)})}),function(r,o,i,a){return e.apply(this,arguments)})(n,"issuerIdentifier",e=>{switch(t?.algorithm){case void 0:case"oidc":(r=e).pathname=Ho("".concat(r.pathname,"/").concat(".well-known/openid-configuration"));break;case"oauth2":!function(r,o){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r.pathname="/"===r.pathname?o:Ho("".concat(o,"/").concat(i?r.pathname:r.pathname.replace(/(\/)$/,"")))}(e,".well-known/oauth-authorization-server");break;default:throw ie('"options.algorithm" must be "oidc" (default), or "oauth2"',"ERR_INVALID_ARG_VALUE")}var r;return e},t);var e}),qn.apply(this,arguments)}function dt(n,t,e,r,o){try{if("number"!=typeof n||!Number.isFinite(n))throw ie("".concat(e," must be a number"),"ERR_INVALID_ARG_TYPE",o);if(n>0)return;if(t){if(0!==n)throw ie("".concat(e," must be a non-negative number"),"ERR_INVALID_ARG_VALUE",o);return}throw ie("".concat(e," must be a positive number"),"ERR_INVALID_ARG_VALUE",o)}catch(i){throw r?G(i.message,r,o):i}}function ge(n,t,e,r){try{if("string"!=typeof n)throw ie("".concat(t," must be a string"),"ERR_INVALID_ARG_TYPE",r);if(0===n.length)throw ie("".concat(t," must not be empty"),"ERR_INVALID_ARG_VALUE",r)}catch(o){throw e?G(o.message,e,r):o}}function Jo(n){!function(t,e){if(Xo(t)!==e)throw function(r){let o='"response" content-type must be ';for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];if(a.length>2){const c=a.pop();o+="".concat(a.join(", "),", or ").concat(c)}else o+=2===a.length?"".concat(a[0]," or ").concat(a[1]):a[0];return G(o,Qo,r)}(t,e)}(n,"application/json")}function Fo(){return St(crypto.getRandomValues(new Uint8Array(32)))}function Oa(n){switch(n.algorithm.name){case"RSA-PSS":return function(t){switch(t.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new je("unsupported RsaHashedKeyAlgorithm hash name",{cause:t})}}(n);case"RSASSA-PKCS1-v1_5":return function(t){switch(t.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new je("unsupported RsaHashedKeyAlgorithm hash name",{cause:t})}}(n);case"ECDSA":return function(t){switch(t.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new je("unsupported EcKeyAlgorithm namedCurve",{cause:t})}}(n);case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return n.algorithm.name;case"EdDSA":return"Ed25519";default:throw new je("unsupported CryptoKey algorithm name",{cause:n})}}function En(n){const t=n?.[Xn];return"number"==typeof t&&Number.isFinite(t)?t:0}function er(n){const t=n?.[Yn];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function Sn(){return Math.floor(Date.now()/1e3)}function Ge(n){if("object"!=typeof n||null===n)throw ie('"as" must be an object',"ERR_INVALID_ARG_TYPE");ge(n.issuer,'"as.issuer"')}function Ze(n){if("object"!=typeof n||null===n)throw ie('"client" must be an object',"ERR_INVALID_ARG_TYPE");ge(n.client_id,'"client.client_id"')}function Bo(n){return ge(n,'"clientSecret"'),(t,e,r,o)=>{r.set("client_id",e.client_id),r.set("client_secret",n)}}const Ca=URL.parse?(n,t)=>URL.parse(n,t):(n,t)=>{try{return new URL(n,t)}catch{return null}};function tr(n,t){if(t&&"https:"!==n.protocol)throw G("only requests to HTTPS are allowed",qo,n);if("https:"!==n.protocol&&"http:"!==n.protocol)throw G("only HTTP and HTTPS requests are allowed",ei,n)}function tn(n,t,e,r){return function Vo(n,t,e,r){let o;if("string"!=typeof n||!(o=Ca(n)))throw G("authorization server metadata does not contain a valid ".concat(e?'"as.mtls_endpoint_aliases.'.concat(t,'"'):'"as.'.concat(t,'"')),void 0===n?Ga:Za,{attribute:e?"mtls_endpoint_aliases.".concat(t):t});return tr(o,r),o}(e&&n.mtls_endpoint_aliases&&t in n.mtls_endpoint_aliases?n.mtls_endpoint_aliases[t]:n[t],t,e,r)}class kn extends Error{constructor(t,e){var r;super(t,e),W(this,"cause",void 0),W(this,"code",void 0),W(this,"error",void 0),W(this,"status",void 0),W(this,"error_description",void 0),W(this,"response",void 0),this.name=this.constructor.name,this.code=Ba,this.cause=e.cause,this.error=e.cause.error,this.status=e.response.status,this.error_description=e.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:e.response}),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}class Go extends Error{constructor(t,e){var r,o;super(t,e),W(this,"cause",void 0),W(this,"code",void 0),W(this,"error",void 0),W(this,"error_description",void 0),this.name=this.constructor.name,this.code=Va,this.cause=e.cause,this.error=e.cause.get("error"),this.error_description=null!==(r=e.cause.get("error_description"))&&void 0!==r?r:void 0,null===(o=Error.captureStackTrace)||void 0===o||o.call(Error,this,this.constructor)}}class nr extends Error{constructor(t,e){var r;super(t,e),W(this,"cause",void 0),W(this,"code",void 0),W(this,"response",void 0),W(this,"status",void 0),this.name=this.constructor.name,this.code=Fa,this.cause=e.cause,this.status=e.response.status,this.response=e.response,Object.defineProperty(this,"response",{enumerable:!1}),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}const Ua=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)"),ja=new RegExp('^[,\\s]*([a-zA-Z0-9!#$%&\\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),La=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)[,\\s]*(.*)"),Ma=new RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");function rr(n,t,e){return or.apply(this,arguments)}function or(){return or=(0,l.A)(function*(n,t,e){if(n.status!==t){let o;var r;throw function(i){let a;if(a=function(s){if(!Nt(s,Response))throw ie('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");const c=s.headers.get("www-authenticate");if(null===c)return;const d=[];let u=c;for(;u;){var p;let A=u.match(Ua);const m=null===(p=A)||void 0===p?void 0:p[1].toLowerCase();if(!m)return;const E=u.substring(A[0].length);if(E&&!E.match(/^[\s,]/))return;const k=E.match(/^\s+(.*)$/);u=k?k[1]:void 0;const S={};let T;if(k)for(;u;){let J,O;if(A=u.match(ja)){if([,J,O,u]=A,O.includes("\\"))try{O=JSON.parse('"'.concat(O,'"'))}catch{}S[J.toLowerCase()]=O}else{if(!(A=u.match(La))){if(A=u.match(Ma)){if(Object.keys(S).length)break;[,T,u]=A;break}return}[,J,O,u]=A,S[J.toLowerCase()]=O}}else u=E||void 0;const M={scheme:m,parameters:S};T&&(M.token68=T),d.push(M)}return d.length?d:void 0}(i))throw new nr("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:a,response:i})}(n),(o=yield(i=(0,l.A)(function*(a){if(a.status>399&&a.status<500){on(a),Jo(a);try{const s=yield a.clone().json();if(bn(s)&&"string"==typeof s.error&&s.error.length)return s}catch{}}}),function(a){return i.apply(this,arguments)})(n))?(yield null===(r=n.body)||void 0===r?void 0:r.cancel(),new kn("server responded with an error in the response body",{cause:o,response:n})):G('"response" is not a conform '.concat(e," response (unexpected HTTP status code)"),mr,n)}var i}),or.apply(this,arguments)}function Zo(n){if(!lr.has(n))throw ie('"options.DPoP" is not a valid DPoPHandle',"ERR_INVALID_ARG_VALUE")}function Xo(n){var t;return null===(t=n.headers.get("content-type"))||void 0===t?void 0:t.split(";")[0]}function ir(n,t,e,r,o,i,a){return ar.apply(this,arguments)}function ar(){return ar=(0,l.A)(function*(n,t,e,r,o,i,a){return yield e(n,t,o,i),i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(a?.[Ve]||fetch)(r.href,{body:o,headers:Object.fromEntries(i.entries()),method:"POST",redirect:"manual",signal:zo(r,a?.signal)})}),ar.apply(this,arguments)}function nn(n,t,e,r,o,i){return sr.apply(this,arguments)}function sr(){return sr=(0,l.A)(function*(n,t,e,r,o,i){var a;const s=tn(n,"token_endpoint",t.use_mtls_endpoint_aliases,!0!==i?.[ze]);o.set("grant_type",r);const c=An(i?.headers);c.set("accept","application/json"),void 0!==i?.DPoP&&(Zo(i.DPoP),yield i.DPoP.addProof(s,c,"POST"));const d=yield ir(n,t,e,s,o,c,i);return null==i||null===(a=i.DPoP)||void 0===a||a.cacheNonce(d,s),d}),sr.apply(this,arguments)}const Yo=new WeakMap,Ka=new WeakMap;function cr(n){if(!n.id_token)return;const t=Yo.get(n);if(!t)throw ie('"ref" was already garbage collected or did not resolve from the proper sources',"ERR_INVALID_ARG_VALUE");return t}function Ht(n,t,e,r,o,i){return ur.apply(this,arguments)}function ur(){return ur=(0,l.A)(function*(n,t,e,r,o,i){if(Ge(n),Ze(t),!Nt(e,Response))throw ie('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield rr(e,200,"Token Endpoint"),on(e);const a=yield Pn(e);if(ge(a.access_token,'"response" body "access_token" property',ee,{body:a}),ge(a.token_type,'"response" body "token_type" property',ee,{body:a}),a.token_type=a.token_type.toLowerCase(),void 0!==a.expires_in){let s="number"!=typeof a.expires_in?parseFloat(a.expires_in):a.expires_in;dt(s,!0,'"response" body "expires_in" property',ee,{body:a}),a.expires_in=s}if(void 0!==a.refresh_token&&ge(a.refresh_token,'"response" body "refresh_token" property',ee,{body:a}),void 0!==a.scope&&"string"!=typeof a.scope)throw G('"response" body "scope" property must be a string',ee,{body:a});if(void 0!==a.id_token){ge(a.id_token,'"response" body "id_token" property',ee,{body:a});const s=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&s.push("auth_time"),void 0!==t.default_max_age&&(dt(t.default_max_age,!0,'"client.default_max_age"'),s.push("auth_time")),null!=r&&r.length&&s.push(...r);const{claims:c,jwt:d}=yield(u=(0,l.A)(function*(p,A,m,E,k){let b,S,{0:T,1:M,length:J}=p.split(".");if(5===J){if(void 0===k)throw new je("JWE decryption is not configured",{cause:p});p=yield k(p),({0:T,1:M,length:J}=p.split("."))}if(3!==J)throw G("Invalid JWT",ee,p);try{b=JSON.parse(zt(St(T)))}catch($){throw G("failed to parse JWT Header body as base64url encoded JSON",Tn,$)}if(!bn(b))throw G("JWT Header must be a top level object",ee,p);if(A(b),void 0!==b.crit)throw new je('no JWT "crit" header parameter extensions are supported',{cause:{header:b}});try{S=JSON.parse(zt(St(M)))}catch($){throw G("failed to parse JWT Payload body as base64url encoded JSON",Tn,$)}if(!bn(S))throw G("JWT Payload must be a top level object",ee,p);const O=Sn()+m;if(void 0!==S.exp){if("number"!=typeof S.exp)throw G('unexpected JWT "exp" (expiration time) claim type',ee,{claims:S});if(S.exp<=O-E)throw G('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',rn,{claims:S,now:O,tolerance:E,claim:"exp"})}if(void 0!==S.iat&&"number"!=typeof S.iat)throw G('unexpected JWT "iat" (issued at) claim type',ee,{claims:S});if(void 0!==S.iss&&"string"!=typeof S.iss)throw G('unexpected JWT "iss" (issuer) claim type',ee,{claims:S});if(void 0!==S.nbf){if("number"!=typeof S.nbf)throw G('unexpected JWT "nbf" (not before) claim type',ee,{claims:S});if(S.nbf>O+E)throw G('unexpected JWT "nbf" (not before) claim value',rn,{claims:S,now:O,tolerance:E,claim:"nbf"})}if(void 0!==S.aud&&"string"!=typeof S.aud&&!Array.isArray(S.aud))throw G('unexpected JWT "aud" (audience) claim type',ee,{claims:S});return{header:b,claims:S,jwt:p}}),function(p,A,m,E,k){return u.apply(this,arguments)})(a.id_token,$a.bind(void 0,t.id_token_signed_response_alg,n.id_token_signing_alg_values_supported,"RS256"),En(t),er(t),o).then(Ha.bind(void 0,s)).then(Na.bind(void 0,n)).then(Wa.bind(void 0,t.client_id));if(Array.isArray(c.aud)&&1!==c.aud.length){if(void 0===c.azp)throw G('ID Token "aud" (audience) claim includes additional untrusted audiences',at,{claims:c,claim:"aud"});if(c.azp!==t.client_id)throw G('unexpected ID Token "azp" (authorized party) claim value',at,{expected:t.client_id,claims:c,claim:"azp"})}void 0!==c.auth_time&&dt(c.auth_time,!0,'ID Token "auth_time" (authentication time)',ee,{claims:c}),Ka.set(e,d),Yo.set(a,c)}var u;if(void 0!==i?.[a.token_type])i[a.token_type](e,a);else if("dpop"!==a.token_type&&"bearer"!==a.token_type)throw new je("unsupported `token_type` value",{cause:{body:a}});return a}),ur.apply(this,arguments)}function Wa(n,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(n))throw G('unexpected JWT "aud" (audience) claim value',at,{expected:n,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==n)throw G('unexpected JWT "aud" (audience) claim value',at,{expected:n,claims:t.claims,claim:"aud"});return t}function Na(n,t){var e,r;const o=null!==(e=null===(r=n[ni])||void 0===r?void 0:r.call(n,t))&&void 0!==e?e:n.issuer;if(t.claims.iss!==o)throw G('unexpected JWT "iss" (issuer) claim value',at,{expected:o,claims:t.claims,claim:"iss"});return t}const lr=new WeakSet,$o=Symbol(),za={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function Ha(n,t){for(const e of n)if(void 0===t.claims[e])throw G('JWT "'.concat(e,'" (').concat(za[e],") claim missing"),ee,{claims:t.claims});return t}const dr=Symbol(),hr=Symbol();function pr(){return pr=(0,l.A)(function*(n,t,e,r){return"string"==typeof r?.expectedNonce||"number"==typeof r?.maxAge||null!=r&&r.requireIdToken?(o=(0,l.A)(function*(i,a,s,c,d,u,p){const A=[];switch(c){case void 0:c=dr;break;case dr:break;default:ge(c,'"expectedNonce" argument'),A.push("nonce")}switch(null!=d||(d=a.default_max_age),d){case void 0:d=hr;break;case hr:break;default:dt(d,!0,'"maxAge" argument'),A.push("auth_time")}const m=yield Ht(i,a,s,A,u,p);ge(m.id_token,'"response" body "id_token" property',ee,{body:m});const E=cr(m);if(d!==hr){const k=Sn()+En(a),b=er(a);if(E.auth_time+d<k-b)throw G("too much time has elapsed since the last End-User authentication",rn,{claims:E,now:k,tolerance:b,claim:"auth_time"})}if(c===dr){if(void 0!==E.nonce)throw G('unexpected ID Token "nonce" claim value',at,{expected:void 0,claims:E,claim:"nonce"})}else if(E.nonce!==c)throw G('unexpected ID Token "nonce" claim value',at,{expected:c,claims:E,claim:"nonce"});return m}),function(i,a,s,c,d,u,p){return o.apply(this,arguments)})(n,t,e,r.expectedNonce,r.maxAge,r[$e],r.recognizedTokenTypes):function(){var o=(0,l.A)(function*(i,a,s,c,d){const u=yield Ht(i,a,s,void 0,c,d),p=cr(u);if(p){if(void 0!==a.default_max_age){dt(a.default_max_age,!0,'"client.default_max_age"');const A=Sn()+En(a),m=er(a);if(p.auth_time+a.default_max_age<A-m)throw G("too much time has elapsed since the last End-User authentication",rn,{claims:p,now:A,tolerance:m,claim:"auth_time"})}if(void 0!==p.nonce)throw G('unexpected ID Token "nonce" claim value',at,{expected:void 0,claims:p,claim:"nonce"})}return u});return function(i,a,s,c,d){return o.apply(this,arguments)}}()(n,t,e,r?.[$e],r?.recognizedTokenTypes);var o}),pr.apply(this,arguments)}const Fa="OAUTH_WWW_AUTHENTICATE_CHALLENGE",Ba="OAUTH_RESPONSE_BODY_ERROR",fr="OAUTH_UNSUPPORTED_OPERATION",Va="OAUTH_AUTHORIZATION_RESPONSE_ERROR",Tn="OAUTH_PARSE_ERROR",ee="OAUTH_INVALID_RESPONSE",Qo="OAUTH_RESPONSE_IS_NOT_JSON",mr="OAUTH_RESPONSE_IS_NOT_CONFORM",qo="OAUTH_HTTP_REQUEST_FORBIDDEN",ei="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",rn="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",at="OAUTH_JWT_CLAIM_COMPARISON_FAILED",yr="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",Ga="OAUTH_MISSING_SERVER_METADATA",Za="OAUTH_INVALID_SERVER_METADATA";function on(n){if(n.bodyUsed)throw ie('"response" body has been used already',"ERR_INVALID_ARG_VALUE")}function ti(n){const{algorithm:t}=n;if("number"!=typeof t.modulusLength||t.modulusLength<2048)throw new je("unsupported ".concat(t.name," modulusLength"),{cause:n})}function Xa(n){const{algorithm:t}=n;switch(t.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new je("unsupported ECDSA namedCurve",{cause:n})}}function gr(){return gr=(0,l.A)(function*(n){if("POST"!==n.method)throw ie("form_post responses are expected to use the POST method","ERR_INVALID_ARG_VALUE",{cause:n});if("application/x-www-form-urlencoded"!==Xo(n))throw ie("form_post responses are expected to use the application/x-www-form-urlencoded content-type","ERR_INVALID_ARG_VALUE",{cause:n});return(t=(0,l.A)(function*(e){if(e.bodyUsed)throw ie("form_post Request instances must contain a readable body","ERR_INVALID_ARG_VALUE",{cause:e});return e.text()}),function(e){return t.apply(this,arguments)})(n);var t}),gr.apply(this,arguments)}function $a(n,t,e,r){if(void 0===n)if(Array.isArray(t)){if(!t.includes(r.alg))throw G('unexpected JWT "alg" header parameter',ee,{header:r,expected:t,reason:"authorization server metadata"})}else{if(void 0===e)throw G('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:n,issuer:t,fallback:e});if("string"==typeof e?r.alg!==e:"function"==typeof e?!e(r.alg):!e.includes(r.alg))throw G('unexpected JWT "alg" header parameter',ee,{header:r,expected:e,reason:"default value"})}else if("string"==typeof n?r.alg!==n:!n.includes(r.alg))throw G('unexpected JWT "alg" header parameter',ee,{header:r,expected:n,reason:"client configuration"})}function kt(n,t){const{0:e,length:r}=n.getAll(t);if(r>1)throw G('"'.concat(t,'" parameter must be provided only once'),ee);return e}const Qa=Symbol(),qa=Symbol();function Pn(n){return _r.apply(this,arguments)}function _r(){return _r=(0,l.A)(function*(n){let t,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jo;try{t=yield n.json()}catch(r){throw e(n),G('failed to parse "response" body as JSON',Tn,r)}if(!bn(t))throw G('"response" body must be a top level object',ee,{body:t});return t}),_r.apply(this,arguments)}const vr=Symbol(),ni=Symbol(),ri=new TextEncoder,an=new TextDecoder;function wr(n){const t=new Uint8Array(n.length);for(let e=0;e<n.length;e++){const r=n.charCodeAt(e);if(r>127)throw new TypeError("non-ASCII string encountered in encode()");t[e]=r}return t}function oi(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(n);const t=atob(n),e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function sn(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof n?n:an.decode(n),{alphabet:"base64url"});let t=n;t instanceof Uint8Array&&(t=an.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return oi(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}class Ee extends Error{constructor(t,e){var r;super(t,e),W(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}W(Ee,"code","ERR_JOSE_GENERIC");class Xe extends Ee{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(t,{cause:{claim:r,reason:o,payload:e}}),W(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),W(this,"claim",void 0),W(this,"reason",void 0),W(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=e}}W(Xe,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class br extends Ee{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(t,{cause:{claim:r,reason:o,payload:e}}),W(this,"code","ERR_JWT_EXPIRED"),W(this,"claim",void 0),W(this,"reason",void 0),W(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=e}}W(br,"code","ERR_JWT_EXPIRED");class ii extends Ee{constructor(){super(...arguments),W(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}W(ii,"code","ERR_JOSE_ALG_NOT_ALLOWED");class Le extends Ee{constructor(){super(...arguments),W(this,"code","ERR_JOSE_NOT_SUPPORTED")}}W(Le,"code","ERR_JOSE_NOT_SUPPORTED"),W(class extends Ee{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"decryption operation failed",arguments.length>1?arguments[1]:void 0),W(this,"code","ERR_JWE_DECRYPTION_FAILED")}},"code","ERR_JWE_DECRYPTION_FAILED"),W(class extends Ee{constructor(){super(...arguments),W(this,"code","ERR_JWE_INVALID")}},"code","ERR_JWE_INVALID");class be extends Ee{constructor(){super(...arguments),W(this,"code","ERR_JWS_INVALID")}}W(be,"code","ERR_JWS_INVALID");class Ar extends Ee{constructor(){super(...arguments),W(this,"code","ERR_JWT_INVALID")}}W(Ar,"code","ERR_JWT_INVALID"),W(class extends Ee{constructor(){super(...arguments),W(this,"code","ERR_JWK_INVALID")}},"code","ERR_JWK_INVALID");class Er extends Ee{constructor(){super(...arguments),W(this,"code","ERR_JWKS_INVALID")}}W(Er,"code","ERR_JWKS_INVALID");class Sr extends Ee{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no applicable key found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),W(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}W(Sr,"code","ERR_JWKS_NO_MATCHING_KEY");class ai extends Ee{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"multiple matching keys found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),W(this,Symbol.asyncIterator,void 0),W(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}W(ai,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class si extends Ee{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"request timed out",arguments.length>1?arguments[1]:void 0),W(this,"code","ERR_JWKS_TIMEOUT")}}W(si,"code","ERR_JWKS_TIMEOUT");class ci extends Ee{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"signature verification failed",arguments.length>1?arguments[1]:void 0),W(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}W(ci,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const Qe=function(n){return new TypeError("CryptoKey does not support this operation, its ".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"algorithm.name"," must be ").concat(n))},Jt=(n,t)=>n.name===t;function kr(n){return parseInt(n.name.slice(4),10)}function ui(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];if((r=r.filter(Boolean)).length>2){const a=r.pop();n+="one of type ".concat(r.join(", "),", or ").concat(a,".")}else n+=2===r.length?"one of type ".concat(r[0]," or ").concat(r[1],"."):"of type ".concat(r[0],".");if(null==t)n+=" Received ".concat(t);else if("function"==typeof t&&t.name)n+=" Received function ".concat(t.name);else if("object"==typeof t&&null!=t){var i;null!==(i=t.constructor)&&void 0!==i&&i.name&&(n+=" Received an instance of ".concat(t.constructor.name))}return n}const li=function(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];return ui("Key for the ".concat(n," algorithm must be "),t,...r)},di=n=>{if("CryptoKey"===n?.[Symbol.toStringTag])return!0;try{return n instanceof CryptoKey}catch{return!1}},hi=n=>"KeyObject"===n?.[Symbol.toStringTag],pi=n=>di(n)||hi(n);function ht(n){if("object"!=typeof(t=n)||null===t||"[object Object]"!==Object.prototype.toString.call(n))return!1;var t;if(null===Object.getPrototypeOf(n))return!0;let e=n;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const Tr=(n,t)=>{if(n.byteLength!==t.length)return!1;for(let e=0;e<n.byteLength;e++)if(n[e]!==t[e])return!1;return!0},cn=n=>{const t=n.data[n.pos++];if(128&t){const e=127&t;let r=0;for(let o=0;o<e;o++)r=r<<8|n.data[n.pos++];return r}return t},un=(n,t,e)=>{if(n.data[n.pos++]!==t)throw new Error(e)},fi=(n,t)=>{const e=n.data.subarray(n.pos,n.pos+t);return n.pos+=t,e},rs=function(){var n=(0,l.A)(function*(t,e,r,o){var i;let a,s;const c="spki"===t,d=()=>c?["verify"]:["sign"];switch(r){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:"SHA-".concat(r.slice(-3))},s=d();break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(r.slice(-3))},s=d();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(r.slice(-3),10)||1)},s=c?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":a={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[r]},s=d();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{const u=o.getNamedCurve(e);a="X25519"===u?{name:"X25519"}:{name:"ECDH",namedCurve:u}}catch{throw new Le("Invalid or unsupported key format")}s=c?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":a={name:"Ed25519"},s=d();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":a={name:r},s=d();break;default:throw new Le('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(t,e,a,null!==(i=o?.extractable)&&void 0!==i?i:!!c,s)});return function(e,r,o,i){return n.apply(this,arguments)}}(),os=(n,t,e)=>{var r;const o=oi(n.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""));let i=e;return null!=t&&null!==(r=t.startsWith)&&void 0!==r&&r.call(t,"ECDH-ES")&&(i||(i={}),i.getNamedCurve=a=>{const s={data:a,pos:0};return function(c){un(c,48,"Invalid PKCS#8 structure"),cn(c),un(c,2,"Expected version field");const d=cn(c);c.pos+=d,un(c,48,"Expected algorithm identifier"),cn(c)}(s),(n=>{const t=(o=>{un(o,6,"Expected algorithm OID");const i=cn(o);return fi(o,i)})(n);if(Tr(t,[43,101,110]))return"X25519";if(!Tr(t,[42,134,72,206,61,2,1]))throw new Error("Unsupported key algorithm");un(n,6,"Expected curve OID");const e=cn(n),r=fi(n,e);for(const{name:o,oid:i}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(Tr(r,i))return o;throw new Error("Unsupported named curve")})(s)}),rs("pkcs8",o,t,i)};function In(n){return Pr.apply(this,arguments)}function Pr(){return Pr=(0,l.A)(function*(n){var t,e;if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:r,keyUsages:o}=function(a){let s,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":s={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new Le('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:"SHA-".concat(a.alg.slice(-3))},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(a.alg.slice(-3))},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(a.alg.slice(-3),10)||1)},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Le('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":s={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new Le('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":s={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new Le('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new Le('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:s,keyUsages:c}}(n),i=F({},n);return"AKP"!==i.kty&&delete i.alg,delete i.use,crypto.subtle.importKey("jwk",i,r,null!==(t=n.ext)&&void 0!==t?t:!n.d&&!n.priv,null!==(e=n.key_ops)&&void 0!==e?e:o)}),Pr.apply(this,arguments)}const Ir=n=>ht(n)&&"string"==typeof n.kty;let pt;const mi=function(){var n=(0,l.A)(function*(t,e,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];pt||(pt=new WeakMap);let i=pt.get(t);if(null!=i&&i[r])return i[r];const a=yield In(F(F({},e),{},{alg:r}));return o&&Object.freeze(t),i?i[r]=a:pt.set(t,{[r]:a}),a});return function(e,r,o){return n.apply(this,arguments)}}();function xr(){return xr=(0,l.A)(function*(n,t){if(n instanceof Uint8Array||di(n))return n;if(hi(n)){if("secret"===n.type)return n.export();if("toCryptoKey"in n&&"function"==typeof n.toCryptoKey)try{return((r,o)=>{pt||(pt=new WeakMap);let i=pt.get(r);if(null!=i&&i[o])return i[o];const a="public"===r.type,s=!!a;let c;if("x25519"===r.asymmetricKeyType){switch(o){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}c=r.toCryptoKey(r.asymmetricKeyType,s,a?[]:["deriveBits"])}if("ed25519"===r.asymmetricKeyType){if("EdDSA"!==o&&"Ed25519"!==o)throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,s,[a?"verify":"sign"])}switch(r.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(o!==r.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,s,[a?"verify":"sign"])}if("rsa"===r.asymmetricKeyType){let u;switch(o){case"RSA-OAEP":u="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":u="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":u="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":u="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(o.startsWith("RSA-OAEP"))return r.toCryptoKey({name:"RSA-OAEP",hash:u},s,a?["encrypt"]:["decrypt"]);c=r.toCryptoKey({name:o.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:u},s,[a?"verify":"sign"])}if("ec"===r.asymmetricKeyType){var d;const u=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(null===(d=r.asymmetricKeyDetails)||void 0===d?void 0:d.namedCurve);if(!u)throw new TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===o&&"P-256"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),"ES384"===o&&"P-384"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),"ES512"===o&&"P-521"===u&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:u},s,[a?"verify":"sign"])),o.startsWith("ECDH-ES")&&(c=r.toCryptoKey({name:"ECDH",namedCurve:u},s,a?[]:["deriveBits"]))}if(!c)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return i?i[o]=c:pt.set(r,{[o]:c}),c})(n,t)}catch(r){if(r instanceof TypeError)throw r}let e=n.export({format:"jwk"});return mi(n,e,t)}if(Ir(n))return n.k?sn(n.k):mi(n,n,t,!0);throw new Error("unreachable")}),xr.apply(this,arguments)}const Ft=n=>n?.[Symbol.toStringTag],Or=(n,t,e)=>{if(void 0!==t.use){let i;switch(e){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc"}if(t.use!==i)throw new TypeError('Invalid key for this operation, its "use" must be "'.concat(i,'" when present'))}if(void 0!==t.alg&&t.alg!==n)throw new TypeError('Invalid key for this operation, its "alg" must be "'.concat(n,'" when present'));if(Array.isArray(t.key_ops)){var r,o;let i;switch(!0){case"sign"===e||"verify"===e:case"dir"===n:case n.includes("CBC-HS"):i=e;break;case n.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(n):i=!n.includes("GCM")&&n.endsWith("KW")?"encrypt"===e?"wrapKey":"unwrapKey":e;break;case"encrypt"===e&&n.startsWith("RSA"):i="wrapKey";break;case"decrypt"===e:i=n.startsWith("RSA")?"unwrapKey":"deriveBits"}if(i&&!1===(null===(r=t.key_ops)||void 0===r||null===(o=r.includes)||void 0===o?void 0:o.call(r,i)))throw new TypeError('Invalid key for this operation, its "key_ops" must include "'.concat(i,'" when present'))}return!0};var xn,Rr;let qe,yi;(typeof navigator>"u"||null===(xn=navigator.userAgent)||void 0===xn||null===(Rr=xn.startsWith)||void 0===Rr||!Rr.call(xn,"Mozilla/5.0 "))&&(yi="".concat("openid-client","/").concat("v6.8.1"),qe={"user-agent":yi});const Se=n=>On.get(n);let On,Rn;function gi(n){return void 0!==n?Bo(n):(Rn||(Rn=new WeakMap),(t,e,r,o)=>{let i;return(i=Rn.get(e))||(function(a,s){if("string"!=typeof a)throw et("".concat(s," must be a string"),dn);if(0===a.length)throw et("".concat(s," must not be empty"),ln)}(e.client_secret,'"metadata.client_secret"'),i=Bo(e.client_secret),Rn.set(e,i)),i(t,e,r,o)})}const ft=Ve,ln="ERR_INVALID_ARG_VALUE",dn="ERR_INVALID_ARG_TYPE";function et(n,t,e){const r=new TypeError(n,{cause:e});return Object.assign(r,{code:t}),r}class Cn extends Error{constructor(t,e){var r;super(t,e),W(this,"code",void 0),this.name=this.constructor.name,this.code=e?.code,null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,this.constructor)}}function xe(n,t,e){return new Cn(n,{cause:t,code:e})}function Oe(n){if(n instanceof TypeError||n instanceof Cn||n instanceof kn||n instanceof Go||n instanceof nr)throw n;if(n instanceof Qn)switch(n.code){case qo:throw xe("only requests to HTTPS are allowed",n,n.code);case ei:throw xe("only requests to HTTP or HTTPS are allowed",n,n.code);case mr:throw xe("unexpected HTTP response status code",n.cause,n.code);case Qo:throw xe("unexpected response content-type",n.cause,n.code);case Tn:throw xe("parsing error occured",n,n.code);case ee:throw xe("invalid response encountered",n,n.code);case at:throw xe("unexpected JWT claim value encountered",n,n.code);case yr:throw xe("unexpected JSON attribute value encountered",n,n.code);case rn:throw xe("JWT timestamp claim value failed validation",n,n.code);default:throw xe(n.message,n,n.code)}if(n instanceof je)throw xe("unsupported operation",n,n.code);if(n instanceof DOMException)switch(n.name){case"OperationError":throw xe("runtime operation error",n,fr);case"NotSupportedError":throw xe("runtime unsupported operation",n,fr);case"TimeoutError":throw xe("operation timed out",n,"OAUTH_TIMEOUT");case"AbortError":throw xe("operation aborted",n,"OAUTH_ABORT")}throw new Cn("something went wrong",{cause:n})}function Cr(){return Cr=(0,l.A)(function*(n,t,e,r,o){const i=yield(c=(0,l.A)(function*(d,u){var p,A;if(!(d instanceof URL))throw et('"server" must be an instance of URL',dn);const m=!d.href.includes("/.well-known/"),E=null!==(p=u?.timeout)&&void 0!==p?p:30,k=AbortSignal.timeout(1e3*E),b=yield(m?function xa(n,t){return qn.apply(this,arguments)}(d,{algorithm:u?.algorithm,[Ve]:u?.[ft],[ze]:null==u||null===(A=u.execute)||void 0===A?void 0:A.includes(Ei),signal:k,headers:new Headers(qe)}):(u?.[ft]||fetch)((tr(d,null==u||null===(S=u.execute)||void 0===S||!S.includes(Ei)),d.href),{headers:Object.fromEntries(new Headers(F({accept:"application/json"},qe)).entries()),body:void 0,method:"GET",redirect:"manual",signal:k})).then(T=>{return(M=(0,l.A)(function*(J,O){const $=J;if(!($ instanceof URL)&&$!==vr)throw ie('"expectedIssuerIdentifier" must be an instance of URL',"ERR_INVALID_ARG_TYPE");if(!Nt(O,Response))throw ie('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");if(200!==O.status)throw G('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',mr,O);on(O);const re=yield Pn(O);if(ge(re.issuer,'"response" body "issuer" property',ee,{body:re}),$!==vr&&new URL(re.issuer).href!==$.href)throw G('"response" body "issuer" property does not match the expected value',yr,{expected:$.href,body:re,attribute:"issuer"});return re}),function(J,O){return M.apply(this,arguments)})(vr,T);var M}).catch(Oe);var S,J;return m&&new URL(b.issuer).href!==d.href&&(J=u,!("https://login.microsoftonline.com"!==d.origin||null!=J&&J.algorithm&&"oidc"!==J.algorithm||(b[_i]=!0,0))||function(T,M){return!(!T.hostname.endsWith(".b2clogin.com")||null!=M&&M.algorithm&&"oidc"!==M.algorithm)}(d,u)||(()=>{throw new Cn("discovered metadata issuer does not match the expected issuer",{code:yr,cause:{expected:d.href,body:b,attribute:"issuer"}})})()),b}),function(d,u){return c.apply(this,arguments)})(n,o),a=new Dn(i,t,e,r);var c;let s=Se(a);if(null!=o&&o[ft]&&(s.fetch=o[ft]),null!=o&&o.timeout&&(s.timeout=o.timeout),null!=o&&o.execute)for(const c of o.execute)c(a);return a}),Cr.apply(this,arguments)}new TextDecoder;const _i=Symbol();class Dn{constructor(t,e,r,o){var i,a,s,c,d;if("string"!=typeof e||!e.length)throw et('"clientId" must be a non-empty string',dn);if("string"==typeof r&&(r={client_secret:r}),void 0!==(null===(i=r)||void 0===i?void 0:i.client_id)&&e!==r.client_id)throw et('"clientId" and "metadata.client_id" must be the same',ln);const u=F(F({},structuredClone(r)),{},{client_id:e});let p;u[Xn]=null!==(a=null===(s=r)||void 0===s?void 0:s[Xn])&&void 0!==a?a:0,u[Yn]=null!==(c=null===(d=r)||void 0===d?void 0:d[Yn])&&void 0!==c?c:30,p=o||("string"==typeof u.client_secret&&u.client_secret.length?gi(u.client_secret):(k,b,S,T)=>{S.set("client_id",b.client_id)});let A=Object.freeze(u);const m=structuredClone(t);_i in t&&(m[ni]=k=>{let{claims:{tid:b}}=k;return t.issuer.replace("{tenantid}",b)});let E=Object.freeze(m);On||(On=new WeakMap),On.set(this,{__proto__:null,as:E,c:A,auth:p,tlsOnly:!0,jwksCache:{}})}serverMetadata(){const t=structuredClone(Se(this).as);return e=t,Object.defineProperties(e,function(r){return{supportsPKCE:{__proto__:null,value(){var o;return!0===(null===(o=r.code_challenge_methods_supported)||void 0===o?void 0:o.includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"S256"))}}}}(e)),t;var e}clientMetadata(){return structuredClone(Se(this).c)}get timeout(){return Se(this).timeout}set timeout(t){Se(this).timeout=t}get[ft](){return Se(this).fetch}set[ft](t){Se(this).fetch=t}}function hn(n){Object.defineProperties(n,function(t){let e;if(void 0!==t.expires_in){const r=new Date;r.setSeconds(r.getSeconds()+t.expires_in),e=r.getTime()}return{expiresIn:{__proto__:null,value(){if(e){const r=Date.now();return e>r?Math.floor((e-r)/1e3):0}}},claims:{__proto__:null,value(){try{return cr(this)}catch{return}}}}}(n))}function vi(n,t,e){return Dr.apply(this,arguments)}function Dr(){return Dr=(0,l.A)(function*(n,t,e){var r;let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=null===(r=n.headers.get("retry-after"))||void 0===r?void 0:r.trim();if(void 0===i)return;let a;if(/^\d+$/.test(i))a=parseInt(i,10);else{const s=new Date(i);if(Number.isFinite(s.getTime())){const c=new Date,d=s.getTime()-c.getTime();d>0&&(a=Math.ceil(d/1e3))}}if(o&&!Number.isFinite(a))throw new Qn("invalid Retry-After header value",{cause:n});a>t&&(yield wi(a-t,e))}),Dr.apply(this,arguments)}function wi(n,t){return new Promise((e,r)=>{const o=i=>{try{t.throwIfAborted()}catch(s){return void r(s)}if(i<=0)return void e();const a=Math.min(i,5);setTimeout(()=>o(i-a),1e3*a)};o(n)})}function bi(n,t){return Ur.apply(this,arguments)}function Ur(){return Ur=(0,l.A)(function*(n,t){st(n);const{as:e,c:r,auth:o,fetch:i,tlsOnly:a,timeout:s}=Se(n);return(c=(0,l.A)(function*(d,u,p,A,m){Ge(d),Ze(u);const E=tn(d,"backchannel_authentication_endpoint",u.use_mtls_endpoint_aliases,!0!==m?.[ze]),k=new URLSearchParams(A);k.set("client_id",u.client_id);const b=An(m?.headers);return b.set("accept","application/json"),ir(d,u,p,E,k,b,m)}),function(d,u,p,A,m){return c.apply(this,arguments)})(e,r,o,t,{[Ve]:i,[ze]:!a,headers:new Headers(qe),signal:Tt(s)}).then(c=>{return(d=(0,l.A)(function*(u,p,A){if(Ge(u),Ze(p),!Nt(A,Response))throw ie('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield rr(A,200,"Backchannel Authentication Endpoint"),on(A);const m=yield Pn(A);ge(m.auth_req_id,'"response" body "auth_req_id" property',ee,{body:m});let E="number"!=typeof m.expires_in?parseFloat(m.expires_in):m.expires_in;return dt(E,!0,'"response" body "expires_in" property',ee,{body:m}),m.expires_in=E,void 0!==m.interval&&dt(m.interval,!1,'"response" body "interval" property',ee,{body:m}),m}),function(u,p,A){return d.apply(this,arguments)})(e,r,c);var d}).catch(Oe);var c}),Ur.apply(this,arguments)}function Ai(n,t,e,r){return jr.apply(this,arguments)}function jr(){return jr=(0,l.A)(function*(n,t,e,r){var o,i;st(n),e=new URLSearchParams(e);let a=null!==(o=t.interval)&&void 0!==o?o:5;const s=null!==(i=r?.signal)&&void 0!==i?i:AbortSignal.timeout(1e3*t.expires_in);try{yield wi(a,s)}catch(O){Oe(O)}const{as:c,c:d,auth:u,fetch:p,tlsOnly:A,nonRepudiation:m,timeout:E,decrypt:k}=Se(n),b=(O,$)=>Ai(n,F(F({},t),{},{interval:O}),e,F(F({},r),{},{signal:s,flag:$})),S=yield(O=(0,l.A)(function*($,re,Me,Ae,it){Ge($),Ze(re),ge(Ae,'"authReqId"');const Ce=new URLSearchParams(it?.additionalParameters);return Ce.set("auth_req_id",Ae),nn($,re,Me,"urn:openid:params:grant-type:ciba",Ce,it)}),function($,re,Me,Ae,it){return O.apply(this,arguments)})(c,d,u,t.auth_req_id,{[Ve]:p,[ze]:!A,additionalParameters:e,DPoP:r?.DPoP,headers:new Headers(qe),signal:s.aborted?s:Tt(E)}).catch(Oe);var O,T;if(503===S.status&&S.headers.has("retry-after"))return yield vi(S,a,s,!0),yield null===(T=S.body)||void 0===T?void 0:T.cancel(),b(a);const M=function(){var O=(0,l.A)(function*($,re,Me,Ae){return Ht($,re,Me,void 0,Ae?.[$e],Ae?.recognizedTokenTypes)});return function($,re,Me,Ae){return O.apply(this,arguments)}}()(c,d,S,{[$e]:k});let J;try{J=yield M}catch(O){if(pn(O,r))return b(a,mt);if(O instanceof kn)switch(O.error){case"slow_down":a+=5;case"authorization_pending":return yield vi(O.response,a,s),b(a)}Oe(O)}return J.id_token&&(yield m?.(S)),hn(J),J}),jr.apply(this,arguments)}function Ei(n){Se(n).tlsOnly=!1}function Si(n,t,e,r,o){return Lr.apply(this,arguments)}function Lr(){return Lr=(0,l.A)(function*(n,t,e,r,o){if(st(n),!(o?.flag===mt||t instanceof URL||function(O){try{return"Request"===Object.getPrototypeOf(O)[Symbol.toStringTag]}catch{return!1}}(t)))throw et('"currentUrl" must be an instance of URL, or Request',dn);let i,a;const{as:s,c,auth:d,fetch:u,tlsOnly:p,jarm:A,hybrid:m,nonRepudiation:E,timeout:k,decrypt:b,implicit:S}=Se(n);if(o?.flag===mt)i=o.authResponse,a=o.redirectUri;else{if(!(t instanceof URL)){const O=t;switch(t=new URL(t.url),O.method){case"GET":break;case"POST":const $=new URLSearchParams(yield function Ya(n){return gr.apply(this,arguments)}(O));if(m)t.hash=$.toString();else for(const[re,Me]of $.entries())t.searchParams.append(re,Me);break;default:throw et("unexpected Request HTTP method",ln)}}switch(O=t,(O=new URL(O)).search="",O.hash="",a=O.href,!0){case!!A:i=yield A(t,e?.expectedState);break;case!!m:i=yield m(t,e?.expectedNonce,e?.expectedState,e?.maxAge);break;case!!S:throw new TypeError("authorizationCodeGrant() cannot be used by response_type=id_token clients");default:try{i=function es(n,t,e,r){if(Ge(n),Ze(t),e instanceof URL&&(e=e.searchParams),!(e instanceof URLSearchParams))throw ie('"parameters" must be an instance of URLSearchParams, or URL',"ERR_INVALID_ARG_TYPE");if(kt(e,"response"))throw G('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',ee,{parameters:e});const o=kt(e,"iss"),i=kt(e,"state");if(!o&&n.authorization_response_iss_parameter_supported)throw G('response parameter "iss" (issuer) missing',ee,{parameters:e});if(o&&o!==n.issuer)throw G('unexpected "iss" (issuer) response parameter value',ee,{expected:n.issuer,parameters:e});switch(r){case void 0:case qa:if(void 0!==i)throw G('unexpected "state" response parameter encountered',ee,{expected:void 0,parameters:e});break;case Qa:break;default:if(ge(r,'"expectedState" argument'),i!==r)throw G(void 0===i?'response parameter "state" missing':'unexpected "state" response parameter value',ee,{expected:r,parameters:e})}if(kt(e,"error"))throw new Go("authorization response from the server is an error",{cause:e});const a=kt(e,"id_token"),s=kt(e,"token");if(void 0!==a||void 0!==s)throw new je("implicit and hybrid flows are not supported");return c=new URLSearchParams(e),lr.add(c),c;var c}(s,c,t.searchParams,e?.expectedState)}catch(O){Oe(O)}}}var O;const T=yield function(){var O=(0,l.A)(function*($,re,Me,Ae,it,Ce,Dt){if(Ge($),Ze(re),!lr.has(Ae))throw ie('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',"ERR_INVALID_ARG_VALUE");ge(it,'"redirectUri"');const Hi=kt(Ae,"code");if(!Hi)throw G('no authorization code in "callbackParameters"',ee);const Nn=new URLSearchParams(Dt?.additionalParameters);return Nn.set("redirect_uri",it),Nn.set("code",Hi),Ce!==$o&&(ge(Ce,'"codeVerifier"'),Nn.set("code_verifier",Ce)),nn($,re,Me,"authorization_code",Nn,Dt)});return function($,re,Me,Ae,it,Ce,Dt){return O.apply(this,arguments)}}()(s,c,d,i,a,e?.pkceCodeVerifier||$o,{additionalParameters:r,[Ve]:u,[ze]:!p,DPoP:o?.DPoP,headers:new Headers(qe),signal:Tt(k)}).catch(Oe);"string"!=typeof e?.expectedNonce&&"number"!=typeof e?.maxAge||(e.idTokenExpected=!0);const M=function Ja(n,t,e,r){return pr.apply(this,arguments)}(s,c,T,{expectedNonce:e?.expectedNonce,maxAge:e?.maxAge,requireIdToken:e?.idTokenExpected,[$e]:b});let J;try{J=yield M}catch(O){if(pn(O,o))return Si(n,void 0,e,r,F(F({},o),{},{flag:mt,authResponse:i,redirectUri:a}));Oe(O)}return J.id_token&&(yield E?.(T)),hn(J),J}),Lr.apply(this,arguments)}function ki(n,t,e,r){return Mr.apply(this,arguments)}function Mr(){return Mr=(0,l.A)(function*(n,t,e,r){st(n),e=new URLSearchParams(e);const{as:o,c:i,auth:a,fetch:s,tlsOnly:c,nonRepudiation:d,timeout:u,decrypt:p}=Se(n),A=yield(k=(0,l.A)(function*(b,S,T,M,J){Ge(b),Ze(S),ge(M,'"refreshToken"');const O=new URLSearchParams(J?.additionalParameters);return O.set("refresh_token",M),nn(b,S,T,"refresh_token",O,J)}),function(b,S,T,M,J){return k.apply(this,arguments)})(o,i,a,t,{[Ve]:s,[ze]:!c,additionalParameters:e,DPoP:r?.DPoP,headers:new Headers(qe),signal:Tt(u)}).catch(Oe),m=function(){var k=(0,l.A)(function*(b,S,T,M){return Ht(b,S,T,void 0,M?.[$e],M?.recognizedTokenTypes)});return function(b,S,T,M){return k.apply(this,arguments)}}()(o,i,A,{[$e]:p});var k;let E;try{E=yield m}catch(k){if(pn(k,r))return ki(n,t,e,F(F({},r),{},{flag:mt}));Oe(k)}return E.id_token&&(yield d?.(A)),hn(E),E}),Mr.apply(this,arguments)}function Ti(n,t,e){return Kr.apply(this,arguments)}function Kr(){return Kr=(0,l.A)(function*(n,t,e){st(n),t=new URLSearchParams(t);const{as:r,c:o,auth:i,fetch:a,tlsOnly:s,timeout:c}=Se(n),d=yield(A=(0,l.A)(function*(m,E,k,b,S){return Ge(m),Ze(E),nn(m,E,k,"client_credentials",new URLSearchParams(b),S)}),function(m,E,k,b,S){return A.apply(this,arguments)})(r,o,i,t,{[Ve]:a,[ze]:!s,DPoP:e?.DPoP,headers:new Headers(qe),signal:Tt(c)}).catch(Oe),u=function(){var A=(0,l.A)(function*(m,E,k,b){return Ht(m,E,k,void 0,b?.[$e],b?.recognizedTokenTypes)});return function(m,E,k,b){return A.apply(this,arguments)}}()(r,o,d);var A;let p;try{p=yield u}catch(A){if(pn(A,e))return Ti(n,t,F(F({},e),{},{flag:mt}));Oe(A)}return hn(p),p}),Kr.apply(this,arguments)}function Wr(n,t){st(n);const{as:e,c:r,tlsOnly:o,hybrid:i,jarm:a,implicit:s}=Se(n),c=tn(e,"authorization_endpoint",!1,o);if((t=new URLSearchParams(t)).has("client_id")||t.set("client_id",r.client_id),!t.has("request_uri")&&!t.has("request")){if(t.has("response_type")||t.set("response_type",i?"code id_token":s?"id_token":"code"),s&&!t.has("nonce"))throw et("response_type=id_token clients must provide a nonce parameter in their authorization request parameters",ln);a&&t.set("response_mode","jwt")}for(const[d,u]of t.entries())c.searchParams.append(d,u);return c}function Pi(n,t,e){return Nr.apply(this,arguments)}function Nr(){return Nr=(0,l.A)(function*(n,t,e){st(n);const r=Wr(n,t),{as:o,c:i,auth:a,fetch:s,tlsOnly:c,timeout:d}=Se(n),u=yield(m=(0,l.A)(function*(E,k,b,S,T){var M;Ge(E),Ze(k);const J=tn(E,"pushed_authorization_request_endpoint",k.use_mtls_endpoint_aliases,!0!==T?.[ze]),O=new URLSearchParams(S);O.set("client_id",k.client_id);const $=An(T?.headers);$.set("accept","application/json"),void 0!==T?.DPoP&&(Zo(T.DPoP),yield T.DPoP.addProof(J,$,"POST"));const re=yield ir(E,k,b,J,O,$,T);return null==T||null===(M=T.DPoP)||void 0===M||M.cacheNonce(re,J),re}),function(E,k,b,S,T){return m.apply(this,arguments)})(o,i,a,r.searchParams,{[Ve]:s,[ze]:!c,DPoP:e?.DPoP,headers:new Headers(qe),signal:Tt(d)}).catch(Oe),p=function(){var m=(0,l.A)(function*(E,k,b){if(Ge(E),Ze(k),!Nt(b,Response))throw ie('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");yield rr(b,201,"Pushed Authorization Request Endpoint"),on(b);const S=yield Pn(b);ge(S.request_uri,'"response" body "request_uri" property',ee,{body:S});let T="number"!=typeof S.expires_in?parseFloat(S.expires_in):S.expires_in;return dt(T,!0,'"response" body "expires_in" property',ee,{body:S}),S.expires_in=T,S});return function(E,k,b){return m.apply(this,arguments)}}()(o,i,u);var m;let A;try{A=yield p}catch(m){if(pn(m,e))return Pi(n,t,F(F({},e),{},{flag:mt}));Oe(m)}return Wr(n,{request_uri:A.request_uri})}),Nr.apply(this,arguments)}function st(n){if(!(n instanceof Dn))throw et('"config" must be an instance of Configuration',dn);if(Object.getPrototypeOf(n)!==Dn.prototype)throw et("subclassing Configuration is not allowed",ln)}function Tt(n){return n?AbortSignal.timeout(1e3*n):void 0}function pn(n,t){return!(null==t||!t.DPoP||t.flag===mt)&&function(e){if(e instanceof nr){const{0:r,length:o}=e.cause;return 1===o&&"dpop"===r.scheme&&"use_dpop_nonce"===r.parameters.error}return e instanceof kn&&"use_dpop_nonce"===e.error}(n)}Object.freeze(Dn.prototype);const mt=Symbol();function zr(n,t,e,r){return Hr.apply(this,arguments)}function Hr(){return Hr=(0,l.A)(function*(n,t,e,r){st(n);const{as:o,c:i,auth:a,fetch:s,tlsOnly:c,timeout:d,decrypt:u}=Se(n),p=yield(A=(0,l.A)(function*(m,E,k,b,S,T){return Ge(m),Ze(E),ge(b,'"grantType"'),nn(m,E,k,b,new URLSearchParams(S),T)}),function(m,E,k,b,S,T){return A.apply(this,arguments)})(o,i,a,t,new URLSearchParams(e),{[Ve]:s,[ze]:!c,DPoP:r?.DPoP,headers:new Headers(qe),signal:Tt(d)}).then(A=>{let m;return"urn:ietf:params:oauth:grant-type:token-exchange"===t&&(m={n_a:()=>{}}),(E=(0,l.A)(function*(k,b,S,T){return Ht(k,b,S,void 0,T?.[$e],T?.recognizedTokenTypes)}),function(k,b,S,T){return E.apply(this,arguments)})(o,i,A,{[$e]:u,recognizedTokenTypes:m});var E}).catch(Oe);var A;return hn(p),p}),Hr.apply(this,arguments)}function Jr(){return Jr=(0,l.A)(function*(n,t,e){if(t instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(function(r){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return ui("Key must be ",r,...i)}(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:"SHA-".concat(n.slice(-3)),name:"HMAC"},!1,[e])}return function ts(n,t,e){switch(t){case"HS256":case"HS384":case"HS512":{if(!Jt(n.algorithm,"HMAC"))throw Qe("HMAC");const r=parseInt(t.slice(2),10);if(kr(n.algorithm.hash)!==r)throw Qe("SHA-".concat(r),"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Jt(n.algorithm,"RSASSA-PKCS1-v1_5"))throw Qe("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(kr(n.algorithm.hash)!==r)throw Qe("SHA-".concat(r),"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Jt(n.algorithm,"RSA-PSS"))throw Qe("RSA-PSS");const r=parseInt(t.slice(2),10);if(kr(n.algorithm.hash)!==r)throw Qe("SHA-".concat(r),"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!Jt(n.algorithm,"Ed25519"))throw Qe("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!Jt(n.algorithm,t))throw Qe(t);break;case"ES256":case"ES384":case"ES512":{if(!Jt(n.algorithm,"ECDSA"))throw Qe("ECDSA");const r=function(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(n.algorithm.namedCurve!==r)throw Qe(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}!function(r,o){if(o&&!r.usages.includes(o))throw new TypeError("CryptoKey does not support this operation, its usages must include ".concat(o,"."))}(n,e)}(t,n,e),t}),Jr.apply(this,arguments)}function Fr(){return Fr=(0,l.A)(function*(n,t,e,r){const o=yield function ls(n,t,e){return Jr.apply(this,arguments)}(n,t,"verify");!function(a,s){if(a.startsWith("RS")||a.startsWith("PS")){const{modulusLength:c}=s.algorithm;if("number"!=typeof c||c<2048)throw new TypeError("".concat(a," requires key modulusLength to be 2048 bits or larger"))}}(n,o);const i=function(a,s){const c="SHA-".concat(a.slice(-3));switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:s.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new Le("alg ".concat(a," is not supported either by JOSE or your javascript runtime"))}}(n,o.algorithm);try{return yield crypto.subtle.verify(i,o,e,r)}catch{return!1}}),Fr.apply(this,arguments)}function Br(){return Br=(0,l.A)(function*(n,t,e){if(!ht(n))throw new be("Flattened JWS must be an object");if(void 0===n.protected&&void 0===n.header)throw new be('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==n.protected&&"string"!=typeof n.protected)throw new be("JWS Protected Header incorrect type");if(void 0===n.payload)throw new be("JWS Payload missing");if("string"!=typeof n.signature)throw new be("JWS Signature missing or incorrect type");if(void 0!==n.header&&!ht(n.header))throw new be("JWS Unprotected Header incorrect type");let r={};if(n.protected)try{const k=sn(n.protected);r=JSON.parse(an.decode(k))}catch{throw new be("JWS Protected Header is invalid")}if(!function(){for(var k=arguments.length,b=new Array(k),S=0;S<k;S++)b[S]=arguments[S];const T=b.filter(Boolean);if(0===T.length||1===T.length)return!0;let M;for(const J of T){const O=Object.keys(J);if(M&&0!==M.size)for(const $ of O){if(M.has($))return!1;M.add($)}else M=new Set(O)}return!0}(r,n.header))throw new be("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o=F(F({},r),n.header);let a=!0;if(function(k,b,S,T,M){if(void 0!==M.crit&&void 0===T?.crit)throw new k('"crit" (Critical) Header Parameter MUST be integrity protected');if(!T||void 0===T.crit)return new Set;if(!Array.isArray(T.crit)||0===T.crit.length||T.crit.some(O=>"string"!=typeof O||0===O.length))throw new k('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let J;J=void 0!==S?new Map([...Object.entries(S),...b.entries()]):b;for(const O of T.crit){if(!J.has(O))throw new Le('Extension Header Parameter "'.concat(O,'" is not recognized'));if(void 0===M[O])throw new k('Extension Header Parameter "'.concat(O,'" is missing'));if(J.get(O)&&void 0===T[O])throw new k('Extension Header Parameter "'.concat(O,'" MUST be integrity protected'))}return new Set(T.crit)}(be,new Map([["b64",!0]]),e?.crit,r,o).has("b64")&&(a=r.b64,"boolean"!=typeof a))throw new be('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:s}=o;if("string"!=typeof s||!s)throw new be('JWS "alg" (Algorithm) Header Parameter missing or invalid');const c=e&&function(k,b){if(void 0!==b&&(!Array.isArray(b)||b.some(S=>"string"!=typeof S)))throw new TypeError('"'.concat("algorithms",'" option must be an array of strings'));if(b)return new Set(b)}(0,e.algorithms);if(c&&!c.has(s))throw new ii('"alg" (Algorithm) Header Parameter value not allowed');if(a){if("string"!=typeof n.payload)throw new be("JWS Payload must be a string")}else if("string"!=typeof n.payload&&!(n.payload instanceof Uint8Array))throw new be("JWS Payload must be a string or an Uint8Array instance");let d=!1;"function"==typeof t&&(t=yield t(r,n),d=!0),function as(n,t,e){switch(n.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((r,o,i)=>{if(!(o instanceof Uint8Array)){if(Ir(o)){if("oct"===(a=o).kty&&"string"==typeof a.k&&Or(r,o,i))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!pi(o))throw new TypeError(li(r,o,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==o.type)throw new TypeError("".concat(Ft(o),' instances for symmetric algorithms must be of type "secret"'))}var a})(n,t,e);break;default:((r,o,i)=>{if(Ir(o))switch(i){case"decrypt":case"sign":if("oct"!==(a=o).kty&&("AKP"===a.kty&&"string"==typeof a.priv||"string"==typeof a.d)&&Or(r,o,i))return;throw new TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if((a=>"oct"!==a.kty&&void 0===a.d&&void 0===a.priv)(o)&&Or(r,o,i))return;throw new TypeError("JSON Web Key for this operation must be a public JWK")}var a;if(!pi(o))throw new TypeError(li(r,o,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===o.type)throw new TypeError("".concat(Ft(o),' instances for asymmetric algorithms must not be of type "secret"'));if("public"===o.type)switch(i){case"sign":throw new TypeError("".concat(Ft(o),' instances for asymmetric algorithm signing must be of type "private"'));case"decrypt":throw new TypeError("".concat(Ft(o),' instances for asymmetric algorithm decryption must be of type "private"'))}if("private"===o.type)switch(i){case"verify":throw new TypeError("".concat(Ft(o),' instances for asymmetric algorithm verifying must be of type "public"'));case"encrypt":throw new TypeError("".concat(Ft(o),' instances for asymmetric algorithm encryption must be of type "public"'))}})(n,t,e)}}(s,t,"verify");const u=function(){for(var k=arguments.length,b=new Array(k),S=0;S<k;S++)b[S]=arguments[S];const T=b.reduce((O,$)=>{let{length:re}=$;return O+re},0),M=new Uint8Array(T);let J=0;for(const O of b)M.set(O,J),J+=O.length;return M}(void 0!==n.protected?wr(n.protected):new Uint8Array,wr("."),"string"==typeof n.payload?a?wr(n.payload):ri.encode(n.payload):n.payload);let p;try{p=sn(n.signature)}catch{throw new be("Failed to base64url decode the signature")}const A=yield function is(n,t){return xr.apply(this,arguments)}(t,s);if(!(yield function ds(n,t,e,r){return Fr.apply(this,arguments)}(s,A,p,u)))throw new ci;let m;if(a)try{m=sn(n.payload)}catch{throw new be("Failed to base64url decode the payload")}else m="string"==typeof n.payload?ri.encode(n.payload):n.payload;const E={payload:m};return void 0!==n.protected&&(E.protectedHeader=r),void 0!==n.header&&(E.unprotectedHeader=n.header),d?F(F({},E),{},{key:A}):E}),Br.apply(this,arguments)}const fs=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function Ii(n){const t=fs.exec(n);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const e=parseFloat(t[2]);let r;switch(t[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(e);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(60*e);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(3600*e);break;case"day":case"days":case"d":r=Math.round(86400*e);break;case"week":case"weeks":case"w":r=Math.round(604800*e);break;default:r=Math.round(31557600*e)}return"-"===t[1]||"ago"===t[4]?-r:r}const xi=n=>n.includes("/")?n.toLowerCase():"application/".concat(n.toLowerCase());function Vr(){return Vr=(0,l.A)(function*(n,t,e){var r;const o=yield(s=(0,l.A)(function*(c,d,u){if(c instanceof Uint8Array&&(c=an.decode(c)),"string"!=typeof c)throw new be("Compact JWS must be a string or Uint8Array");const{0:p,1:A,2:m,length:E}=c.split(".");if(3!==E)throw new be("Invalid Compact JWS");const k=yield function hs(n,t,e){return Br.apply(this,arguments)}({payload:A,protected:p,signature:m},d,u),b={payload:k.payload,protectedHeader:k.protectedHeader};return"function"==typeof d?F(F({},b),{},{key:k.key}):b}),function(c,d,u){return s.apply(this,arguments)})(n,t,e);var s;if(null!==(r=o.protectedHeader.crit)&&void 0!==r&&r.includes("b64")&&!1===o.protectedHeader.b64)throw new Ar("JWTs MUST NOT use unencoded payload");const i=function(s,c){let d,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{d=JSON.parse(an.decode(c))}catch{}if(!ht(d))throw new Ar("JWT Claims Set must be a top-level JSON object");const{typ:p}=u;if(p&&("string"!=typeof s.typ||xi(s.typ)!==xi(p)))throw new Xe('unexpected "typ" JWT header value',d,"typ","check_failed");const{requiredClaims:A=[],issuer:m,subject:E,audience:k,maxTokenAge:b}=u,S=[...A];void 0!==b&&S.push("iat"),void 0!==k&&S.push("aud"),void 0!==E&&S.push("sub"),void 0!==m&&S.push("iss");for(const O of new Set(S.reverse()))if(!(O in d))throw new Xe('missing required "'.concat(O,'" claim'),d,O,"missing");if(m&&!(Array.isArray(m)?m:[m]).includes(d.iss))throw new Xe('unexpected "iss" claim value',d,"iss","check_failed");if(E&&d.sub!==E)throw new Xe('unexpected "sub" claim value',d,"sub","check_failed");if(k&&!((n,t)=>"string"==typeof n?t.includes(n):!!Array.isArray(n)&&t.some(Set.prototype.has.bind(new Set(n))))(d.aud,"string"==typeof k?[k]:k))throw new Xe('unexpected "aud" claim value',d,"aud","check_failed");let T;switch(typeof u.clockTolerance){case"string":T=Ii(u.clockTolerance);break;case"number":T=u.clockTolerance;break;case"undefined":T=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:M}=u,J=(n=>Math.floor(n.getTime()/1e3))(M||new Date);if((void 0!==d.iat||b)&&"number"!=typeof d.iat)throw new Xe('"iat" claim must be a number',d,"iat","invalid");if(void 0!==d.nbf){if("number"!=typeof d.nbf)throw new Xe('"nbf" claim must be a number',d,"nbf","invalid");if(d.nbf>J+T)throw new Xe('"nbf" claim timestamp check failed',d,"nbf","check_failed")}if(void 0!==d.exp){if("number"!=typeof d.exp)throw new Xe('"exp" claim must be a number',d,"exp","invalid");if(d.exp<=J-T)throw new br('"exp" claim timestamp check failed',d,"exp","check_failed")}if(b){const O=J-d.iat;if(O-T>("number"==typeof b?b:Ii(b)))throw new br('"iat" claim timestamp check failed (too far in the past)',d,"iat","check_failed");if(O<0-T)throw new Xe('"iat" claim timestamp check failed (it should be in the past)',d,"iat","check_failed")}return d}(o.protectedHeader,o.payload,e),a={payload:i,protectedHeader:o.protectedHeader};return"function"==typeof t?F(F({},a),{},{key:o.key}):a}),Vr.apply(this,arguments)}function gs(n){return ht(n)}var Un,Gr,jn=new WeakMap,Zr=new WeakMap;class _s{constructor(t){if(ve(this,jn,void 0),ve(this,Zr,new WeakMap),!((e=t)&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(gs)))throw new Er("JSON Web Key Set malformed");var e;he(jn,this,structuredClone(t))}jwks(){return L(jn,this)}getKey(t,e){var r=this;return(0,l.A)(function*(){const{alg:o,kid:i}=F(F({},t),e?.header),a=function(u){switch("string"==typeof u&&u.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new Le('Unsupported "alg" value for a JSON Web Key Set')}}(o),s=L(jn,r).keys.filter(u=>{let p=a===u.kty;if(p&&"string"==typeof i&&(p=i===u.kid),!p||"string"!=typeof u.alg&&"AKP"!==a||(p=o===u.alg),p&&"string"==typeof u.use&&(p="sig"===u.use),p&&Array.isArray(u.key_ops)&&(p=u.key_ops.includes("verify")),p)switch(o){case"ES256":p="P-256"===u.crv;break;case"ES384":p="P-384"===u.crv;break;case"ES512":p="P-521"===u.crv;break;case"Ed25519":case"EdDSA":p="Ed25519"===u.crv}return p}),{0:c,length:d}=s;if(0===d)throw new Sr;if(1!==d){const u=new ai,p=L(Zr,r);throw u[Symbol.asyncIterator]=function Sa(n){return function(){return new en(n.apply(this,arguments))}}(function*(){for(const A of s)try{yield yield Ea(Oi(p,A,o))}catch{}}),u}return Oi(L(Zr,r),c,o)})()}}function Oi(n,t,e){return Xr.apply(this,arguments)}function Xr(){return Xr=(0,l.A)(function*(n,t,e){const r=n.get(t)||n.set(t,{}).get(t);if(void 0===r[e]){const o=yield(i=(0,l.A)(function*(a,s,c){var d;if(!ht(a))throw new TypeError("JWK must be an object");let u;switch(null!=s||(s=a.alg),null!=u||(u=null!==(d=c?.extractable)&&void 0!==d?d:a.ext),a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw new TypeError('missing "k" (Key Value) Parameter value');return sn(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new Le('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return In(F(F({},a),{},{alg:s,ext:u}));case"AKP":if("string"!=typeof a.alg||!a.alg)throw new TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==s&&s!==a.alg)throw new TypeError("JWK alg and alg option value mismatch");return In(F(F({},a),{},{ext:u}));case"EC":case"OKP":return In(F(F({},a),{},{alg:s,ext:u}));default:throw new Le('Unsupported "kty" (Key Type) Parameter value')}}),function(a,s,c){return i.apply(this,arguments)})(F(F({},t),{},{ext:!0}),e);if(o instanceof Uint8Array||"public"!==o.type)throw new Er("JSON Web Key Set members must be public keys");r[e]=o}var i;return r[e]}),Xr.apply(this,arguments)}function Ri(n){const t=new _s(n),e=function(){var r=(0,l.A)(function*(o,i){return t.getKey(o,i)});return function(i,a){return r.apply(this,arguments)}}();return Object.defineProperties(e,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),e}let Yr;(typeof navigator>"u"||null===(Un=navigator.userAgent)||void 0===Un||null===(Gr=Un.startsWith)||void 0===Gr||!Gr.call(Un,"Mozilla/5.0 "))&&(Yr="".concat("jose","/").concat("v6.1.3"));const Ci=Symbol(),$r=Symbol();var Qr=new WeakMap,qr=new WeakMap,eo=new WeakMap,Ln=new WeakMap,Pt=new WeakMap,ct=new WeakMap,yt=new WeakMap,to=new WeakMap,It=new WeakMap,xt=new WeakMap;class vs{constructor(t,e){if(ve(this,Qr,void 0),ve(this,qr,void 0),ve(this,eo,void 0),ve(this,Ln,void 0),ve(this,Pt,void 0),ve(this,ct,void 0),ve(this,yt,void 0),ve(this,to,void 0),ve(this,It,void 0),ve(this,xt,void 0),!(t instanceof URL))throw new TypeError("url must be an instance of URL");var r,o;he(Qr,this,new URL(t.href)),he(qr,this,"number"==typeof e?.timeoutDuration?e?.timeoutDuration:5e3),he(eo,this,"number"==typeof e?.cooldownDuration?e?.cooldownDuration:3e4),he(Ln,this,"number"==typeof e?.cacheMaxAge?e?.cacheMaxAge:6e5),he(yt,this,new Headers(e?.headers)),Yr&&!L(yt,this).has("User-Agent")&&L(yt,this).set("User-Agent",Yr),L(yt,this).has("accept")||(L(yt,this).set("accept","application/json"),L(yt,this).append("accept","application/jwk-set+json")),he(to,this,e?.[Ci]),void 0!==e?.[$r]&&(he(xt,this,e?.[$r]),r=e?.[$r],o=L(Ln,this),"object"==typeof r&&null!==r&&"uat"in r&&"number"==typeof r.uat&&!(Date.now()-r.uat>=o)&&"jwks"in r&&ht(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,ht)&&(he(Pt,this,L(xt,this).uat),he(It,this,Ri(L(xt,this).jwks))))}pendingFetch(){return!!L(ct,this)}coolingDown(){return"number"==typeof L(Pt,this)&&Date.now()<L(Pt,this)+L(eo,this)}fresh(){return"number"==typeof L(Pt,this)&&Date.now()<L(Pt,this)+L(Ln,this)}jwks(){var t;return null===(t=L(It,this))||void 0===t?void 0:t.jwks()}getKey(t,e){var r=this;return(0,l.A)(function*(){L(It,r)&&r.fresh()||(yield r.reload());try{return yield L(It,r).call(r,t,e)}catch(o){if(o instanceof Sr&&!1===r.coolingDown())return yield r.reload(),L(It,r).call(r,t,e);throw o}})()}reload(){var t=this;return(0,l.A)(function*(){var e;L(ct,t)&&(typeof WebSocketPair<"u"||typeof navigator<"u"&&"Cloudflare-Workers"===navigator.userAgent||typeof EdgeRuntime<"u"&&"vercel"===EdgeRuntime)&&he(ct,t,void 0),L(ct,t)||he(ct,t,(e=(0,l.A)(function*(r,o,i){const s=yield(arguments.length>3&&void 0!==arguments[3]?arguments[3]:fetch)(r,{method:"GET",signal:i,redirect:"manual",headers:o}).catch(c=>{throw"TimeoutError"===c.name?new si:c});if(200!==s.status)throw new Ee("Expected 200 OK from the JSON Web Key Set HTTP response");try{return yield s.json()}catch{throw new Ee("Failed to parse the JSON Web Key Set HTTP response as JSON")}}),function(r,o,i){return e.apply(this,arguments)})(L(Qr,t).href,L(yt,t),AbortSignal.timeout(L(qr,t)),L(to,t)).then(e=>{he(It,t,Ri(e)),L(xt,t)&&(L(xt,t).uat=Date.now(),L(xt,t).jwks=e),he(Pt,t,Date.now()),he(ct,t,void 0)}).catch(e=>{throw he(ct,t,void 0),e})),yield L(ct,t)})()}}const ws=["mfaToken"],bs=["mfaToken"];var Ot,Mn,Rt,gt,Bt,ce,fn,_e,Di=class extends Error{constructor(n,t){super(t),W(this,"code",void 0),this.name="NotSupportedError",this.code=n}},ut=class extends Error{constructor(n,t,e){super(t),W(this,"cause",void 0),W(this,"code",void 0),this.code=n,this.cause=e&&{error:e.error,error_description:e.error_description,message:e.message}}},As=class extends ut{constructor(n,t){super("token_by_code_error",n,t),this.name="TokenByCodeError"}},Es=class extends ut{constructor(n,t){super("token_by_client_credentials_error",n,t),this.name="TokenByClientCredentialsError"}},Ss=class extends ut{constructor(n,t){super("token_by_refresh_token_error",n,t),this.name="TokenByRefreshTokenError"}},no=class extends ut{constructor(n,t){super("token_for_connection_error",n,t),this.name="TokenForConnectionErrorCode"}},tt=class extends ut{constructor(n,t){super("token_exchange_error",n,t),this.name="TokenExchangeError"}},_t=class extends Error{constructor(n){super(n),W(this,"code","verify_logout_token_error"),this.name="VerifyLogoutTokenError"}},ro=class extends ut{constructor(n){super("backchannel_authentication_error","There was an error when trying to use Client-Initiated Backchannel Authentication.",n),W(this,"code","backchannel_authentication_error"),this.name="BackchannelAuthenticationError"}},ks=class extends ut{constructor(n){super("build_authorization_url_error","There was an error when trying to build the authorization URL.",n),this.name="BuildAuthorizationUrlError"}},Ts=class extends ut{constructor(n){super("build_link_user_url_error","There was an error when trying to build the Link User URL.",n),this.name="BuildLinkUserUrlError"}},Ps=class extends ut{constructor(n){super("build_unlink_user_url_error","There was an error when trying to build the Unlink User URL.",n),this.name="BuildUnlinkUserUrlError"}},Is=class extends Error{constructor(){super("The client secret or client assertion signing key must be provided."),W(this,"code","missing_client_auth_error"),this.name="MissingClientAuthError"}};function oo(n){return Object.entries(n).filter(t=>{let[,e]=t;return void 0!==e}).reduce((t,e)=>F(F({},t),{},{[e[0]]:e[1]}),{})}var Kn=class extends Error{constructor(n,t,e){super(t),W(this,"cause",void 0),W(this,"code",void 0),this.code=n,this.cause=e&&{error:e.error,error_description:e.error_description,message:e.message}}},Ui=class extends Kn{constructor(n,t){super("mfa_list_authenticators_error",n,t),this.name="MfaListAuthenticatorsError"}},ji=class extends Kn{constructor(n,t){super("mfa_enrollment_error",n,t),this.name="MfaEnrollmentError"}},xs=class extends Kn{constructor(n,t){super("mfa_delete_authenticator_error",n,t),this.name="MfaDeleteAuthenticatorError"}},Li=class extends Kn{constructor(n,t){super("mfa_challenge_error",n,t),this.name="MfaChallengeError"}};function Os(n){return{id:n.id,authenticatorType:n.authenticator_type,active:n.active,name:n.name,oobChannels:n.oob_channels,type:n.type}}var Rs=(Ot=new WeakMap,Mn=new WeakMap,Rt=new WeakMap,class{constructor(n){var t;ve(this,Ot,void 0),ve(this,Mn,void 0),ve(this,Rt,void 0),he(Ot,this,"https://".concat(n.domain)),he(Mn,this,n.clientId),he(Rt,this,null!==(t=n.customFetch)&&void 0!==t?t:function(){return fetch(...arguments)})}listAuthenticators(n){var t=this;return(0,l.A)(function*(){const e="".concat(L(Ot,t),"/mfa/authenticators"),{mfaToken:r}=n,o=yield L(Rt,t).call(t,e,{method:"GET",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!o.ok){const i=yield o.json();throw new Ui(i.error_description||"Failed to list authenticators",i)}return(yield o.json()).map(Os)})()}enrollAuthenticator(n){var t=this;return(0,l.A)(function*(){const e="".concat(L(Ot,t),"/mfa/associate"),{mfaToken:r}=n,o=Wo(n,ws),i={authenticator_types:o.authenticatorTypes};"oobChannels"in o&&(i.oob_channels=o.oobChannels),"phoneNumber"in o&&o.phoneNumber&&(i.phone_number=o.phoneNumber),"email"in o&&o.email&&(i.email=o.email);const a=yield L(Rt,t).call(t,e,{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){const s=yield a.json();throw new ji(s.error_description||"Failed to enroll authenticator",s)}return function(s){if("otp"===s.authenticator_type)return{authenticatorType:"otp",secret:s.secret,barcodeUri:s.barcode_uri,recoveryCodes:s.recovery_codes,id:s.id};if("oob"===s.authenticator_type)return{authenticatorType:"oob",oobChannel:s.oob_channel,oobCode:s.oob_code,bindingMethod:s.binding_method,id:s.id};throw new Error("Unexpected authenticator type: ".concat(s.authenticator_type))}(yield a.json())})()}deleteAuthenticator(n){var t=this;return(0,l.A)(function*(){const{authenticatorId:e,mfaToken:r}=n,o="".concat(L(Ot,t),"/mfa/authenticators/").concat(encodeURIComponent(e)),i=yield L(Rt,t).call(t,o,{method:"DELETE",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(!i.ok){const a=yield i.json();throw new xs(a.error_description||"Failed to delete authenticator",a)}})()}challengeAuthenticator(n){var t=this;return(0,l.A)(function*(){const e="".concat(L(Ot,t),"/mfa/challenge"),{mfaToken:r}=n,o=Wo(n,bs),i={mfa_token:r,client_id:L(Mn,t),challenge_type:o.challengeType};o.authenticatorId&&(i.authenticator_id=o.authenticatorId);const a=yield L(Rt,t).call(t,e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){const s=yield a.json();throw new Li(s.error_description||"Failed to challenge authenticator",s)}return function(s){const c={challengeType:s.challenge_type};return void 0!==s.oob_code&&(c.oobCode=s.oob_code),void 0!==s.binding_method&&(c.bindingMethod=s.binding_method),c}(yield a.json())})()}}),Ct=class Ji{constructor(t,e,r,o,i,a,s){W(this,"accessToken",void 0),W(this,"idToken",void 0),W(this,"refreshToken",void 0),W(this,"expiresAt",void 0),W(this,"scope",void 0),W(this,"claims",void 0),W(this,"authorizationDetails",void 0),W(this,"tokenType",void 0),W(this,"issuedTokenType",void 0),this.accessToken=t,this.idToken=r,this.refreshToken=o,this.expiresAt=e,this.scope=i,this.claims=a,this.authorizationDetails=s}static fromTokenEndpointResponse(t){const e=t.id_token?t.claims():void 0,r=new Ji(t.access_token,Math.floor(Date.now()/1e3)+Number(t.expires_in),t.id_token,t.refresh_token,t.scope,e,t.authorization_details);return r.tokenType=t.token_type,r.issuedTokenType=t.issued_token_type,r}},io="openid profile email offline_access",Cs=Object.freeze(new Set(["grant_type","client_id","client_secret","client_assertion","client_assertion_type","subject_token","subject_token_type","requested_token_type","actor_token","actor_token_type","audience","aud","resource","resources","resource_indicator","scope","connection","login_hint","organization","assertion"]));function Mi(n){if(null==n)throw new tt("subject_token is required");if("string"!=typeof n)throw new tt("subject_token must be a string");if(0===n.trim().length)throw new tt("subject_token cannot be blank or whitespace");if(n!==n.trim())throw new tt("subject_token must not include leading or trailing whitespace");if(/^bearer\s+/i.test(n))throw new tt("subject_token must not include the 'Bearer ' prefix")}function Ki(n,t){if(t)for(const[e,r]of Object.entries(t))if(!Cs.has(e))if(Array.isArray(r)){if(r.length>20)throw new tt("Parameter '".concat(e,"' exceeds maximum array size of ").concat(20));r.forEach(o=>{n.append(e,o)})}else n.append(e,r)}var Ds=(gt=new WeakMap,Bt=new WeakMap,ce=new WeakMap,fn=new WeakMap,_e=new WeakSet,class{constructor(n){if(Mo(this,e=_e),e.add(this),ve(this,gt,void 0),ve(this,Bt,void 0),ve(this,ce,void 0),ve(this,fn,void 0),W(this,"mfa",void 0),he(ce,this,n),n.useMtls&&!n.customFetch)throw new Di("mtls_without_custom_fetch_not_supported","Using mTLS without a custom fetch implementation is not supported");var e;this.mfa=new Rs({domain:L(ce,this).domain,clientId:L(ce,this).clientId,customFetch:L(ce,this).customFetch})}buildAuthorizationUrl(n){var t=this;return(0,l.A)(function*(){const{serverMetadata:e}=yield ye(_e,t,He).call(t);if(null!=n&&n.pushedAuthorizationRequests&&!e.pushed_authorization_request_endpoint)throw new Di("par_not_supported_error","The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par");try{return yield ye(_e,t,lo).call(t,n)}catch(r){throw new ks(r)}})()}buildLinkUserUrl(n){var t=this;return(0,l.A)(function*(){try{const e=yield ye(_e,t,lo).call(t,{authorizationParams:F(F({},n.authorizationParams),{},{requested_connection:n.connection,requested_connection_scope:n.connectionScope,scope:"openid link_account offline_access",id_token_hint:n.idToken})});return{linkUserUrl:e.authorizationUrl,codeVerifier:e.codeVerifier}}catch(e){throw new Ts(e)}})()}buildUnlinkUserUrl(n){var t=this;return(0,l.A)(function*(){try{const e=yield ye(_e,t,lo).call(t,{authorizationParams:F(F({},n.authorizationParams),{},{requested_connection:n.connection,scope:"openid unlink_account",id_token_hint:n.idToken})});return{unlinkUserUrl:e.authorizationUrl,codeVerifier:e.codeVerifier}}catch(e){throw new Ps(e)}})()}backchannelAuthentication(n){var t=this;return(0,l.A)(function*(){const{configuration:e,serverMetadata:r}=yield ye(_e,t,He).call(t),o=oo(F(F({},L(ce,t).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(F(F({scope:io},o),{},{client_id:L(ce,t).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:r.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&i.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&i.append("authorization_details",JSON.stringify(n.authorizationDetails));try{const a=yield bi(e,i),s=yield Ai(e,a);return Ct.fromTokenEndpointResponse(s)}catch(a){throw new ro(a)}})()}initiateBackchannelAuthentication(n){var t=this;return(0,l.A)(function*(){const{configuration:e,serverMetadata:r}=yield ye(_e,t,He).call(t),o=oo(F(F({},L(ce,t).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(F(F({scope:io},o),{},{client_id:L(ce,t).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:r.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&i.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&i.append("authorization_details",JSON.stringify(n.authorizationDetails));try{const a=yield bi(e,i);return{authReqId:a.auth_req_id,expiresIn:a.expires_in,interval:a.interval}}catch(a){throw new ro(a)}})()}backchannelAuthenticationGrant(n){var t=this;return(0,l.A)(function*(){let{authReqId:e}=n;const{configuration:r}=yield ye(_e,t,He).call(t),o=new URLSearchParams({auth_req_id:e});try{const i=yield zr(r,"urn:openid:params:grant-type:ciba",o);return Ct.fromTokenEndpointResponse(i)}catch(i){throw new ro(i)}})()}getTokenForConnection(n){var t=this;return(0,l.A)(function*(){var e;if(n.refreshToken&&n.accessToken)throw new no("Either a refresh or access token should be specified, but not both.");const r=null!==(e=n.accessToken)&&void 0!==e?e:n.refreshToken;if(!r)throw new no("Either a refresh or access token must be specified.");try{return yield t.exchangeToken({connection:n.connection,subjectToken:r,subjectTokenType:n.accessToken?"urn:ietf:params:oauth:token-type:access_token":"urn:ietf:params:oauth:token-type:refresh_token",loginHint:n.loginHint})}catch(o){throw o instanceof tt?new no(o.message,o.cause):o}})()}exchangeToken(n){var t=this;return(0,l.A)(function*(){return"connection"in n?ye(_e,t,Us).call(t,n):ye(_e,t,js).call(t,n)})()}getTokenByCode(n,t){var e=this;return(0,l.A)(function*(){const{configuration:r}=yield ye(_e,e,He).call(e);try{const o=yield Si(r,n,{pkceCodeVerifier:t.codeVerifier});return Ct.fromTokenEndpointResponse(o)}catch(o){throw new As("There was an error while trying to request a token.",o)}})()}getTokenByRefreshToken(n){var t=this;return(0,l.A)(function*(){const{configuration:e}=yield ye(_e,t,He).call(t);try{const r=yield ki(e,n.refreshToken);return Ct.fromTokenEndpointResponse(r)}catch(r){throw new Ss("The access token has expired and there was an error while trying to refresh it.",r)}})()}getTokenByClientCredentials(n){var t=this;return(0,l.A)(function*(){const{configuration:e}=yield ye(_e,t,He).call(t);try{const r=new URLSearchParams({audience:n.audience});n.organization&&r.append("organization",n.organization);const o=yield Ti(e,r);return Ct.fromTokenEndpointResponse(o)}catch(r){throw new Es("There was an error while trying to request a token.",r)}})()}buildLogoutUrl(n){var t=this;return(0,l.A)(function*(){const{configuration:e,serverMetadata:r}=yield ye(_e,t,He).call(t);if(!r.end_session_endpoint){const o=new URL("https://".concat(L(ce,t).domain,"/v2/logout"));return o.searchParams.set("returnTo",n.returnTo),o.searchParams.set("client_id",L(ce,t).clientId),o}return function(o,i){st(o);const{as:a,c:s,tlsOnly:c}=Se(o),d=tn(a,"end_session_endpoint",!1,c);(i=new URLSearchParams(i)).has("client_id")||i.set("client_id",s.client_id);for(const[u,p]of i.entries())d.searchParams.append(u,p);return d}(e,{post_logout_redirect_uri:n.returnTo})})()}verifyLogoutToken(n){var t=this;return(0,l.A)(function*(){const{serverMetadata:e}=yield ye(_e,t,He).call(t);L(fn,t)||he(fn,t,function(o,i){const a=new vs(o,i),s=function(){var c=(0,l.A)(function*(d,u){return a.getKey(d,u)});return function(u,p){return c.apply(this,arguments)}}();return Object.defineProperties(s,{coolingDown:{get:()=>a.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>a.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>a.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>a.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>a.jwks(),enumerable:!0,configurable:!1,writable:!1}}),s}(new URL(e.jwks_uri),{[Ci]:L(ce,t).customFetch}));const{payload:r}=yield function ys(n,t,e){return Vr.apply(this,arguments)}(n.logoutToken,L(fn,t),{issuer:e.issuer,audience:L(ce,t).clientId,algorithms:["RS256"],requiredClaims:["iat"]});if(!("sid"in r)&&!("sub"in r))throw new _t('either "sid" or "sub" (or both) claims must be present');if("sid"in r&&"string"!=typeof r.sid)throw new _t('"sid" claim must be a string');if("sub"in r&&"string"!=typeof r.sub)throw new _t('"sub" claim must be a string');if("nonce"in r)throw new _t('"nonce" claim is prohibited');if(!("events"in r))throw new _t('"events" claim is missing');if("object"!=typeof r.events||null===r.events)throw new _t('"events" claim must be an object');if(!("http://schemas.openid.net/event/backchannel-logout"in r.events))throw new _t('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim');if("object"!=typeof r.events["http://schemas.openid.net/event/backchannel-logout"])throw new _t('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object');return{sid:r.sid,sub:r.sub}})()}});function He(){return ao.apply(this,arguments)}function ao(){return ao=(0,l.A)(function*(){if(L(gt,this)&&L(Bt,this))return{configuration:L(gt,this),serverMetadata:L(Bt,this)};const n=yield ye(_e,this,Ls).call(this);return he(gt,this,yield function us(n,t,e,r,o){return Cr.apply(this,arguments)}(new URL("https://".concat(L(ce,this).domain)),L(ce,this).clientId,{use_mtls_endpoint_aliases:L(ce,this).useMtls},n,{[ft]:L(ce,this).customFetch})),he(Bt,this,L(gt,this).serverMetadata()),L(gt,this)[ft]=L(ce,this).customFetch||fetch,{configuration:L(gt,this),serverMetadata:L(Bt,this)}}),ao.apply(this,arguments)}function Us(n){return so.apply(this,arguments)}function so(){return so=(0,l.A)(function*(n){var t,e;const{configuration:r}=yield ye(_e,this,He).call(this);if("audience"in n||"resource"in n)throw new tt("audience and resource parameters are not supported for Token Vault exchanges");Mi(n.subjectToken);const o=new URLSearchParams({connection:n.connection,subject_token:n.subjectToken,subject_token_type:null!==(t=n.subjectTokenType)&&void 0!==t?t:"urn:ietf:params:oauth:token-type:access_token",requested_token_type:null!==(e=n.requestedTokenType)&&void 0!==e?e:"http://auth0.com/oauth/token-type/federated-connection-access-token"});n.loginHint&&o.append("login_hint",n.loginHint),n.scope&&o.append("scope",n.scope),Ki(o,n.extra);try{const i=yield zr(r,"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",o);return Ct.fromTokenEndpointResponse(i)}catch(i){throw new tt("Failed to exchange token for connection '".concat(n.connection,"'."),i)}}),so.apply(this,arguments)}function js(n){return co.apply(this,arguments)}function co(){return co=(0,l.A)(function*(n){const{configuration:t}=yield ye(_e,this,He).call(this);Mi(n.subjectToken);const e=new URLSearchParams({subject_token_type:n.subjectTokenType,subject_token:n.subjectToken});n.audience&&e.append("audience",n.audience),n.scope&&e.append("scope",n.scope),n.requestedTokenType&&e.append("requested_token_type",n.requestedTokenType),n.organization&&e.append("organization",n.organization),Ki(e,n.extra);try{const r=yield zr(t,"urn:ietf:params:oauth:grant-type:token-exchange",e);return Ct.fromTokenEndpointResponse(r)}catch(r){throw new tt("Failed to exchange token of type '".concat(n.subjectTokenType,"'").concat(n.audience?" for audience '".concat(n.audience,"'"):"","."),r)}}),co.apply(this,arguments)}function Ls(){return uo.apply(this,arguments)}function uo(){return uo=(0,l.A)(function*(){if(!L(ce,this).clientSecret&&!L(ce,this).clientAssertionSigningKey&&!L(ce,this).useMtls)throw new Is;if(L(ce,this).useMtls)return(t,e,r,o)=>{r.set("client_id",e.client_id)};let n=L(ce,this).clientAssertionSigningKey;return!n||n instanceof CryptoKey||(n=yield(t=(0,l.A)(function*(e,r,o){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return os(e,r,o)}),function(e,r,o){return t.apply(this,arguments)})(n,L(ce,this).clientAssertionSigningAlg||"RS256")),n?function(t){return function Ra(n,t){const{key:e,kid:r}=(o=n)instanceof CryptoKey?{key:o}:o?.key instanceof CryptoKey?(void 0!==o.kid&&ge(o.kid,'"kid"'),{key:o.key,kid:o.kid}):{};var o;return function Ia(n,t){if(function(e,r){if(!(e instanceof CryptoKey))throw ie("".concat(r," must be a CryptoKey"),"ERR_INVALID_ARG_TYPE")}(n,t),"private"!==n.type)throw ie("".concat(t," must be a private CryptoKey"),"ERR_INVALID_ARG_VALUE")}(e,'"clientPrivateKey.key"'),function(){var i=(0,l.A)(function*(a,s,c,d){var u;const p={alg:Oa(e),kid:r},A=function(m,E){const k=Sn()+En(E);return{jti:Fo(),aud:m.issuer,exp:k+60,iat:k,nbf:k,iss:E.client_id,sub:E.client_id}}(a,s);var m;null==t||null===(u=t[ka])||void 0===u||u.call(t,p,A),c.set("client_id",s.client_id),c.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),c.set("client_assertion",yield(m=(0,l.A)(function*(E,k,b){if(!b.usages.includes("sign"))throw ie('CryptoKey instances used for signing assertions must include "sign" in their "usages"',"ERR_INVALID_ARG_VALUE");const S="".concat(St(zt(JSON.stringify(E))),".").concat(St(zt(JSON.stringify(k)))),T=St(yield crypto.subtle.sign(function(M){switch(M.algorithm.name){case"ECDSA":return{name:M.algorithm.name,hash:Xa(M)};case"RSA-PSS":switch(ti(M),M.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:M.algorithm.name,saltLength:parseInt(M.algorithm.hash.name.slice(-3),10)>>3};default:throw new je("unsupported RSA-PSS hash name",{cause:M})}case"RSASSA-PKCS1-v1_5":return ti(M),M.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return M.algorithm.name}throw new je("unsupported CryptoKey algorithm name",{cause:M})}(b),b,zt(S)));return"".concat(S,".").concat(T)}),function(E,k,b){return m.apply(this,arguments)})(p,A,e))});return function(a,s,c,d){return i.apply(this,arguments)}}()}(t,void 0)}(n):gi(L(ce,this).clientSecret);var t}),uo.apply(this,arguments)}function lo(n){return ho.apply(this,arguments)}function ho(){return ho=(0,l.A)(function*(n){const{configuration:t}=yield ye(_e,this,He).call(this),e=function cs(){return Fo()}(),r=yield function ss(n){return(t=(0,l.A)(function*(e){return ge(e,"codeVerifier"),St(yield crypto.subtle.digest("SHA-256",zt(e)))}),function(e){return t.apply(this,arguments)})(n);var t}(e),o=oo(F(F({},L(ce,this).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(F(F({scope:io},o),{},{client_id:L(ce,this).clientId,code_challenge:r,code_challenge_method:"S256"}));return{authorizationUrl:null!=n&&n.pushedAuthorizationRequests?yield Pi(t,i):yield Wr(t,i),codeVerifier:e}}),ho.apply(this,arguments)}class vt extends N{constructor(t,e){super(t,e),Object.setPrototypeOf(this,vt.prototype)}static fromPayload(t){let{error:e,error_description:r}=t;return new vt(e,r)}}class Wn extends vt{constructor(t,e){super(t,e),Object.setPrototypeOf(this,Wn.prototype)}}class po extends vt{constructor(t,e){super(t,e),Object.setPrototypeOf(this,po.prototype)}}class fo extends vt{constructor(t,e){super(t,e),Object.setPrototypeOf(this,fo.prototype)}}class Vt extends vt{constructor(t,e){super(t,e),Object.setPrototypeOf(this,Vt.prototype)}}class mo extends vt{constructor(t,e){super(t,e),Object.setPrototypeOf(this,mo.prototype)}}class Ms{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e5;this.contexts=new Map,this.ttlMs=t}set(t,e){this.cleanup(),this.contexts.set(t,Object.assign(Object.assign({},e),{createdAt:Date.now()}))}get(t){const e=this.contexts.get(t);if(e){if(!(Date.now()-e.createdAt>this.ttlMs))return e;this.contexts.delete(t)}}remove(t){this.contexts.delete(t)}cleanup(){const t=Date.now();for(const[e,r]of this.contexts)t-r.createdAt>this.ttlMs&&this.contexts.delete(e)}get size(){return this.contexts.size}}class Ks{constructor(t,e){this.authJsMfaClient=t,this.auth0Client=e,this.contextManager=new Ms}setMFAAuthDetails(t,e,r,o){this.contextManager.set(t,{scope:e,audience:r,mfaRequirements:o})}getAuthenticators(t){var e=this;return(0,l.A)(function*(){var r,o;const i=e.contextManager.get(t);if(null===(r=i?.mfaRequirements)||void 0===r||!r.challenge||0===i.mfaRequirements.challenge.length)throw new Wn("invalid_request","challengeType is required and must contain at least one challenge type, please check mfa_required error payload");const a=i.mfaRequirements.challenge.map(s=>s.type);try{return(yield e.authJsMfaClient.listAuthenticators({mfaToken:t})).filter(s=>!!s.type&&a.includes(s.type))}catch(s){throw s instanceof Ui?new Wn(null===(o=s.cause)||void 0===o?void 0:o.error,s.message):s}})()}enroll(t){var e=this;return(0,l.A)(function*(){var r;const o=function(i){const a=va[i.factorType];return Object.assign(Object.assign(Object.assign({mfaToken:i.mfaToken,authenticatorTypes:a.authenticatorTypes},a.oobChannels&&{oobChannels:a.oobChannels}),"phoneNumber"in i&&{phoneNumber:i.phoneNumber}),"email"in i&&{email:i.email})}(t);try{return yield e.authJsMfaClient.enrollAuthenticator(o)}catch(i){throw i instanceof ji?new po(null===(r=i.cause)||void 0===r?void 0:r.error,i.message):i}})()}challenge(t){var e=this;return(0,l.A)(function*(){var r;try{const o={challengeType:t.challengeType,mfaToken:t.mfaToken};return t.authenticatorId&&(o.authenticatorId=t.authenticatorId),yield e.authJsMfaClient.challengeAuthenticator(o)}catch(o){throw o instanceof Li?new fo(null===(r=o.cause)||void 0===r?void 0:r.error,o.message):o}})()}getEnrollmentFactors(t){var e=this;return(0,l.A)(function*(){const r=e.contextManager.get(t);if(!r||!r.mfaRequirements)throw new mo("mfa_context_not_found","MFA context not found for this MFA token. Please retry the original request to get a new MFA token.");return r.mfaRequirements.enroll&&0!==r.mfaRequirements.enroll.length?r.mfaRequirements.enroll:[]})()}verify(t){var e=this;return(0,l.A)(function*(){const r=e.contextManager.get(t.mfaToken);if(!r)throw new Vt("mfa_context_not_found","MFA context not found for this MFA token. Please retry the original request to get a new MFA token.");const o="otp"in(s=t)&&s.otp?"http://auth0.com/oauth/grant-type/mfa-otp":"oobCode"in s&&s.oobCode?"http://auth0.com/oauth/grant-type/mfa-oob":"recoveryCode"in s&&s.recoveryCode?"http://auth0.com/oauth/grant-type/mfa-recovery-code":void 0;var s;if(!o)throw new Vt("invalid_request","Unable to determine grant type. Provide one of: otp, oobCode, or recoveryCode.");const i=r.scope,a=r.audience;try{const s=yield e.auth0Client._requestTokenForMfa({grant_type:o,mfaToken:t.mfaToken,scope:i,audience:a,otp:t.otp,oob_code:t.oobCode,binding_code:t.bindingCode,recovery_code:t.recoveryCode});return e.contextManager.remove(t.mfaToken),s}catch(s){if(s instanceof wt)e.setMFAAuthDetails(s.mfa_token,i,a,s.mfa_requirements);else if(s instanceof Vt)throw new Vt(s.error,s.error_description);throw s}})()}}const mn=new pe;class Ws{constructor(t){var e=this;let r,o;if(this.userCache=(new ko).enclosedCache,this.activeLockKeys=new Set,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=(0,l.A)(function*(){const u=Array.from(e.activeLockKeys);for(const p of u)yield mn.releaseLock(p);e.activeLockKeys.clear(),window.removeEventListener("pagehide",e._releaseLockOnPageHide)}),this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),t),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),t.authorizationParams)}),typeof window<"u"&&(()=>{if(!Mt())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(void 0===Mt().subtle)throw new Error("\n      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.\n    ")})(),t.cache&&t.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),t.cache)o=t.cache;else{if(r=t.cacheLocation||"memory",!Do(r))throw new Error('Invalid cache location "'.concat(r,'"'));o=Do(r)()}this.httpTimeoutMs=t.httpTimeoutInSeconds?1e3*t.httpTimeoutInSeconds:1e4,this.cookieStorage=!1===t.legacySameSiteCookie?Kt:ua,this.orgHintCookieName="auth0.".concat(this.options.clientId,".organization_hint"),this.isAuthenticatedCookieName=(()=>"auth0.".concat(this.options.clientId,".is.authenticated"))(),this.sessionCheckExpiryDays=t.sessionCheckExpiryDays||1;const a=t.useCookiesForTransactions?this.cookieStorage:la;var s,u,p;this.scope=function(u,p){for(var A=arguments.length,m=new Array(A>2?A-2:0),E=2;E<A;E++)m[E-2]=arguments[E];if("object"!=typeof u)return{default:gn(p,u,...m)};let k={default:gn(p,...m)};return Object.keys(u).forEach(b=>{k[b]=gn(p,u[b],...m)}),k}(this.options.authorizationParams.scope,"openid",this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new ra(a,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||z,this.cacheManager=new na(o,o.allKeys?void 0:new pa(o,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new ya(this.options.clientId):void 0,this.domainUrl=/^https?:\/\//.test(s=this.options.domain)?s:"https://".concat(s),this.tokenIssuer=(p=this.domainUrl,(u=this.options.issuer)?u.startsWith("https://")?u:"https://".concat(u,"/"):"".concat(p,"/"));const c="".concat(this.domainUrl,"/me/"),d=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:c},detailedResponse:!0})}));this.myAccountApi=new _a(d,c),this.authJsClient=new Ds({domain:this.options.domain,clientId:this.options.clientId}),this.mfa=new Ks(this.authJsClient.mfa,this),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&"memory"===r&&(this.worker=this.options.workerUrl?new Worker(this.options.workerUrl):new ha)}getConfiguration(){return Object.freeze({domain:this.options.domain,clientId:this.options.clientId})}_url(t){const r=f(this.options.auth0Client||Q,!0),o=encodeURIComponent(btoa(JSON.stringify(r)));return"".concat(this.domainUrl).concat(t,"&auth0Client=").concat(o)}_authorizeUrl(t){return this._url("/authorize?".concat(y(t)))}_verifyIdToken(t,e,r){var o=this;return(0,l.A)(function*(){const i=yield o.nowProvider();return(n=>{if(!n.id_token)throw new Error("ID token is required but missing");const t=(i=>{const a=i.split("."),[s,c,d]=a;if(3!==a.length||!s||!c||!d)throw new Error("ID token could not be decoded");const u=JSON.parse(v(c)),p={__raw:i},A={};return Object.keys(u).forEach(m=>{p[m]=u[m],oa.includes(m)||(A[m]=u[m])}),{encoded:{header:s,payload:c,signature:d},header:JSON.parse(v(s)),claims:p,user:A}})(n.id_token);if(!t.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(t.claims.iss!==n.iss)throw new Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(n.iss,'", found "').concat(t.claims.iss,'"'));if(!t.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==t.header.alg)throw new Error('Signature algorithm of "'.concat(t.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!t.claims.aud||"string"!=typeof t.claims.aud&&!Array.isArray(t.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(n.aud))throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but was not one of "').concat(t.claims.aud.join(", "),'"'));if(t.claims.aud.length>1){if(!t.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(t.claims.azp!==n.aud)throw new Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(n.aud,'", found "').concat(t.claims.azp,'"'))}}else if(t.claims.aud!==n.aud)throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but found "').concat(t.claims.aud,'"'));if(n.nonce){if(!t.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(t.claims.nonce!==n.nonce)throw new Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(n.nonce,'", found "').concat(t.claims.nonce,'"'))}if(n.max_age&&!$t(t.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(null==t.claims.exp||!$t(t.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!$t(t.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const e=n.leeway||60,r=new Date(n.now||Date.now()),o=new Date(0);if(o.setUTCSeconds(t.claims.exp+e),r>o)throw new Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(null!=t.claims.nbf&&$t(t.claims.nbf)){const i=new Date(0);if(i.setUTCSeconds(t.claims.nbf-e),r<i)throw new Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (".concat(r,") is before ").concat(i))}if(null!=t.claims.auth_time&&$t(t.claims.auth_time)){const i=new Date(0);if(i.setUTCSeconds(parseInt(t.claims.auth_time)+n.max_age+e),r>i)throw new Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (".concat(r,") is after last auth at ").concat(i))}if(n.organization){const i=n.organization.trim();if(i.startsWith("org_")){const a=i;if(!t.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(a!==t.claims.org_id)throw new Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(a,'", found "').concat(t.claims.org_id,'"'))}else{const a=i.toLowerCase();if(!t.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(a!==t.claims.org_name)throw new Error('Organization Name (org_name) claim mismatch in the ID token; expected "'.concat(a,'", found "').concat(t.claims.org_name,'"'))}}return t})({iss:o.tokenIssuer,aud:o.options.clientId,id_token:t,nonce:e,organization:r,leeway:o.options.leeway,max_age:(a=o.options.authorizationParams.max_age,"string"!=typeof a?a:parseInt(a,10)||void 0),now:i});var a})()}_processOrgHint(t){t?this.cookieStorage.save(this.orgHintCookieName,t,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}_prepareAuthorizeUrl(t,e,r){var o=this;return(0,l.A)(function*(){var i;const a=Yt(bt()),s=Yt(bt()),c=bt(),d=yield _(c),u=I(d),p=yield null===(i=o.dpop)||void 0===i?void 0:i.calculateThumbprint(),A=(E=o.options,k=o.scope,b=t,S=a,T=s,M=u,J=t.redirect_uri||o.options.authorizationParams.redirect_uri||r,O=e?.response_mode,$=p,Object.assign(Object.assign(Object.assign({client_id:E.clientId},E.authorizationParams),b),{scope:_n(k,b.scope,b.audience),response_type:"code",response_mode:O||"query",state:S,nonce:T,redirect_uri:J||E.authorizationParams.redirect_uri,code_challenge:M,code_challenge_method:"S256",dpop_jkt:$})),m=o._authorizeUrl(A);var E,k,b,S,T,M,J,O,$;return{nonce:s,code_verifier:c,scope:A.scope,audience:A.audience||"default",redirect_uri:A.redirect_uri,state:a,url:m}})()}loginWithPopup(t,e){var r=this;return(0,l.A)(function*(){var o;if(t=t||{},!(e=e||{}).popup&&(e.popup=(()=>{const d=window.screenX+(window.innerWidth-400)/2,u=window.screenY+(window.innerHeight-600)/2;return window.open("","auth0:authorize:popup","left=".concat(d,",top=").concat(u,",width=").concat(400,",height=").concat(600,",resizable,scrollbars=yes,status=1"))})(),!e.popup))throw new Zt;const i=yield r._prepareAuthorizeUrl(t.authorizationParams||{},{response_mode:"web_message"},window.location.origin);e.popup.location.href=i.url;const a=yield(c=Object.assign(Object.assign({},e),{timeoutInSeconds:e.timeoutInSeconds||r.options.authorizeTimeoutInSeconds||60}),new Promise((d,u)=>{let p;const A=setInterval(()=>{c.popup&&c.popup.closed&&(clearInterval(A),clearTimeout(m),window.removeEventListener("message",p,!1),u(new Fe(c.popup)))},1e3),m=setTimeout(()=>{clearInterval(A),u(new lt(c.popup)),window.removeEventListener("message",p,!1)},1e3*(c.timeoutInSeconds||60));p=function(E){if(E.data&&"authorization_response"===E.data.type){if(clearTimeout(m),clearInterval(A),window.removeEventListener("message",p,!1),!1!==c.closePopup&&c.popup.close(),E.data.response.error)return u(N.fromPayload(E.data.response));d(E.data.response)}},window.addEventListener("message",p)}));var c;if(i.state!==a.state)throw new N("state_mismatch","Invalid state");const s=(null===(o=t.authorizationParams)||void 0===o?void 0:o.organization)||r.options.authorizationParams.organization;yield r._requestToken({audience:i.audience,scope:i.scope,code_verifier:i.code_verifier,grant_type:"authorization_code",code:a.code,redirect_uri:i.redirect_uri},{nonceIn:i.nonce,organization:s})})()}getUser(){var t=this;return(0,l.A)(function*(){var e;const r=yield t._getIdTokenFromCache();return null===(e=r?.decodedToken)||void 0===e?void 0:e.user})()}getIdTokenClaims(){var t=this;return(0,l.A)(function*(){var e;const r=yield t._getIdTokenFromCache();return null===(e=r?.decodedToken)||void 0===e?void 0:e.claims})()}loginWithRedirect(){var t=arguments,e=this;return(0,l.A)(function*(){var r;const o=Uo(t.length>0&&void 0!==t[0]?t[0]:{}),{openUrl:i,fragment:a,appState:s}=o,c=C(o,["openUrl","fragment","appState"]),d=(null===(r=c.authorizationParams)||void 0===r?void 0:r.organization)||e.options.authorizationParams.organization,u=yield e._prepareAuthorizeUrl(c.authorizationParams||{}),{url:p}=u,A=C(u,["url"]);e.transactionManager.create(Object.assign(Object.assign(Object.assign({},A),{appState:s,response_type:At.Code}),d&&{organization:d}));const m=a?"".concat(p,"#").concat(a):p;i?yield i(m):window.location.assign(m)})()}handleRedirectCallback(){var t=arguments,e=this;return(0,l.A)(function*(){const r=(t.length>0&&void 0!==t[0]?t[0]:window.location.href).split("?").slice(1);if(0===r.length)throw new Error("There are no query params available for parsing.");const o=e.transactionManager.get();if(!o)throw new N("missing_transaction","Invalid state");e.transactionManager.remove();const i=(a=>{a.indexOf("#")>-1&&(a=a.substring(0,a.indexOf("#")));const s=new URLSearchParams(a);return{state:s.get("state"),code:s.get("code")||void 0,connect_code:s.get("connect_code")||void 0,error:s.get("error")||void 0,error_description:s.get("error_description")||void 0}})(r.join(""));return o.response_type===At.ConnectCode?e._handleConnectAccountRedirectCallback(i,o):e._handleLoginRedirectCallback(i,o)})()}_handleLoginRedirectCallback(t,e){var r=this;return(0,l.A)(function*(){const{code:o,state:i,error:a,error_description:s}=t;if(a)throw new oe(a,s||a,i,e.appState);if(!e.code_verifier||e.state&&e.state!==i)throw new N("state_mismatch","Invalid state");const c=e.organization,d=e.nonce,u=e.redirect_uri;return yield r._requestToken(Object.assign({audience:e.audience,scope:e.scope,code_verifier:e.code_verifier,grant_type:"authorization_code",code:o},u?{redirect_uri:u}:{}),{nonceIn:d,organization:c}),{appState:e.appState,response_type:At.Code}})()}_handleConnectAccountRedirectCallback(t,e){var r=this;return(0,l.A)(function*(){const{connect_code:o,state:i,error:a,error_description:s}=t;if(a)throw new Pe(a,s||a,e.connection,i,e.appState);if(!o)throw new N("missing_connect_code","Missing connect code");if(!(e.code_verifier&&e.state&&e.auth_session&&e.redirect_uri&&e.state===i))throw new N("state_mismatch","Invalid state");const c=yield r.myAccountApi.completeAccount({auth_session:e.auth_session,connect_code:o,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier});return Object.assign(Object.assign({},c),{appState:e.appState,response_type:At.ConnectCode})})()}checkSession(t){var e=this;return(0,l.A)(function*(){if(!e.cookieStorage.get(e.isAuthenticatedCookieName)){if(!e.cookieStorage.get("auth0.is.authenticated"))return;e.cookieStorage.save(e.isAuthenticatedCookieName,!0,{daysUntilExpire:e.sessionCheckExpiryDays,cookieDomain:e.options.cookieDomain}),e.cookieStorage.remove("auth0.is.authenticated")}try{yield e.getTokenSilently(t)}catch{}})()}getTokenSilently(){var t=arguments,e=this;return(0,l.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{};var o,i;const a=Object.assign(Object.assign({cacheMode:"on"},r),{authorizationParams:Object.assign(Object.assign(Object.assign({},e.options.authorizationParams),r.authorizationParams),{scope:_n(e.scope,null===(o=r.authorizationParams)||void 0===o?void 0:o.scope,(null===(i=r.authorizationParams)||void 0===i?void 0:i.audience)||e.options.authorizationParams.audience)})}),s=yield((c,d)=>{let u=Vn[d];return u||(u=e._getTokenSilently(a).finally(()=>{delete Vn[d],u=null}),Vn[d]=u),u})(0,"".concat(e.options.clientId,"::").concat(a.authorizationParams.audience,"::").concat(a.authorizationParams.scope));return r.detailedResponse?s:s?.access_token})()}_getTokenSilently(t){var e=this;return(0,l.A)(function*(){const{cacheMode:r}=t,o=C(t,["cacheMode"]);if("off"!==r){const c=yield e._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:e.options.clientId,cacheMode:r});if(c)return c}if("cache-only"===r)return;const i=(a=e.options.clientId,s=o.authorizationParams.audience||"default","".concat("auth0.lock.getTokenSilently",".").concat(a,".").concat(s));var a,s;if(!(yield Co(()=>mn.acquireLock(i,5e3),10)))throw new Ke;e.activeLockKeys.add(i),1===e.activeLockKeys.size&&window.addEventListener("pagehide",e._releaseLockOnPageHide);try{if("off"!==r){const E=yield e._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:e.options.clientId});if(E)return E}const c=e.options.useRefreshTokens?yield e._getTokenUsingRefreshToken(o):yield e._getTokenFromIFrame(o),{id_token:d,token_type:u,access_token:p,oauthTokenScope:A,expires_in:m}=c;return Object.assign(Object.assign({id_token:d,token_type:u,access_token:p},A?{scope:A}:null),{expires_in:m})}finally{yield mn.releaseLock(i),e.activeLockKeys.delete(i),0===e.activeLockKeys.size&&window.removeEventListener("pagehide",e._releaseLockOnPageHide)}})()}getTokenWithPopup(){var t=arguments,e=this;return(0,l.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{},o=t.length>1&&void 0!==t[1]?t[1]:{};var i,a;const s=Object.assign(Object.assign({},r),{authorizationParams:Object.assign(Object.assign(Object.assign({},e.options.authorizationParams),r.authorizationParams),{scope:_n(e.scope,null===(i=r.authorizationParams)||void 0===i?void 0:i.scope,(null===(a=r.authorizationParams)||void 0===a?void 0:a.audience)||e.options.authorizationParams.audience)})});return o=Object.assign(Object.assign({},Te),o),yield e.loginWithPopup(s,o),(yield e.cacheManager.get(new Ne({scope:s.authorizationParams.scope,audience:s.authorizationParams.audience||"default",clientId:e.options.clientId}),void 0,e.options.useMrrt)).access_token})()}isAuthenticated(){var t=this;return(0,l.A)(function*(){return!!(yield t.getUser())})()}_buildLogoutUrl(t){null!==t.clientId?t.clientId=t.clientId||this.options.clientId:delete t.clientId;const e=t.logoutParams||{},{federated:r}=e,o=C(e,["federated"]),i=r?"&federated":"";return this._url("/v2/logout?".concat(y(Object.assign({clientId:t.clientId},o))))+i}logout(){var t=arguments,e=this;return(0,l.A)(function*(){let r=t.length>0&&void 0!==t[0]?t[0]:{};var o;const i=Uo(r),{openUrl:a}=i,s=C(i,["openUrl"]);null===r.clientId?yield e.cacheManager.clear():yield e.cacheManager.clear(r.clientId||e.options.clientId),e.cookieStorage.remove(e.orgHintCookieName,{cookieDomain:e.options.cookieDomain}),e.cookieStorage.remove(e.isAuthenticatedCookieName,{cookieDomain:e.options.cookieDomain}),e.userCache.remove("@@user@@"),yield null===(o=e.dpop)||void 0===o?void 0:o.clear();const c=e._buildLogoutUrl(s);a?yield a(c):!1!==a&&window.location.assign(c)})()}_getTokenFromIFrame(t){var e=this;return(0,l.A)(function*(){const r=(o=e.options.clientId,"".concat("auth0.lock.getTokenFromIFrame",".").concat(o));var o;if(!(yield Co(()=>mn.acquireLock(r,5e3),10)))throw new Ke;try{const i=Object.assign(Object.assign({},t.authorizationParams),{prompt:"none"}),a=e.cookieStorage.get(e.orgHintCookieName);a&&!i.organization&&(i.organization=a);const{url:s,state:c,nonce:d,code_verifier:u,redirect_uri:p,scope:A,audience:m}=yield e._prepareAuthorizeUrl(i,{response_mode:"web_message"},window.location.origin);if(window.crossOriginIsolated)throw new N("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const E=t.timeoutInSeconds||e.options.authorizeTimeoutInSeconds;let k;try{k=new URL(e.domainUrl).origin}catch{k=e.domainUrl}const b=yield function(T,M){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return new Promise((O,$)=>{const re=window.document.createElement("iframe");re.setAttribute("width","0"),re.setAttribute("height","0"),re.style.display="none";const Me=()=>{window.document.body.contains(re)&&(window.document.body.removeChild(re),window.removeEventListener("message",Ae,!1))};let Ae;const it=setTimeout(()=>{$(new Ke),Me()},1e3*J);Ae=function(Ce){if(Ce.origin!=M||!Ce.data||"authorization_response"!==Ce.data.type)return;const Dt=Ce.source;Dt&&Dt.close(),Ce.data.response.error?$(N.fromPayload(Ce.data.response)):O(Ce.data.response),clearTimeout(it),window.removeEventListener("message",Ae,!1),setTimeout(Me,2e3)},window.addEventListener("message",Ae,!1),window.document.body.appendChild(re),re.setAttribute("src",T)})}(s,k,E);if(c!==b.state)throw new N("state_mismatch","Invalid state");const S=yield e._requestToken(Object.assign(Object.assign({},t.authorizationParams),{code_verifier:u,code:b.code,grant_type:"authorization_code",redirect_uri:p,timeout:t.authorizationParams.timeout||e.httpTimeoutMs}),{nonceIn:d,organization:i.organization});return Object.assign(Object.assign({},S),{scope:A,oauthTokenScope:S.scope,audience:m})}catch(i){throw"login_required"===i.error&&e.logout({openUrl:!1}),i}finally{yield mn.releaseLock(r)}})()}_getTokenUsingRefreshToken(t){var e=this;return(0,l.A)(function*(){var r,o;const i=yield e.cacheManager.get(new Ne({scope:t.authorizationParams.scope,audience:t.authorizationParams.audience||"default",clientId:e.options.clientId}),void 0,e.options.useMrrt);if(!(i&&i.refresh_token||e.worker)){if(e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);throw new Ut(t.authorizationParams.audience||"default",t.authorizationParams.scope)}const a=t.authorizationParams.redirect_uri||e.options.authorizationParams.redirect_uri||window.location.origin,s="number"==typeof t.timeoutInSeconds?1e3*t.timeoutInSeconds:null,c=((m,E,k,b)=>{var S;if(m&&k&&b){if(E.audience!==k)return E.scope;const T=b.split(" "),M=(null===(S=E.scope)||void 0===S?void 0:S.split(" "))||[],J=M.every(O=>T.includes(O));return T.length>=M.length&&J?b:E.scope}return E.scope})(e.options.useMrrt,t.authorizationParams,i?.audience,i?.scope);try{const m=yield e._requestToken(Object.assign(Object.assign(Object.assign({},t.authorizationParams),{grant_type:"refresh_token",refresh_token:i&&i.refresh_token,redirect_uri:a}),s&&{timeout:s}),{scopesToRequest:c});if(m.refresh_token&&i?.refresh_token&&(yield e.cacheManager.updateEntry(i.refresh_token,m.refresh_token)),e.options.useMrrt&&(d=i?.audience,u=i?.scope,!(d===t.authorizationParams.audience&&jo(t.authorizationParams.scope,u)||jo(c,m.scope)))){if(e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);yield e.cacheManager.remove(e.options.clientId,t.authorizationParams.audience,t.authorizationParams.scope);const E=((k,b)=>{const S=k?.split(" ")||[],T=b?.split(" ")||[];return S.filter(M=>-1==T.indexOf(M)).join(",")})(c,m.scope);throw new Xt(t.authorizationParams.audience||"default",E)}return Object.assign(Object.assign({},m),{scope:t.authorizationParams.scope,oauthTokenScope:m.scope,audience:t.authorizationParams.audience||"default"})}catch(m){if((m.message.indexOf("Missing Refresh Token")>-1||m.message&&m.message.indexOf("invalid refresh token")>-1)&&e.options.useRefreshTokensFallback)return yield e._getTokenFromIFrame(t);throw m instanceof wt&&e.mfa.setMFAAuthDetails(m.mfa_token,null===(r=t.authorizationParams)||void 0===r?void 0:r.scope,null===(o=t.authorizationParams)||void 0===o?void 0:o.audience,m.mfa_requirements),m}var d,u})()}_saveEntryInCache(t){var e=this;return(0,l.A)(function*(){const{id_token:r,decodedToken:o}=t,i=C(t,["id_token","decodedToken"]);e.userCache.set("@@user@@",{id_token:r,decodedToken:o}),yield e.cacheManager.setIdToken(e.options.clientId,t.id_token,t.decodedToken),yield e.cacheManager.set(i)})()}_getIdTokenFromCache(){var t=this;return(0,l.A)(function*(){const e=t.options.authorizationParams.audience||"default",r=t.scope[e],o=yield t.cacheManager.getIdToken(new Ne({clientId:t.options.clientId,audience:e,scope:r})),i=t.userCache.get("@@user@@");return o&&o.id_token===i?.id_token?i:(t.userCache.set("@@user@@",o),o)})()}_getEntryFromCache(t){var e=this;return(0,l.A)(function*(){let{scope:r,audience:o,clientId:i,cacheMode:a}=t;const s=yield e.cacheManager.get(new Ne({scope:r,audience:o,clientId:i}),60,e.options.useMrrt,a);if(s&&s.access_token){const{token_type:c,access_token:d,oauthTokenScope:u,expires_in:p}=s,A=yield e._getIdTokenFromCache();return A&&Object.assign(Object.assign({id_token:A.id_token,token_type:c||"Bearer",access_token:d},u?{scope:u}:null),{expires_in:p})}})()}_requestToken(t,e){var r=this;return(0,l.A)(function*(){var o,i;const{nonceIn:a,organization:s,scopesToRequest:c}=e||{},d=yield function qi(n,t){return Fn.apply(this,arguments)}(Object.assign(Object.assign({baseUrl:r.domainUrl,client_id:r.options.clientId,auth0Client:r.options.auth0Client,useFormData:r.options.useFormData,timeout:r.httpTimeoutMs,useMrrt:r.options.useMrrt,dpop:r.dpop},t),{scope:c||t.scope}),r.worker),u=yield r._verifyIdToken(d.id_token,a,s);if("authorization_code"===t.grant_type){const p=yield r._getIdTokenFromCache();null!==(i=null===(o=p?.decodedToken)||void 0===o?void 0:o.claims)&&void 0!==i&&i.sub&&p.decodedToken.claims.sub!==u.claims.sub&&(yield r.cacheManager.clear(r.options.clientId),r.userCache.remove("@@user@@"))}return yield r._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},d),{decodedToken:u,scope:t.scope,audience:t.audience||"default"}),d.scope?{oauthTokenScope:d.scope}:null),{client_id:r.options.clientId})),r.cookieStorage.save(r.isAuthenticatedCookieName,!0,{daysUntilExpire:r.sessionCheckExpiryDays,cookieDomain:r.options.cookieDomain}),r._processOrgHint(s||u.claims.org_id),Object.assign(Object.assign({},d),{decodedToken:u})})()}exchangeToken(t){var e=this;return(0,l.A)(function*(){return e._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:t.subject_token,subject_token_type:t.subject_token_type,scope:_n(e.scope,t.scope,t.audience||e.options.authorizationParams.audience),audience:t.audience||e.options.authorizationParams.audience,organization:t.organization||e.options.authorizationParams.organization})})()}_assertDpop(t){if(!t)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(t){return this._assertDpop(this.dpop),this.dpop.getNonce(t)}setDpopNonce(t,e){return this._assertDpop(this.dpop),this.dpop.setNonce(t,e)}generateDpopProof(t){return this._assertDpop(this.dpop),this.dpop.generateProof(t)}createFetcher(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ga(t,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:e=>{var r;return this.getTokenSilently({authorizationParams:{scope:null===(r=e?.scope)||void 0===r?void 0:r.join(" "),audience:e?.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(t.dpopNonceId),setDpopNonce:e=>this.setDpopNonce(e,t.dpopNonceId),generateDpopProof:e=>this.generateDpopProof(e)})}connectAccountWithRedirect(t){var e=this;return(0,l.A)(function*(){const{openUrl:r,appState:o,connection:i,scopes:a,authorization_params:s,redirectUri:c=e.options.authorizationParams.redirect_uri||window.location.origin}=t;if(!i)throw new Error("connection is required");const d=Yt(bt()),u=bt(),p=yield _(u),A=I(p),{connect_uri:m,connect_params:E,auth_session:k}=yield e.myAccountApi.connectAccount({connection:i,scopes:a,redirect_uri:c,state:d,code_challenge:A,code_challenge_method:"S256",authorization_params:s});e.transactionManager.create({state:d,code_verifier:u,auth_session:k,redirect_uri:c,appState:o,connection:i,response_type:At.ConnectCode});const b=new URL(m);b.searchParams.set("ticket",E.ticket),r?yield r(b.toString()):window.location.assign(b)})()}_requestTokenForMfa(t,e){var r=this;return(0,l.A)(function*(){const{mfaToken:o}=t,i=C(t,["mfaToken"]);return r._requestToken(Object.assign(Object.assign({},i),{mfa_token:o}),e)})()}}function yo(){return yo=(0,l.A)(function*(n){const t=new Ws(n);return yield t.checkSession(),t}),yo.apply(this,arguments)}const ke={domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"lT0H33rFRamTUtbbXwPwO7M0SdT8Qq26",redirectUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",logoutUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",scope:"openid profile email",audience:void 0,connection:void 0},nt={TOKEN_STORAGE:"sessionStorage",USER_INFO_STORAGE:"sessionStorage"},rt={ACCESS_TOKEN:"auth0_access_token",USER_INFO:"auth0_user_info"};function Gt(n,t){return("localStorage"===t?localStorage:sessionStorage).getItem(n)}function go(n,t,e){("localStorage"===e?localStorage:sessionStorage).setItem(n,t)}function _o(n,t){("localStorage"===t?localStorage:sessionStorage).removeItem(n)}var vo=h(4230);let Wi=(()=>{class n{constructor(){this.eventSubject=new g.Subject,this.events$=this.eventSubject.asObservable(),console.log("[EventBusService] Event bus initialized")}sendEvent(e){this.eventSubject.next(e)}getEvents(){return this.events$}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ni=(()=>{class n{constructor(e,r){this.http=e,this.eventBus=r,this.id="auth of pokemon",this.STANDARD_JWT_CLAIMS=["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at","iss","aud","exp","iat","auth_time","nonce","acr","amr","azp","at_hash","c_hash"],this.auth0Client=null,this.userSubject=new g.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("[AuthService - USERS_CRUD MFE] Initializing Auth0 authentication service"),console.log("[AuthService - USERS_CRUD MFE] This is the USERS_CRUD version, different from shell"),this.initializationPromise=this.initializeAuth0()}sayHi(){console.log("In sayHI() function of mfe-USERS_CRUD auth service")}initializeAuth0(){var e=this;return(0,l.A)(function*(){try{if(console.log("[AuthService] Starting Auth0 client initialization..."),!ke||"object"!=typeof ke)throw new Error("[AuthService] AUTH0_CONFIG is not defined or invalid");if(!ke.domain||!ke.clientId)throw new Error("[AuthService] AUTH0_CONFIG is missing required fields (domain, clientId)");e.auth0Client=yield function Ns(n){return yo.apply(this,arguments)}({domain:ke.domain,clientId:ke.clientId,authorizationParams:{redirect_uri:ke.redirectUri,scope:ke.scope,...ke.audience&&{audience:ke.audience}},cacheLocation:"memory",useRefreshTokens:!0}),console.log("[AuthService] Auth0 client initialized successfully")}catch(r){throw console.error("[AuthService] Failed to initialize Auth0 client:",r),r}})()}ensureInitialized(){var e=this;return(0,l.A)(function*(){if(yield e.initializationPromise,!e.auth0Client)throw new Error("[AuthService] Auth0 client failed to initialize")})()}login(e,r){var o=this;return(0,l.A)(function*(){e&&console.log(`[AuthService] Logging in: ${e}`);try{let s;if(yield o.ensureInitialized(),!window.location.pathname.includes("auth-callback")&&window.location.search){const d=window.location.search;s={returnTo:d},console.log("[AuthService] Preserving URL parameters through auth flow:",d)}const c={redirect_uri:ke.redirectUri,scope:ke.scope,...ke.audience&&{audience:ke.audience},...ke.connection&&{connection:ke.connection}};r?.invitation&&(c.invitation=r.invitation,console.log("[AuthService] Including invitation parameter:",r.invitation)),r?.organization&&(c.organization=r.organization,console.log("[AuthService] Including organization parameter:",r.organization)),console.log("[AuthService] Starting Auth0 login redirect..."),yield o.auth0Client.loginWithRedirect({authorizationParams:c,...s&&{appState:s}})}catch(i){throw console.error("[AuthService] Login failed:",i),i}})()}handleCallback(){var e=this;return(0,l.A)(function*(){try{console.log("[AuthService] Processing Auth0 callback..."),yield e.ensureInitialized();const r=yield e.auth0Client.handleRedirectCallback();console.log("[AuthService] Callback processed successfully"),r.appState?console.log("[AuthService] Restored appState from auth flow:",JSON.stringify(r.appState)):console.log("[AuthService] No appState restored (user may not have started from invitation link)");const o=yield e.auth0Client.getUser();if(!o)return console.warn("[AuthService] No user info returned from Auth0"),{success:!1};e.logUserClaims(o),e.setUserInfo(o);const i=yield e.auth0Client.getTokenSilently();return e.setToken(i),console.log("[AuthService] Authentication successful"),{success:!0,appState:r.appState}}catch(r){return console.error("[AuthService] Error processing callback:",r),console.error("[AuthService] Error details:",JSON.stringify(r,null,2)),{success:!1}}})()}logUserClaims(e){console.log("=".repeat(80)),console.log("[AuthService] \u{1f50d} AUTH0 ID TOKEN - ALL CLAIMS:"),console.log("=".repeat(80)),this.logStandardClaims(e);const r=this.getCustomClaims(e);this.logClaims("\n\u{1f511} Custom Claims (Auth0):",r,e);const o=this.getAdditionalClaims(e);this.logClaims("\n\u{1f527} Additional Claims:",o,e),console.log("\n\u{1f4e6} Complete User Object (JSON):"),console.log(JSON.stringify(e,null,2)),console.log("=".repeat(80))}logStandardClaims(e){console.log("\n\u{1f4cb} Standard OIDC Claims:"),["sub","name","email","email_verified","preferred_username","given_name","family_name","nickname","locale","picture","phone","phone_verified","updated_at"].forEach(o=>{console.log(`  \u2022 ${"sub"===o?`${o} (Subject/User ID)`:o}:`,e[o])})}logClaims(e,r,o){console.log(e),0!==r.length?r.forEach(i=>{const a=o[i],s="object"==typeof a?JSON.stringify(a,null,2):a;console.log(`  \u2022 ${i}:`,s)}):console.log("  No custom claims found")}getCustomClaims(e){return Object.keys(e).filter(r=>!this.STANDARD_JWT_CLAIMS.includes(r)&&this.isNamespacedClaim(r))}getAdditionalClaims(e){return Object.keys(e).filter(r=>!this.STANDARD_JWT_CLAIMS.includes(r)&&!this.isNamespacedClaim(r))}isNamespacedClaim(e){return e.startsWith("http://")||e.startsWith("https://")}logout(){var e=this;return(0,l.A)(function*(){_o(rt.ACCESS_TOKEN,nt.TOKEN_STORAGE),_o(rt.USER_INFO,nt.USER_INFO_STORAGE),e.userSubject.next(null),e.emitAuthEvent("logout",null),console.log("[AuthService] User logged out, clearing Auth0 session");try{yield e.ensureInitialized(),yield e.auth0Client.logout({logoutParams:{returnTo:ke.logoutUri}})}catch(r){console.error("[AuthService] Error during Auth0 logout:",r)}})()}getToken(){var e=this;return(0,l.A)(function*(){const r=Gt(rt.ACCESS_TOKEN,nt.TOKEN_STORAGE);if(r)return r;try{yield e.ensureInitialized();const o=yield e.auth0Client.getTokenSilently();return e.setToken(o),o}catch(o){return console.error("[AuthService] Error getting token from Auth0:",o),null}})()}getTokenSync(){return Gt(rt.ACCESS_TOKEN,nt.TOKEN_STORAGE)}setToken(e){go(rt.ACCESS_TOKEN,e,nt.TOKEN_STORAGE),this.emitAuthEvent("token_updated",{token:e})}isAuthenticated(){var e=this;return(0,l.A)(function*(){try{return yield e.ensureInitialized(),yield e.auth0Client.isAuthenticated()}catch(r){return console.error("[AuthService] Error checking authentication status:",r),!!Gt(rt.ACCESS_TOKEN,nt.TOKEN_STORAGE)}})()}isAuthenticatedSync(){return!!Gt(rt.ACCESS_TOKEN,nt.TOKEN_STORAGE)}getUser(){return this.userSubject.value}getUserData(){const e=this.getUser();if(!e)return null;const r=this.extractClaimValue(e,"role","user"),o=this.extractClaimValue(e,["org","organization"],"default");return{id:e.sub,name:e.name||e.email||"User",email:e.email||"",role:r,org:o}}extractClaimValue(e,r,o){const i=Array.isArray(r)?r:[r];for(const s of i){const c=e[s];if(c)return c}const a=this.getCustomClaims(e);for(const s of i){const c=a.find(d=>d.toLowerCase().includes(s.toLowerCase()));if(c&&e[c]){const d=e[c];return Array.isArray(d)?d[0]:d}}return o}getUserInfoFromStorage(){const e=Gt(rt.USER_INFO,nt.USER_INFO_STORAGE);return e?JSON.parse(e):null}setUserInfo(e){go(rt.USER_INFO,JSON.stringify(e),nt.USER_INFO_STORAGE),this.userSubject.next(e),console.log("[AuthService] \u{1f4be} User info stored in sessionStorage:"),console.log("  Standard claims:",{sub:e.sub,name:e.name,email:e.email,email_verified:e.email_verified});const r=this.getCustomClaims(e);r.length>0&&(console.log("  Custom claims stored:"),r.forEach(o=>{console.log(`    \u2022 ${o}:`,e[o])})),this.emitAuthEvent("user_info_updated",e)}emitAuthEvent(e,r){const o={type:`auth:${e}`,payload:r,timestamp:(new Date).toISOString()};this.eventBus.sendEvent(JSON.stringify(o)),console.log("[AuthService] Auth event emitted:",o.type)}static{this.\u0275fac=function(r){return new(r||n)(w.\u0275\u0275inject(vo.HttpClient),w.\u0275\u0275inject(Wi))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),zs=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=w.\u0275\u0275defineComponent({type:n,selectors:[["org-core-services"]],standalone:!0,features:[w.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(r,o){1&r&&(w.\u0275\u0275elementStart(0,"p"),w.\u0275\u0275text(1," core-services works! "),w.\u0275\u0275elementEnd())}})}}return n})();var Re=function(n){return n.SUPER_ADMIN="super-admin",n.ORG_ADMIN="org-admin",n.TEAM_LEAD="team-lead",n.SALES_EXECUTIVE="sales-executive",n}(Re||{});let Hs=(()=>{class n{constructor(e){this.currentUserSubject=new g.BehaviorSubject(this.getDummyUser()),this.currentUser$=this.currentUserSubject.asObservable(),this.dataService=e}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(e){this.currentUserSubject.next(e)}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){const r=this.getCurrentUser();return!!r&&e.includes(r.role)}isAdmin(){return this.hasAnyRole([Re.SUPER_ADMIN,Re.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([Re.SUPER_ADMIN,Re.ORG_ADMIN,Re.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:Re.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:Re.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:Re.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:Re.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:Re.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:Re.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const r=this.getAllUsers();return this.isTeamLeadOrHigher()?r.filter(o=>o.role===Re.SALES_EXECUTIVE||o.id===e.id):r.filter(o=>o.id===e.id)}getDummyUser(){return{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:Re.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}}static{this.\u0275fac=function(r){return new(r||n)(w.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var wo=h(3103),Je=function(n){return n.COMPLETED="completed",n.PENDING="pending",n.CANCELLED="cancelled",n}(Je||{}),ot=function(n){return n.ELECTRONICS="Electronics",n.SOFTWARE="Software",n.SERVICES="Services",n.HARDWARE="Hardware",n}(ot||{});let Js=(()=>{class n{constructor(e){this.dummySalesData=this.generateDummyData(),this.dataService=e}getSalesHistory(e,r,o){if(this.dataService)return this.dataService.getSalesHistory(e,r,o);let i=this.dummySalesData.filter(a=>a.salesExecutiveId===e);return r&&(i=i.filter(a=>a.date>=r)),o&&(i=i.filter(a=>a.date<=o)),(0,g.of)(i).pipe((0,wo.c)(300))}getSalesSummary(e){if(this.dataService)return this.dataService.getSalesSummary(e);const r=this.dummySalesData.filter(i=>i.salesExecutiveId===e),o={totalSales:r.filter(i=>i.status===Je.COMPLETED).reduce((i,a)=>i+a.amount,0),totalCommission:r.filter(i=>i.status===Je.COMPLETED).reduce((i,a)=>i+a.commission,0),completedCount:r.filter(i=>i.status===Je.COMPLETED).length,pendingCount:r.filter(i=>i.status===Je.PENDING).length,cancelledCount:r.filter(i=>i.status===Je.CANCELLED).length};return(0,g.of)(o).pipe((0,wo.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,g.of)(this.dummySalesData).pipe((0,wo.c)(300))}generateDummyData(){const e=[{name:"Enterprise Software License",category:ot.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:ot.SERVICES,basePrice:25e3},{name:"Server Hardware",category:ot.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:ot.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:ot.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:ot.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:ot.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:ot.HARDWARE,basePrice:6e4}],r=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],o=["North","South","East","West","Central"],i=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],a=[Je.COMPLETED,Je.COMPLETED,Je.COMPLETED,Je.PENDING,Je.CANCELLED],s=[];let c=1;for(let d=0;d<50;d++){const u=i[d%i.length],p=e[Math.floor(Math.random()*e.length)],A=r[Math.floor(Math.random()*r.length)],m=o[Math.floor(Math.random()*o.length)],E=a[Math.floor(Math.random()*a.length)],k=p.basePrice+(1e4*Math.random()-5e3),b=.05*k,S=new Date;S.setDate(S.getDate()-Math.floor(180*Math.random())),s.push({id:"sale-"+c++,salesExecutiveId:u.id,salesExecutiveName:u.name,productName:p.name,productCategory:p.category,amount:Math.round(k),commission:Math.round(b),status:E,date:S,clientName:A,region:m})}return s.sort((d,u)=>u.date.getTime()-d.date.getTime())}static{this.\u0275fac=function(r){return new(r||n)(w.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var zi=function(n){return n.SUPER_ADMIN="super-admin",n.ORG_ADMIN="org-admin",n.TEAM_LEAD="team-lead",n.MEMBER="member",n}(zi||{}),De=h(6354),ae=h(9437);const bo={useRealAuth0:!1,domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"lT0H33rFRamTUtbbXwPwO7M0SdT8Qq26",redirectUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",scope:"openid profile email",audience:void 0,managementApiAudience:void 0};let yn=(()=>{class n{get domain(){return bo.domain}get managementApiUrl(){return`https://${this.domain}/api/v2`}constructor(e,r){this.http=e,this.authService=r}getHeaders(){const e=this.authService.getTokenSync();return new vo.HttpHeaders({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}getCurrentUser(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}getUserInfo(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}listUsers(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/users?${r}`:`${this.managementApiUrl}/users`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}getUserById(e){return this.http.get(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}createUser(e){return this.http.post(`${this.managementApiUrl}/users`,e,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}updateUser(e,r){return this.http.patch(`${this.managementApiUrl}/users/${e}`,r,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}deleteUser(e){return this.http.delete(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}blockUser(e,r=!0){return this.http.patch(`${this.managementApiUrl}/users/${e}`,{blocked:r},{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}listOrganizations(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/organizations?${r}`:`${this.managementApiUrl}/organizations`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}getOrganizationById(e){return this.http.get(`${this.managementApiUrl}/organizations/${e}`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}createOrganization(e){return this.http.post(`${this.managementApiUrl}/organizations`,e,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}updateOrganization(e,r){return this.http.patch(`${this.managementApiUrl}/organizations/${e}`,r,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}listRoles(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/roles?${r}`:`${this.managementApiUrl}/roles`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}getRoleById(e){return this.http.get(`${this.managementApiUrl}/roles/${e}`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}createRole(e){return this.http.post(`${this.managementApiUrl}/roles`,e,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}updateRole(e,r){return this.http.patch(`${this.managementApiUrl}/roles/${e}`,r,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}listUserRoles(e){return this.http.get(`${this.managementApiUrl}/users/${e}/roles`,{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}assignRolesToUser(e,r){return this.http.post(`${this.managementApiUrl}/users/${e}/roles`,{roles:r},{headers:this.getHeaders()}).pipe((0,ae.W)(this.handleError))}handleError(e){return console.error("Auth0 API Error:",e),(0,g.throwError)(()=>e)}static{this.\u0275fac=function(r){return new(r||n)(w.\u0275\u0275inject(vo.HttpClient),w.\u0275\u0275inject(Ni))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Fs=(()=>{class n{constructor(e){this.auth0Api=e,this.organizationsCache=[],this.organizationsSubject=new g.BehaviorSubject([]),this.organizations$=this.organizationsSubject.asObservable(),this.loadOrganizations()}loadOrganizations(){this.auth0Api.listOrganizations().pipe((0,De.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,ae.W)(e=>(console.error("Error loading organizations from Auth0:",e),(0,g.of)([])))).subscribe(e=>{e&&e.length>0&&(this.organizationsCache=e,this.organizationsSubject.next(this.organizationsCache))})}mapAuth0OrgsToOrganizations(e){return e&&Array.isArray(e)?e.map(r=>({id:r.id,name:r.name,description:r.display_name||r.name,createdAt:r.created_at?new Date(r.created_at):new Date,updatedAt:r.updated_at?new Date(r.updated_at):new Date,isActive:!0,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}})):[]}getAll(){return this.auth0Api.listOrganizations().pipe((0,De.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,ae.W)(e=>(console.error("Error getting organizations:",e),(0,g.of)(this.organizationsCache))))}getById(e){return this.getAll().pipe((0,De.T)(r=>r.find(o=>o.id===e)))}create(e){return this.auth0Api.createOrganization({name:e.name,display_name:e.description}).pipe((0,De.T)(o=>{const i={id:o.id,name:o.name,description:o.display_name||o.name,createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at||o.created_at),isActive:!0,settings:e.settings||{timezone:"UTC",currency:"USD",locale:"en-US"}};return this.organizationsCache.push(i),this.organizationsSubject.next(this.organizationsCache),i}),(0,ae.W)(o=>{console.error("Creating organizations in Auth0 requires admin privileges:",o);const i={...e,id:`org-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return(0,g.of)(i)}))}update(e,r){const o={};return r.name&&(o.name=r.name),r.description&&(o.display_name=r.description),this.auth0Api.updateOrganization(e,o).pipe((0,De.T)(i=>{const a=this.organizationsCache.findIndex(s=>s.id===e);return-1!==a?(this.organizationsCache[a]={...this.organizationsCache[a],...r,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),this.organizationsCache[a]):null}),(0,ae.W)(i=>{console.warn("Updating organizations in Auth0 requires specific permissions:",i);const a=this.organizationsCache.findIndex(s=>s.id===e);return-1!==a?(this.organizationsCache[a]={...this.organizationsCache[a],...r,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),(0,g.of)(this.organizationsCache[a])):(0,g.of)(null)}))}delete(e){return console.warn("Deleting organizations should be done with caution and may not be supported via Auth0 API"),(0,g.of)(!1)}static{this.\u0275fac=function(r){return new(r||n)(w.\u0275\u0275inject(yn))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Bs=(()=>{class n{constructor(e){this.auth0Api=e,this.teamsCache=[],this.teamsSubject=new g.BehaviorSubject([]),this.teams$=this.teamsSubject.asObservable(),this.loadTeams()}loadTeams(){this.teamsCache=this.getDummyTeams(),this.teamsSubject.next(this.teamsCache)}getDummyTeams(){return[{id:"team1",name:"Engineering",description:"Engineering team",organizationId:"org1",leadId:"1",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team2",name:"Product",description:"Product team",organizationId:"org1",leadId:"2",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team3",name:"Design",description:"Design team",organizationId:"org2",leadId:"3",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0}]}getAll(){return(0,g.of)(this.teamsCache)}getByOrganization(e){return this.getAll().pipe((0,De.T)(r=>r.filter(o=>o.organizationId===e)))}getById(e){const r=this.teamsCache.find(o=>o.id===e);return(0,g.of)(r)}create(e){const r={id:`team-${Date.now()}`,name:e.name,description:e.description,organizationId:e.organizationId,leadId:e.leadId,createdAt:new Date,updatedAt:new Date,isActive:!0};return this.teamsCache.push(r),this.teamsSubject.next(this.teamsCache),(0,g.of)(r)}update(e,r){const o=this.teamsCache.findIndex(i=>i.id===e);return-1!==o?(this.teamsCache[o]={...this.teamsCache[o],...r,updatedAt:new Date},this.teamsSubject.next(this.teamsCache),(0,g.of)(this.teamsCache[o])):(0,g.of)(null)}delete(e){const r=this.teamsCache.findIndex(o=>o.id===e);return-1!==r?(this.teamsCache[r].isActive=!1,this.teamsCache[r].updatedAt=new Date,this.teamsSubject.next(this.teamsCache),(0,g.of)(!0)):(0,g.of)(!1)}static{this.\u0275fac=function(r){return new(r||n)(w.\u0275\u0275inject(yn))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Vs=(()=>{class n{constructor(e){this.auth0Api=e,this.usersCache=[],this.usersSubject=new g.BehaviorSubject([]),this.users$=this.usersSubject.asObservable(),this.currentAuth0User=null,this.loadUsers()}loadUsers(){if(!bo.useRealAuth0)return this.usersCache=this.getDummyUsers(),void this.usersSubject.next(this.usersCache);(0,g.forkJoin)({authUser:this.auth0Api.getCurrentUser().pipe((0,ae.W)(()=>(0,g.of)(null))),userInfo:this.auth0Api.getUserInfo().pipe((0,ae.W)(()=>(0,g.of)(null)))}).subscribe(({authUser:e,userInfo:r})=>{const o=this.getDummyUsers();if(e||r){const i=this.mapAuth0UserToUser(e||r);this.currentAuth0User=i,this.usersCache=[i,...o.slice(1)]}else console.log("Could not fetch real user from Auth0 API, using dummy data"),this.usersCache=o;this.usersSubject.next(this.usersCache)})}getDummyUsers(){return[{id:"1",name:"John Doe",email:"john.doe@example.com",organizationId:"org1",teamId:"team1",roleId:"super-admin",isActive:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"2",name:"Jane Smith",email:"jane.smith@example.com",organizationId:"org1",teamId:"team2",roleId:"org-admin",isActive:!0,createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-02-10")},{id:"3",name:"Bob Johnson",email:"bob.johnson@example.com",organizationId:"org2",teamId:"team3",roleId:"team-lead",isActive:!0,createdAt:new Date("2024-03-05"),updatedAt:new Date("2024-03-05")},{id:"4",name:"Alice Brown",email:"alice.brown@example.com",organizationId:"org1",teamId:"team1",roleId:"member",isActive:!1,createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-05-10")}]}mapAuth0UserToUser(e){return e?{id:e.user_id||e.sub||"1",name:this.extractUserName(e),email:e.email||"user@example.com",organizationId:e.org_id||"default-org",teamId:"default-team",roleId:"member",isActive:!e.blocked,createdAt:e.created_at?new Date(e.created_at):new Date,updatedAt:e.updated_at?new Date(e.updated_at):new Date,auth0UserId:e.user_id||e.sub}:this.getDummyUsers()[0]}extractUserName(e){return e.name?e.name:e.nickname?e.nickname:`${e.given_name||""} ${e.family_name||""}`.trim()||(e.email?e.email.split("@")[0]:`User ${e.user_id||e.sub}`)}mapAuth0UsersToUsers(e){return e&&Array.isArray(e)?e.map(r=>({id:r.user_id,name:this.extractUserName(r),email:r.email||"",organizationId:r.org_id||"default-org",teamId:"default-team",roleId:"default-role",isActive:!r.blocked,createdAt:r.created_at?new Date(r.created_at):new Date,updatedAt:r.updated_at?new Date(r.updated_at):new Date,auth0UserId:r.user_id})):[]}mapUserToAuth0Format(e){return{email:e.email,name:e.name,nickname:e.name,blocked:!e.isActive,connection:"Username-Password-Authentication",email_verified:!1,user_metadata:{organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId}}}getAll(){return(0,g.of)(this.usersCache)}getCurrentAuth0User(){return this.currentAuth0User}getByOrganization(e){return this.getAll().pipe((0,De.T)(r=>r.filter(o=>o.organizationId===e)))}getByTeam(e){return this.getAll().pipe((0,De.T)(r=>r.filter(o=>o.teamId===e)))}getById(e){const r=this.usersCache.find(o=>o.id===e);return r?(0,g.of)(r):this.auth0Api.getUserById(e).pipe((0,De.T)(o=>{const i=this.mapAuth0UsersToUsers([o]);return i.length>0?i[0]:void 0}),(0,ae.W)(o=>(console.error("Error getting user by ID (Management API not available):",o),(0,g.of)(void 0))))}create(e){const r=this.mapUserToAuth0Format(e);return this.auth0Api.createUser(r).pipe((0,De.T)(o=>{const i={id:o.user_id||`user-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date,auth0UserId:o.user_id};return this.usersCache.push(i),this.usersSubject.next(this.usersCache),i}),(0,ae.W)(o=>{console.error("Error creating user (Management API not available):",o);const i={id:`local-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date};return this.usersCache.push(i),this.usersSubject.next(this.usersCache),(0,g.of)(i)}))}update(e,r){const o=this.mapUserToAuth0Format(r);return this.auth0Api.updateUser(e,o).pipe((0,De.T)(i=>{const a=this.usersCache.findIndex(s=>s.id===e);return-1!==a?(this.usersCache[a]={...this.usersCache[a],...r,updatedAt:new Date},this.usersSubject.next(this.usersCache),this.usersCache[a]):null}),(0,ae.W)(i=>{console.error("Error updating user (Management API not available):",i);const a=this.usersCache.findIndex(s=>s.id===e);return-1!==a?(this.usersCache[a]={...this.usersCache[a],...r,updatedAt:new Date},this.usersSubject.next(this.usersCache),(0,g.of)(this.usersCache[a])):(0,g.of)(null)}))}delete(e){return this.auth0Api.blockUser(e,!0).pipe((0,De.T)(()=>{const r=this.usersCache.findIndex(o=>o.id===e);return-1!==r&&(this.usersCache[r].isActive=!1,this.usersCache[r].updatedAt=new Date,this.usersSubject.next(this.usersCache),!0)}),(0,ae.W)(r=>{console.error("Error deleting user (Management API not available):",r);const o=this.usersCache.findIndex(i=>i.id===e);return-1!==o&&(this.usersCache[o].isActive=!1,this.usersCache[o].updatedAt=new Date,this.usersSubject.next(this.usersCache)),(0,g.of)(!0)}))}static{this.\u0275fac=function(r){return new(r||n)(w.\u0275\u0275inject(yn))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Gs=(()=>{class n{constructor(e){this.auth0Api=e,this.systemRoles=[{id:"role-1",name:"Super Admin",description:"Full system access",permissions:["*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-2",name:"Organization Admin",description:"Full access within organization",permissions:["org:*","team:*","user:*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-3",name:"Team Lead",description:"Manage team and team members",permissions:["team:read","team:update","user:read","user:update"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-4",name:"Member",description:"Basic member access",permissions:["user:read"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.rolesCache=[...this.systemRoles],this.rolesSubject=new g.BehaviorSubject(this.rolesCache),this.roles$=this.rolesSubject.asObservable(),this.loadCustomRoles()}loadCustomRoles(){this.auth0Api.listRoles().pipe((0,De.T)(e=>this.mapAuth0RolesToRoles(e)),(0,ae.W)(e=>(console.error("Error loading custom roles from Auth0:",e),(0,g.of)([])))).subscribe(e=>{this.rolesCache=[...this.systemRoles,...e],this.rolesSubject.next(this.rolesCache)})}mapAuth0RolesToRoles(e){return e&&Array.isArray(e)?e.map(r=>({id:r.id,name:r.name,description:r.description||"",permissions:[],isSystemRole:!1,createdAt:new Date,updatedAt:new Date})):[]}getAll(){return(0,g.of)(this.rolesCache)}getById(e){const r=this.rolesCache.find(o=>o.id===e);return(0,g.of)(r)}getSystemRoles(){const e=this.rolesCache.filter(r=>r.isSystemRole);return(0,g.of)(e)}getCustomRoles(){const e=this.rolesCache.filter(r=>!r.isSystemRole);return(0,g.of)(e)}create(e){return this.auth0Api.createRole({name:e.name,description:e.description}).pipe((0,De.T)(o=>{const i={id:o.id,name:o.name,description:o.description||"",permissions:e.permissions,isSystemRole:!1,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(i),this.rolesSubject.next(this.rolesCache),i}),(0,ae.W)(o=>{console.error("Error creating role in Auth0:",o);const i={...e,id:`role-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(i),this.rolesSubject.next(this.rolesCache),(0,g.of)(i)}))}update(e,r){const o=this.rolesCache.findIndex(i=>i.id===e);return-1===o||this.rolesCache[o].isSystemRole?(0,g.of)(null):(this.rolesCache[o]={...this.rolesCache[o],...r,updatedAt:new Date},this.rolesSubject.next(this.rolesCache),(0,g.of)(this.rolesCache[o]))}delete(e){const r=this.rolesCache.findIndex(o=>o.id===e);return-1===r||this.rolesCache[r].isSystemRole?(0,g.of)(!1):(this.rolesCache.splice(r,1),this.rolesSubject.next(this.rolesCache),(0,g.of)(!0))}static{this.\u0275fac=function(r){return new(r||n)(w.\u0275\u0275inject(yn))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()},1985:(Y,D,h)=>{h.d(D,{c:()=>U});var w=h(7707),P=h(3961),l=h(3494),g=h(1203),C=h(1026),j=h(8071),R=h(9786);let U=(()=>{class Z{constructor(q){q&&(this._subscribe=q)}lift(q){const se=new Z;return se.source=this,se.operator=q,se}subscribe(q,se,fe){const de=function V(Z){return Z&&Z instanceof w.vU||function H(Z){return Z&&(0,j.T)(Z.next)&&(0,j.T)(Z.error)&&(0,j.T)(Z.complete)}(Z)&&(0,P.Uv)(Z)}(q)?q:new w.Ms(q,se,fe);return(0,R.Y)(()=>{const{operator:pe,source:Te}=this;de.add(pe?pe.call(de,Te):Te?this._subscribe(de):this._trySubscribe(de))}),de}_trySubscribe(q){try{return this._subscribe(q)}catch(se){q.error(se)}}forEach(q,se){return new(se=K(se))((fe,de)=>{const pe=new w.Ms({next:Te=>{try{q(Te)}catch(Q){de(Q),pe.unsubscribe()}},error:de,complete:fe});this.subscribe(pe)})}_subscribe(q){var se;return null===(se=this.source)||void 0===se?void 0:se.subscribe(q)}[l.s](){return this}pipe(...q){return(0,g.m)(q)(this)}toPromise(q){return new(q=K(q))((se,fe)=>{let de;this.subscribe(pe=>de=pe,pe=>fe(pe),()=>se(de))})}}return Z.create=ue=>new Z(ue),Z})();function K(Z){var ue;return null!==(ue=Z??C.$.Promise)&&void 0!==ue?ue:Promise}},8399:(Y,D,h)=>{h.d(D,{_:()=>P});var w=h(6129);class P{constructor(g,C=P.now){this.schedulerActionCtor=g,this.now=C}schedule(g,C=0,j){return new this.schedulerActionCtor(this,g).schedule(j,C)}}P.now=w.U.now},2688:(Y,D,h)=>{h.d(D,{x:()=>g});var w=h(9131),P=h(9326),l=h(9724);function g(...C){return(0,w.K)()((0,l.H)(C,(0,P.lI)(C)))}},983:(Y,D,h)=>{h.d(D,{I:()=>l,w:()=>P});var w=h(1985);const P=new w.c(C=>C.complete());function l(C){return C?function g(C){return new w.c(j=>C.schedule(()=>j.complete()))}(C):P}},9724:(Y,D,h)=>{h.d(D,{H:()=>l});var w=h(5894),P=h(8750);function l(g,C){return C?(0,w.c)(g,C):(0,P.Tg)(g)}},8750:(Y,D,h)=>{h.d(D,{Tg:()=>ue});var w=h(1635),P=h(7441),l=h(9858),g=h(1985),C=h(5055),j=h(7953),R=h(591),U=h(5397),K=h(5196),H=h(8071),V=h(5334),Z=h(3494);function ue(z){if(z instanceof g.c)return z;if(null!=z){if((0,C.l)(z))return function q(z){return new g.c(N=>{const oe=z[Z.s]();if((0,H.T)(oe.subscribe))return oe.subscribe(N);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(z);if((0,P.X)(z))return function se(z){return new g.c(N=>{for(let oe=0;oe<z.length&&!N.closed;oe++)N.next(z[oe]);N.complete()})}(z);if((0,l.y)(z))return function fe(z){return new g.c(N=>{z.then(oe=>{N.closed||(N.next(oe),N.complete())},oe=>N.error(oe)).then(null,V.m)})}(z);if((0,j.T)(z))return pe(z);if((0,U.x)(z))return function de(z){return new g.c(N=>{for(const oe of z)if(N.next(oe),N.closed)return;N.complete()})}(z);if((0,K.U)(z))return function Te(z){return pe((0,K.C)(z))}(z)}throw(0,R.L)(z)}function pe(z){return new g.c(N=>{(function Q(z,N){var oe,Pe,Ke,lt;return(0,w.sH)(this,void 0,void 0,function*(){try{for(oe=(0,w.xN)(z);!(Pe=yield oe.next()).done;)if(N.next(Pe.value),N.closed)return}catch(Fe){Ke={error:Fe}}finally{try{Pe&&!Pe.done&&(lt=oe.return)&&(yield lt.call(oe))}finally{if(Ke)throw Ke.error}}N.complete()})})(z,N).catch(oe=>N.error(oe))})}},1807:(Y,D,h)=>{h.d(D,{O:()=>C});var w=h(1985),P=h(3236),l=h(9470),g=h(8211);function C(j=0,R,U=P.b){let K=-1;return null!=R&&((0,l.m)(R)?U=R:K=R),new w.c(H=>{let V=(0,g.v)(j)?+j-U.now():j;V<0&&(V=0);let Z=0;return U.schedule(function(){H.closed||(H.next(Z++),0<=K?this.schedule(void 0,K):H.complete())},V)})}},9437:(Y,D,h)=>{h.d(D,{W:()=>g});var w=h(8750),P=h(4360),l=h(9974);function g(C){return(0,l.N)((j,R)=>{let H,U=null,K=!1;U=j.subscribe((0,P._)(R,void 0,void 0,V=>{H=(0,w.Tg)(C(V,g(C)(j))),U?(U.unsubscribe(),U=null,H.subscribe(R)):K=!0})),K&&(U.unsubscribe(),U=null,H.subscribe(R))})}},9131:(Y,D,h)=>{h.d(D,{K:()=>P});var w=h(6365);function P(){return(0,w.U)(1)}},3103:(Y,D,h)=>{h.d(D,{c:()=>g});var w=h(3236),P=h(3183),l=h(1807);function g(C,j=w.E){const R=(0,l.O)(C,j);return(0,P.o)(()=>R)}},3183:(Y,D,h)=>{h.d(D,{o:()=>R});var w=h(2688),P=h(6697),l=h(3557),g=h(3703),C=h(3028),j=h(8750);function R(U,K){return K?H=>(0,w.x)(K.pipe((0,P.s)(1),(0,l.w)()),H.pipe(R(U))):(0,C.Z)((H,V)=>(0,j.Tg)(U(H,V)).pipe((0,P.s)(1),(0,g.u)(H)))}},3557:(Y,D,h)=>{h.d(D,{w:()=>g});var w=h(9974),P=h(4360),l=h(5343);function g(){return(0,w.N)((C,j)=>{C.subscribe((0,P._)(j,l.l))})}},3703:(Y,D,h)=>{h.d(D,{u:()=>P});var w=h(6354);function P(l){return(0,w.T)(()=>l)}},6365:(Y,D,h)=>{h.d(D,{U:()=>l});var w=h(3028),P=h(3669);function l(g=1/0){return(0,w.Z)(P.D,g)}},5412:(Y,D,h)=>{h.d(D,{h:()=>g});var w=h(8750),P=h(5225),l=h(4360);function g(C,j,R,U,K,H,V,Z){const ue=[];let q=0,se=0,fe=!1;const de=()=>{fe&&!ue.length&&!q&&j.complete()},pe=Q=>q<U?Te(Q):ue.push(Q),Te=Q=>{H&&j.next(Q),q++;let z=!1;(0,w.Tg)(R(Q,se++)).subscribe((0,l._)(j,N=>{K?.(N),H?pe(N):j.next(N)},()=>{z=!0},void 0,()=>{if(z)try{for(q--;ue.length&&q<U;){const N=ue.shift();V?(0,P.N)(j,V,()=>Te(N)):Te(N)}de()}catch(N){j.error(N)}}))};return C.subscribe((0,l._)(j,pe,()=>{fe=!0,de()})),()=>{Z?.()}}},3028:(Y,D,h)=>{h.d(D,{Z:()=>j});var w=h(6354),P=h(8750),l=h(9974),g=h(5412),C=h(8071);function j(R,U,K=1/0){return(0,C.T)(U)?j((H,V)=>(0,w.T)((Z,ue)=>U(H,Z,V,ue))((0,P.Tg)(R(H,V))),K):("number"==typeof U&&(K=U),(0,l.N)((H,V)=>(0,g.h)(H,V,R,K)))}},941:(Y,D,h)=>{h.d(D,{Q:()=>g});var w=h(5225),P=h(9974),l=h(4360);function g(C,j=0){return(0,P.N)((R,U)=>{R.subscribe((0,l._)(U,K=>(0,w.N)(U,C,()=>U.next(K),j),()=>(0,w.N)(U,C,()=>U.complete(),j),K=>(0,w.N)(U,C,()=>U.error(K),j)))})}},6745:(Y,D,h)=>{h.d(D,{_:()=>P});var w=h(9974);function P(l,g=0){return(0,w.N)((C,j)=>{j.add(l.schedule(()=>C.subscribe(j),g))})}},6697:(Y,D,h)=>{h.d(D,{s:()=>g});var w=h(983),P=h(9974),l=h(4360);function g(C){return C<=0?()=>w.w:(0,P.N)((j,R)=>{let U=0;j.subscribe((0,l._)(R,K=>{++U<=C&&(R.next(K),C<=U&&R.complete())}))})}},7119:(Y,D,h)=>{h.d(D,{S:()=>C});var w=h(1985),P=h(4761),l=h(8071),g=h(5225);function C(j,R){return new w.c(U=>{let K;return(0,g.N)(U,R,()=>{K=j[P.l](),(0,g.N)(U,R,()=>{let H,V;try{({value:H,done:V}=K.next())}catch(Z){return void U.error(Z)}V?U.complete():U.next(H)},0,!0)}),()=>(0,l.T)(K?.return)&&K.return()})}},5894:(Y,D,h)=>{h.d(D,{c:()=>Te});var w=h(8750),P=h(941),l=h(6745),j=h(1985),U=h(7119),K=h(5225);function H(Q,z){if(!Q)throw new Error("Iterable cannot be null");return new j.c(N=>{(0,K.N)(N,z,()=>{const oe=Q[Symbol.asyncIterator]();(0,K.N)(N,z,()=>{oe.next().then(Pe=>{Pe.done?N.complete():N.next(Pe.value)})},0,!0)})})}var V=h(5055),Z=h(9858),ue=h(7441),q=h(5397),se=h(7953),fe=h(591),de=h(5196);function Te(Q,z){if(null!=Q){if((0,V.l)(Q))return function g(Q,z){return(0,w.Tg)(Q).pipe((0,l._)(z),(0,P.Q)(z))}(Q,z);if((0,ue.X)(Q))return function R(Q,z){return new j.c(N=>{let oe=0;return z.schedule(function(){oe===Q.length?N.complete():(N.next(Q[oe++]),N.closed||this.schedule())})})}(Q,z);if((0,Z.y)(Q))return function C(Q,z){return(0,w.Tg)(Q).pipe((0,l._)(z),(0,P.Q)(z))}(Q,z);if((0,se.T)(Q))return H(Q,z);if((0,q.x)(Q))return(0,U.S)(Q,z);if((0,de.U)(Q))return function pe(Q,z){return H((0,de.C)(Q),z)}(Q,z)}throw(0,fe.L)(Q)}},6780:(Y,D,h)=>{h.d(D,{R:()=>C});var w=h(3961);class P extends w.yU{constructor(R,U){super()}schedule(R,U=0){return this}}const l={setInterval(j,R,...U){const{delegate:K}=l;return K?.setInterval?K.setInterval(j,R,...U):setInterval(j,R,...U)},clearInterval(j){const{delegate:R}=l;return(R?.clearInterval||clearInterval)(j)},delegate:void 0};var g=h(7908);class C extends P{constructor(R,U){super(R,U),this.scheduler=R,this.work=U,this.pending=!1}schedule(R,U=0){var K;if(this.closed)return this;this.state=R;const H=this.id,V=this.scheduler;return null!=H&&(this.id=this.recycleAsyncId(V,H,U)),this.pending=!0,this.delay=U,this.id=null!==(K=this.id)&&void 0!==K?K:this.requestAsyncId(V,this.id,U),this}requestAsyncId(R,U,K=0){return l.setInterval(R.flush.bind(R,this),K)}recycleAsyncId(R,U,K=0){if(null!=K&&this.delay===K&&!1===this.pending)return U;null!=U&&l.clearInterval(U)}execute(R,U){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const K=this._execute(R,U);if(K)return K;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(R,U){let H,K=!1;try{this.work(R)}catch(V){K=!0,H=V||new Error("Scheduled action threw falsy error")}if(K)return this.unsubscribe(),H}unsubscribe(){if(!this.closed){const{id:R,scheduler:U}=this,{actions:K}=U;this.work=this.state=this.scheduler=null,this.pending=!1,(0,g.o)(K,this),null!=R&&(this.id=this.recycleAsyncId(U,R,null)),this.delay=null,super.unsubscribe()}}}},707:(Y,D,h)=>{h.d(D,{q:()=>P});var w=h(8399);class P extends w._{constructor(g,C=w._.now){super(g,C),this.actions=[],this._active=!1}flush(g){const{actions:C}=this;if(this._active)return void C.push(g);let j;this._active=!0;do{if(j=g.execute(g.state,g.delay))break}while(g=C.shift());if(this._active=!1,j){for(;g=C.shift();)g.unsubscribe();throw j}}}},3236:(Y,D,h)=>{h.d(D,{E:()=>l,b:()=>g});var w=h(6780);const l=new(h(707).q)(w.R),g=l},6129:(Y,D,h)=>{h.d(D,{U:()=>w});const w={now:()=>(w.delegate||Date).now(),delegate:void 0}},4761:(Y,D,h)=>{h.d(D,{l:()=>P});const P=function w(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},3494:(Y,D,h)=>{h.d(D,{s:()=>w});const w="function"==typeof Symbol&&Symbol.observable||"@@observable"},9326:(Y,D,h)=>{h.d(D,{R0:()=>j,lI:()=>C,ms:()=>g});var w=h(8071),P=h(9470);function l(R){return R[R.length-1]}function g(R){return(0,w.T)(l(R))?R.pop():void 0}function C(R){return(0,P.m)(l(R))?R.pop():void 0}function j(R,U){return"number"==typeof l(R)?R.pop():U}},5225:(Y,D,h)=>{function w(P,l,g,C=0,j=!1){const R=l.schedule(function(){g(),j?P.add(this.schedule(null,C)):this.unsubscribe()},C);if(P.add(R),!j)return R}h.d(D,{N:()=>w})},3669:(Y,D,h)=>{function w(P){return P}h.d(D,{D:()=>w})},7441:(Y,D,h)=>{h.d(D,{X:()=>w});const w=P=>P&&"number"==typeof P.length&&"function"!=typeof P},7953:(Y,D,h)=>{h.d(D,{T:()=>P});var w=h(8071);function P(l){return Symbol.asyncIterator&&(0,w.T)(l?.[Symbol.asyncIterator])}},8211:(Y,D,h)=>{function w(P){return P instanceof Date&&!isNaN(P)}h.d(D,{v:()=>w})},5055:(Y,D,h)=>{h.d(D,{l:()=>l});var w=h(3494),P=h(8071);function l(g){return(0,P.T)(g[w.s])}},5397:(Y,D,h)=>{h.d(D,{x:()=>l});var w=h(4761),P=h(8071);function l(g){return(0,P.T)(g?.[w.l])}},9858:(Y,D,h)=>{h.d(D,{y:()=>P});var w=h(8071);function P(l){return(0,w.T)(l?.then)}},5196:(Y,D,h)=>{h.d(D,{C:()=>l,U:()=>g});var w=h(1635),P=h(8071);function l(C){return(0,w.AQ)(this,arguments,function*(){const R=C.getReader();try{for(;;){const{value:U,done:K}=yield(0,w.N3)(R.read());if(K)return yield(0,w.N3)(void 0);yield yield(0,w.N3)(U)}}finally{R.releaseLock()}})}function g(C){return(0,P.T)(C?.getReader)}},9470:(Y,D,h)=>{h.d(D,{m:()=>P});var w=h(8071);function P(l){return l&&(0,w.T)(l.schedule)}},1203:(Y,D,h)=>{h.d(D,{F:()=>P,m:()=>l});var w=h(3669);function P(...g){return l(g)}function l(g){return 0===g.length?w.D:1===g.length?g[0]:function(j){return g.reduce((R,U)=>U(R),j)}}},591:(Y,D,h)=>{function w(P){return new TypeError(`You provided ${null!==P&&"object"==typeof P?"an invalid object":`'${P}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}h.d(D,{L:()=>w})},467:(Y,D,h)=>{function w(l,g,C,j,R,U,K){try{var H=l[U](K),V=H.value}catch(Z){return void C(Z)}H.done?g(V):Promise.resolve(V).then(j,R)}function P(l){return function(){var g=this,C=arguments;return new Promise(function(j,R){var U=l.apply(g,C);function K(V){w(U,j,R,K,H,"next",V)}function H(V){w(U,j,R,K,H,"throw",V)}K(void 0)})}}h.d(D,{A:()=>P})},1635:(Y,D,h)=>{function Z(f,y,_,v){return new(_||(_=Promise))(function(x,B){function te(le){try{X(v.next(le))}catch(me){B(me)}}function we(le){try{X(v.throw(le))}catch(me){B(me)}}function X(le){le.done?x(le.value):function I(x){return x instanceof _?x:new _(function(B){B(x)})}(le.value).then(te,we)}X((v=v.apply(f,y||[])).next())})}function z(f){return this instanceof z?(this.v=f,this):new z(f)}function N(f,y,_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var I,v=_.apply(f,y||[]),x=[];return I=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),te("next"),te("throw"),te("return",function B(ne){return function(Ie){return Promise.resolve(Ie).then(ne,me)}}),I[Symbol.asyncIterator]=function(){return this},I;function te(ne,Ie){v[ne]&&(I[ne]=function(Ue){return new Promise(function(We,Ye){x.push([ne,Ue,We,Ye])>1||we(ne,Ue)})},Ie&&(I[ne]=Ie(I[ne])))}function we(ne,Ie){try{!function X(ne){ne.value instanceof z?Promise.resolve(ne.value.v).then(le,me):Be(x[0][2],ne)}(v[ne](Ie))}catch(Ue){Be(x[0][3],Ue)}}function le(ne){we("next",ne)}function me(ne){we("throw",ne)}function Be(ne,Ie){ne(Ie),x.shift(),x.length&&we(x[0][0],x[0][1])}}function Pe(f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _,y=f[Symbol.asyncIterator];return y?y.call(f):(f=function fe(f){var y="function"==typeof Symbol&&Symbol.iterator,_=y&&f[y],v=0;if(_)return _.call(f);if(f&&"number"==typeof f.length)return{next:function(){return f&&v>=f.length&&(f=void 0),{value:f&&f[v++],done:!f}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")}(f),_={},v("next"),v("throw"),v("return"),_[Symbol.asyncIterator]=function(){return this},_);function v(x){_[x]=f[x]&&function(B){return new Promise(function(te,we){!function I(x,B,te,we){Promise.resolve(we).then(function(X){x({value:X,done:te})},B)}(te,we,(B=f[x](B)).done,B.value)})}}}h.d(D,{AQ:()=>N,N3:()=>z,sH:()=>Z,xN:()=>Pe}),"function"==typeof SuppressedError&&SuppressedError}}]);