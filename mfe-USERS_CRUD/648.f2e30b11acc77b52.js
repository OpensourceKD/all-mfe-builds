(self.webpackChunkmfe_USERS_CRUD=self.webpackChunkmfe_USERS_CRUD||[]).push([[648],{6648:(v,f,n)=>{n.r(f),n.d(f,{AUTH0_CONFIG:()=>m,Auth0ApiService:()=>_,AuthService:()=>h,CoreServicesComponent:()=>l,CoreServicesService:()=>g,OrganizationService:()=>M,ProductCategory:()=>y,RoleManagementService:()=>j,RoleService:()=>E,SalesDataService:()=>P,SalesStatus:()=>S,SystemRole:()=>R,TeamService:()=>x,UserRole:()=>c,UserService:()=>z});var o=n(4332);let g=(()=>{class s{constructor(){}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var A=n(467),a=n(3425);const m={useRealAuth0:!1,domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"lT0H33rFRamTUtbbXwPwO7M0SdT8Qq26",redirectUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",scope:"openid profile email",audience:void 0,managementApiAudience:void 0};var p=n(4230);let h=(()=>{class s{get domain(){return m.domain}get clientId(){return m.clientId}get redirectUri(){return m.redirectUri}get scope(){return m.scope}constructor(e){this.http=e,this.id="auth of pokemon",this.TOKEN_KEY="auth0_token",this.USER_INFO_KEY="auth0_user_info",this.userSubject=new a.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("In constructor of auth service in pokemon")}login(e){e&&console.log(`[AuthService] Logged in: ${e}`),this.redirectToAuth0Login()}redirectToAuth0Login(){const e=new URL(`https://${this.domain}/authorize`),t=this.generateRandomState(),r=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",t),sessionStorage.setItem("code_verifier",r),e.searchParams.append("client_id",this.clientId),e.searchParams.append("redirect_uri",this.redirectUri),e.searchParams.append("response_type","code"),e.searchParams.append("scope",this.scope),e.searchParams.append("state",t),window.location.href=e.toString()}handleCallback(e,t){var r=this;return(0,A.A)(function*(){const i=sessionStorage.getItem("oauth_state");if(t!==i)return console.error("State mismatch - possible CSRF attack"),!1;try{const d=yield r.exchangeCodeForToken(e);r.setToken(d.access_token);const D=r.decodeIdToken(d.id_token);return r.setUserInfo(D),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(d){return console.error("Error exchanging code for token:",d),!1}})()}exchangeCodeForToken(e){var t=this;return(0,A.A)(function*(){const r=`https://${t.domain}/oauth/token`,i=new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:t.redirectUri,client_id:t.clientId}),d=yield fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()});if(!d.ok)throw new Error(`Token exchange failed: ${d.statusText}`);return d.json()})()}decodeIdToken(e){try{const t=e.split(".")[1],r=JSON.parse(atob(t));return{sub:r.sub,name:r.name,email:r.email}}catch(t){return console.error("Error decoding ID token:",t),{sub:""}}}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),this.userSubject.next(null);const e=`https://${this.domain}/v2/logout?client_id=${this.clientId}&returnTo=${encodeURIComponent(this.redirectUri)}`;window.location.href=e}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}getUserInfoFromStorage(){const e=localStorage.getItem(this.USER_INFO_KEY);return e?JSON.parse(e):null}setUserInfo(e){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(e)),this.userSubject.next(e)}generateRandomState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(t){return new(t||s)(o.\u0275\u0275inject(p.HttpClient))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),l=(()=>{class s{static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:s,selectors:[["org-core-services"]],standalone:!0,features:[o.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(t,r){1&t&&(o.\u0275\u0275elementStart(0,"p"),o.\u0275\u0275text(1," core-services works! "),o.\u0275\u0275elementEnd())}})}}return s})();var c=function(s){return s.SUPER_ADMIN="super-admin",s.ORG_ADMIN="org-admin",s.TEAM_LEAD="team-lead",s.SALES_EXECUTIVE="sales-executive",s}(c||{});let E=(()=>{class s{constructor(e){this.currentUserSubject=new a.BehaviorSubject(this.getDummyUser()),this.currentUser$=this.currentUserSubject.asObservable(),this.dataService=e}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(e){this.currentUserSubject.next(e)}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){const t=this.getCurrentUser();return!!t&&e.includes(t.role)}isAdmin(){return this.hasAnyRole([c.SUPER_ADMIN,c.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([c.SUPER_ADMIN,c.ORG_ADMIN,c.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:c.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:c.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:c.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const t=this.getAllUsers();return this.isTeamLeadOrHigher()?t.filter(r=>r.role===c.SALES_EXECUTIVE||r.id===e.id):t.filter(r=>r.id===e.id)}getDummyUser(){return{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}}static{this.\u0275fac=function(t){return new(t||s)(o.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var I=n(3103),S=function(s){return s.COMPLETED="completed",s.PENDING="pending",s.CANCELLED="cancelled",s}(S||{}),y=function(s){return s.ELECTRONICS="Electronics",s.SOFTWARE="Software",s.SERVICES="Services",s.HARDWARE="Hardware",s}(y||{});let P=(()=>{class s{constructor(e){this.dummySalesData=this.generateDummyData(),this.dataService=e}getSalesHistory(e,t,r){if(this.dataService)return this.dataService.getSalesHistory(e,t,r);let i=this.dummySalesData.filter(d=>d.salesExecutiveId===e);return t&&(i=i.filter(d=>d.date>=t)),r&&(i=i.filter(d=>d.date<=r)),(0,a.of)(i).pipe((0,I.c)(300))}getSalesSummary(e){if(this.dataService)return this.dataService.getSalesSummary(e);const t=this.dummySalesData.filter(i=>i.salesExecutiveId===e),r={totalSales:t.filter(i=>i.status===S.COMPLETED).reduce((i,d)=>i+d.amount,0),totalCommission:t.filter(i=>i.status===S.COMPLETED).reduce((i,d)=>i+d.commission,0),completedCount:t.filter(i=>i.status===S.COMPLETED).length,pendingCount:t.filter(i=>i.status===S.PENDING).length,cancelledCount:t.filter(i=>i.status===S.CANCELLED).length};return(0,a.of)(r).pipe((0,I.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,a.of)(this.dummySalesData).pipe((0,I.c)(300))}generateDummyData(){const e=[{name:"Enterprise Software License",category:y.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:y.SERVICES,basePrice:25e3},{name:"Server Hardware",category:y.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:y.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:y.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:y.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:y.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:y.HARDWARE,basePrice:6e4}],t=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],r=["North","South","East","West","Central"],i=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],d=[S.COMPLETED,S.COMPLETED,S.COMPLETED,S.PENDING,S.CANCELLED],D=[];let W=1;for(let U=0;U<50;U++){const w=i[U%i.length],b=e[Math.floor(Math.random()*e.length)],L=t[Math.floor(Math.random()*t.length)],$=r[Math.floor(Math.random()*r.length)],N=d[Math.floor(Math.random()*d.length)],O=b.basePrice+(1e4*Math.random()-5e3),B=.05*O,T=new Date;T.setDate(T.getDate()-Math.floor(180*Math.random())),D.push({id:"sale-"+W++,salesExecutiveId:w.id,salesExecutiveName:w.name,productName:b.name,productCategory:b.category,amount:Math.round(O),commission:Math.round(B),status:N,date:T,clientName:L,region:$})}return D.sort((U,w)=>w.date.getTime()-U.date.getTime())}static{this.\u0275fac=function(t){return new(t||s)(o.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var R=function(s){return s.SUPER_ADMIN="super-admin",s.ORG_ADMIN="org-admin",s.TEAM_LEAD="team-lead",s.MEMBER="member",s}(R||{}),C=n(6354),u=n(9437);let _=(()=>{class s{get domain(){return m.domain}get managementApiUrl(){return`https://${this.domain}/api/v2`}constructor(e,t){this.http=e,this.authService=t}getHeaders(){const e=this.authService.getToken();return new p.HttpHeaders({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}getCurrentUser(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}getUserInfo(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}listUsers(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/users?${t}`:`${this.managementApiUrl}/users`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}getUserById(e){return this.http.get(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}createUser(e){return this.http.post(`${this.managementApiUrl}/users`,e,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}updateUser(e,t){return this.http.patch(`${this.managementApiUrl}/users/${e}`,t,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}deleteUser(e){return this.http.delete(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}blockUser(e,t=!0){return this.http.patch(`${this.managementApiUrl}/users/${e}`,{blocked:t},{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}listOrganizations(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/organizations?${t}`:`${this.managementApiUrl}/organizations`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}getOrganizationById(e){return this.http.get(`${this.managementApiUrl}/organizations/${e}`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}createOrganization(e){return this.http.post(`${this.managementApiUrl}/organizations`,e,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}updateOrganization(e,t){return this.http.patch(`${this.managementApiUrl}/organizations/${e}`,t,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}listRoles(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/roles?${t}`:`${this.managementApiUrl}/roles`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}getRoleById(e){return this.http.get(`${this.managementApiUrl}/roles/${e}`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}createRole(e){return this.http.post(`${this.managementApiUrl}/roles`,e,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}updateRole(e,t){return this.http.patch(`${this.managementApiUrl}/roles/${e}`,t,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}listUserRoles(e){return this.http.get(`${this.managementApiUrl}/users/${e}/roles`,{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}assignRolesToUser(e,t){return this.http.post(`${this.managementApiUrl}/users/${e}/roles`,{roles:t},{headers:this.getHeaders()}).pipe((0,u.W)(this.handleError))}handleError(e){return console.error("Auth0 API Error:",e),(0,a.throwError)(()=>e)}static{this.\u0275fac=function(t){return new(t||s)(o.\u0275\u0275inject(p.HttpClient),o.\u0275\u0275inject(h))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),M=(()=>{class s{constructor(e){this.auth0Api=e,this.organizationsCache=[],this.organizationsSubject=new a.BehaviorSubject([]),this.organizations$=this.organizationsSubject.asObservable(),this.loadOrganizations()}loadOrganizations(){this.auth0Api.listOrganizations().pipe((0,C.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,u.W)(e=>(console.error("Error loading organizations from Auth0:",e),(0,a.of)([])))).subscribe(e=>{e&&e.length>0&&(this.organizationsCache=e,this.organizationsSubject.next(this.organizationsCache))})}mapAuth0OrgsToOrganizations(e){return e&&Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,description:t.display_name||t.name,createdAt:t.created_at?new Date(t.created_at):new Date,updatedAt:t.updated_at?new Date(t.updated_at):new Date,isActive:!0,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}})):[]}getAll(){return this.auth0Api.listOrganizations().pipe((0,C.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,u.W)(e=>(console.error("Error getting organizations:",e),(0,a.of)(this.organizationsCache))))}getById(e){return this.getAll().pipe((0,C.T)(t=>t.find(r=>r.id===e)))}create(e){return this.auth0Api.createOrganization({name:e.name,display_name:e.description}).pipe((0,C.T)(r=>{const i={id:r.id,name:r.name,description:r.display_name||r.name,createdAt:new Date(r.created_at),updatedAt:new Date(r.updated_at||r.created_at),isActive:!0,settings:e.settings||{timezone:"UTC",currency:"USD",locale:"en-US"}};return this.organizationsCache.push(i),this.organizationsSubject.next(this.organizationsCache),i}),(0,u.W)(r=>{console.error("Creating organizations in Auth0 requires admin privileges:",r);const i={...e,id:`org-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return(0,a.of)(i)}))}update(e,t){const r={};return t.name&&(r.name=t.name),t.description&&(r.display_name=t.description),this.auth0Api.updateOrganization(e,r).pipe((0,C.T)(i=>{const d=this.organizationsCache.findIndex(D=>D.id===e);return-1!==d?(this.organizationsCache[d]={...this.organizationsCache[d],...t,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),this.organizationsCache[d]):null}),(0,u.W)(i=>{console.warn("Updating organizations in Auth0 requires specific permissions:",i);const d=this.organizationsCache.findIndex(D=>D.id===e);return-1!==d?(this.organizationsCache[d]={...this.organizationsCache[d],...t,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),(0,a.of)(this.organizationsCache[d])):(0,a.of)(null)}))}delete(e){return console.warn("Deleting organizations should be done with caution and may not be supported via Auth0 API"),(0,a.of)(!1)}static{this.\u0275fac=function(t){return new(t||s)(o.\u0275\u0275inject(_))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),x=(()=>{class s{constructor(e){this.auth0Api=e,this.teamsCache=[],this.teamsSubject=new a.BehaviorSubject([]),this.teams$=this.teamsSubject.asObservable(),this.loadTeams()}loadTeams(){this.teamsCache=this.getDummyTeams(),this.teamsSubject.next(this.teamsCache)}getDummyTeams(){return[{id:"team1",name:"Engineering",description:"Engineering team",organizationId:"org1",leadId:"1",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team2",name:"Product",description:"Product team",organizationId:"org1",leadId:"2",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team3",name:"Design",description:"Design team",organizationId:"org2",leadId:"3",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0}]}getAll(){return(0,a.of)(this.teamsCache)}getByOrganization(e){return this.getAll().pipe((0,C.T)(t=>t.filter(r=>r.organizationId===e)))}getById(e){const t=this.teamsCache.find(r=>r.id===e);return(0,a.of)(t)}create(e){const t={id:`team-${Date.now()}`,name:e.name,description:e.description,organizationId:e.organizationId,leadId:e.leadId,createdAt:new Date,updatedAt:new Date,isActive:!0};return this.teamsCache.push(t),this.teamsSubject.next(this.teamsCache),(0,a.of)(t)}update(e,t){const r=this.teamsCache.findIndex(i=>i.id===e);return-1!==r?(this.teamsCache[r]={...this.teamsCache[r],...t,updatedAt:new Date},this.teamsSubject.next(this.teamsCache),(0,a.of)(this.teamsCache[r])):(0,a.of)(null)}delete(e){const t=this.teamsCache.findIndex(r=>r.id===e);return-1!==t?(this.teamsCache[t].isActive=!1,this.teamsCache[t].updatedAt=new Date,this.teamsSubject.next(this.teamsCache),(0,a.of)(!0)):(0,a.of)(!1)}static{this.\u0275fac=function(t){return new(t||s)(o.\u0275\u0275inject(_))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),z=(()=>{class s{constructor(e){this.auth0Api=e,this.usersCache=[],this.usersSubject=new a.BehaviorSubject([]),this.users$=this.usersSubject.asObservable(),this.currentAuth0User=null,this.loadUsers()}loadUsers(){if(!m.useRealAuth0)return this.usersCache=this.getDummyUsers(),void this.usersSubject.next(this.usersCache);(0,a.forkJoin)({authUser:this.auth0Api.getCurrentUser().pipe((0,u.W)(()=>(0,a.of)(null))),userInfo:this.auth0Api.getUserInfo().pipe((0,u.W)(()=>(0,a.of)(null)))}).subscribe(({authUser:e,userInfo:t})=>{const r=this.getDummyUsers();if(e||t){const i=this.mapAuth0UserToUser(e||t);this.currentAuth0User=i,this.usersCache=[i,...r.slice(1)]}else console.log("Could not fetch real user from Auth0 API, using dummy data"),this.usersCache=r;this.usersSubject.next(this.usersCache)})}getDummyUsers(){return[{id:"1",name:"John Doe",email:"john.doe@example.com",organizationId:"org1",teamId:"team1",roleId:"super-admin",isActive:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"2",name:"Jane Smith",email:"jane.smith@example.com",organizationId:"org1",teamId:"team2",roleId:"org-admin",isActive:!0,createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-02-10")},{id:"3",name:"Bob Johnson",email:"bob.johnson@example.com",organizationId:"org2",teamId:"team3",roleId:"team-lead",isActive:!0,createdAt:new Date("2024-03-05"),updatedAt:new Date("2024-03-05")},{id:"4",name:"Alice Brown",email:"alice.brown@example.com",organizationId:"org1",teamId:"team1",roleId:"member",isActive:!1,createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-05-10")}]}mapAuth0UserToUser(e){return e?{id:e.user_id||e.sub||"1",name:this.extractUserName(e),email:e.email||"user@example.com",organizationId:e.org_id||"default-org",teamId:"default-team",roleId:"member",isActive:!e.blocked,createdAt:e.created_at?new Date(e.created_at):new Date,updatedAt:e.updated_at?new Date(e.updated_at):new Date,auth0UserId:e.user_id||e.sub}:this.getDummyUsers()[0]}extractUserName(e){return e.name?e.name:e.nickname?e.nickname:`${e.given_name||""} ${e.family_name||""}`.trim()||(e.email?e.email.split("@")[0]:`User ${e.user_id||e.sub}`)}mapAuth0UsersToUsers(e){return e&&Array.isArray(e)?e.map(t=>({id:t.user_id,name:this.extractUserName(t),email:t.email||"",organizationId:t.org_id||"default-org",teamId:"default-team",roleId:"default-role",isActive:!t.blocked,createdAt:t.created_at?new Date(t.created_at):new Date,updatedAt:t.updated_at?new Date(t.updated_at):new Date,auth0UserId:t.user_id})):[]}mapUserToAuth0Format(e){return{email:e.email,name:e.name,nickname:e.name,blocked:!e.isActive,connection:"Username-Password-Authentication",email_verified:!1,user_metadata:{organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId}}}getAll(){return(0,a.of)(this.usersCache)}getCurrentAuth0User(){return this.currentAuth0User}getByOrganization(e){return this.getAll().pipe((0,C.T)(t=>t.filter(r=>r.organizationId===e)))}getByTeam(e){return this.getAll().pipe((0,C.T)(t=>t.filter(r=>r.teamId===e)))}getById(e){const t=this.usersCache.find(r=>r.id===e);return t?(0,a.of)(t):this.auth0Api.getUserById(e).pipe((0,C.T)(r=>{const i=this.mapAuth0UsersToUsers([r]);return i.length>0?i[0]:void 0}),(0,u.W)(r=>(console.error("Error getting user by ID (Management API not available):",r),(0,a.of)(void 0))))}create(e){const t=this.mapUserToAuth0Format(e);return this.auth0Api.createUser(t).pipe((0,C.T)(r=>{const i={id:r.user_id||`user-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date,auth0UserId:r.user_id};return this.usersCache.push(i),this.usersSubject.next(this.usersCache),i}),(0,u.W)(r=>{console.error("Error creating user (Management API not available):",r);const i={id:`local-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date};return this.usersCache.push(i),this.usersSubject.next(this.usersCache),(0,a.of)(i)}))}update(e,t){const r=this.mapUserToAuth0Format(t);return this.auth0Api.updateUser(e,r).pipe((0,C.T)(i=>{const d=this.usersCache.findIndex(D=>D.id===e);return-1!==d?(this.usersCache[d]={...this.usersCache[d],...t,updatedAt:new Date},this.usersSubject.next(this.usersCache),this.usersCache[d]):null}),(0,u.W)(i=>{console.error("Error updating user (Management API not available):",i);const d=this.usersCache.findIndex(D=>D.id===e);return-1!==d?(this.usersCache[d]={...this.usersCache[d],...t,updatedAt:new Date},this.usersSubject.next(this.usersCache),(0,a.of)(this.usersCache[d])):(0,a.of)(null)}))}delete(e){return this.auth0Api.blockUser(e,!0).pipe((0,C.T)(()=>{const t=this.usersCache.findIndex(r=>r.id===e);return-1!==t&&(this.usersCache[t].isActive=!1,this.usersCache[t].updatedAt=new Date,this.usersSubject.next(this.usersCache),!0)}),(0,u.W)(t=>{console.error("Error deleting user (Management API not available):",t);const r=this.usersCache.findIndex(i=>i.id===e);return-1!==r&&(this.usersCache[r].isActive=!1,this.usersCache[r].updatedAt=new Date,this.usersSubject.next(this.usersCache)),(0,a.of)(!0)}))}static{this.\u0275fac=function(t){return new(t||s)(o.\u0275\u0275inject(_))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),j=(()=>{class s{constructor(e){this.auth0Api=e,this.systemRoles=[{id:"role-1",name:"Super Admin",description:"Full system access",permissions:["*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-2",name:"Organization Admin",description:"Full access within organization",permissions:["org:*","team:*","user:*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-3",name:"Team Lead",description:"Manage team and team members",permissions:["team:read","team:update","user:read","user:update"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-4",name:"Member",description:"Basic member access",permissions:["user:read"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.rolesCache=[...this.systemRoles],this.rolesSubject=new a.BehaviorSubject(this.rolesCache),this.roles$=this.rolesSubject.asObservable(),this.loadCustomRoles()}loadCustomRoles(){this.auth0Api.listRoles().pipe((0,C.T)(e=>this.mapAuth0RolesToRoles(e)),(0,u.W)(e=>(console.error("Error loading custom roles from Auth0:",e),(0,a.of)([])))).subscribe(e=>{this.rolesCache=[...this.systemRoles,...e],this.rolesSubject.next(this.rolesCache)})}mapAuth0RolesToRoles(e){return e&&Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,description:t.description||"",permissions:[],isSystemRole:!1,createdAt:new Date,updatedAt:new Date})):[]}getAll(){return(0,a.of)(this.rolesCache)}getById(e){const t=this.rolesCache.find(r=>r.id===e);return(0,a.of)(t)}getSystemRoles(){const e=this.rolesCache.filter(t=>t.isSystemRole);return(0,a.of)(e)}getCustomRoles(){const e=this.rolesCache.filter(t=>!t.isSystemRole);return(0,a.of)(e)}create(e){return this.auth0Api.createRole({name:e.name,description:e.description}).pipe((0,C.T)(r=>{const i={id:r.id,name:r.name,description:r.description||"",permissions:e.permissions,isSystemRole:!1,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(i),this.rolesSubject.next(this.rolesCache),i}),(0,u.W)(r=>{console.error("Error creating role in Auth0:",r);const i={...e,id:`role-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(i),this.rolesSubject.next(this.rolesCache),(0,a.of)(i)}))}update(e,t){const r=this.rolesCache.findIndex(i=>i.id===e);return-1===r||this.rolesCache[r].isSystemRole?(0,a.of)(null):(this.rolesCache[r]={...this.rolesCache[r],...t,updatedAt:new Date},this.rolesSubject.next(this.rolesCache),(0,a.of)(this.rolesCache[r]))}delete(e){const t=this.rolesCache.findIndex(r=>r.id===e);return-1===t||this.rolesCache[t].isSystemRole?(0,a.of)(!1):(this.rolesCache.splice(t,1),this.rolesSubject.next(this.rolesCache),(0,a.of)(!0))}static{this.\u0275fac=function(t){return new(t||s)(o.\u0275\u0275inject(_))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})()},8399:(v,f,n)=>{n.d(f,{_:()=>g});var o=n(6129);class g{constructor(a,m=g.now){this.schedulerActionCtor=a,this.now=m}schedule(a,m=0,p){return new this.schedulerActionCtor(this,a).schedule(p,m)}}g.now=o.U.now},1807:(v,f,n)=>{n.d(f,{O:()=>m});var o=n(1985),g=n(3236),A=n(9470),a=n(8211);function m(p=0,h,l=g.b){let c=-1;return null!=h&&((0,A.m)(h)?l=h:c=h),new o.c(E=>{let I=(0,a.v)(p)?+p-l.now():p;I<0&&(I=0);let S=0;return l.schedule(function(){E.closed||(E.next(S++),0<=c?this.schedule(void 0,c):E.complete())},I)})}},3103:(v,f,n)=>{n.d(f,{c:()=>a});var o=n(3236),g=n(3183),A=n(1807);function a(m,p=o.E){const h=(0,A.O)(m,p);return(0,g.o)(()=>h)}},3183:(v,f,n)=>{n.d(f,{o:()=>h});var o=n(2688),g=n(6697),A=n(3557),a=n(3703),m=n(3028),p=n(8750);function h(l,c){return c?E=>(0,o.x)(c.pipe((0,g.s)(1),(0,A.w)()),E.pipe(h(l))):(0,m.Z)((E,I)=>(0,p.Tg)(l(E,I)).pipe((0,g.s)(1),(0,a.u)(E)))}},3557:(v,f,n)=>{n.d(f,{w:()=>a});var o=n(9974),g=n(4360),A=n(5343);function a(){return(0,o.N)((m,p)=>{m.subscribe((0,g._)(p,A.l))})}},6780:(v,f,n)=>{n.d(f,{R:()=>m});var o=n(3961);class g extends o.yU{constructor(h,l){super()}schedule(h,l=0){return this}}const A={setInterval(p,h,...l){const{delegate:c}=A;return c?.setInterval?c.setInterval(p,h,...l):setInterval(p,h,...l)},clearInterval(p){const{delegate:h}=A;return(h?.clearInterval||clearInterval)(p)},delegate:void 0};var a=n(7908);class m extends g{constructor(h,l){super(h,l),this.scheduler=h,this.work=l,this.pending=!1}schedule(h,l=0){var c;if(this.closed)return this;this.state=h;const E=this.id,I=this.scheduler;return null!=E&&(this.id=this.recycleAsyncId(I,E,l)),this.pending=!0,this.delay=l,this.id=null!==(c=this.id)&&void 0!==c?c:this.requestAsyncId(I,this.id,l),this}requestAsyncId(h,l,c=0){return A.setInterval(h.flush.bind(h,this),c)}recycleAsyncId(h,l,c=0){if(null!=c&&this.delay===c&&!1===this.pending)return l;null!=l&&A.clearInterval(l)}execute(h,l){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const c=this._execute(h,l);if(c)return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(h,l){let E,c=!1;try{this.work(h)}catch(I){c=!0,E=I||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),E}unsubscribe(){if(!this.closed){const{id:h,scheduler:l}=this,{actions:c}=l;this.work=this.state=this.scheduler=null,this.pending=!1,(0,a.o)(c,this),null!=h&&(this.id=this.recycleAsyncId(l,h,null)),this.delay=null,super.unsubscribe()}}}},707:(v,f,n)=>{n.d(f,{q:()=>g});var o=n(8399);class g extends o._{constructor(a,m=o._.now){super(a,m),this.actions=[],this._active=!1}flush(a){const{actions:m}=this;if(this._active)return void m.push(a);let p;this._active=!0;do{if(p=a.execute(a.state,a.delay))break}while(a=m.shift());if(this._active=!1,p){for(;a=m.shift();)a.unsubscribe();throw p}}}},3236:(v,f,n)=>{n.d(f,{E:()=>A,b:()=>a});var o=n(6780);const A=new(n(707).q)(o.R),a=A},6129:(v,f,n)=>{n.d(f,{U:()=>o});const o={now:()=>(o.delegate||Date).now(),delegate:void 0}},8211:(v,f,n)=>{function o(g){return g instanceof Date&&!isNaN(g)}n.d(f,{v:()=>o})}}]);