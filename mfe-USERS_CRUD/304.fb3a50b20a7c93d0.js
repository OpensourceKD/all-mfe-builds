(self.webpackChunkmfe_USERS_CRUD=self.webpackChunkmfe_USERS_CRUD||[]).push([[304],{3304:(D,E,r)=>{r.r(E),r.d(E,{AuthService:()=>u,CoreServicesComponent:()=>l,CoreServicesService:()=>h,OrganizationService:()=>U,ProductCategory:()=>v,RoleManagementService:()=>C,RoleService:()=>c,SalesDataService:()=>M,SalesStatus:()=>_,SystemRole:()=>P,TeamService:()=>R,UserRole:()=>n,UserService:()=>g,ZitadelApiService:()=>O});var a=r(4332);let h=(()=>{class i{constructor(){}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var m=r(467),s=r(3425),d=r(4230);let u=(()=>{class i{constructor(e){this.http=e,this.id="auth of pokemon",this.ISSUER_BASE_URL="https://topfix-wrczmn.us1.zitadel.cloud",this.CLIENT_ID="336777344075263315",this.REDIRECT_URI="https://opensourcekd.github.io/pokemon/#/auth-callback",this.SCOPE="openid profile email",this.TOKEN_KEY="zitadel_token",this.USER_INFO_KEY="zitadel_user_info",this.userSubject=new s.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("In constructor of auth service in pokemon")}login(e){e&&console.log(`[AuthService] Logged in: ${e}`),this.redirectToZitadelLogin()}redirectToZitadelLogin(){const e=new URL(`${this.ISSUER_BASE_URL}/oauth/v2/authorize`),t=this.generateRandomState(),o=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",t),sessionStorage.setItem("code_verifier",o),e.searchParams.append("client_id",this.CLIENT_ID),e.searchParams.append("redirect_uri",this.REDIRECT_URI),e.searchParams.append("response_type","code"),e.searchParams.append("scope",this.SCOPE),e.searchParams.append("state",t),window.location.href=e.toString()}handleCallback(e,t){var o=this;return(0,m.A)(function*(){const f=sessionStorage.getItem("oauth_state");if(t!==f)return console.error("State mismatch - possible CSRF attack"),!1;try{const I=yield o.exchangeCodeForToken(e);o.setToken(I.access_token);const y=o.decodeIdToken(I.id_token);return o.setUserInfo(y),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(I){return console.error("Error exchanging code for token:",I),!1}})()}exchangeCodeForToken(e){var t=this;return(0,m.A)(function*(){const o=`${t.ISSUER_BASE_URL}/oauth/v2/token`,f=new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:t.REDIRECT_URI,client_id:t.CLIENT_ID}),I=yield fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:f.toString()});if(!I.ok)throw new Error(`Token exchange failed: ${I.statusText}`);return I.json()})()}decodeIdToken(e){try{const t=e.split(".")[1],o=JSON.parse(atob(t));return{sub:o.sub,name:o.name,email:o.email}}catch(t){return console.error("Error decoding ID token:",t),{sub:""}}}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),this.userSubject.next(null)}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}getUserInfoFromStorage(){const e=localStorage.getItem(this.USER_INFO_KEY);return e?JSON.parse(e):null}setUserInfo(e){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(e)),this.userSubject.next(e)}generateRandomState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),l=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:i,selectors:[["org-core-services"]],standalone:!0,features:[a.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(t,o){1&t&&(a.\u0275\u0275elementStart(0,"p"),a.\u0275\u0275text(1," core-services works! "),a.\u0275\u0275elementEnd())}})}}return i})();var n=function(i){return i.SUPER_ADMIN="super-admin",i.ORG_ADMIN="org-admin",i.TEAM_LEAD="team-lead",i.SALES_EXECUTIVE="sales-executive",i}(n||{});let c=(()=>{class i{constructor(e){this.currentUserSubject=new s.BehaviorSubject(this.getDummyUser()),this.currentUser$=this.currentUserSubject.asObservable(),this.dataService=e}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(e){this.currentUserSubject.next(e)}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){const t=this.getCurrentUser();return!!t&&e.includes(t.role)}isAdmin(){return this.hasAnyRole([n.SUPER_ADMIN,n.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([n.SUPER_ADMIN,n.ORG_ADMIN,n.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:n.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:n.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:n.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:n.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:n.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:n.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const t=this.getAllUsers();return this.isTeamLeadOrHigher()?t.filter(o=>o.role===n.SALES_EXECUTIVE||o.id===e.id):t.filter(o=>o.id===e.id)}getDummyUser(){return{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:n.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var p=r(3103),_=function(i){return i.COMPLETED="completed",i.PENDING="pending",i.CANCELLED="cancelled",i}(_||{}),v=function(i){return i.ELECTRONICS="Electronics",i.SOFTWARE="Software",i.SERVICES="Services",i.HARDWARE="Hardware",i}(v||{});let M=(()=>{class i{constructor(e){this.dummySalesData=this.generateDummyData(),this.dataService=e}getSalesHistory(e,t,o){if(this.dataService)return this.dataService.getSalesHistory(e,t,o);let f=this.dummySalesData.filter(I=>I.salesExecutiveId===e);return t&&(f=f.filter(I=>I.date>=t)),o&&(f=f.filter(I=>I.date<=o)),(0,s.of)(f).pipe((0,p.c)(300))}getSalesSummary(e){if(this.dataService)return this.dataService.getSalesSummary(e);const t=this.dummySalesData.filter(f=>f.salesExecutiveId===e),o={totalSales:t.filter(f=>f.status===_.COMPLETED).reduce((f,I)=>f+I.amount,0),totalCommission:t.filter(f=>f.status===_.COMPLETED).reduce((f,I)=>f+I.commission,0),completedCount:t.filter(f=>f.status===_.COMPLETED).length,pendingCount:t.filter(f=>f.status===_.PENDING).length,cancelledCount:t.filter(f=>f.status===_.CANCELLED).length};return(0,s.of)(o).pipe((0,p.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,s.of)(this.dummySalesData).pipe((0,p.c)(300))}generateDummyData(){const e=[{name:"Enterprise Software License",category:v.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:v.SERVICES,basePrice:25e3},{name:"Server Hardware",category:v.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:v.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:v.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:v.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:v.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:v.HARDWARE,basePrice:6e4}],t=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],o=["North","South","East","West","Central"],f=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],I=[_.COMPLETED,_.COMPLETED,_.COMPLETED,_.PENDING,_.CANCELLED],y=[];let j=1;for(let L=0;L<50;L++){const N=f[L%f.length],b=e[Math.floor(Math.random()*e.length)],x=t[Math.floor(Math.random()*t.length)],K=o[Math.floor(Math.random()*o.length)],$=I[Math.floor(Math.random()*I.length)],B=b.basePrice+(1e4*Math.random()-5e3),F=.05*B,W=new Date;W.setDate(W.getDate()-Math.floor(180*Math.random())),y.push({id:"sale-"+j++,salesExecutiveId:N.id,salesExecutiveName:N.name,productName:b.name,productCategory:b.category,amount:Math.round(B),commission:Math.round(F),status:$,date:W,clientName:x,region:K})}return y.sort((L,N)=>N.date.getTime()-L.date.getTime())}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var P=function(i){return i.SUPER_ADMIN="super-admin",i.ORG_ADMIN="org-admin",i.TEAM_LEAD="team-lead",i.MEMBER="member",i}(P||{}),S=r(6354),A=r(9437);let O=(()=>{class i{constructor(e,t){this.http=e,this.authService=t,this.API_BASE_URL="https://topfix-wrczmn.us1.zitadel.cloud",this.MANAGEMENT_API=`${this.API_BASE_URL}/management/v1`,this.AUTH_API=`${this.API_BASE_URL}/auth/v1`}getHeaders(){const e=this.authService.getToken();return new d.HttpHeaders({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}getCurrentUser(){return this.http.get(`${this.AUTH_API}/users/me`,{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}listUsers(e){return this.http.post(`${this.MANAGEMENT_API}/users/_search`,e||{},{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}getUserById(e){return this.http.get(`${this.MANAGEMENT_API}/users/${e}`,{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}createUser(e){return this.http.post(`${this.MANAGEMENT_API}/users/human/_import`,e,{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}updateUser(e,t){return this.http.put(`${this.MANAGEMENT_API}/users/${e}`,t,{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}deactivateUser(e){return this.http.post(`${this.MANAGEMENT_API}/users/${e}/_deactivate`,{},{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}listOrganizations(e){return this.http.post(`${this.API_BASE_URL}/admin/v1/orgs/_search`,e||{},{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}getMyOrganization(){return this.http.get(`${this.MANAGEMENT_API}/orgs/me`,{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}listProjects(e){return this.http.post(`${this.MANAGEMENT_API}/projects/_search`,e||{},{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}getProjectById(e){return this.http.get(`${this.MANAGEMENT_API}/projects/${e}`,{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}createProject(e){return this.http.post(`${this.MANAGEMENT_API}/projects`,e,{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}updateProject(e,t){return this.http.put(`${this.MANAGEMENT_API}/projects/${e}`,t,{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}listProjectRoles(e,t){return this.http.post(`${this.MANAGEMENT_API}/projects/${e}/roles/_search`,t||{},{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}listUserGrants(e,t){return this.http.post(`${this.MANAGEMENT_API}/users/${e}/grants/_search`,t||{},{headers:this.getHeaders()}).pipe((0,A.W)(this.handleError))}handleError(e){return console.error("Zitadel API Error:",e),(0,s.throwError)(()=>e)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(d.HttpClient),a.\u0275\u0275inject(u))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),U=(()=>{class i{constructor(e){this.zitadelApi=e,this.organizationsCache=[],this.organizationsSubject=new s.BehaviorSubject([]),this.organizations$=this.organizationsSubject.asObservable(),this.loadOrganization()}loadOrganization(){this.zitadelApi.getMyOrganization().pipe((0,S.T)(e=>this.mapZitadelOrgToOrganization(e)),(0,A.W)(e=>(console.error("Error loading organization from Zitadel:",e),(0,s.of)(null)))).subscribe(e=>{e&&(this.organizationsCache=[e],this.organizationsSubject.next(this.organizationsCache))})}mapZitadelOrgToOrganization(e){return e&&e.org?{id:e.org.id,name:e.org.name,description:e.org.name,createdAt:e.org.details?.creationDate?new Date(e.org.details.creationDate):new Date,updatedAt:e.org.details?.changeDate?new Date(e.org.details.changeDate):new Date,isActive:"ORG_STATE_ACTIVE"===e.org.state,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}}:null}getAll(){return this.zitadelApi.getMyOrganization().pipe((0,S.T)(e=>{const t=this.mapZitadelOrgToOrganization(e);return t?[t]:[]}),(0,A.W)(e=>(console.error("Error getting organizations:",e),(0,s.of)(this.organizationsCache))))}getById(e){return this.getAll().pipe((0,S.T)(t=>t.find(o=>o.id===e)))}create(e){console.warn("Creating organizations in Zitadel requires admin privileges");const t={...e,id:`org-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return(0,s.of)(t)}update(e,t){console.warn("Updating organizations in Zitadel requires specific permissions");const o=this.organizationsCache.findIndex(f=>f.id===e);return-1!==o?(this.organizationsCache[o]={...this.organizationsCache[o],...t,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),(0,s.of)(this.organizationsCache[o])):(0,s.of)(null)}delete(e){return console.warn("Deleting organizations is not supported via Zitadel API"),(0,s.of)(!1)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(O))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),R=(()=>{class i{constructor(e){this.zitadelApi=e,this.teamsCache=[],this.teamsSubject=new s.BehaviorSubject([]),this.teams$=this.teamsSubject.asObservable(),this.loadTeams()}loadTeams(){this.zitadelApi.listProjects().pipe((0,S.T)(e=>this.mapZitadelProjectsToTeams(e)),(0,A.W)(e=>(console.error("Error loading teams from Zitadel:",e),(0,s.of)([])))).subscribe(e=>{this.teamsCache=e,this.teamsSubject.next(e)})}mapZitadelProjectsToTeams(e){return e&&e.result?e.result.map(t=>({id:t.id,name:t.name,description:`Team for ${t.name} project`,organizationId:t.details?.resourceOwner||"default-org",leadId:void 0,createdAt:t.details?.creationDate?new Date(t.details.creationDate):new Date,updatedAt:t.details?.changeDate?new Date(t.details.changeDate):new Date,isActive:"PROJECT_STATE_ACTIVE"===t.state})):[]}mapTeamToZitadelFormat(e){return{name:e.name,projectRoleAssertion:!0,projectRoleCheck:!0}}getAll(){return this.zitadelApi.listProjects().pipe((0,S.T)(e=>this.mapZitadelProjectsToTeams(e)),(0,A.W)(e=>(console.error("Error getting teams:",e),(0,s.of)(this.teamsCache))))}getByOrganization(e){return this.getAll().pipe((0,S.T)(t=>t.filter(o=>o.organizationId===e)))}getById(e){return this.zitadelApi.getProjectById(e).pipe((0,S.T)(t=>{const o=this.mapZitadelProjectsToTeams({result:[t]});return o.length>0?o[0]:void 0}),(0,A.W)(t=>{console.error("Error getting team by ID:",t);const o=this.teamsCache.find(f=>f.id===e);return(0,s.of)(o)}))}create(e){const t=this.mapTeamToZitadelFormat(e);return this.zitadelApi.createProject(t).pipe((0,S.T)(o=>{const f={id:o.id||`team-${Date.now()}`,name:e.name,description:e.description,organizationId:e.organizationId,leadId:e.leadId,createdAt:new Date,updatedAt:new Date,isActive:!0};return this.teamsCache.push(f),this.teamsSubject.next(this.teamsCache),f}),(0,A.W)(o=>{throw console.error("Error creating team:",o),o}))}update(e,t){const o=this.mapTeamToZitadelFormat(t);return this.zitadelApi.updateProject(e,o).pipe((0,S.T)(f=>{const I=this.teamsCache.findIndex(y=>y.id===e);return-1!==I?(this.teamsCache[I]={...this.teamsCache[I],...t,updatedAt:new Date},this.teamsSubject.next(this.teamsCache),this.teamsCache[I]):null}),(0,A.W)(f=>{throw console.error("Error updating team:",f),f}))}delete(e){console.warn("Deleting projects (teams) in Zitadel should be done with caution"),console.warn("This operation only marks the team as inactive locally. Use Zitadel Console for actual deletion.");const t=this.teamsCache.findIndex(o=>o.id===e);return-1!==t?(this.teamsCache[t].isActive=!1,this.teamsCache[t].updatedAt=new Date,this.teamsSubject.next(this.teamsCache),(0,s.of)(!0)):(0,s.of)(!1)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(O))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),g=(()=>{class i{constructor(e){this.zitadelApi=e,this.usersCache=[],this.usersSubject=new s.BehaviorSubject([]),this.users$=this.usersSubject.asObservable(),this.loadUsers()}loadUsers(){this.zitadelApi.listUsers().pipe((0,S.T)(e=>this.mapZitadelUsersToUsers(e)),(0,A.W)(e=>(console.error("Error loading users from Zitadel:",e),(0,s.of)([])))).subscribe(e=>{this.usersCache=e,this.usersSubject.next(e)})}extractUserName(e){return e.userName?e.userName:`${e.human?.profile?.firstName||""} ${e.human?.profile?.lastName||""}`.trim()||(e.human?.profile?.displayName?e.human.profile.displayName:e.human?.email?.email?e.human.email.email.split("@")[0]:`User ${e.id}`)}mapZitadelUsersToUsers(e){return e&&e.result?e.result.map(t=>({id:t.id,name:this.extractUserName(t),email:t.human?.email?.email||t.preferredLoginName||"",organizationId:t.details?.resourceOwner||"default-org",teamId:"default-team",roleId:"default-role",isActive:"USER_STATE_ACTIVE"===t.state,createdAt:t.details?.creationDate?new Date(t.details.creationDate):new Date,updatedAt:t.details?.changeDate?new Date(t.details.changeDate):new Date,zitadelUserId:t.id})):[]}mapUserToZitadelFormat(e){return{userName:e.name,profile:{firstName:e.name?.split(" ")[0]||"",lastName:e.name?.split(" ").slice(1).join(" ")||"",displayName:e.name},email:{email:e.email,isEmailVerified:!1}}}getAll(){return this.zitadelApi.listUsers().pipe((0,S.T)(e=>this.mapZitadelUsersToUsers(e)),(0,A.W)(e=>(console.error("Error getting users:",e),(0,s.of)(this.usersCache))))}getByOrganization(e){return this.getAll().pipe((0,S.T)(t=>t.filter(o=>o.organizationId===e)))}getByTeam(e){return this.getAll().pipe((0,S.T)(t=>t.filter(o=>o.teamId===e)))}getById(e){return this.zitadelApi.getUserById(e).pipe((0,S.T)(t=>{const o=this.mapZitadelUsersToUsers({result:[t]});return o.length>0?o[0]:void 0}),(0,A.W)(t=>{console.error("Error getting user by ID:",t);const o=this.usersCache.find(f=>f.id===e);return(0,s.of)(o)}))}create(e){const t=this.mapUserToZitadelFormat(e);return this.zitadelApi.createUser(t).pipe((0,S.T)(o=>{const f={id:o.userId||`user-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date,zitadelUserId:o.userId};return this.usersCache.push(f),this.usersSubject.next(this.usersCache),f}),(0,A.W)(o=>{throw console.error("Error creating user:",o),o}))}update(e,t){const o=this.mapUserToZitadelFormat(t);return this.zitadelApi.updateUser(e,o).pipe((0,S.T)(f=>{const I=this.usersCache.findIndex(y=>y.id===e);return-1!==I?(this.usersCache[I]={...this.usersCache[I],...t,updatedAt:new Date},this.usersSubject.next(this.usersCache),this.usersCache[I]):null}),(0,A.W)(f=>{throw console.error("Error updating user:",f),f}))}delete(e){return this.zitadelApi.deactivateUser(e).pipe((0,S.T)(()=>{const t=this.usersCache.findIndex(o=>o.id===e);return-1!==t&&(this.usersCache[t].isActive=!1,this.usersCache[t].updatedAt=new Date,this.usersSubject.next(this.usersCache),!0)}),(0,A.W)(t=>(console.error("Error deleting user:",t),(0,s.of)(!1))))}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(O))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var T=r(5558);let C=(()=>{class i{constructor(e){this.zitadelApi=e,this.systemRoles=[{id:"role-1",name:"Super Admin",description:"Full system access",permissions:["*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-2",name:"Organization Admin",description:"Full access within organization",permissions:["org:*","team:*","user:*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-3",name:"Team Lead",description:"Manage team and team members",permissions:["team:read","team:update","user:read","user:update"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-4",name:"Member",description:"Basic member access",permissions:["user:read"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.rolesCache=[...this.systemRoles],this.rolesSubject=new s.BehaviorSubject(this.rolesCache),this.roles$=this.rolesSubject.asObservable(),this.loadCustomRoles()}loadCustomRoles(){this.zitadelApi.listProjects().pipe((0,T.n)(e=>e&&e.result&&0!==e.result.length?this.zitadelApi.listProjectRoles(e.result[0].id):(0,s.of)([])),(0,S.T)(e=>this.mapZitadelRolesToRoles(e)),(0,A.W)(e=>(console.error("Error loading custom roles from Zitadel:",e),(0,s.of)([])))).subscribe(e=>{this.rolesCache=[...this.systemRoles,...e],this.rolesSubject.next(this.rolesCache)})}mapZitadelRolesToRoles(e){return e&&e.result?e.result.map(t=>({id:t.key,name:t.displayName||t.key,description:t.displayName||"",permissions:[],isSystemRole:!1,createdAt:t.details?.creationDate?new Date(t.details.creationDate):new Date,updatedAt:t.details?.changeDate?new Date(t.details.changeDate):new Date})):[]}getAll(){return(0,s.of)(this.rolesCache)}getById(e){const t=this.rolesCache.find(o=>o.id===e);return(0,s.of)(t)}getSystemRoles(){const e=this.rolesCache.filter(t=>t.isSystemRole);return(0,s.of)(e)}getCustomRoles(){const e=this.rolesCache.filter(t=>!t.isSystemRole);return(0,s.of)(e)}create(e){console.warn("Creating roles in Zitadel requires specifying a project ID");const t={...e,id:`role-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(t),this.rolesSubject.next(this.rolesCache),(0,s.of)(t)}update(e,t){const o=this.rolesCache.findIndex(f=>f.id===e);return-1===o||this.rolesCache[o].isSystemRole?(0,s.of)(null):(this.rolesCache[o]={...this.rolesCache[o],...t,updatedAt:new Date},this.rolesSubject.next(this.rolesCache),(0,s.of)(this.rolesCache[o]))}delete(e){const t=this.rolesCache.findIndex(o=>o.id===e);return-1===t||this.rolesCache[t].isSystemRole?(0,s.of)(!1):(this.rolesCache.splice(t,1),this.rolesSubject.next(this.rolesCache),(0,s.of)(!0))}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(O))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},8399:(D,E,r)=>{r.d(E,{_:()=>h});var a=r(6129);class h{constructor(s,d=h.now){this.schedulerActionCtor=s,this.now=d}schedule(s,d=0,u){return new this.schedulerActionCtor(this,s).schedule(u,d)}}h.now=a.U.now},2688:(D,E,r)=>{r.d(E,{x:()=>s});var a=r(9131),h=r(9326),m=r(9724);function s(...d){return(0,a.K)()((0,m.H)(d,(0,h.lI)(d)))}},983:(D,E,r)=>{r.d(E,{I:()=>m,w:()=>h});var a=r(1985);const h=new a.c(d=>d.complete());function m(d){return d?function s(d){return new a.c(u=>d.schedule(()=>u.complete()))}(d):h}},9724:(D,E,r)=>{r.d(E,{H:()=>m});var a=r(5894),h=r(8750);function m(s,d){return d?(0,a.c)(s,d):(0,h.Tg)(s)}},1807:(D,E,r)=>{r.d(E,{O:()=>d});var a=r(1985),h=r(3236),m=r(9470),s=r(8211);function d(u=0,l,n=h.b){let c=-1;return null!=l&&((0,m.m)(l)?n=l:c=l),new a.c(p=>{let _=(0,s.v)(u)?+u-n.now():u;_<0&&(_=0);let v=0;return n.schedule(function(){p.closed||(p.next(v++),0<=c?this.schedule(void 0,c):p.complete())},_)})}},9437:(D,E,r)=>{r.d(E,{W:()=>s});var a=r(8750),h=r(4360),m=r(9974);function s(d){return(0,m.N)((u,l)=>{let p,n=null,c=!1;n=u.subscribe((0,h._)(l,void 0,void 0,_=>{p=(0,a.Tg)(d(_,s(d)(u))),n?(n.unsubscribe(),n=null,p.subscribe(l)):c=!0})),c&&(n.unsubscribe(),n=null,p.subscribe(l))})}},9131:(D,E,r)=>{r.d(E,{K:()=>h});var a=r(6365);function h(){return(0,a.U)(1)}},3103:(D,E,r)=>{r.d(E,{c:()=>s});var a=r(3236),h=r(3183),m=r(1807);function s(d,u=a.E){const l=(0,m.O)(d,u);return(0,h.o)(()=>l)}},3183:(D,E,r)=>{r.d(E,{o:()=>l});var a=r(2688),h=r(6697),m=r(3557),s=r(3703),d=r(3028),u=r(8750);function l(n,c){return c?p=>(0,a.x)(c.pipe((0,h.s)(1),(0,m.w)()),p.pipe(l(n))):(0,d.Z)((p,_)=>(0,u.Tg)(n(p,_)).pipe((0,h.s)(1),(0,s.u)(p)))}},3557:(D,E,r)=>{r.d(E,{w:()=>s});var a=r(9974),h=r(4360),m=r(5343);function s(){return(0,a.N)((d,u)=>{d.subscribe((0,h._)(u,m.l))})}},3703:(D,E,r)=>{r.d(E,{u:()=>h});var a=r(6354);function h(m){return(0,a.T)(()=>m)}},6365:(D,E,r)=>{r.d(E,{U:()=>m});var a=r(3028),h=r(3669);function m(s=1/0){return(0,a.Z)(h.D,s)}},5412:(D,E,r)=>{r.d(E,{h:()=>s});var a=r(8750),h=r(5225),m=r(4360);function s(d,u,l,n,c,p,_,v){const M=[];let P=0,S=0,A=!1;const O=()=>{A&&!M.length&&!P&&u.complete()},U=g=>P<n?R(g):M.push(g),R=g=>{p&&u.next(g),P++;let T=!1;(0,a.Tg)(l(g,S++)).subscribe((0,m._)(u,C=>{c?.(C),p?U(C):u.next(C)},()=>{T=!0},void 0,()=>{if(T)try{for(P--;M.length&&P<n;){const C=M.shift();_?(0,h.N)(u,_,()=>R(C)):R(C)}O()}catch(C){u.error(C)}}))};return d.subscribe((0,m._)(u,U,()=>{A=!0,O()})),()=>{v?.()}}},3028:(D,E,r)=>{r.d(E,{Z:()=>u});var a=r(6354),h=r(8750),m=r(9974),s=r(5412),d=r(8071);function u(l,n,c=1/0){return(0,d.T)(n)?u((p,_)=>(0,a.T)((v,M)=>n(p,v,_,M))((0,h.Tg)(l(p,_))),c):("number"==typeof n&&(c=n),(0,m.N)((p,_)=>(0,s.h)(p,_,l,c)))}},941:(D,E,r)=>{r.d(E,{Q:()=>s});var a=r(5225),h=r(9974),m=r(4360);function s(d,u=0){return(0,h.N)((l,n)=>{l.subscribe((0,m._)(n,c=>(0,a.N)(n,d,()=>n.next(c),u),()=>(0,a.N)(n,d,()=>n.complete(),u),c=>(0,a.N)(n,d,()=>n.error(c),u)))})}},6745:(D,E,r)=>{r.d(E,{_:()=>h});var a=r(9974);function h(m,s=0){return(0,a.N)((d,u)=>{u.add(m.schedule(()=>d.subscribe(u),s))})}},5558:(D,E,r)=>{r.d(E,{n:()=>s});var a=r(8750),h=r(9974),m=r(4360);function s(d,u){return(0,h.N)((l,n)=>{let c=null,p=0,_=!1;const v=()=>_&&!c&&n.complete();l.subscribe((0,m._)(n,M=>{c?.unsubscribe();let P=0;const S=p++;(0,a.Tg)(d(M,S)).subscribe(c=(0,m._)(n,A=>n.next(u?u(M,A,S,P++):A),()=>{c=null,v()}))},()=>{_=!0,v()}))})}},6697:(D,E,r)=>{r.d(E,{s:()=>s});var a=r(983),h=r(9974),m=r(4360);function s(d){return d<=0?()=>a.w:(0,h.N)((u,l)=>{let n=0;u.subscribe((0,m._)(l,c=>{++n<=d&&(l.next(c),d<=n&&l.complete())}))})}},7119:(D,E,r)=>{r.d(E,{S:()=>d});var a=r(1985),h=r(4761),m=r(8071),s=r(5225);function d(u,l){return new a.c(n=>{let c;return(0,s.N)(n,l,()=>{c=u[h.l](),(0,s.N)(n,l,()=>{let p,_;try{({value:p,done:_}=c.next())}catch(v){return void n.error(v)}_?n.complete():n.next(p)},0,!0)}),()=>(0,m.T)(c?.return)&&c.return()})}},5894:(D,E,r)=>{r.d(E,{c:()=>R});var a=r(8750),h=r(941),m=r(6745),u=r(1985),n=r(7119),c=r(5225);function p(g,T){if(!g)throw new Error("Iterable cannot be null");return new u.c(C=>{(0,c.N)(C,T,()=>{const i=g[Symbol.asyncIterator]();(0,c.N)(C,T,()=>{i.next().then(w=>{w.done?C.complete():C.next(w.value)})},0,!0)})})}var _=r(5055),v=r(9858),M=r(7441),P=r(5397),S=r(7953),A=r(591),O=r(5196);function R(g,T){if(null!=g){if((0,_.l)(g))return function s(g,T){return(0,a.Tg)(g).pipe((0,m._)(T),(0,h.Q)(T))}(g,T);if((0,M.X)(g))return function l(g,T){return new u.c(C=>{let i=0;return T.schedule(function(){i===g.length?C.complete():(C.next(g[i++]),C.closed||this.schedule())})})}(g,T);if((0,v.y)(g))return function d(g,T){return(0,a.Tg)(g).pipe((0,m._)(T),(0,h.Q)(T))}(g,T);if((0,S.T)(g))return p(g,T);if((0,P.x)(g))return(0,n.S)(g,T);if((0,O.U)(g))return function U(g,T){return p((0,O.C)(g),T)}(g,T)}throw(0,A.L)(g)}},6780:(D,E,r)=>{r.d(E,{R:()=>d});var a=r(3961);class h extends a.yU{constructor(l,n){super()}schedule(l,n=0){return this}}const m={setInterval(u,l,...n){const{delegate:c}=m;return c?.setInterval?c.setInterval(u,l,...n):setInterval(u,l,...n)},clearInterval(u){const{delegate:l}=m;return(l?.clearInterval||clearInterval)(u)},delegate:void 0};var s=r(7908);class d extends h{constructor(l,n){super(l,n),this.scheduler=l,this.work=n,this.pending=!1}schedule(l,n=0){var c;if(this.closed)return this;this.state=l;const p=this.id,_=this.scheduler;return null!=p&&(this.id=this.recycleAsyncId(_,p,n)),this.pending=!0,this.delay=n,this.id=null!==(c=this.id)&&void 0!==c?c:this.requestAsyncId(_,this.id,n),this}requestAsyncId(l,n,c=0){return m.setInterval(l.flush.bind(l,this),c)}recycleAsyncId(l,n,c=0){if(null!=c&&this.delay===c&&!1===this.pending)return n;null!=n&&m.clearInterval(n)}execute(l,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const c=this._execute(l,n);if(c)return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(l,n){let p,c=!1;try{this.work(l)}catch(_){c=!0,p=_||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),p}unsubscribe(){if(!this.closed){const{id:l,scheduler:n}=this,{actions:c}=n;this.work=this.state=this.scheduler=null,this.pending=!1,(0,s.o)(c,this),null!=l&&(this.id=this.recycleAsyncId(n,l,null)),this.delay=null,super.unsubscribe()}}}},707:(D,E,r)=>{r.d(E,{q:()=>h});var a=r(8399);class h extends a._{constructor(s,d=a._.now){super(s,d),this.actions=[],this._active=!1}flush(s){const{actions:d}=this;if(this._active)return void d.push(s);let u;this._active=!0;do{if(u=s.execute(s.state,s.delay))break}while(s=d.shift());if(this._active=!1,u){for(;s=d.shift();)s.unsubscribe();throw u}}}},3236:(D,E,r)=>{r.d(E,{E:()=>m,b:()=>s});var a=r(6780);const m=new(r(707).q)(a.R),s=m},6129:(D,E,r)=>{r.d(E,{U:()=>a});const a={now:()=>(a.delegate||Date).now(),delegate:void 0}},9326:(D,E,r)=>{r.d(E,{R0:()=>u,lI:()=>d,ms:()=>s});var a=r(8071),h=r(9470);function m(l){return l[l.length-1]}function s(l){return(0,a.T)(m(l))?l.pop():void 0}function d(l){return(0,h.m)(m(l))?l.pop():void 0}function u(l,n){return"number"==typeof m(l)?l.pop():n}},5225:(D,E,r)=>{function a(h,m,s,d=0,u=!1){const l=m.schedule(function(){s(),u?h.add(this.schedule(null,d)):this.unsubscribe()},d);if(h.add(l),!u)return l}r.d(E,{N:()=>a})},8211:(D,E,r)=>{function a(h){return h instanceof Date&&!isNaN(h)}r.d(E,{v:()=>a})},9470:(D,E,r)=>{r.d(E,{m:()=>h});var a=r(8071);function h(m){return m&&(0,a.T)(m.schedule)}},467:(D,E,r)=>{function a(m,s,d,u,l,n,c){try{var p=m[n](c),_=p.value}catch(v){return void d(v)}p.done?s(_):Promise.resolve(_).then(u,l)}function h(m){return function(){var s=this,d=arguments;return new Promise(function(u,l){var n=m.apply(s,d);function c(_){a(n,u,l,c,p,"next",_)}function p(_){a(n,u,l,c,p,"throw",_)}c(void 0)})}}r.d(E,{A:()=>h})}}]);