(self.webpackChunkmfe_USERS_CRUD=self.webpackChunkmfe_USERS_CRUD||[]).push([[267,648],{6648:(S,m,t)=>{t.r(m),t.d(m,{AUTH0_CONFIG:()=>u,Auth0ApiService:()=>j,AuthService:()=>p,CoreServicesComponent:()=>E,CoreServicesService:()=>a,OrganizationService:()=>N,ProductCategory:()=>L,RoleManagementService:()=>y,RoleService:()=>I,SalesDataService:()=>M,SalesStatus:()=>O,SystemRole:()=>x,TeamService:()=>w,UserRole:()=>c,UserService:()=>D});var s=t(4332);let a=(()=>{class d{constructor(){}static{this.\u0275fac=function(r){return new(r||d)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();var f=t(467),n=t(3425);const u={useRealAuth0:!0,domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"lT0H33rFRamTUtbbXwPwO7M0SdT8Qq26",redirectUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",scope:"openid profile email read:users create:users update:users delete:users",audience:void 0,managementApiAudience:"https://dev-26sow24tone5na8a.us.auth0.com/api/v2/"};var g=t(4230);let p=(()=>{class d{get domain(){return u.domain}get clientId(){return u.clientId}get redirectUri(){return u.redirectUri}get scope(){return u.scope}get audience(){return u.managementApiAudience}constructor(e){this.http=e,this.id="auth of pokemon",this.TOKEN_KEY="auth0_token",this.USER_INFO_KEY="auth0_user_info",this.userSubject=new n.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("In constructor of auth service in pokemon")}login(e){e&&console.log(`[AuthService] Logged in: ${e}`),this.redirectToAuth0Login()}redirectToAuth0Login(){const e=new URL(`https://${this.domain}/authorize`),r=this.generateRandomState(),_=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",r),sessionStorage.setItem("code_verifier",_),e.searchParams.append("client_id",this.clientId),e.searchParams.append("redirect_uri",this.redirectUri),e.searchParams.append("response_type","code"),e.searchParams.append("scope",this.scope),e.searchParams.append("state",r),this.audience&&e.searchParams.append("audience",this.audience),window.location.href=e.toString()}handleCallback(e,r){var _=this;return(0,f.A)(function*(){const b=sessionStorage.getItem("oauth_state");if(r!==b)return console.error("State mismatch - possible CSRF attack"),!1;try{const U=yield _.exchangeCodeForToken(e);_.setToken(U.access_token);const G=_.decodeIdToken(U.id_token);return _.setUserInfo(G),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(U){return console.error("Error exchanging code for token:",U),!1}})()}exchangeCodeForToken(e){var r=this;return(0,f.A)(function*(){const _=`https://${r.domain}/oauth/token`,b=new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:r.redirectUri,client_id:r.clientId}),U=yield fetch(_,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b.toString()});if(!U.ok)throw new Error(`Token exchange failed: ${U.statusText}`);return U.json()})()}decodeIdToken(e){try{const r=e.split(".")[1],_=JSON.parse(atob(r));return{sub:_.sub,name:_.name,email:_.email}}catch(r){return console.error("Error decoding ID token:",r),{sub:""}}}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),this.userSubject.next(null);const e=`https://${this.domain}/v2/logout?client_id=${this.clientId}&returnTo=${encodeURIComponent(this.redirectUri)}`;window.location.href=e}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}getUserInfoFromStorage(){const e=localStorage.getItem(this.USER_INFO_KEY);return e?JSON.parse(e):null}setUserInfo(e){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(e)),this.userSubject.next(e)}generateRandomState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(r){return new(r||d)(s.\u0275\u0275inject(g.HttpClient))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),E=(()=>{class d{static{this.\u0275fac=function(r){return new(r||d)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:d,selectors:[["org-core-services"]],standalone:!0,features:[s.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(r,_){1&r&&(s.\u0275\u0275elementStart(0,"p"),s.\u0275\u0275text(1," core-services works! "),s.\u0275\u0275elementEnd())}})}}return d})();var c=function(d){return d.SUPER_ADMIN="super-admin",d.ORG_ADMIN="org-admin",d.TEAM_LEAD="team-lead",d.SALES_EXECUTIVE="sales-executive",d}(c||{});let I=(()=>{class d{constructor(e){this.currentUserSubject=new n.BehaviorSubject(this.getDummyUser()),this.currentUser$=this.currentUserSubject.asObservable(),this.dataService=e}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(e){this.currentUserSubject.next(e)}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){const r=this.getCurrentUser();return!!r&&e.includes(r.role)}isAdmin(){return this.hasAnyRole([c.SUPER_ADMIN,c.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([c.SUPER_ADMIN,c.ORG_ADMIN,c.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:c.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:c.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:c.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const r=this.getAllUsers();return this.isTeamLeadOrHigher()?r.filter(_=>_.role===c.SALES_EXECUTIVE||_.id===e.id):r.filter(_=>_.id===e.id)}getDummyUser(){return{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}}static{this.\u0275fac=function(r){return new(r||d)(s.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();var C=t(3103),O=function(d){return d.COMPLETED="completed",d.PENDING="pending",d.CANCELLED="cancelled",d}(O||{}),L=function(d){return d.ELECTRONICS="Electronics",d.SOFTWARE="Software",d.SERVICES="Services",d.HARDWARE="Hardware",d}(L||{});let M=(()=>{class d{constructor(e){this.dummySalesData=this.generateDummyData(),this.dataService=e}getSalesHistory(e,r,_){if(this.dataService)return this.dataService.getSalesHistory(e,r,_);let b=this.dummySalesData.filter(U=>U.salesExecutiveId===e);return r&&(b=b.filter(U=>U.date>=r)),_&&(b=b.filter(U=>U.date<=_)),(0,n.of)(b).pipe((0,C.c)(300))}getSalesSummary(e){if(this.dataService)return this.dataService.getSalesSummary(e);const r=this.dummySalesData.filter(b=>b.salesExecutiveId===e),_={totalSales:r.filter(b=>b.status===O.COMPLETED).reduce((b,U)=>b+U.amount,0),totalCommission:r.filter(b=>b.status===O.COMPLETED).reduce((b,U)=>b+U.commission,0),completedCount:r.filter(b=>b.status===O.COMPLETED).length,pendingCount:r.filter(b=>b.status===O.PENDING).length,cancelledCount:r.filter(b=>b.status===O.CANCELLED).length};return(0,n.of)(_).pipe((0,C.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,n.of)(this.dummySalesData).pipe((0,C.c)(300))}generateDummyData(){const e=[{name:"Enterprise Software License",category:L.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:L.SERVICES,basePrice:25e3},{name:"Server Hardware",category:L.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:L.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:L.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:L.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:L.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:L.HARDWARE,basePrice:6e4}],r=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],_=["North","South","East","West","Central"],b=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],U=[O.COMPLETED,O.COMPLETED,O.COMPLETED,O.PENDING,O.CANCELLED],G=[];let ee=1;for(let J=0;J<50;J++){const Q=b[J%b.length],k=e[Math.floor(Math.random()*e.length)],te=r[Math.floor(Math.random()*r.length)],re=_[Math.floor(Math.random()*_.length)],ne=U[Math.floor(Math.random()*U.length)],i=k.basePrice+(1e4*Math.random()-5e3),o=.05*i,l=new Date;l.setDate(l.getDate()-Math.floor(180*Math.random())),G.push({id:"sale-"+ee++,salesExecutiveId:Q.id,salesExecutiveName:Q.name,productName:k.name,productCategory:k.category,amount:Math.round(i),commission:Math.round(o),status:ne,date:l,clientName:te,region:re})}return G.sort((J,Q)=>Q.date.getTime()-J.date.getTime())}static{this.\u0275fac=function(r){return new(r||d)(s.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();var x=function(d){return d.SUPER_ADMIN="super-admin",d.ORG_ADMIN="org-admin",d.TEAM_LEAD="team-lead",d.MEMBER="member",d}(x||{}),W=t(6354),P=t(9437);let j=(()=>{class d{get domain(){return u.domain}get managementApiUrl(){return`https://${this.domain}/api/v2`}constructor(e,r){this.http=e,this.authService=r}getHeaders(){const e=this.authService.getToken();return new g.HttpHeaders({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}getCurrentUser(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}getUserInfo(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}listUsers(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/users?${r}`:`${this.managementApiUrl}/users`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}getUserById(e){return this.http.get(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}createUser(e){return this.http.post(`${this.managementApiUrl}/users`,e,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}updateUser(e,r){return this.http.patch(`${this.managementApiUrl}/users/${e}`,r,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}deleteUser(e){return this.http.delete(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}blockUser(e,r=!0){return this.http.patch(`${this.managementApiUrl}/users/${e}`,{blocked:r},{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}listOrganizations(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/organizations?${r}`:`${this.managementApiUrl}/organizations`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}getOrganizationById(e){return this.http.get(`${this.managementApiUrl}/organizations/${e}`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}createOrganization(e){return this.http.post(`${this.managementApiUrl}/organizations`,e,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}updateOrganization(e,r){return this.http.patch(`${this.managementApiUrl}/organizations/${e}`,r,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}listRoles(e){const r=new URLSearchParams(e||{}).toString();return this.http.get(r?`${this.managementApiUrl}/roles?${r}`:`${this.managementApiUrl}/roles`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}getRoleById(e){return this.http.get(`${this.managementApiUrl}/roles/${e}`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}createRole(e){return this.http.post(`${this.managementApiUrl}/roles`,e,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}updateRole(e,r){return this.http.patch(`${this.managementApiUrl}/roles/${e}`,r,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}listUserRoles(e){return this.http.get(`${this.managementApiUrl}/users/${e}/roles`,{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}assignRolesToUser(e,r){return this.http.post(`${this.managementApiUrl}/users/${e}/roles`,{roles:r},{headers:this.getHeaders()}).pipe((0,P.W)(this.handleError))}handleError(e){return console.error("Auth0 API Error:",e),(0,n.throwError)(()=>e)}static{this.\u0275fac=function(r){return new(r||d)(s.\u0275\u0275inject(g.HttpClient),s.\u0275\u0275inject(p))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),N=(()=>{class d{constructor(e){this.auth0Api=e,this.organizationsCache=[],this.organizationsSubject=new n.BehaviorSubject([]),this.organizations$=this.organizationsSubject.asObservable(),this.loadOrganizations()}loadOrganizations(){if(!u.useRealAuth0)return this.organizationsCache=this.getDummyOrganizations(),void this.organizationsSubject.next(this.organizationsCache);this.auth0Api.listOrganizations().pipe((0,W.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,P.W)(e=>(console.error("Error loading organizations from Auth0:",e),(0,n.of)([])))).subscribe(e=>{this.organizationsCache=e,this.organizationsSubject.next(this.organizationsCache)})}getDummyOrganizations(){return[{id:"org1",name:"Acme Corporation",description:"Leading technology company",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}},{id:"org2",name:"Global Tech Inc",description:"Innovation in software development",createdAt:new Date("2024-02-01"),updatedAt:new Date("2024-02-01"),isActive:!0,settings:{timezone:"UTC",currency:"EUR",locale:"en-GB"}}]}mapAuth0OrgsToOrganizations(e){return e&&Array.isArray(e)?e.map(r=>({id:r.id,name:r.name,description:r.display_name||r.name,createdAt:r.created_at?new Date(r.created_at):new Date,updatedAt:r.updated_at?new Date(r.updated_at):new Date,isActive:!0,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}})):[]}getAll(){return u.useRealAuth0?this.auth0Api.listOrganizations().pipe((0,W.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,P.W)(e=>(console.error("Error getting organizations:",e),(0,n.of)(this.organizationsCache)))):(0,n.of)(this.organizationsCache)}getById(e){return this.getAll().pipe((0,W.T)(r=>r.find(_=>_.id===e)))}create(e){return this.auth0Api.createOrganization({name:e.name,display_name:e.description}).pipe((0,W.T)(_=>{const b={id:_.id,name:_.name,description:_.display_name||_.name,createdAt:new Date(_.created_at),updatedAt:new Date(_.updated_at||_.created_at),isActive:!0,settings:e.settings||{timezone:"UTC",currency:"USD",locale:"en-US"}};return this.organizationsCache.push(b),this.organizationsSubject.next(this.organizationsCache),b}),(0,P.W)(_=>{console.error("Creating organizations in Auth0 requires admin privileges:",_);const b={...e,id:`org-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return(0,n.of)(b)}))}update(e,r){const _={};return r.name&&(_.name=r.name),r.description&&(_.display_name=r.description),this.auth0Api.updateOrganization(e,_).pipe((0,W.T)(b=>{const U=this.organizationsCache.findIndex(G=>G.id===e);return-1!==U?(this.organizationsCache[U]={...this.organizationsCache[U],...r,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),this.organizationsCache[U]):null}),(0,P.W)(b=>{console.warn("Updating organizations in Auth0 requires specific permissions:",b);const U=this.organizationsCache.findIndex(G=>G.id===e);return-1!==U?(this.organizationsCache[U]={...this.organizationsCache[U],...r,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),(0,n.of)(this.organizationsCache[U])):(0,n.of)(null)}))}delete(e){return console.warn("Deleting organizations should be done with caution and may not be supported via Auth0 API"),(0,n.of)(!1)}static{this.\u0275fac=function(r){return new(r||d)(s.\u0275\u0275inject(j))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),w=(()=>{class d{constructor(e){this.auth0Api=e,this.teamsCache=[],this.teamsSubject=new n.BehaviorSubject([]),this.teams$=this.teamsSubject.asObservable(),this.loadTeams()}loadTeams(){if(!u.useRealAuth0)return this.teamsCache=this.getDummyTeams(),void this.teamsSubject.next(this.teamsCache);this.teamsCache=[],this.teamsSubject.next(this.teamsCache)}getDummyTeams(){return[{id:"team1",name:"Engineering",description:"Engineering team",organizationId:"org1",leadId:"1",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team2",name:"Product",description:"Product team",organizationId:"org1",leadId:"2",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team3",name:"Design",description:"Design team",organizationId:"org2",leadId:"3",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0}]}getAll(){return(0,n.of)(this.teamsCache)}getByOrganization(e){return this.getAll().pipe((0,W.T)(r=>r.filter(_=>_.organizationId===e)))}getById(e){const r=this.teamsCache.find(_=>_.id===e);return(0,n.of)(r)}create(e){const r={id:`team-${Date.now()}`,name:e.name,description:e.description,organizationId:e.organizationId,leadId:e.leadId,createdAt:new Date,updatedAt:new Date,isActive:!0};return this.teamsCache.push(r),this.teamsSubject.next(this.teamsCache),(0,n.of)(r)}update(e,r){const _=this.teamsCache.findIndex(b=>b.id===e);return-1!==_?(this.teamsCache[_]={...this.teamsCache[_],...r,updatedAt:new Date},this.teamsSubject.next(this.teamsCache),(0,n.of)(this.teamsCache[_])):(0,n.of)(null)}delete(e){const r=this.teamsCache.findIndex(_=>_.id===e);return-1!==r?(this.teamsCache[r].isActive=!1,this.teamsCache[r].updatedAt=new Date,this.teamsSubject.next(this.teamsCache),(0,n.of)(!0)):(0,n.of)(!1)}static{this.\u0275fac=function(r){return new(r||d)(s.\u0275\u0275inject(j))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),D=(()=>{class d{constructor(e){this.auth0Api=e,this.usersCache=[],this.usersSubject=new n.BehaviorSubject([]),this.users$=this.usersSubject.asObservable(),this.currentAuth0User=null,this.loadUsers()}loadUsers(){if(!u.useRealAuth0)return this.usersCache=this.getDummyUsers(),void this.usersSubject.next(this.usersCache);this.auth0Api.listUsers().pipe((0,P.W)(e=>(console.error("Error loading users from Auth0 Management API:",e),(0,n.forkJoin)({authUser:this.auth0Api.getCurrentUser().pipe((0,P.W)(()=>(0,n.of)(null))),userInfo:this.auth0Api.getUserInfo().pipe((0,P.W)(()=>(0,n.of)(null)))}).pipe((0,W.T)(({authUser:r,userInfo:_})=>{const b=r||_;return b?[b]:[]}))))).subscribe(e=>{e&&e.length>0?(this.usersCache=this.mapAuth0UsersToUsers(e),this.usersCache.length>0&&(this.currentAuth0User=this.usersCache[0]),this.usersSubject.next(this.usersCache)):(console.warn("No users returned from Auth0 API"),this.usersCache=[],this.usersSubject.next(this.usersCache))})}getDummyUsers(){return[{id:"1",name:"John Doe",email:"john.doe@example.com",organizationId:"org1",teamId:"team1",roleId:"super-admin",isActive:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"2",name:"Jane Smith",email:"jane.smith@example.com",organizationId:"org1",teamId:"team2",roleId:"org-admin",isActive:!0,createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-02-10")},{id:"3",name:"Bob Johnson",email:"bob.johnson@example.com",organizationId:"org2",teamId:"team3",roleId:"team-lead",isActive:!0,createdAt:new Date("2024-03-05"),updatedAt:new Date("2024-03-05")},{id:"4",name:"Alice Brown",email:"alice.brown@example.com",organizationId:"org1",teamId:"team1",roleId:"member",isActive:!1,createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-05-10")}]}mapAuth0UserToUser(e){return e?{id:e.user_id||e.sub||"1",name:this.extractUserName(e),email:e.email||"user@example.com",organizationId:e.org_id||"default-org",teamId:"default-team",roleId:"member",isActive:!e.blocked,createdAt:e.created_at?new Date(e.created_at):new Date,updatedAt:e.updated_at?new Date(e.updated_at):new Date,auth0UserId:e.user_id||e.sub}:this.getDummyUsers()[0]}extractUserName(e){return e.name?e.name:e.nickname?e.nickname:`${e.given_name||""} ${e.family_name||""}`.trim()||(e.email?e.email.split("@")[0]:`User ${e.user_id||e.sub}`)}mapAuth0UsersToUsers(e){return e&&Array.isArray(e)?e.map(r=>({id:r.user_id,name:this.extractUserName(r),email:r.email||"",organizationId:r.org_id||"default-org",teamId:"default-team",roleId:"default-role",isActive:!r.blocked,createdAt:r.created_at?new Date(r.created_at):new Date,updatedAt:r.updated_at?new Date(r.updated_at):new Date,auth0UserId:r.user_id})):[]}mapUserToAuth0Format(e){return{email:e.email,name:e.name,nickname:e.name,blocked:!e.isActive,connection:"Username-Password-Authentication",email_verified:!1,user_metadata:{organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId}}}getAll(){return(0,n.of)(this.usersCache)}getCurrentAuth0User(){return this.currentAuth0User}getByOrganization(e){return this.getAll().pipe((0,W.T)(r=>r.filter(_=>_.organizationId===e)))}getByTeam(e){return this.getAll().pipe((0,W.T)(r=>r.filter(_=>_.teamId===e)))}getById(e){const r=this.usersCache.find(_=>_.id===e);return r?(0,n.of)(r):this.auth0Api.getUserById(e).pipe((0,W.T)(_=>{const b=this.mapAuth0UsersToUsers([_]);return b.length>0?b[0]:void 0}),(0,P.W)(_=>(console.error("Error getting user by ID (Management API not available):",_),(0,n.of)(void 0))))}create(e){const r=this.mapUserToAuth0Format(e);return this.auth0Api.createUser(r).pipe((0,W.T)(_=>{const b={id:_.user_id||`user-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date,auth0UserId:_.user_id};return this.usersCache.push(b),this.usersSubject.next(this.usersCache),b}),(0,P.W)(_=>{console.error("Error creating user (Management API not available):",_);const b={id:`local-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date};return this.usersCache.push(b),this.usersSubject.next(this.usersCache),(0,n.of)(b)}))}update(e,r){const _=this.mapUserToAuth0Format(r);return this.auth0Api.updateUser(e,_).pipe((0,W.T)(b=>{const U=this.usersCache.findIndex(G=>G.id===e);return-1!==U?(this.usersCache[U]={...this.usersCache[U],...r,updatedAt:new Date},this.usersSubject.next(this.usersCache),this.usersCache[U]):null}),(0,P.W)(b=>{console.error("Error updating user (Management API not available):",b);const U=this.usersCache.findIndex(G=>G.id===e);return-1!==U?(this.usersCache[U]={...this.usersCache[U],...r,updatedAt:new Date},this.usersSubject.next(this.usersCache),(0,n.of)(this.usersCache[U])):(0,n.of)(null)}))}delete(e){return this.auth0Api.blockUser(e,!0).pipe((0,W.T)(()=>{const r=this.usersCache.findIndex(_=>_.id===e);return-1!==r&&(this.usersCache[r].isActive=!1,this.usersCache[r].updatedAt=new Date,this.usersSubject.next(this.usersCache),!0)}),(0,P.W)(r=>{console.error("Error deleting user (Management API not available):",r);const _=this.usersCache.findIndex(b=>b.id===e);return-1!==_&&(this.usersCache[_].isActive=!1,this.usersCache[_].updatedAt=new Date,this.usersSubject.next(this.usersCache)),(0,n.of)(!0)}))}static{this.\u0275fac=function(r){return new(r||d)(s.\u0275\u0275inject(j))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})(),y=(()=>{class d{constructor(e){this.auth0Api=e,this.systemRoles=[{id:"role-1",name:"Super Admin",description:"Full system access",permissions:["*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-2",name:"Organization Admin",description:"Full access within organization",permissions:["org:*","team:*","user:*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-3",name:"Team Lead",description:"Manage team and team members",permissions:["team:read","team:update","user:read","user:update"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-4",name:"Member",description:"Basic member access",permissions:["user:read"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.rolesCache=[...this.systemRoles],this.rolesSubject=new n.BehaviorSubject(this.rolesCache),this.roles$=this.rolesSubject.asObservable(),this.loadCustomRoles()}loadCustomRoles(){if(!u.useRealAuth0)return this.rolesCache=[...this.systemRoles],void this.rolesSubject.next(this.rolesCache);this.auth0Api.listRoles().pipe((0,W.T)(e=>this.mapAuth0RolesToRoles(e)),(0,P.W)(e=>(console.error("Error loading custom roles from Auth0:",e),(0,n.of)([])))).subscribe(e=>{this.rolesCache=[...this.systemRoles,...e],this.rolesSubject.next(this.rolesCache)})}mapAuth0RolesToRoles(e){return e&&Array.isArray(e)?e.map(r=>({id:r.id,name:r.name,description:r.description||"",permissions:[],isSystemRole:!1,createdAt:new Date,updatedAt:new Date})):[]}getAll(){return(0,n.of)(this.rolesCache)}getById(e){const r=this.rolesCache.find(_=>_.id===e);return(0,n.of)(r)}getSystemRoles(){const e=this.rolesCache.filter(r=>r.isSystemRole);return(0,n.of)(e)}getCustomRoles(){const e=this.rolesCache.filter(r=>!r.isSystemRole);return(0,n.of)(e)}create(e){return this.auth0Api.createRole({name:e.name,description:e.description}).pipe((0,W.T)(_=>{const b={id:_.id,name:_.name,description:_.description||"",permissions:e.permissions,isSystemRole:!1,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(b),this.rolesSubject.next(this.rolesCache),b}),(0,P.W)(_=>{console.error("Error creating role in Auth0:",_);const b={...e,id:`role-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(b),this.rolesSubject.next(this.rolesCache),(0,n.of)(b)}))}update(e,r){const _=this.rolesCache.findIndex(b=>b.id===e);return-1===_||this.rolesCache[_].isSystemRole?(0,n.of)(null):(this.rolesCache[_]={...this.rolesCache[_],...r,updatedAt:new Date},this.rolesSubject.next(this.rolesCache),(0,n.of)(this.rolesCache[_]))}delete(e){const r=this.rolesCache.findIndex(_=>_.id===e);return-1===r||this.rolesCache[r].isSystemRole?(0,n.of)(!1):(this.rolesCache.splice(r,1),this.rolesSubject.next(this.rolesCache),(0,n.of)(!0))}static{this.\u0275fac=function(r){return new(r||d)(s.\u0275\u0275inject(j))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},1985:(S,m,t)=>{t.d(m,{c:()=>E});var s=t(7707),a=t(3961),f=t(3494),n=t(1203),u=t(1026),g=t(8071),p=t(9786);let E=(()=>{class O{constructor(M){M&&(this._subscribe=M)}lift(M){const x=new O;return x.source=this,x.operator=M,x}subscribe(M,x,W){const P=function C(O){return O&&O instanceof s.vU||function I(O){return O&&(0,g.T)(O.next)&&(0,g.T)(O.error)&&(0,g.T)(O.complete)}(O)&&(0,a.Uv)(O)}(M)?M:new s.Ms(M,x,W);return(0,p.Y)(()=>{const{operator:j,source:N}=this;P.add(j?j.call(P,N):N?this._subscribe(P):this._trySubscribe(P))}),P}_trySubscribe(M){try{return this._subscribe(M)}catch(x){M.error(x)}}forEach(M,x){return new(x=c(x))((W,P)=>{const j=new s.Ms({next:N=>{try{M(N)}catch(w){P(w),j.unsubscribe()}},error:P,complete:W});this.subscribe(j)})}_subscribe(M){var x;return null===(x=this.source)||void 0===x?void 0:x.subscribe(M)}[f.s](){return this}pipe(...M){return(0,n.m)(M)(this)}toPromise(M){return new(M=c(M))((x,W)=>{let P;this.subscribe(j=>P=j,j=>W(j),()=>x(P))})}}return O.create=L=>new O(L),O})();function c(O){var L;return null!==(L=O??u.$.Promise)&&void 0!==L?L:Promise}},8399:(S,m,t)=>{t.d(m,{_:()=>a});var s=t(6129);class a{constructor(n,u=a.now){this.schedulerActionCtor=n,this.now=u}schedule(n,u=0,g){return new this.schedulerActionCtor(this,n).schedule(g,u)}}a.now=s.U.now},7707:(S,m,t)=>{t.d(m,{Ms:()=>W,vU:()=>O});var s=t(8071),a=t(3961),f=t(1026),n=t(5334),u=t(5343);const g=c("C",void 0,void 0);function c(D,y,d){return{kind:D,value:y,error:d}}var I=t(9270),C=t(9786);class O extends a.yU{constructor(y){super(),this.isStopped=!1,y?(this.destination=y,(0,a.Uv)(y)&&y.add(this)):this.destination=w}static create(y,d,z){return new W(y,d,z)}next(y){this.isStopped?N(function E(D){return c("N",D,void 0)}(y),this):this._next(y)}error(y){this.isStopped?N(function p(D){return c("E",void 0,D)}(y),this):(this.isStopped=!0,this._error(y))}complete(){this.isStopped?N(g,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(y){this.destination.next(y)}_error(y){try{this.destination.error(y)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const L=Function.prototype.bind;function M(D,y){return L.call(D,y)}class x{constructor(y){this.partialObserver=y}next(y){const{partialObserver:d}=this;if(d.next)try{d.next(y)}catch(z){P(z)}}error(y){const{partialObserver:d}=this;if(d.error)try{d.error(y)}catch(z){P(z)}else P(y)}complete(){const{partialObserver:y}=this;if(y.complete)try{y.complete()}catch(d){P(d)}}}class W extends O{constructor(y,d,z){let e;if(super(),(0,s.T)(y)||!y)e={next:y??void 0,error:d??void 0,complete:z??void 0};else{let r;this&&f.$.useDeprecatedNextContext?(r=Object.create(y),r.unsubscribe=()=>this.unsubscribe(),e={next:y.next&&M(y.next,r),error:y.error&&M(y.error,r),complete:y.complete&&M(y.complete,r)}):e=y}this.destination=new x(e)}}function P(D){f.$.useDeprecatedSynchronousErrorHandling?(0,C.l)(D):(0,n.m)(D)}function N(D,y){const{onStoppedNotification:d}=f.$;d&&I.f.setTimeout(()=>d(D,y))}const w={closed:!0,next:u.l,error:function j(D){throw D},complete:u.l}},3961:(S,m,t)=>{t.d(m,{Kn:()=>u,Uv:()=>g,yU:()=>n});var s=t(8071),a=t(4079),f=t(7908);class n{constructor(c){this.initialTeardown=c,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let c;if(!this.closed){this.closed=!0;const{_parentage:I}=this;if(I)if(this._parentage=null,Array.isArray(I))for(const L of I)L.remove(this);else I.remove(this);const{initialTeardown:C}=this;if((0,s.T)(C))try{C()}catch(L){c=L instanceof a.Z?L.errors:[L]}const{_finalizers:O}=this;if(O){this._finalizers=null;for(const L of O)try{p(L)}catch(M){c=c??[],M instanceof a.Z?c=[...c,...M.errors]:c.push(M)}}if(c)throw new a.Z(c)}}add(c){var I;if(c&&c!==this)if(this.closed)p(c);else{if(c instanceof n){if(c.closed||c._hasParent(this))return;c._addParent(this)}(this._finalizers=null!==(I=this._finalizers)&&void 0!==I?I:[]).push(c)}}_hasParent(c){const{_parentage:I}=this;return I===c||Array.isArray(I)&&I.includes(c)}_addParent(c){const{_parentage:I}=this;this._parentage=Array.isArray(I)?(I.push(c),I):I?[I,c]:c}_removeParent(c){const{_parentage:I}=this;I===c?this._parentage=null:Array.isArray(I)&&(0,f.o)(I,c)}remove(c){const{_finalizers:I}=this;I&&(0,f.o)(I,c),c instanceof n&&c._removeParent(this)}}n.EMPTY=(()=>{const E=new n;return E.closed=!0,E})();const u=n.EMPTY;function g(E){return E instanceof n||E&&"closed"in E&&(0,s.T)(E.remove)&&(0,s.T)(E.add)&&(0,s.T)(E.unsubscribe)}function p(E){(0,s.T)(E)?E():E.unsubscribe()}},1026:(S,m,t)=>{t.d(m,{$:()=>s});const s={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},2688:(S,m,t)=>{t.d(m,{x:()=>n});var s=t(9131),a=t(9326),f=t(9724);function n(...u){return(0,s.K)()((0,f.H)(u,(0,a.lI)(u)))}},983:(S,m,t)=>{t.d(m,{I:()=>f,w:()=>a});var s=t(1985);const a=new s.c(u=>u.complete());function f(u){return u?function n(u){return new s.c(g=>u.schedule(()=>g.complete()))}(u):a}},9724:(S,m,t)=>{t.d(m,{H:()=>f});var s=t(5894),a=t(8750);function f(n,u){return u?(0,s.c)(n,u):(0,a.Tg)(n)}},8750:(S,m,t)=>{t.d(m,{Tg:()=>L});var s=t(1635),a=t(7441),f=t(9858),n=t(1985),u=t(5055),g=t(7953),p=t(591),E=t(5397),c=t(5196),I=t(8071),C=t(5334),O=t(3494);function L(D){if(D instanceof n.c)return D;if(null!=D){if((0,u.l)(D))return function M(D){return new n.c(y=>{const d=D[O.s]();if((0,I.T)(d.subscribe))return d.subscribe(y);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(D);if((0,a.X)(D))return function x(D){return new n.c(y=>{for(let d=0;d<D.length&&!y.closed;d++)y.next(D[d]);y.complete()})}(D);if((0,f.y)(D))return function W(D){return new n.c(y=>{D.then(d=>{y.closed||(y.next(d),y.complete())},d=>y.error(d)).then(null,C.m)})}(D);if((0,g.T)(D))return j(D);if((0,E.x)(D))return function P(D){return new n.c(y=>{for(const d of D)if(y.next(d),y.closed)return;y.complete()})}(D);if((0,c.U)(D))return function N(D){return j((0,c.C)(D))}(D)}throw(0,p.L)(D)}function j(D){return new n.c(y=>{(function w(D,y){var d,z,e,r;return(0,s.sH)(this,void 0,void 0,function*(){try{for(d=(0,s.xN)(D);!(z=yield d.next()).done;)if(y.next(z.value),y.closed)return}catch(_){e={error:_}}finally{try{z&&!z.done&&(r=d.return)&&(yield r.call(d))}finally{if(e)throw e.error}}y.complete()})})(D,y).catch(d=>y.error(d))})}},1807:(S,m,t)=>{t.d(m,{O:()=>u});var s=t(1985),a=t(3236),f=t(9470),n=t(8211);function u(g=0,p,E=a.b){let c=-1;return null!=p&&((0,f.m)(p)?E=p:c=p),new s.c(I=>{let C=(0,n.v)(g)?+g-E.now():g;C<0&&(C=0);let O=0;return E.schedule(function(){I.closed||(I.next(O++),0<=c?this.schedule(void 0,c):I.complete())},C)})}},4360:(S,m,t)=>{t.d(m,{H:()=>f,_:()=>a});var s=t(7707);function a(n,u,g,p,E){return new f(n,u,g,p,E)}class f extends s.vU{constructor(u,g,p,E,c,I){super(u),this.onFinalize=c,this.shouldUnsubscribe=I,this._next=g?function(C){try{g(C)}catch(O){u.error(O)}}:super._next,this._error=E?function(C){try{E(C)}catch(O){u.error(O)}finally{this.unsubscribe()}}:super._error,this._complete=p?function(){try{p()}catch(C){u.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var u;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:g}=this;super.unsubscribe(),!g&&(null===(u=this.onFinalize)||void 0===u||u.call(this))}}}},9437:(S,m,t)=>{t.d(m,{W:()=>n});var s=t(8750),a=t(4360),f=t(9974);function n(u){return(0,f.N)((g,p)=>{let I,E=null,c=!1;E=g.subscribe((0,a._)(p,void 0,void 0,C=>{I=(0,s.Tg)(u(C,n(u)(g))),E?(E.unsubscribe(),E=null,I.subscribe(p)):c=!0})),c&&(E.unsubscribe(),E=null,I.subscribe(p))})}},9131:(S,m,t)=>{t.d(m,{K:()=>a});var s=t(6365);function a(){return(0,s.U)(1)}},3103:(S,m,t)=>{t.d(m,{c:()=>n});var s=t(3236),a=t(3183),f=t(1807);function n(u,g=s.E){const p=(0,f.O)(u,g);return(0,a.o)(()=>p)}},3183:(S,m,t)=>{t.d(m,{o:()=>p});var s=t(2688),a=t(6697),f=t(3557),n=t(3703),u=t(3028),g=t(8750);function p(E,c){return c?I=>(0,s.x)(c.pipe((0,a.s)(1),(0,f.w)()),I.pipe(p(E))):(0,u.Z)((I,C)=>(0,g.Tg)(E(I,C)).pipe((0,a.s)(1),(0,n.u)(I)))}},3557:(S,m,t)=>{t.d(m,{w:()=>n});var s=t(9974),a=t(4360),f=t(5343);function n(){return(0,s.N)((u,g)=>{u.subscribe((0,a._)(g,f.l))})}},6354:(S,m,t)=>{t.d(m,{T:()=>f});var s=t(9974),a=t(4360);function f(n,u){return(0,s.N)((g,p)=>{let E=0;g.subscribe((0,a._)(p,c=>{p.next(n.call(u,c,E++))}))})}},3703:(S,m,t)=>{t.d(m,{u:()=>a});var s=t(6354);function a(f){return(0,s.T)(()=>f)}},6365:(S,m,t)=>{t.d(m,{U:()=>f});var s=t(3028),a=t(3669);function f(n=1/0){return(0,s.Z)(a.D,n)}},5412:(S,m,t)=>{t.d(m,{h:()=>n});var s=t(8750),a=t(5225),f=t(4360);function n(u,g,p,E,c,I,C,O){const L=[];let M=0,x=0,W=!1;const P=()=>{W&&!L.length&&!M&&g.complete()},j=w=>M<E?N(w):L.push(w),N=w=>{I&&g.next(w),M++;let D=!1;(0,s.Tg)(p(w,x++)).subscribe((0,f._)(g,y=>{c?.(y),I?j(y):g.next(y)},()=>{D=!0},void 0,()=>{if(D)try{for(M--;L.length&&M<E;){const y=L.shift();C?(0,a.N)(g,C,()=>N(y)):N(y)}P()}catch(y){g.error(y)}}))};return u.subscribe((0,f._)(g,j,()=>{W=!0,P()})),()=>{O?.()}}},3028:(S,m,t)=>{t.d(m,{Z:()=>g});var s=t(6354),a=t(8750),f=t(9974),n=t(5412),u=t(8071);function g(p,E,c=1/0){return(0,u.T)(E)?g((I,C)=>(0,s.T)((O,L)=>E(I,O,C,L))((0,a.Tg)(p(I,C))),c):("number"==typeof E&&(c=E),(0,f.N)((I,C)=>(0,n.h)(I,C,p,c)))}},941:(S,m,t)=>{t.d(m,{Q:()=>n});var s=t(5225),a=t(9974),f=t(4360);function n(u,g=0){return(0,a.N)((p,E)=>{p.subscribe((0,f._)(E,c=>(0,s.N)(E,u,()=>E.next(c),g),()=>(0,s.N)(E,u,()=>E.complete(),g),c=>(0,s.N)(E,u,()=>E.error(c),g)))})}},6745:(S,m,t)=>{t.d(m,{_:()=>a});var s=t(9974);function a(f,n=0){return(0,s.N)((u,g)=>{g.add(f.schedule(()=>u.subscribe(g),n))})}},6697:(S,m,t)=>{t.d(m,{s:()=>n});var s=t(983),a=t(9974),f=t(4360);function n(u){return u<=0?()=>s.w:(0,a.N)((g,p)=>{let E=0;g.subscribe((0,f._)(p,c=>{++E<=u&&(p.next(c),u<=E&&p.complete())}))})}},7119:(S,m,t)=>{t.d(m,{S:()=>u});var s=t(1985),a=t(4761),f=t(8071),n=t(5225);function u(g,p){return new s.c(E=>{let c;return(0,n.N)(E,p,()=>{c=g[a.l](),(0,n.N)(E,p,()=>{let I,C;try{({value:I,done:C}=c.next())}catch(O){return void E.error(O)}C?E.complete():E.next(I)},0,!0)}),()=>(0,f.T)(c?.return)&&c.return()})}},5894:(S,m,t)=>{t.d(m,{c:()=>N});var s=t(8750),a=t(941),f=t(6745),g=t(1985),E=t(7119),c=t(5225);function I(w,D){if(!w)throw new Error("Iterable cannot be null");return new g.c(y=>{(0,c.N)(y,D,()=>{const d=w[Symbol.asyncIterator]();(0,c.N)(y,D,()=>{d.next().then(z=>{z.done?y.complete():y.next(z.value)})},0,!0)})})}var C=t(5055),O=t(9858),L=t(7441),M=t(5397),x=t(7953),W=t(591),P=t(5196);function N(w,D){if(null!=w){if((0,C.l)(w))return function n(w,D){return(0,s.Tg)(w).pipe((0,f._)(D),(0,a.Q)(D))}(w,D);if((0,L.X)(w))return function p(w,D){return new g.c(y=>{let d=0;return D.schedule(function(){d===w.length?y.complete():(y.next(w[d++]),y.closed||this.schedule())})})}(w,D);if((0,O.y)(w))return function u(w,D){return(0,s.Tg)(w).pipe((0,f._)(D),(0,a.Q)(D))}(w,D);if((0,x.T)(w))return I(w,D);if((0,M.x)(w))return(0,E.S)(w,D);if((0,P.U)(w))return function j(w,D){return I((0,P.C)(w),D)}(w,D)}throw(0,W.L)(w)}},6780:(S,m,t)=>{t.d(m,{R:()=>u});var s=t(3961);class a extends s.yU{constructor(p,E){super()}schedule(p,E=0){return this}}const f={setInterval(g,p,...E){const{delegate:c}=f;return c?.setInterval?c.setInterval(g,p,...E):setInterval(g,p,...E)},clearInterval(g){const{delegate:p}=f;return(p?.clearInterval||clearInterval)(g)},delegate:void 0};var n=t(7908);class u extends a{constructor(p,E){super(p,E),this.scheduler=p,this.work=E,this.pending=!1}schedule(p,E=0){var c;if(this.closed)return this;this.state=p;const I=this.id,C=this.scheduler;return null!=I&&(this.id=this.recycleAsyncId(C,I,E)),this.pending=!0,this.delay=E,this.id=null!==(c=this.id)&&void 0!==c?c:this.requestAsyncId(C,this.id,E),this}requestAsyncId(p,E,c=0){return f.setInterval(p.flush.bind(p,this),c)}recycleAsyncId(p,E,c=0){if(null!=c&&this.delay===c&&!1===this.pending)return E;null!=E&&f.clearInterval(E)}execute(p,E){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const c=this._execute(p,E);if(c)return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(p,E){let I,c=!1;try{this.work(p)}catch(C){c=!0,I=C||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),I}unsubscribe(){if(!this.closed){const{id:p,scheduler:E}=this,{actions:c}=E;this.work=this.state=this.scheduler=null,this.pending=!1,(0,n.o)(c,this),null!=p&&(this.id=this.recycleAsyncId(E,p,null)),this.delay=null,super.unsubscribe()}}}},707:(S,m,t)=>{t.d(m,{q:()=>a});var s=t(8399);class a extends s._{constructor(n,u=s._.now){super(n,u),this.actions=[],this._active=!1}flush(n){const{actions:u}=this;if(this._active)return void u.push(n);let g;this._active=!0;do{if(g=n.execute(n.state,n.delay))break}while(n=u.shift());if(this._active=!1,g){for(;n=u.shift();)n.unsubscribe();throw g}}}},3236:(S,m,t)=>{t.d(m,{E:()=>f,b:()=>n});var s=t(6780);const f=new(t(707).q)(s.R),n=f},6129:(S,m,t)=>{t.d(m,{U:()=>s});const s={now:()=>(s.delegate||Date).now(),delegate:void 0}},9270:(S,m,t)=>{t.d(m,{f:()=>s});const s={setTimeout(a,f,...n){const{delegate:u}=s;return u?.setTimeout?u.setTimeout(a,f,...n):setTimeout(a,f,...n)},clearTimeout(a){const{delegate:f}=s;return(f?.clearTimeout||clearTimeout)(a)},delegate:void 0}},4761:(S,m,t)=>{t.d(m,{l:()=>a});const a=function s(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},3494:(S,m,t)=>{t.d(m,{s:()=>s});const s="function"==typeof Symbol&&Symbol.observable||"@@observable"},4079:(S,m,t)=>{t.d(m,{Z:()=>a});const a=(0,t(1853).L)(f=>function(u){f(this),this.message=u?`${u.length} errors occurred during unsubscription:\n${u.map((g,p)=>`${p+1}) ${g.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=u})},9326:(S,m,t)=>{t.d(m,{R0:()=>g,lI:()=>u,ms:()=>n});var s=t(8071),a=t(9470);function f(p){return p[p.length-1]}function n(p){return(0,s.T)(f(p))?p.pop():void 0}function u(p){return(0,a.m)(f(p))?p.pop():void 0}function g(p,E){return"number"==typeof f(p)?p.pop():E}},7908:(S,m,t)=>{function s(a,f){if(a){const n=a.indexOf(f);0<=n&&a.splice(n,1)}}t.d(m,{o:()=>s})},1853:(S,m,t)=>{function s(a){const n=a(u=>{Error.call(u),u.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}t.d(m,{L:()=>s})},9786:(S,m,t)=>{t.d(m,{Y:()=>f,l:()=>n});var s=t(1026);let a=null;function f(u){if(s.$.useDeprecatedSynchronousErrorHandling){const g=!a;if(g&&(a={errorThrown:!1,error:null}),u(),g){const{errorThrown:p,error:E}=a;if(a=null,p)throw E}}else u()}function n(u){s.$.useDeprecatedSynchronousErrorHandling&&a&&(a.errorThrown=!0,a.error=u)}},5225:(S,m,t)=>{function s(a,f,n,u=0,g=!1){const p=f.schedule(function(){n(),g?a.add(this.schedule(null,u)):this.unsubscribe()},u);if(a.add(p),!g)return p}t.d(m,{N:()=>s})},3669:(S,m,t)=>{function s(a){return a}t.d(m,{D:()=>s})},7441:(S,m,t)=>{t.d(m,{X:()=>s});const s=a=>a&&"number"==typeof a.length&&"function"!=typeof a},7953:(S,m,t)=>{t.d(m,{T:()=>a});var s=t(8071);function a(f){return Symbol.asyncIterator&&(0,s.T)(f?.[Symbol.asyncIterator])}},8211:(S,m,t)=>{function s(a){return a instanceof Date&&!isNaN(a)}t.d(m,{v:()=>s})},8071:(S,m,t)=>{function s(a){return"function"==typeof a}t.d(m,{T:()=>s})},5055:(S,m,t)=>{t.d(m,{l:()=>f});var s=t(3494),a=t(8071);function f(n){return(0,a.T)(n[s.s])}},5397:(S,m,t)=>{t.d(m,{x:()=>f});var s=t(4761),a=t(8071);function f(n){return(0,a.T)(n?.[s.l])}},9858:(S,m,t)=>{t.d(m,{y:()=>a});var s=t(8071);function a(f){return(0,s.T)(f?.then)}},5196:(S,m,t)=>{t.d(m,{C:()=>f,U:()=>n});var s=t(1635),a=t(8071);function f(u){return(0,s.AQ)(this,arguments,function*(){const p=u.getReader();try{for(;;){const{value:E,done:c}=yield(0,s.N3)(p.read());if(c)return yield(0,s.N3)(void 0);yield yield(0,s.N3)(E)}}finally{p.releaseLock()}})}function n(u){return(0,a.T)(u?.getReader)}},9470:(S,m,t)=>{t.d(m,{m:()=>a});var s=t(8071);function a(f){return f&&(0,s.T)(f.schedule)}},9974:(S,m,t)=>{t.d(m,{N:()=>f,S:()=>a});var s=t(8071);function a(n){return(0,s.T)(n?.lift)}function f(n){return u=>{if(a(u))return u.lift(function(g){try{return n(g,this)}catch(p){this.error(p)}});throw new TypeError("Unable to lift unknown Observable type")}}},5343:(S,m,t)=>{function s(){}t.d(m,{l:()=>s})},1203:(S,m,t)=>{t.d(m,{F:()=>a,m:()=>f});var s=t(3669);function a(...n){return f(n)}function f(n){return 0===n.length?s.D:1===n.length?n[0]:function(g){return n.reduce((p,E)=>E(p),g)}}},5334:(S,m,t)=>{t.d(m,{m:()=>f});var s=t(1026),a=t(9270);function f(n){a.f.setTimeout(()=>{const{onUnhandledError:u}=s.$;if(!u)throw n;u(n)})}},591:(S,m,t)=>{function s(a){return new TypeError(`You provided ${null!==a&&"object"==typeof a?"an invalid object":`'${a}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}t.d(m,{L:()=>s})},467:(S,m,t)=>{function s(f,n,u,g,p,E,c){try{var I=f[E](c),C=I.value}catch(O){return void u(O)}I.done?n(C):Promise.resolve(C).then(g,p)}function a(f){return function(){var n=this,u=arguments;return new Promise(function(g,p){var E=f.apply(n,u);function c(C){s(E,g,p,c,I,"next",C)}function I(C){s(E,g,p,c,I,"throw",C)}c(void 0)})}}t.d(m,{A:()=>a})},1635:(S,m,t)=>{function O(i,o,l,h){return new(l||(l=Promise))(function(v,T){function B($){try{R(h.next($))}catch(F){T(F)}}function H($){try{R(h.throw($))}catch(F){T(F)}}function R($){$.done?v($.value):function A(v){return v instanceof l?v:new l(function(T){T(v)})}($.value).then(B,H)}R((h=h.apply(i,o||[])).next())})}function D(i){return this instanceof D?(this.v=i,this):new D(i)}function y(i,o,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A,h=l.apply(i,o||[]),v=[];return A=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),B("next"),B("throw"),B("return",function T(K){return function(V){return Promise.resolve(V).then(K,F)}}),A[Symbol.asyncIterator]=function(){return this},A;function B(K,V){h[K]&&(A[K]=function(Y){return new Promise(function(X,Z){v.push([K,Y,X,Z])>1||H(K,Y)})},V&&(A[K]=V(A[K])))}function H(K,V){try{!function R(K){K.value instanceof D?Promise.resolve(K.value.v).then($,F):q(v[0][2],K)}(h[K](V))}catch(Y){q(v[0][3],Y)}}function $(K){H("next",K)}function F(K){H("throw",K)}function q(K,V){K(V),v.shift(),v.length&&H(v[0][0],v[0][1])}}function z(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,o=i[Symbol.asyncIterator];return o?o.call(i):(i=function W(i){var o="function"==typeof Symbol&&Symbol.iterator,l=o&&i[o],h=0;if(l)return l.call(i);if(i&&"number"==typeof i.length)return{next:function(){return i&&h>=i.length&&(i=void 0),{value:i&&i[h++],done:!i}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}(i),l={},h("next"),h("throw"),h("return"),l[Symbol.asyncIterator]=function(){return this},l);function h(v){l[v]=i[v]&&function(T){return new Promise(function(B,H){!function A(v,T,B,H){Promise.resolve(H).then(function(R){v({value:R,done:B})},T)}(B,H,(T=i[v](T)).done,T.value)})}}}t.d(m,{AQ:()=>y,N3:()=>D,sH:()=>O,xN:()=>z}),"function"==typeof SuppressedError&&SuppressedError}}]);