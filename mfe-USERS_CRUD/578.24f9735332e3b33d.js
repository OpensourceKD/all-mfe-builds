(self.webpackChunkmfe_USERS_CRUD=self.webpackChunkmfe_USERS_CRUD||[]).push([[578],{6578:(v,p,r)=>{r.r(p),r.d(p,{AUTH0_CONFIG:()=>l,Auth0ApiService:()=>T,AuthService:()=>o,CoreServicesComponent:()=>d,CoreServicesService:()=>m,OrganizationService:()=>M,ProductCategory:()=>S,RoleManagementService:()=>y,RoleService:()=>E,SalesDataService:()=>P,SalesStatus:()=>D,SystemRole:()=>R,TeamService:()=>I,UserRole:()=>c,UserService:()=>C});var a=r(4332);let m=(()=>{class i{constructor(){}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var f=r(467),n=r(3425);const l={useRealAuth0:!1,domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"lT0H33rFRamTUtbbXwPwO7M0SdT8Qq26",redirectUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",scope:"openid profile email",audience:void 0,managementApiAudience:void 0};var u=r(4230);let o=(()=>{class i{get domain(){return l.domain}get clientId(){return l.clientId}get redirectUri(){return l.redirectUri}get scope(){return l.scope}constructor(e){this.http=e,this.id="auth of pokemon",this.TOKEN_KEY="auth0_token",this.USER_INFO_KEY="auth0_user_info",this.userSubject=new n.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("In constructor of auth service in pokemon")}login(e){e&&console.log(`[AuthService] Logged in: ${e}`),this.redirectToAuth0Login()}redirectToAuth0Login(){const e=new URL(`https://${this.domain}/authorize`),t=this.generateRandomState(),s=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",t),sessionStorage.setItem("code_verifier",s),e.searchParams.append("client_id",this.clientId),e.searchParams.append("redirect_uri",this.redirectUri),e.searchParams.append("response_type","code"),e.searchParams.append("scope",this.scope),e.searchParams.append("state",t),window.location.href=e.toString()}handleCallback(e,t){var s=this;return(0,f.A)(function*(){const h=sessionStorage.getItem("oauth_state");if(t!==h)return console.error("State mismatch - possible CSRF attack"),!1;try{const g=yield s.exchangeCodeForToken(e);s.setToken(g.access_token);const U=s.decodeIdToken(g.id_token);return s.setUserInfo(U),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(g){return console.error("Error exchanging code for token:",g),!1}})()}exchangeCodeForToken(e){var t=this;return(0,f.A)(function*(){const s=`https://${t.domain}/oauth/token`,h=new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:t.redirectUri,client_id:t.clientId}),g=yield fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:h.toString()});if(!g.ok)throw new Error(`Token exchange failed: ${g.statusText}`);return g.json()})()}decodeIdToken(e){try{const t=e.split(".")[1],s=JSON.parse(atob(t));return{sub:s.sub,name:s.name,email:s.email}}catch(t){return console.error("Error decoding ID token:",t),{sub:""}}}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),this.userSubject.next(null);const e=`https://${this.domain}/v2/logout?client_id=${this.clientId}&returnTo=${encodeURIComponent(this.redirectUri)}`;window.location.href=e}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}getUserInfoFromStorage(){const e=localStorage.getItem(this.USER_INFO_KEY);return e?JSON.parse(e):null}setUserInfo(e){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(e)),this.userSubject.next(e)}generateRandomState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(u.HttpClient))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),d=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:i,selectors:[["org-core-services"]],standalone:!0,features:[a.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(t,s){1&t&&(a.\u0275\u0275elementStart(0,"p"),a.\u0275\u0275text(1," core-services works! "),a.\u0275\u0275elementEnd())}})}}return i})();var c=function(i){return i.SUPER_ADMIN="super-admin",i.ORG_ADMIN="org-admin",i.TEAM_LEAD="team-lead",i.SALES_EXECUTIVE="sales-executive",i}(c||{});let E=(()=>{class i{constructor(e){this.currentUserSubject=new n.BehaviorSubject(this.getDummyUser()),this.currentUser$=this.currentUserSubject.asObservable(),this.dataService=e}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(e){this.currentUserSubject.next(e)}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){const t=this.getCurrentUser();return!!t&&e.includes(t.role)}isAdmin(){return this.hasAnyRole([c.SUPER_ADMIN,c.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([c.SUPER_ADMIN,c.ORG_ADMIN,c.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:c.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:c.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:c.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const t=this.getAllUsers();return this.isTeamLeadOrHigher()?t.filter(s=>s.role===c.SALES_EXECUTIVE||s.id===e.id):t.filter(s=>s.id===e.id)}getDummyUser(){return{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var A=r(3103),D=function(i){return i.COMPLETED="completed",i.PENDING="pending",i.CANCELLED="cancelled",i}(D||{}),S=function(i){return i.ELECTRONICS="Electronics",i.SOFTWARE="Software",i.SERVICES="Services",i.HARDWARE="Hardware",i}(S||{});let P=(()=>{class i{constructor(e){this.dummySalesData=this.generateDummyData(),this.dataService=e}getSalesHistory(e,t,s){if(this.dataService)return this.dataService.getSalesHistory(e,t,s);let h=this.dummySalesData.filter(g=>g.salesExecutiveId===e);return t&&(h=h.filter(g=>g.date>=t)),s&&(h=h.filter(g=>g.date<=s)),(0,n.of)(h).pipe((0,A.c)(300))}getSalesSummary(e){if(this.dataService)return this.dataService.getSalesSummary(e);const t=this.dummySalesData.filter(h=>h.salesExecutiveId===e),s={totalSales:t.filter(h=>h.status===D.COMPLETED).reduce((h,g)=>h+g.amount,0),totalCommission:t.filter(h=>h.status===D.COMPLETED).reduce((h,g)=>h+g.commission,0),completedCount:t.filter(h=>h.status===D.COMPLETED).length,pendingCount:t.filter(h=>h.status===D.PENDING).length,cancelledCount:t.filter(h=>h.status===D.CANCELLED).length};return(0,n.of)(s).pipe((0,A.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,n.of)(this.dummySalesData).pipe((0,A.c)(300))}generateDummyData(){const e=[{name:"Enterprise Software License",category:S.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:S.SERVICES,basePrice:25e3},{name:"Server Hardware",category:S.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:S.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:S.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:S.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:S.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:S.HARDWARE,basePrice:6e4}],t=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],s=["North","South","East","West","Central"],h=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],g=[D.COMPLETED,D.COMPLETED,D.COMPLETED,D.PENDING,D.CANCELLED],U=[];let z=1;for(let b=0;b<50;b++){const w=h[b%h.length],L=e[Math.floor(Math.random()*e.length)],j=t[Math.floor(Math.random()*t.length)],K=s[Math.floor(Math.random()*s.length)],N=g[Math.floor(Math.random()*g.length)],B=L.basePrice+(1e4*Math.random()-5e3),$=.05*B,W=new Date;W.setDate(W.getDate()-Math.floor(180*Math.random())),U.push({id:"sale-"+z++,salesExecutiveId:w.id,salesExecutiveName:w.name,productName:L.name,productCategory:L.category,amount:Math.round(B),commission:Math.round($),status:N,date:W,clientName:j,region:K})}return U.sort((b,w)=>w.date.getTime()-b.date.getTime())}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var R=function(i){return i.SUPER_ADMIN="super-admin",i.ORG_ADMIN="org-admin",i.TEAM_LEAD="team-lead",i.MEMBER="member",i}(R||{}),O=r(6354),_=r(9437);let T=(()=>{class i{get domain(){return l.domain}get managementApiUrl(){return`https://${this.domain}/api/v2`}constructor(e,t){this.http=e,this.authService=t}getHeaders(){const e=this.authService.getToken();return new u.HttpHeaders({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}getCurrentUser(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}getUserInfo(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}listUsers(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/users?${t}`:`${this.managementApiUrl}/users`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}getUserById(e){return this.http.get(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}createUser(e){return this.http.post(`${this.managementApiUrl}/users`,e,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}updateUser(e,t){return this.http.patch(`${this.managementApiUrl}/users/${e}`,t,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}deleteUser(e){return this.http.delete(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}blockUser(e,t=!0){return this.http.patch(`${this.managementApiUrl}/users/${e}`,{blocked:t},{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}listOrganizations(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/organizations?${t}`:`${this.managementApiUrl}/organizations`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}getOrganizationById(e){return this.http.get(`${this.managementApiUrl}/organizations/${e}`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}createOrganization(e){return this.http.post(`${this.managementApiUrl}/organizations`,e,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}updateOrganization(e,t){return this.http.patch(`${this.managementApiUrl}/organizations/${e}`,t,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}listRoles(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/roles?${t}`:`${this.managementApiUrl}/roles`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}getRoleById(e){return this.http.get(`${this.managementApiUrl}/roles/${e}`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}createRole(e){return this.http.post(`${this.managementApiUrl}/roles`,e,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}updateRole(e,t){return this.http.patch(`${this.managementApiUrl}/roles/${e}`,t,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}listUserRoles(e){return this.http.get(`${this.managementApiUrl}/users/${e}/roles`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}assignRolesToUser(e,t){return this.http.post(`${this.managementApiUrl}/users/${e}/roles`,{roles:t},{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}handleError(e){return console.error("Auth0 API Error:",e),(0,n.throwError)(()=>e)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(u.HttpClient),a.\u0275\u0275inject(o))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),M=(()=>{class i{constructor(e){this.auth0Api=e,this.organizationsCache=[],this.organizationsSubject=new n.BehaviorSubject([]),this.organizations$=this.organizationsSubject.asObservable(),this.loadOrganizations()}loadOrganizations(){this.auth0Api.listOrganizations().pipe((0,O.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,_.W)(e=>(console.error("Error loading organizations from Auth0:",e),(0,n.of)([])))).subscribe(e=>{e&&e.length>0&&(this.organizationsCache=e,this.organizationsSubject.next(this.organizationsCache))})}mapAuth0OrgsToOrganizations(e){return e&&Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,description:t.display_name||t.name,createdAt:t.created_at?new Date(t.created_at):new Date,updatedAt:t.updated_at?new Date(t.updated_at):new Date,isActive:!0,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}})):[]}getAll(){return this.auth0Api.listOrganizations().pipe((0,O.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,_.W)(e=>(console.error("Error getting organizations:",e),(0,n.of)(this.organizationsCache))))}getById(e){return this.getAll().pipe((0,O.T)(t=>t.find(s=>s.id===e)))}create(e){return this.auth0Api.createOrganization({name:e.name,display_name:e.description}).pipe((0,O.T)(s=>{const h={id:s.id,name:s.name,description:s.display_name||s.name,createdAt:new Date(s.created_at),updatedAt:new Date(s.updated_at||s.created_at),isActive:!0,settings:e.settings||{timezone:"UTC",currency:"USD",locale:"en-US"}};return this.organizationsCache.push(h),this.organizationsSubject.next(this.organizationsCache),h}),(0,_.W)(s=>{console.error("Creating organizations in Auth0 requires admin privileges:",s);const h={...e,id:`org-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return(0,n.of)(h)}))}update(e,t){const s={};return t.name&&(s.name=t.name),t.description&&(s.display_name=t.description),this.auth0Api.updateOrganization(e,s).pipe((0,O.T)(h=>{const g=this.organizationsCache.findIndex(U=>U.id===e);return-1!==g?(this.organizationsCache[g]={...this.organizationsCache[g],...t,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),this.organizationsCache[g]):null}),(0,_.W)(h=>{console.warn("Updating organizations in Auth0 requires specific permissions:",h);const g=this.organizationsCache.findIndex(U=>U.id===e);return-1!==g?(this.organizationsCache[g]={...this.organizationsCache[g],...t,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),(0,n.of)(this.organizationsCache[g])):(0,n.of)(null)}))}delete(e){return console.warn("Deleting organizations should be done with caution and may not be supported via Auth0 API"),(0,n.of)(!1)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(T))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),I=(()=>{class i{constructor(e){this.auth0Api=e,this.teamsCache=[],this.teamsSubject=new n.BehaviorSubject([]),this.teams$=this.teamsSubject.asObservable(),this.loadTeams()}loadTeams(){this.teamsCache=this.getDummyTeams(),this.teamsSubject.next(this.teamsCache)}getDummyTeams(){return[{id:"team1",name:"Engineering",description:"Engineering team",organizationId:"org1",leadId:"1",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team2",name:"Product",description:"Product team",organizationId:"org1",leadId:"2",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team3",name:"Design",description:"Design team",organizationId:"org2",leadId:"3",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0}]}getAll(){return(0,n.of)(this.teamsCache)}getByOrganization(e){return this.getAll().pipe((0,O.T)(t=>t.filter(s=>s.organizationId===e)))}getById(e){const t=this.teamsCache.find(s=>s.id===e);return(0,n.of)(t)}create(e){const t={id:`team-${Date.now()}`,name:e.name,description:e.description,organizationId:e.organizationId,leadId:e.leadId,createdAt:new Date,updatedAt:new Date,isActive:!0};return this.teamsCache.push(t),this.teamsSubject.next(this.teamsCache),(0,n.of)(t)}update(e,t){const s=this.teamsCache.findIndex(h=>h.id===e);return-1!==s?(this.teamsCache[s]={...this.teamsCache[s],...t,updatedAt:new Date},this.teamsSubject.next(this.teamsCache),(0,n.of)(this.teamsCache[s])):(0,n.of)(null)}delete(e){const t=this.teamsCache.findIndex(s=>s.id===e);return-1!==t?(this.teamsCache[t].isActive=!1,this.teamsCache[t].updatedAt=new Date,this.teamsSubject.next(this.teamsCache),(0,n.of)(!0)):(0,n.of)(!1)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(T))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),C=(()=>{class i{constructor(e){this.auth0Api=e,this.usersCache=[],this.usersSubject=new n.BehaviorSubject([]),this.users$=this.usersSubject.asObservable(),this.currentAuth0User=null,this.loadUsers()}loadUsers(){if(!l.useRealAuth0)return this.usersCache=this.getDummyUsers(),void this.usersSubject.next(this.usersCache);(0,n.forkJoin)({authUser:this.auth0Api.getCurrentUser().pipe((0,_.W)(()=>(0,n.of)(null))),userInfo:this.auth0Api.getUserInfo().pipe((0,_.W)(()=>(0,n.of)(null)))}).subscribe(({authUser:e,userInfo:t})=>{const s=this.getDummyUsers();if(e||t){const h=this.mapAuth0UserToUser(e||t);this.currentAuth0User=h,this.usersCache=[h,...s.slice(1)]}else console.log("Could not fetch real user from Auth0 API, using dummy data"),this.usersCache=s;this.usersSubject.next(this.usersCache)})}getDummyUsers(){return[{id:"1",name:"John Doe",email:"john.doe@example.com",organizationId:"org1",teamId:"team1",roleId:"super-admin",isActive:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"2",name:"Jane Smith",email:"jane.smith@example.com",organizationId:"org1",teamId:"team2",roleId:"org-admin",isActive:!0,createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-02-10")},{id:"3",name:"Bob Johnson",email:"bob.johnson@example.com",organizationId:"org2",teamId:"team3",roleId:"team-lead",isActive:!0,createdAt:new Date("2024-03-05"),updatedAt:new Date("2024-03-05")},{id:"4",name:"Alice Brown",email:"alice.brown@example.com",organizationId:"org1",teamId:"team1",roleId:"member",isActive:!1,createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-05-10")}]}mapAuth0UserToUser(e){return e?{id:e.user_id||e.sub||"1",name:this.extractUserName(e),email:e.email||"user@example.com",organizationId:e.org_id||"default-org",teamId:"default-team",roleId:"member",isActive:!e.blocked,createdAt:e.created_at?new Date(e.created_at):new Date,updatedAt:e.updated_at?new Date(e.updated_at):new Date,auth0UserId:e.user_id||e.sub}:this.getDummyUsers()[0]}extractUserName(e){return e.name?e.name:e.nickname?e.nickname:`${e.given_name||""} ${e.family_name||""}`.trim()||(e.email?e.email.split("@")[0]:`User ${e.user_id||e.sub}`)}mapAuth0UsersToUsers(e){return e&&Array.isArray(e)?e.map(t=>({id:t.user_id,name:this.extractUserName(t),email:t.email||"",organizationId:t.org_id||"default-org",teamId:"default-team",roleId:"default-role",isActive:!t.blocked,createdAt:t.created_at?new Date(t.created_at):new Date,updatedAt:t.updated_at?new Date(t.updated_at):new Date,auth0UserId:t.user_id})):[]}mapUserToAuth0Format(e){return{email:e.email,name:e.name,nickname:e.name,blocked:!e.isActive,connection:"Username-Password-Authentication",email_verified:!1,user_metadata:{organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId}}}getAll(){return(0,n.of)(this.usersCache)}getCurrentAuth0User(){return this.currentAuth0User}getByOrganization(e){return this.getAll().pipe((0,O.T)(t=>t.filter(s=>s.organizationId===e)))}getByTeam(e){return this.getAll().pipe((0,O.T)(t=>t.filter(s=>s.teamId===e)))}getById(e){const t=this.usersCache.find(s=>s.id===e);return t?(0,n.of)(t):this.auth0Api.getUserById(e).pipe((0,O.T)(s=>{const h=this.mapAuth0UsersToUsers([s]);return h.length>0?h[0]:void 0}),(0,_.W)(s=>(console.error("Error getting user by ID (Management API not available):",s),(0,n.of)(void 0))))}create(e){const t=this.mapUserToAuth0Format(e);return this.auth0Api.createUser(t).pipe((0,O.T)(s=>{const h={id:s.user_id||`user-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date,auth0UserId:s.user_id};return this.usersCache.push(h),this.usersSubject.next(this.usersCache),h}),(0,_.W)(s=>{console.error("Error creating user (Management API not available):",s);const h={id:`local-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date};return this.usersCache.push(h),this.usersSubject.next(this.usersCache),(0,n.of)(h)}))}update(e,t){const s=this.mapUserToAuth0Format(t);return this.auth0Api.updateUser(e,s).pipe((0,O.T)(h=>{const g=this.usersCache.findIndex(U=>U.id===e);return-1!==g?(this.usersCache[g]={...this.usersCache[g],...t,updatedAt:new Date},this.usersSubject.next(this.usersCache),this.usersCache[g]):null}),(0,_.W)(h=>{console.error("Error updating user (Management API not available):",h);const g=this.usersCache.findIndex(U=>U.id===e);return-1!==g?(this.usersCache[g]={...this.usersCache[g],...t,updatedAt:new Date},this.usersSubject.next(this.usersCache),(0,n.of)(this.usersCache[g])):(0,n.of)(null)}))}delete(e){return this.auth0Api.blockUser(e,!0).pipe((0,O.T)(()=>{const t=this.usersCache.findIndex(s=>s.id===e);return-1!==t&&(this.usersCache[t].isActive=!1,this.usersCache[t].updatedAt=new Date,this.usersSubject.next(this.usersCache),!0)}),(0,_.W)(t=>{console.error("Error deleting user (Management API not available):",t);const s=this.usersCache.findIndex(h=>h.id===e);return-1!==s&&(this.usersCache[s].isActive=!1,this.usersCache[s].updatedAt=new Date,this.usersSubject.next(this.usersCache)),(0,n.of)(!0)}))}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(T))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),y=(()=>{class i{constructor(e){this.auth0Api=e,this.systemRoles=[{id:"role-1",name:"Super Admin",description:"Full system access",permissions:["*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-2",name:"Organization Admin",description:"Full access within organization",permissions:["org:*","team:*","user:*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-3",name:"Team Lead",description:"Manage team and team members",permissions:["team:read","team:update","user:read","user:update"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-4",name:"Member",description:"Basic member access",permissions:["user:read"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.rolesCache=[...this.systemRoles],this.rolesSubject=new n.BehaviorSubject(this.rolesCache),this.roles$=this.rolesSubject.asObservable(),this.loadCustomRoles()}loadCustomRoles(){this.auth0Api.listRoles().pipe((0,O.T)(e=>this.mapAuth0RolesToRoles(e)),(0,_.W)(e=>(console.error("Error loading custom roles from Auth0:",e),(0,n.of)([])))).subscribe(e=>{this.rolesCache=[...this.systemRoles,...e],this.rolesSubject.next(this.rolesCache)})}mapAuth0RolesToRoles(e){return e&&Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,description:t.description||"",permissions:[],isSystemRole:!1,createdAt:new Date,updatedAt:new Date})):[]}getAll(){return(0,n.of)(this.rolesCache)}getById(e){const t=this.rolesCache.find(s=>s.id===e);return(0,n.of)(t)}getSystemRoles(){const e=this.rolesCache.filter(t=>t.isSystemRole);return(0,n.of)(e)}getCustomRoles(){const e=this.rolesCache.filter(t=>!t.isSystemRole);return(0,n.of)(e)}create(e){return this.auth0Api.createRole({name:e.name,description:e.description}).pipe((0,O.T)(s=>{const h={id:s.id,name:s.name,description:s.description||"",permissions:e.permissions,isSystemRole:!1,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(h),this.rolesSubject.next(this.rolesCache),h}),(0,_.W)(s=>{console.error("Error creating role in Auth0:",s);const h={...e,id:`role-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(h),this.rolesSubject.next(this.rolesCache),(0,n.of)(h)}))}update(e,t){const s=this.rolesCache.findIndex(h=>h.id===e);return-1===s||this.rolesCache[s].isSystemRole?(0,n.of)(null):(this.rolesCache[s]={...this.rolesCache[s],...t,updatedAt:new Date},this.rolesSubject.next(this.rolesCache),(0,n.of)(this.rolesCache[s]))}delete(e){const t=this.rolesCache.findIndex(s=>s.id===e);return-1===t||this.rolesCache[t].isSystemRole?(0,n.of)(!1):(this.rolesCache.splice(t,1),this.rolesSubject.next(this.rolesCache),(0,n.of)(!0))}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(T))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},8399:(v,p,r)=>{r.d(p,{_:()=>m});var a=r(6129);class m{constructor(n,l=m.now){this.schedulerActionCtor=n,this.now=l}schedule(n,l=0,u){return new this.schedulerActionCtor(this,n).schedule(u,l)}}m.now=a.U.now},2688:(v,p,r)=>{r.d(p,{x:()=>n});var a=r(9131),m=r(9326),f=r(9724);function n(...l){return(0,a.K)()((0,f.H)(l,(0,m.lI)(l)))}},983:(v,p,r)=>{r.d(p,{I:()=>f,w:()=>m});var a=r(1985);const m=new a.c(l=>l.complete());function f(l){return l?function n(l){return new a.c(u=>l.schedule(()=>u.complete()))}(l):m}},9724:(v,p,r)=>{r.d(p,{H:()=>f});var a=r(5894),m=r(8750);function f(n,l){return l?(0,a.c)(n,l):(0,m.Tg)(n)}},1807:(v,p,r)=>{r.d(p,{O:()=>l});var a=r(1985),m=r(3236),f=r(9470),n=r(8211);function l(u=0,o,d=m.b){let c=-1;return null!=o&&((0,f.m)(o)?d=o:c=o),new a.c(E=>{let A=(0,n.v)(u)?+u-d.now():u;A<0&&(A=0);let D=0;return d.schedule(function(){E.closed||(E.next(D++),0<=c?this.schedule(void 0,c):E.complete())},A)})}},9437:(v,p,r)=>{r.d(p,{W:()=>n});var a=r(8750),m=r(4360),f=r(9974);function n(l){return(0,f.N)((u,o)=>{let E,d=null,c=!1;d=u.subscribe((0,m._)(o,void 0,void 0,A=>{E=(0,a.Tg)(l(A,n(l)(u))),d?(d.unsubscribe(),d=null,E.subscribe(o)):c=!0})),c&&(d.unsubscribe(),d=null,E.subscribe(o))})}},9131:(v,p,r)=>{r.d(p,{K:()=>m});var a=r(6365);function m(){return(0,a.U)(1)}},3103:(v,p,r)=>{r.d(p,{c:()=>n});var a=r(3236),m=r(3183),f=r(1807);function n(l,u=a.E){const o=(0,f.O)(l,u);return(0,m.o)(()=>o)}},3183:(v,p,r)=>{r.d(p,{o:()=>o});var a=r(2688),m=r(6697),f=r(3557),n=r(3703),l=r(3028),u=r(8750);function o(d,c){return c?E=>(0,a.x)(c.pipe((0,m.s)(1),(0,f.w)()),E.pipe(o(d))):(0,l.Z)((E,A)=>(0,u.Tg)(d(E,A)).pipe((0,m.s)(1),(0,n.u)(E)))}},3557:(v,p,r)=>{r.d(p,{w:()=>n});var a=r(9974),m=r(4360),f=r(5343);function n(){return(0,a.N)((l,u)=>{l.subscribe((0,m._)(u,f.l))})}},3703:(v,p,r)=>{r.d(p,{u:()=>m});var a=r(6354);function m(f){return(0,a.T)(()=>f)}},6365:(v,p,r)=>{r.d(p,{U:()=>f});var a=r(3028),m=r(3669);function f(n=1/0){return(0,a.Z)(m.D,n)}},5412:(v,p,r)=>{r.d(p,{h:()=>n});var a=r(8750),m=r(5225),f=r(4360);function n(l,u,o,d,c,E,A,D){const S=[];let P=0,R=0,O=!1;const _=()=>{O&&!S.length&&!P&&u.complete()},T=I=>P<d?M(I):S.push(I),M=I=>{E&&u.next(I),P++;let C=!1;(0,a.Tg)(o(I,R++)).subscribe((0,f._)(u,y=>{c?.(y),E?T(y):u.next(y)},()=>{C=!0},void 0,()=>{if(C)try{for(P--;S.length&&P<d;){const y=S.shift();A?(0,m.N)(u,A,()=>M(y)):M(y)}_()}catch(y){u.error(y)}}))};return l.subscribe((0,f._)(u,T,()=>{O=!0,_()})),()=>{D?.()}}},3028:(v,p,r)=>{r.d(p,{Z:()=>u});var a=r(6354),m=r(8750),f=r(9974),n=r(5412),l=r(8071);function u(o,d,c=1/0){return(0,l.T)(d)?u((E,A)=>(0,a.T)((D,S)=>d(E,D,A,S))((0,m.Tg)(o(E,A))),c):("number"==typeof d&&(c=d),(0,f.N)((E,A)=>(0,n.h)(E,A,o,c)))}},941:(v,p,r)=>{r.d(p,{Q:()=>n});var a=r(5225),m=r(9974),f=r(4360);function n(l,u=0){return(0,m.N)((o,d)=>{o.subscribe((0,f._)(d,c=>(0,a.N)(d,l,()=>d.next(c),u),()=>(0,a.N)(d,l,()=>d.complete(),u),c=>(0,a.N)(d,l,()=>d.error(c),u)))})}},6745:(v,p,r)=>{r.d(p,{_:()=>m});var a=r(9974);function m(f,n=0){return(0,a.N)((l,u)=>{u.add(f.schedule(()=>l.subscribe(u),n))})}},6697:(v,p,r)=>{r.d(p,{s:()=>n});var a=r(983),m=r(9974),f=r(4360);function n(l){return l<=0?()=>a.w:(0,m.N)((u,o)=>{let d=0;u.subscribe((0,f._)(o,c=>{++d<=l&&(o.next(c),l<=d&&o.complete())}))})}},7119:(v,p,r)=>{r.d(p,{S:()=>l});var a=r(1985),m=r(4761),f=r(8071),n=r(5225);function l(u,o){return new a.c(d=>{let c;return(0,n.N)(d,o,()=>{c=u[m.l](),(0,n.N)(d,o,()=>{let E,A;try{({value:E,done:A}=c.next())}catch(D){return void d.error(D)}A?d.complete():d.next(E)},0,!0)}),()=>(0,f.T)(c?.return)&&c.return()})}},5894:(v,p,r)=>{r.d(p,{c:()=>M});var a=r(8750),m=r(941),f=r(6745),u=r(1985),d=r(7119),c=r(5225);function E(I,C){if(!I)throw new Error("Iterable cannot be null");return new u.c(y=>{(0,c.N)(y,C,()=>{const i=I[Symbol.asyncIterator]();(0,c.N)(y,C,()=>{i.next().then(x=>{x.done?y.complete():y.next(x.value)})},0,!0)})})}var A=r(5055),D=r(9858),S=r(7441),P=r(5397),R=r(7953),O=r(591),_=r(5196);function M(I,C){if(null!=I){if((0,A.l)(I))return function n(I,C){return(0,a.Tg)(I).pipe((0,f._)(C),(0,m.Q)(C))}(I,C);if((0,S.X)(I))return function o(I,C){return new u.c(y=>{let i=0;return C.schedule(function(){i===I.length?y.complete():(y.next(I[i++]),y.closed||this.schedule())})})}(I,C);if((0,D.y)(I))return function l(I,C){return(0,a.Tg)(I).pipe((0,f._)(C),(0,m.Q)(C))}(I,C);if((0,R.T)(I))return E(I,C);if((0,P.x)(I))return(0,d.S)(I,C);if((0,_.U)(I))return function T(I,C){return E((0,_.C)(I),C)}(I,C)}throw(0,O.L)(I)}},6780:(v,p,r)=>{r.d(p,{R:()=>l});var a=r(3961);class m extends a.yU{constructor(o,d){super()}schedule(o,d=0){return this}}const f={setInterval(u,o,...d){const{delegate:c}=f;return c?.setInterval?c.setInterval(u,o,...d):setInterval(u,o,...d)},clearInterval(u){const{delegate:o}=f;return(o?.clearInterval||clearInterval)(u)},delegate:void 0};var n=r(7908);class l extends m{constructor(o,d){super(o,d),this.scheduler=o,this.work=d,this.pending=!1}schedule(o,d=0){var c;if(this.closed)return this;this.state=o;const E=this.id,A=this.scheduler;return null!=E&&(this.id=this.recycleAsyncId(A,E,d)),this.pending=!0,this.delay=d,this.id=null!==(c=this.id)&&void 0!==c?c:this.requestAsyncId(A,this.id,d),this}requestAsyncId(o,d,c=0){return f.setInterval(o.flush.bind(o,this),c)}recycleAsyncId(o,d,c=0){if(null!=c&&this.delay===c&&!1===this.pending)return d;null!=d&&f.clearInterval(d)}execute(o,d){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const c=this._execute(o,d);if(c)return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(o,d){let E,c=!1;try{this.work(o)}catch(A){c=!0,E=A||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),E}unsubscribe(){if(!this.closed){const{id:o,scheduler:d}=this,{actions:c}=d;this.work=this.state=this.scheduler=null,this.pending=!1,(0,n.o)(c,this),null!=o&&(this.id=this.recycleAsyncId(d,o,null)),this.delay=null,super.unsubscribe()}}}},707:(v,p,r)=>{r.d(p,{q:()=>m});var a=r(8399);class m extends a._{constructor(n,l=a._.now){super(n,l),this.actions=[],this._active=!1}flush(n){const{actions:l}=this;if(this._active)return void l.push(n);let u;this._active=!0;do{if(u=n.execute(n.state,n.delay))break}while(n=l.shift());if(this._active=!1,u){for(;n=l.shift();)n.unsubscribe();throw u}}}},3236:(v,p,r)=>{r.d(p,{E:()=>f,b:()=>n});var a=r(6780);const f=new(r(707).q)(a.R),n=f},6129:(v,p,r)=>{r.d(p,{U:()=>a});const a={now:()=>(a.delegate||Date).now(),delegate:void 0}},9326:(v,p,r)=>{r.d(p,{R0:()=>u,lI:()=>l,ms:()=>n});var a=r(8071),m=r(9470);function f(o){return o[o.length-1]}function n(o){return(0,a.T)(f(o))?o.pop():void 0}function l(o){return(0,m.m)(f(o))?o.pop():void 0}function u(o,d){return"number"==typeof f(o)?o.pop():d}},5225:(v,p,r)=>{function a(m,f,n,l=0,u=!1){const o=f.schedule(function(){n(),u?m.add(this.schedule(null,l)):this.unsubscribe()},l);if(m.add(o),!u)return o}r.d(p,{N:()=>a})},8211:(v,p,r)=>{function a(m){return m instanceof Date&&!isNaN(m)}r.d(p,{v:()=>a})},9470:(v,p,r)=>{r.d(p,{m:()=>m});var a=r(8071);function m(f){return f&&(0,a.T)(f.schedule)}},467:(v,p,r)=>{function a(f,n,l,u,o,d,c){try{var E=f[d](c),A=E.value}catch(D){return void l(D)}E.done?n(A):Promise.resolve(A).then(u,o)}function m(f){return function(){var n=this,l=arguments;return new Promise(function(u,o){var d=f.apply(n,l);function c(A){a(d,u,o,c,E,"next",A)}function E(A){a(d,u,o,c,E,"throw",A)}c(void 0)})}}r.d(p,{A:()=>m})}}]);