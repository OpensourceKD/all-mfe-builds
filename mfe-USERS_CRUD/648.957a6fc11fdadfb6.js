(self.webpackChunkmfe_USERS_CRUD=self.webpackChunkmfe_USERS_CRUD||[]).push([[648],{6648:(D,f,r)=>{r.r(f),r.d(f,{AUTH0_CONFIG:()=>d,Auth0ApiService:()=>T,AuthService:()=>o,CoreServicesComponent:()=>u,CoreServicesService:()=>m,OrganizationService:()=>M,ProductCategory:()=>O,RoleManagementService:()=>y,RoleService:()=>A,SalesDataService:()=>P,SalesStatus:()=>v,SystemRole:()=>R,TeamService:()=>I,UserRole:()=>c,UserService:()=>C});var a=r(4332);let m=(()=>{class i{constructor(){}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var p=r(467),n=r(3425);const d={useRealAuth0:!0,domain:"dev-26sow24tone5na8a.us.auth0.com",clientId:"lT0H33rFRamTUtbbXwPwO7M0SdT8Qq26",redirectUri:"https://opensourcekd.github.io/all-mfe-builds/mfe-USERS_CRUD/",scope:"openid profile email read:users create:users update:users delete:users",audience:void 0,managementApiAudience:"https://dev-26sow24tone5na8a.us.auth0.com/api/v2/"};var l=r(4230);let o=(()=>{class i{get domain(){return d.domain}get clientId(){return d.clientId}get redirectUri(){return d.redirectUri}get scope(){return d.scope}get audience(){return d.managementApiAudience}constructor(e){this.http=e,this.id="auth of pokemon",this.TOKEN_KEY="auth0_token",this.USER_INFO_KEY="auth0_user_info",this.userSubject=new n.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("In constructor of auth service in pokemon")}login(e){e&&console.log(`[AuthService] Logged in: ${e}`),this.redirectToAuth0Login()}redirectToAuth0Login(){const e=new URL(`https://${this.domain}/authorize`),t=this.generateRandomState(),s=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",t),sessionStorage.setItem("code_verifier",s),e.searchParams.append("client_id",this.clientId),e.searchParams.append("redirect_uri",this.redirectUri),e.searchParams.append("response_type","code"),e.searchParams.append("scope",this.scope),e.searchParams.append("state",t),this.audience&&e.searchParams.append("audience",this.audience),window.location.href=e.toString()}handleCallback(e,t){var s=this;return(0,p.A)(function*(){const h=sessionStorage.getItem("oauth_state");if(t!==h)return console.error("State mismatch - possible CSRF attack"),!1;try{const g=yield s.exchangeCodeForToken(e);s.setToken(g.access_token);const U=s.decodeIdToken(g.id_token);return s.setUserInfo(U),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(g){return console.error("Error exchanging code for token:",g),!1}})()}exchangeCodeForToken(e){var t=this;return(0,p.A)(function*(){const s=`https://${t.domain}/oauth/token`,h=new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:t.redirectUri,client_id:t.clientId}),g=yield fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:h.toString()});if(!g.ok)throw new Error(`Token exchange failed: ${g.statusText}`);return g.json()})()}decodeIdToken(e){try{const t=e.split(".")[1],s=JSON.parse(atob(t));return{sub:s.sub,name:s.name,email:s.email}}catch(t){return console.error("Error decoding ID token:",t),{sub:""}}}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),this.userSubject.next(null);const e=`https://${this.domain}/v2/logout?client_id=${this.clientId}&returnTo=${encodeURIComponent(this.redirectUri)}`;window.location.href=e}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}getUserInfoFromStorage(){const e=localStorage.getItem(this.USER_INFO_KEY);return e?JSON.parse(e):null}setUserInfo(e){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(e)),this.userSubject.next(e)}generateRandomState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(l.HttpClient))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),u=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:i,selectors:[["org-core-services"]],standalone:!0,features:[a.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(t,s){1&t&&(a.\u0275\u0275elementStart(0,"p"),a.\u0275\u0275text(1," core-services works! "),a.\u0275\u0275elementEnd())}})}}return i})();var c=function(i){return i.SUPER_ADMIN="super-admin",i.ORG_ADMIN="org-admin",i.TEAM_LEAD="team-lead",i.SALES_EXECUTIVE="sales-executive",i}(c||{});let A=(()=>{class i{constructor(e){this.currentUserSubject=new n.BehaviorSubject(this.getDummyUser()),this.currentUser$=this.currentUserSubject.asObservable(),this.dataService=e}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(e){this.currentUserSubject.next(e)}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){const t=this.getCurrentUser();return!!t&&e.includes(t.role)}isAdmin(){return this.hasAnyRole([c.SUPER_ADMIN,c.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([c.SUPER_ADMIN,c.ORG_ADMIN,c.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:c.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:c.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:c.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const t=this.getAllUsers();return this.isTeamLeadOrHigher()?t.filter(s=>s.role===c.SALES_EXECUTIVE||s.id===e.id):t.filter(s=>s.id===e.id)}getDummyUser(){return{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:c.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var E=r(3103),v=function(i){return i.COMPLETED="completed",i.PENDING="pending",i.CANCELLED="cancelled",i}(v||{}),O=function(i){return i.ELECTRONICS="Electronics",i.SOFTWARE="Software",i.SERVICES="Services",i.HARDWARE="Hardware",i}(O||{});let P=(()=>{class i{constructor(e){this.dummySalesData=this.generateDummyData(),this.dataService=e}getSalesHistory(e,t,s){if(this.dataService)return this.dataService.getSalesHistory(e,t,s);let h=this.dummySalesData.filter(g=>g.salesExecutiveId===e);return t&&(h=h.filter(g=>g.date>=t)),s&&(h=h.filter(g=>g.date<=s)),(0,n.of)(h).pipe((0,E.c)(300))}getSalesSummary(e){if(this.dataService)return this.dataService.getSalesSummary(e);const t=this.dummySalesData.filter(h=>h.salesExecutiveId===e),s={totalSales:t.filter(h=>h.status===v.COMPLETED).reduce((h,g)=>h+g.amount,0),totalCommission:t.filter(h=>h.status===v.COMPLETED).reduce((h,g)=>h+g.commission,0),completedCount:t.filter(h=>h.status===v.COMPLETED).length,pendingCount:t.filter(h=>h.status===v.PENDING).length,cancelledCount:t.filter(h=>h.status===v.CANCELLED).length};return(0,n.of)(s).pipe((0,E.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,n.of)(this.dummySalesData).pipe((0,E.c)(300))}generateDummyData(){const e=[{name:"Enterprise Software License",category:O.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:O.SERVICES,basePrice:25e3},{name:"Server Hardware",category:O.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:O.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:O.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:O.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:O.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:O.HARDWARE,basePrice:6e4}],t=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],s=["North","South","East","West","Central"],h=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],g=[v.COMPLETED,v.COMPLETED,v.COMPLETED,v.PENDING,v.CANCELLED],U=[];let B=1;for(let b=0;b<50;b++){const w=h[b%h.length],L=e[Math.floor(Math.random()*e.length)],j=t[Math.floor(Math.random()*t.length)],K=s[Math.floor(Math.random()*s.length)],N=g[Math.floor(Math.random()*g.length)],z=L.basePrice+(1e4*Math.random()-5e3),$=.05*z,x=new Date;x.setDate(x.getDate()-Math.floor(180*Math.random())),U.push({id:"sale-"+B++,salesExecutiveId:w.id,salesExecutiveName:w.name,productName:L.name,productCategory:L.category,amount:Math.round(z),commission:Math.round($),status:N,date:x,clientName:j,region:K})}return U.sort((b,w)=>w.date.getTime()-b.date.getTime())}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var R=function(i){return i.SUPER_ADMIN="super-admin",i.ORG_ADMIN="org-admin",i.TEAM_LEAD="team-lead",i.MEMBER="member",i}(R||{}),S=r(6354),_=r(9437);let T=(()=>{class i{get domain(){return d.domain}get managementApiUrl(){return`https://${this.domain}/api/v2`}constructor(e,t){this.http=e,this.authService=t}getHeaders(){const e=this.authService.getToken();return new l.HttpHeaders({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}getCurrentUser(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}getUserInfo(){return this.http.get(`https://${this.domain}/userinfo`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}listUsers(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/users?${t}`:`${this.managementApiUrl}/users`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}getUserById(e){return this.http.get(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}createUser(e){return this.http.post(`${this.managementApiUrl}/users`,e,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}updateUser(e,t){return this.http.patch(`${this.managementApiUrl}/users/${e}`,t,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}deleteUser(e){return this.http.delete(`${this.managementApiUrl}/users/${e}`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}blockUser(e,t=!0){return this.http.patch(`${this.managementApiUrl}/users/${e}`,{blocked:t},{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}listOrganizations(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/organizations?${t}`:`${this.managementApiUrl}/organizations`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}getOrganizationById(e){return this.http.get(`${this.managementApiUrl}/organizations/${e}`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}createOrganization(e){return this.http.post(`${this.managementApiUrl}/organizations`,e,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}updateOrganization(e,t){return this.http.patch(`${this.managementApiUrl}/organizations/${e}`,t,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}listRoles(e){const t=new URLSearchParams(e||{}).toString();return this.http.get(t?`${this.managementApiUrl}/roles?${t}`:`${this.managementApiUrl}/roles`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}getRoleById(e){return this.http.get(`${this.managementApiUrl}/roles/${e}`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}createRole(e){return this.http.post(`${this.managementApiUrl}/roles`,e,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}updateRole(e,t){return this.http.patch(`${this.managementApiUrl}/roles/${e}`,t,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}listUserRoles(e){return this.http.get(`${this.managementApiUrl}/users/${e}/roles`,{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}assignRolesToUser(e,t){return this.http.post(`${this.managementApiUrl}/users/${e}/roles`,{roles:t},{headers:this.getHeaders()}).pipe((0,_.W)(this.handleError))}handleError(e){return console.error("Auth0 API Error:",e),(0,n.throwError)(()=>e)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(l.HttpClient),a.\u0275\u0275inject(o))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),M=(()=>{class i{constructor(e){this.auth0Api=e,this.organizationsCache=[],this.organizationsSubject=new n.BehaviorSubject([]),this.organizations$=this.organizationsSubject.asObservable(),this.loadOrganizations()}loadOrganizations(){if(!d.useRealAuth0)return this.organizationsCache=this.getDummyOrganizations(),void this.organizationsSubject.next(this.organizationsCache);this.auth0Api.listOrganizations().pipe((0,S.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,_.W)(e=>(console.error("Error loading organizations from Auth0:",e),(0,n.of)([])))).subscribe(e=>{this.organizationsCache=e,this.organizationsSubject.next(this.organizationsCache)})}getDummyOrganizations(){return[{id:"org1",name:"Acme Corporation",description:"Leading technology company",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}},{id:"org2",name:"Global Tech Inc",description:"Innovation in software development",createdAt:new Date("2024-02-01"),updatedAt:new Date("2024-02-01"),isActive:!0,settings:{timezone:"UTC",currency:"EUR",locale:"en-GB"}}]}mapAuth0OrgsToOrganizations(e){return e&&Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,description:t.display_name||t.name,createdAt:t.created_at?new Date(t.created_at):new Date,updatedAt:t.updated_at?new Date(t.updated_at):new Date,isActive:!0,settings:{timezone:"UTC",currency:"USD",locale:"en-US"}})):[]}getAll(){return d.useRealAuth0?this.auth0Api.listOrganizations().pipe((0,S.T)(e=>this.mapAuth0OrgsToOrganizations(e)),(0,_.W)(e=>(console.error("Error getting organizations:",e),(0,n.of)(this.organizationsCache)))):(0,n.of)(this.organizationsCache)}getById(e){return this.getAll().pipe((0,S.T)(t=>t.find(s=>s.id===e)))}create(e){return this.auth0Api.createOrganization({name:e.name,display_name:e.description}).pipe((0,S.T)(s=>{const h={id:s.id,name:s.name,description:s.display_name||s.name,createdAt:new Date(s.created_at),updatedAt:new Date(s.updated_at||s.created_at),isActive:!0,settings:e.settings||{timezone:"UTC",currency:"USD",locale:"en-US"}};return this.organizationsCache.push(h),this.organizationsSubject.next(this.organizationsCache),h}),(0,_.W)(s=>{console.error("Creating organizations in Auth0 requires admin privileges:",s);const h={...e,id:`org-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return(0,n.of)(h)}))}update(e,t){const s={};return t.name&&(s.name=t.name),t.description&&(s.display_name=t.description),this.auth0Api.updateOrganization(e,s).pipe((0,S.T)(h=>{const g=this.organizationsCache.findIndex(U=>U.id===e);return-1!==g?(this.organizationsCache[g]={...this.organizationsCache[g],...t,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),this.organizationsCache[g]):null}),(0,_.W)(h=>{console.warn("Updating organizations in Auth0 requires specific permissions:",h);const g=this.organizationsCache.findIndex(U=>U.id===e);return-1!==g?(this.organizationsCache[g]={...this.organizationsCache[g],...t,updatedAt:new Date},this.organizationsSubject.next(this.organizationsCache),(0,n.of)(this.organizationsCache[g])):(0,n.of)(null)}))}delete(e){return console.warn("Deleting organizations should be done with caution and may not be supported via Auth0 API"),(0,n.of)(!1)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(T))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),I=(()=>{class i{constructor(e){this.auth0Api=e,this.teamsCache=[],this.teamsSubject=new n.BehaviorSubject([]),this.teams$=this.teamsSubject.asObservable(),this.loadTeams()}loadTeams(){if(!d.useRealAuth0)return this.teamsCache=this.getDummyTeams(),void this.teamsSubject.next(this.teamsCache);this.teamsCache=[],this.teamsSubject.next(this.teamsCache)}getDummyTeams(){return[{id:"team1",name:"Engineering",description:"Engineering team",organizationId:"org1",leadId:"1",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team2",name:"Product",description:"Product team",organizationId:"org1",leadId:"2",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0},{id:"team3",name:"Design",description:"Design team",organizationId:"org2",leadId:"3",createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),isActive:!0}]}getAll(){return(0,n.of)(this.teamsCache)}getByOrganization(e){return this.getAll().pipe((0,S.T)(t=>t.filter(s=>s.organizationId===e)))}getById(e){const t=this.teamsCache.find(s=>s.id===e);return(0,n.of)(t)}create(e){const t={id:`team-${Date.now()}`,name:e.name,description:e.description,organizationId:e.organizationId,leadId:e.leadId,createdAt:new Date,updatedAt:new Date,isActive:!0};return this.teamsCache.push(t),this.teamsSubject.next(this.teamsCache),(0,n.of)(t)}update(e,t){const s=this.teamsCache.findIndex(h=>h.id===e);return-1!==s?(this.teamsCache[s]={...this.teamsCache[s],...t,updatedAt:new Date},this.teamsSubject.next(this.teamsCache),(0,n.of)(this.teamsCache[s])):(0,n.of)(null)}delete(e){const t=this.teamsCache.findIndex(s=>s.id===e);return-1!==t?(this.teamsCache[t].isActive=!1,this.teamsCache[t].updatedAt=new Date,this.teamsSubject.next(this.teamsCache),(0,n.of)(!0)):(0,n.of)(!1)}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(T))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),C=(()=>{class i{constructor(e){this.auth0Api=e,this.usersCache=[],this.usersSubject=new n.BehaviorSubject([]),this.users$=this.usersSubject.asObservable(),this.currentAuth0User=null,this.loadUsers()}loadUsers(){if(!d.useRealAuth0)return this.usersCache=this.getDummyUsers(),void this.usersSubject.next(this.usersCache);this.auth0Api.listUsers().pipe((0,_.W)(e=>(console.error("Error loading users from Auth0 Management API:",e),(0,n.forkJoin)({authUser:this.auth0Api.getCurrentUser().pipe((0,_.W)(()=>(0,n.of)(null))),userInfo:this.auth0Api.getUserInfo().pipe((0,_.W)(()=>(0,n.of)(null)))}).pipe((0,S.T)(({authUser:t,userInfo:s})=>{const h=t||s;return h?[h]:[]}))))).subscribe(e=>{e&&e.length>0?(this.usersCache=this.mapAuth0UsersToUsers(e),this.usersCache.length>0&&(this.currentAuth0User=this.usersCache[0]),this.usersSubject.next(this.usersCache)):(console.warn("No users returned from Auth0 API"),this.usersCache=[],this.usersSubject.next(this.usersCache))})}getDummyUsers(){return[{id:"1",name:"John Doe",email:"john.doe@example.com",organizationId:"org1",teamId:"team1",roleId:"super-admin",isActive:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"2",name:"Jane Smith",email:"jane.smith@example.com",organizationId:"org1",teamId:"team2",roleId:"org-admin",isActive:!0,createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-02-10")},{id:"3",name:"Bob Johnson",email:"bob.johnson@example.com",organizationId:"org2",teamId:"team3",roleId:"team-lead",isActive:!0,createdAt:new Date("2024-03-05"),updatedAt:new Date("2024-03-05")},{id:"4",name:"Alice Brown",email:"alice.brown@example.com",organizationId:"org1",teamId:"team1",roleId:"member",isActive:!1,createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-05-10")}]}mapAuth0UserToUser(e){return e?{id:e.user_id||e.sub||"1",name:this.extractUserName(e),email:e.email||"user@example.com",organizationId:e.org_id||"default-org",teamId:"default-team",roleId:"member",isActive:!e.blocked,createdAt:e.created_at?new Date(e.created_at):new Date,updatedAt:e.updated_at?new Date(e.updated_at):new Date,auth0UserId:e.user_id||e.sub}:this.getDummyUsers()[0]}extractUserName(e){return e.name?e.name:e.nickname?e.nickname:`${e.given_name||""} ${e.family_name||""}`.trim()||(e.email?e.email.split("@")[0]:`User ${e.user_id||e.sub}`)}mapAuth0UsersToUsers(e){return e&&Array.isArray(e)?e.map(t=>({id:t.user_id,name:this.extractUserName(t),email:t.email||"",organizationId:t.org_id||"default-org",teamId:"default-team",roleId:"default-role",isActive:!t.blocked,createdAt:t.created_at?new Date(t.created_at):new Date,updatedAt:t.updated_at?new Date(t.updated_at):new Date,auth0UserId:t.user_id})):[]}mapUserToAuth0Format(e){return{email:e.email,name:e.name,nickname:e.name,blocked:!e.isActive,connection:"Username-Password-Authentication",email_verified:!1,user_metadata:{organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId}}}getAll(){return(0,n.of)(this.usersCache)}getCurrentAuth0User(){return this.currentAuth0User}getByOrganization(e){return this.getAll().pipe((0,S.T)(t=>t.filter(s=>s.organizationId===e)))}getByTeam(e){return this.getAll().pipe((0,S.T)(t=>t.filter(s=>s.teamId===e)))}getById(e){const t=this.usersCache.find(s=>s.id===e);return t?(0,n.of)(t):this.auth0Api.getUserById(e).pipe((0,S.T)(s=>{const h=this.mapAuth0UsersToUsers([s]);return h.length>0?h[0]:void 0}),(0,_.W)(s=>(console.error("Error getting user by ID (Management API not available):",s),(0,n.of)(void 0))))}create(e){const t=this.mapUserToAuth0Format(e);return this.auth0Api.createUser(t).pipe((0,S.T)(s=>{const h={id:s.user_id||`user-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date,auth0UserId:s.user_id};return this.usersCache.push(h),this.usersSubject.next(this.usersCache),h}),(0,_.W)(s=>{console.error("Error creating user (Management API not available):",s);const h={id:`local-${Date.now()}`,name:e.name,email:e.email,organizationId:e.organizationId,teamId:e.teamId,roleId:e.roleId,isActive:e.isActive,createdAt:new Date,updatedAt:new Date};return this.usersCache.push(h),this.usersSubject.next(this.usersCache),(0,n.of)(h)}))}update(e,t){const s=this.mapUserToAuth0Format(t);return this.auth0Api.updateUser(e,s).pipe((0,S.T)(h=>{const g=this.usersCache.findIndex(U=>U.id===e);return-1!==g?(this.usersCache[g]={...this.usersCache[g],...t,updatedAt:new Date},this.usersSubject.next(this.usersCache),this.usersCache[g]):null}),(0,_.W)(h=>{console.error("Error updating user (Management API not available):",h);const g=this.usersCache.findIndex(U=>U.id===e);return-1!==g?(this.usersCache[g]={...this.usersCache[g],...t,updatedAt:new Date},this.usersSubject.next(this.usersCache),(0,n.of)(this.usersCache[g])):(0,n.of)(null)}))}delete(e){return this.auth0Api.blockUser(e,!0).pipe((0,S.T)(()=>{const t=this.usersCache.findIndex(s=>s.id===e);return-1!==t&&(this.usersCache[t].isActive=!1,this.usersCache[t].updatedAt=new Date,this.usersSubject.next(this.usersCache),!0)}),(0,_.W)(t=>{console.error("Error deleting user (Management API not available):",t);const s=this.usersCache.findIndex(h=>h.id===e);return-1!==s&&(this.usersCache[s].isActive=!1,this.usersCache[s].updatedAt=new Date,this.usersSubject.next(this.usersCache)),(0,n.of)(!0)}))}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(T))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),y=(()=>{class i{constructor(e){this.auth0Api=e,this.systemRoles=[{id:"role-1",name:"Super Admin",description:"Full system access",permissions:["*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-2",name:"Organization Admin",description:"Full access within organization",permissions:["org:*","team:*","user:*"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-3",name:"Team Lead",description:"Manage team and team members",permissions:["team:read","team:update","user:read","user:update"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")},{id:"role-4",name:"Member",description:"Basic member access",permissions:["user:read"],isSystemRole:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}],this.rolesCache=[...this.systemRoles],this.rolesSubject=new n.BehaviorSubject(this.rolesCache),this.roles$=this.rolesSubject.asObservable(),this.loadCustomRoles()}loadCustomRoles(){if(!d.useRealAuth0)return this.rolesCache=[...this.systemRoles],void this.rolesSubject.next(this.rolesCache);this.auth0Api.listRoles().pipe((0,S.T)(e=>this.mapAuth0RolesToRoles(e)),(0,_.W)(e=>(console.error("Error loading custom roles from Auth0:",e),(0,n.of)([])))).subscribe(e=>{this.rolesCache=[...this.systemRoles,...e],this.rolesSubject.next(this.rolesCache)})}mapAuth0RolesToRoles(e){return e&&Array.isArray(e)?e.map(t=>({id:t.id,name:t.name,description:t.description||"",permissions:[],isSystemRole:!1,createdAt:new Date,updatedAt:new Date})):[]}getAll(){return(0,n.of)(this.rolesCache)}getById(e){const t=this.rolesCache.find(s=>s.id===e);return(0,n.of)(t)}getSystemRoles(){const e=this.rolesCache.filter(t=>t.isSystemRole);return(0,n.of)(e)}getCustomRoles(){const e=this.rolesCache.filter(t=>!t.isSystemRole);return(0,n.of)(e)}create(e){return this.auth0Api.createRole({name:e.name,description:e.description}).pipe((0,S.T)(s=>{const h={id:s.id,name:s.name,description:s.description||"",permissions:e.permissions,isSystemRole:!1,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(h),this.rolesSubject.next(this.rolesCache),h}),(0,_.W)(s=>{console.error("Error creating role in Auth0:",s);const h={...e,id:`role-${Date.now()}`,createdAt:new Date,updatedAt:new Date};return this.rolesCache.push(h),this.rolesSubject.next(this.rolesCache),(0,n.of)(h)}))}update(e,t){const s=this.rolesCache.findIndex(h=>h.id===e);return-1===s||this.rolesCache[s].isSystemRole?(0,n.of)(null):(this.rolesCache[s]={...this.rolesCache[s],...t,updatedAt:new Date},this.rolesSubject.next(this.rolesCache),(0,n.of)(this.rolesCache[s]))}delete(e){const t=this.rolesCache.findIndex(s=>s.id===e);return-1===t||this.rolesCache[t].isSystemRole?(0,n.of)(!1):(this.rolesCache.splice(t,1),this.rolesSubject.next(this.rolesCache),(0,n.of)(!0))}static{this.\u0275fac=function(t){return new(t||i)(a.\u0275\u0275inject(T))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},8399:(D,f,r)=>{r.d(f,{_:()=>m});var a=r(6129);class m{constructor(n,d=m.now){this.schedulerActionCtor=n,this.now=d}schedule(n,d=0,l){return new this.schedulerActionCtor(this,n).schedule(l,d)}}m.now=a.U.now},2688:(D,f,r)=>{r.d(f,{x:()=>n});var a=r(9131),m=r(9326),p=r(9724);function n(...d){return(0,a.K)()((0,p.H)(d,(0,m.lI)(d)))}},983:(D,f,r)=>{r.d(f,{I:()=>p,w:()=>m});var a=r(1985);const m=new a.c(d=>d.complete());function p(d){return d?function n(d){return new a.c(l=>d.schedule(()=>l.complete()))}(d):m}},9724:(D,f,r)=>{r.d(f,{H:()=>p});var a=r(5894),m=r(8750);function p(n,d){return d?(0,a.c)(n,d):(0,m.Tg)(n)}},1807:(D,f,r)=>{r.d(f,{O:()=>d});var a=r(1985),m=r(3236),p=r(9470),n=r(8211);function d(l=0,o,u=m.b){let c=-1;return null!=o&&((0,p.m)(o)?u=o:c=o),new a.c(A=>{let E=(0,n.v)(l)?+l-u.now():l;E<0&&(E=0);let v=0;return u.schedule(function(){A.closed||(A.next(v++),0<=c?this.schedule(void 0,c):A.complete())},E)})}},9437:(D,f,r)=>{r.d(f,{W:()=>n});var a=r(8750),m=r(4360),p=r(9974);function n(d){return(0,p.N)((l,o)=>{let A,u=null,c=!1;u=l.subscribe((0,m._)(o,void 0,void 0,E=>{A=(0,a.Tg)(d(E,n(d)(l))),u?(u.unsubscribe(),u=null,A.subscribe(o)):c=!0})),c&&(u.unsubscribe(),u=null,A.subscribe(o))})}},9131:(D,f,r)=>{r.d(f,{K:()=>m});var a=r(6365);function m(){return(0,a.U)(1)}},3103:(D,f,r)=>{r.d(f,{c:()=>n});var a=r(3236),m=r(3183),p=r(1807);function n(d,l=a.E){const o=(0,p.O)(d,l);return(0,m.o)(()=>o)}},3183:(D,f,r)=>{r.d(f,{o:()=>o});var a=r(2688),m=r(6697),p=r(3557),n=r(3703),d=r(3028),l=r(8750);function o(u,c){return c?A=>(0,a.x)(c.pipe((0,m.s)(1),(0,p.w)()),A.pipe(o(u))):(0,d.Z)((A,E)=>(0,l.Tg)(u(A,E)).pipe((0,m.s)(1),(0,n.u)(A)))}},3557:(D,f,r)=>{r.d(f,{w:()=>n});var a=r(9974),m=r(4360),p=r(5343);function n(){return(0,a.N)((d,l)=>{d.subscribe((0,m._)(l,p.l))})}},3703:(D,f,r)=>{r.d(f,{u:()=>m});var a=r(6354);function m(p){return(0,a.T)(()=>p)}},6365:(D,f,r)=>{r.d(f,{U:()=>p});var a=r(3028),m=r(3669);function p(n=1/0){return(0,a.Z)(m.D,n)}},5412:(D,f,r)=>{r.d(f,{h:()=>n});var a=r(8750),m=r(5225),p=r(4360);function n(d,l,o,u,c,A,E,v){const O=[];let P=0,R=0,S=!1;const _=()=>{S&&!O.length&&!P&&l.complete()},T=I=>P<u?M(I):O.push(I),M=I=>{A&&l.next(I),P++;let C=!1;(0,a.Tg)(o(I,R++)).subscribe((0,p._)(l,y=>{c?.(y),A?T(y):l.next(y)},()=>{C=!0},void 0,()=>{if(C)try{for(P--;O.length&&P<u;){const y=O.shift();E?(0,m.N)(l,E,()=>M(y)):M(y)}_()}catch(y){l.error(y)}}))};return d.subscribe((0,p._)(l,T,()=>{S=!0,_()})),()=>{v?.()}}},3028:(D,f,r)=>{r.d(f,{Z:()=>l});var a=r(6354),m=r(8750),p=r(9974),n=r(5412),d=r(8071);function l(o,u,c=1/0){return(0,d.T)(u)?l((A,E)=>(0,a.T)((v,O)=>u(A,v,E,O))((0,m.Tg)(o(A,E))),c):("number"==typeof u&&(c=u),(0,p.N)((A,E)=>(0,n.h)(A,E,o,c)))}},941:(D,f,r)=>{r.d(f,{Q:()=>n});var a=r(5225),m=r(9974),p=r(4360);function n(d,l=0){return(0,m.N)((o,u)=>{o.subscribe((0,p._)(u,c=>(0,a.N)(u,d,()=>u.next(c),l),()=>(0,a.N)(u,d,()=>u.complete(),l),c=>(0,a.N)(u,d,()=>u.error(c),l)))})}},6745:(D,f,r)=>{r.d(f,{_:()=>m});var a=r(9974);function m(p,n=0){return(0,a.N)((d,l)=>{l.add(p.schedule(()=>d.subscribe(l),n))})}},6697:(D,f,r)=>{r.d(f,{s:()=>n});var a=r(983),m=r(9974),p=r(4360);function n(d){return d<=0?()=>a.w:(0,m.N)((l,o)=>{let u=0;l.subscribe((0,p._)(o,c=>{++u<=d&&(o.next(c),d<=u&&o.complete())}))})}},7119:(D,f,r)=>{r.d(f,{S:()=>d});var a=r(1985),m=r(4761),p=r(8071),n=r(5225);function d(l,o){return new a.c(u=>{let c;return(0,n.N)(u,o,()=>{c=l[m.l](),(0,n.N)(u,o,()=>{let A,E;try{({value:A,done:E}=c.next())}catch(v){return void u.error(v)}E?u.complete():u.next(A)},0,!0)}),()=>(0,p.T)(c?.return)&&c.return()})}},5894:(D,f,r)=>{r.d(f,{c:()=>M});var a=r(8750),m=r(941),p=r(6745),l=r(1985),u=r(7119),c=r(5225);function A(I,C){if(!I)throw new Error("Iterable cannot be null");return new l.c(y=>{(0,c.N)(y,C,()=>{const i=I[Symbol.asyncIterator]();(0,c.N)(y,C,()=>{i.next().then(W=>{W.done?y.complete():y.next(W.value)})},0,!0)})})}var E=r(5055),v=r(9858),O=r(7441),P=r(5397),R=r(7953),S=r(591),_=r(5196);function M(I,C){if(null!=I){if((0,E.l)(I))return function n(I,C){return(0,a.Tg)(I).pipe((0,p._)(C),(0,m.Q)(C))}(I,C);if((0,O.X)(I))return function o(I,C){return new l.c(y=>{let i=0;return C.schedule(function(){i===I.length?y.complete():(y.next(I[i++]),y.closed||this.schedule())})})}(I,C);if((0,v.y)(I))return function d(I,C){return(0,a.Tg)(I).pipe((0,p._)(C),(0,m.Q)(C))}(I,C);if((0,R.T)(I))return A(I,C);if((0,P.x)(I))return(0,u.S)(I,C);if((0,_.U)(I))return function T(I,C){return A((0,_.C)(I),C)}(I,C)}throw(0,S.L)(I)}},6780:(D,f,r)=>{r.d(f,{R:()=>d});var a=r(3961);class m extends a.yU{constructor(o,u){super()}schedule(o,u=0){return this}}const p={setInterval(l,o,...u){const{delegate:c}=p;return c?.setInterval?c.setInterval(l,o,...u):setInterval(l,o,...u)},clearInterval(l){const{delegate:o}=p;return(o?.clearInterval||clearInterval)(l)},delegate:void 0};var n=r(7908);class d extends m{constructor(o,u){super(o,u),this.scheduler=o,this.work=u,this.pending=!1}schedule(o,u=0){var c;if(this.closed)return this;this.state=o;const A=this.id,E=this.scheduler;return null!=A&&(this.id=this.recycleAsyncId(E,A,u)),this.pending=!0,this.delay=u,this.id=null!==(c=this.id)&&void 0!==c?c:this.requestAsyncId(E,this.id,u),this}requestAsyncId(o,u,c=0){return p.setInterval(o.flush.bind(o,this),c)}recycleAsyncId(o,u,c=0){if(null!=c&&this.delay===c&&!1===this.pending)return u;null!=u&&p.clearInterval(u)}execute(o,u){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const c=this._execute(o,u);if(c)return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(o,u){let A,c=!1;try{this.work(o)}catch(E){c=!0,A=E||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),A}unsubscribe(){if(!this.closed){const{id:o,scheduler:u}=this,{actions:c}=u;this.work=this.state=this.scheduler=null,this.pending=!1,(0,n.o)(c,this),null!=o&&(this.id=this.recycleAsyncId(u,o,null)),this.delay=null,super.unsubscribe()}}}},707:(D,f,r)=>{r.d(f,{q:()=>m});var a=r(8399);class m extends a._{constructor(n,d=a._.now){super(n,d),this.actions=[],this._active=!1}flush(n){const{actions:d}=this;if(this._active)return void d.push(n);let l;this._active=!0;do{if(l=n.execute(n.state,n.delay))break}while(n=d.shift());if(this._active=!1,l){for(;n=d.shift();)n.unsubscribe();throw l}}}},3236:(D,f,r)=>{r.d(f,{E:()=>p,b:()=>n});var a=r(6780);const p=new(r(707).q)(a.R),n=p},6129:(D,f,r)=>{r.d(f,{U:()=>a});const a={now:()=>(a.delegate||Date).now(),delegate:void 0}},9326:(D,f,r)=>{r.d(f,{R0:()=>l,lI:()=>d,ms:()=>n});var a=r(8071),m=r(9470);function p(o){return o[o.length-1]}function n(o){return(0,a.T)(p(o))?o.pop():void 0}function d(o){return(0,m.m)(p(o))?o.pop():void 0}function l(o,u){return"number"==typeof p(o)?o.pop():u}},5225:(D,f,r)=>{function a(m,p,n,d=0,l=!1){const o=p.schedule(function(){n(),l?m.add(this.schedule(null,d)):this.unsubscribe()},d);if(m.add(o),!l)return o}r.d(f,{N:()=>a})},8211:(D,f,r)=>{function a(m){return m instanceof Date&&!isNaN(m)}r.d(f,{v:()=>a})},9470:(D,f,r)=>{r.d(f,{m:()=>m});var a=r(8071);function m(p){return p&&(0,a.T)(p.schedule)}},467:(D,f,r)=>{function a(p,n,d,l,o,u,c){try{var A=p[u](c),E=A.value}catch(v){return void d(v)}A.done?n(E):Promise.resolve(E).then(l,o)}function m(p){return function(){var n=this,d=arguments;return new Promise(function(l,o){var u=p.apply(n,d);function c(E){a(u,l,o,c,A,"next",E)}function A(E){a(u,l,o,c,A,"throw",E)}c(void 0)})}}r.d(f,{A:()=>m})}}]);