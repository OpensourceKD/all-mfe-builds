(self.webpackChunkmfe_MY_SALES=self.webpackChunkmfe_MY_SALES||[]).push([[588],{2588:(D,u,e)=>{e.r(u),e.d(u,{AuthService:()=>i,CoreServicesComponent:()=>n,CoreServicesService:()=>o,ProductCategory:()=>S,RoleService:()=>l,SalesDataService:()=>P,SalesStatus:()=>m,UserRole:()=>t});var r=e(4332);let o=(()=>{class _{constructor(){}static{this.\u0275fac=function(h){return new(h||_)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})();var c=e(467),s=e(3425),a=e(4230);let i=(()=>{class _{constructor(d){this.http=d,this.id="auth of pokemon",this.ISSUER_BASE_URL="https://topfix-wrczmn.us1.zitadel.cloud",this.CLIENT_ID="336777344075263315",this.REDIRECT_URI="https://opensourcekd.github.io/i17e/auth-callback",this.SCOPE="openid profile email",this.TOKEN_KEY="zitadel_token",this.USER_INFO_KEY="zitadel_user_info",this.userSubject=new s.BehaviorSubject(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable()}login(d){this.redirectToZitadelLogin()}redirectToZitadelLogin(){const d=new URL(`${this.ISSUER_BASE_URL}/oauth/v2/authorize`),h=this.generateRandomState(),I=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",h),sessionStorage.setItem("code_verifier",I),d.searchParams.append("client_id",this.CLIENT_ID),d.searchParams.append("redirect_uri",this.REDIRECT_URI),d.searchParams.append("response_type","code"),d.searchParams.append("scope",this.SCOPE),d.searchParams.append("state",h),window.location.href=d.toString()}handleCallback(d,h){var I=this;return(0,c.A)(function*(){const v=sessionStorage.getItem("oauth_state");if(h!==v)return console.error("[AuthService] State mismatch - possible CSRF attack"),!1;try{const E=yield I.exchangeCodeForToken(d);I.setToken(E.access_token);const O=I.decodeIdToken(E.id_token);return I.setUserInfo(O),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),console.log("[AuthService] Authentication successful"),!0}catch(E){return console.error("[AuthService] Error exchanging code for token:",E),!1}})()}exchangeCodeForToken(d){var h=this;return(0,c.A)(function*(){const I=`${h.ISSUER_BASE_URL}/oauth/v2/token`,v=new URLSearchParams({grant_type:"authorization_code",code:d,redirect_uri:h.REDIRECT_URI,client_id:h.CLIENT_ID}),E=yield fetch(I,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:v.toString()});if(!E.ok)throw new Error(`Token exchange failed: ${E.statusText}`);return E.json()})()}decodeIdToken(d){try{const h=d.split(".")[1],I=JSON.parse(atob(h));return{sub:I.sub,name:I.name,email:I.email}}catch(h){return console.error("[AuthService] Error decoding ID token:",h),{sub:""}}}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),this.userSubject.next(null),console.log("[AuthService] User logged out")}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(d){localStorage.setItem(this.TOKEN_KEY,d)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}getUserInfoFromStorage(){const d=localStorage.getItem(this.USER_INFO_KEY);return d?JSON.parse(d):null}setUserInfo(d){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(d)),this.userSubject.next(d)}generateRandomState(){const d=new Uint8Array(32);return crypto.getRandomValues(d),Array.from(d,h=>h.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const d=new Uint8Array(32);return crypto.getRandomValues(d),Array.from(d,h=>h.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(h){return new(h||_)(r.\u0275\u0275inject(a.HttpClient))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})(),n=(()=>{class _{static{this.\u0275fac=function(h){return new(h||_)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:_,selectors:[["org-core-services"]],standalone:!0,features:[r.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(h,I){1&h&&(r.\u0275\u0275elementStart(0,"p"),r.\u0275\u0275text(1," core-services works! "),r.\u0275\u0275elementEnd())}})}}return _})();var t=function(_){return _.SUPER_ADMIN="super-admin",_.ORG_ADMIN="org-admin",_.TEAM_LEAD="team-lead",_.SALES_EXECUTIVE="sales-executive",_}(t||{});let l=(()=>{class _{constructor(){this.currentUserSubject=new s.BehaviorSubject(this.getDummyUser()),this.currentUser$=this.currentUserSubject.asObservable()}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(d){this.currentUserSubject.next(d)}hasRole(d){return this.getCurrentUser()?.role===d}hasAnyRole(d){const h=this.getCurrentUser();return!!h&&d.includes(h.role)}isAdmin(){return this.hasAnyRole([t.SUPER_ADMIN,t.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([t.SUPER_ADMIN,t.ORG_ADMIN,t.TEAM_LEAD])}getAllUsers(){return[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:t.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:t.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:t.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:t.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:t.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:t.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}]}getViewableUsers(){const d=this.getCurrentUser();if(!d)return[];const h=this.getAllUsers();return this.isTeamLeadOrHigher()?h.filter(I=>I.role===t.SALES_EXECUTIVE||I.id===d.id):h.filter(I=>I.id===d.id)}getDummyUser(){return{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:t.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}}static{this.\u0275fac=function(h){return new(h||_)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})();var f=e(3103),m=function(_){return _.COMPLETED="completed",_.PENDING="pending",_.CANCELLED="cancelled",_}(m||{}),S=function(_){return _.ELECTRONICS="Electronics",_.SOFTWARE="Software",_.SERVICES="Services",_.HARDWARE="Hardware",_}(S||{});let P=(()=>{class _{constructor(){this.dummySalesData=this.generateDummyData()}getSalesHistory(d,h,I){let v=this.dummySalesData.filter(E=>E.salesExecutiveId===d);return h&&(v=v.filter(E=>E.date>=h)),I&&(v=v.filter(E=>E.date<=I)),(0,s.of)(v).pipe((0,f.c)(300))}getSalesSummary(d){const h=this.dummySalesData.filter(v=>v.salesExecutiveId===d),I={totalSales:h.filter(v=>v.status===m.COMPLETED).reduce((v,E)=>v+E.amount,0),totalCommission:h.filter(v=>v.status===m.COMPLETED).reduce((v,E)=>v+E.commission,0),completedCount:h.filter(v=>v.status===m.COMPLETED).length,pendingCount:h.filter(v=>v.status===m.PENDING).length,cancelledCount:h.filter(v=>v.status===m.CANCELLED).length};return(0,s.of)(I).pipe((0,f.c)(300))}getAllSales(){return(0,s.of)(this.dummySalesData).pipe((0,f.c)(300))}generateDummyData(){const d=[{name:"Enterprise Software License",category:S.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:S.SERVICES,basePrice:25e3},{name:"Server Hardware",category:S.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:S.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:S.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:S.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:S.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:S.HARDWARE,basePrice:6e4}],h=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],I=["North","South","East","West","Central"],v=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],E=[m.COMPLETED,m.COMPLETED,m.COMPLETED,m.PENDING,m.CANCELLED],O=[];let M=1;for(let A=0;A<50;A++){const g=v[A%v.length],T=d[Math.floor(Math.random()*d.length)],y=h[Math.floor(Math.random()*h.length)],L=I[Math.floor(Math.random()*I.length)],p=E[Math.floor(Math.random()*E.length)],U=T.basePrice+(1e4*Math.random()-5e3),K=.05*U,R=new Date;R.setDate(R.getDate()-Math.floor(180*Math.random())),O.push({id:"sale-"+M++,salesExecutiveId:g.id,salesExecutiveName:g.name,productName:T.name,productCategory:T.category,amount:Math.round(U),commission:Math.round(K),status:p,date:R,clientName:y,region:L})}return O.sort((A,g)=>g.date.getTime()-A.date.getTime())}static{this.\u0275fac=function(h){return new(h||_)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},8399:(D,u,e)=>{e.d(u,{_:()=>o});var r=e(6129);class o{constructor(s,a=o.now){this.schedulerActionCtor=s,this.now=a}schedule(s,a=0,i){return new this.schedulerActionCtor(this,s).schedule(i,a)}}o.now=r.U.now},2688:(D,u,e)=>{e.d(u,{x:()=>s});var r=e(9131),o=e(9326),c=e(9724);function s(...a){return(0,r.K)()((0,c.H)(a,(0,o.lI)(a)))}},983:(D,u,e)=>{e.d(u,{I:()=>c,w:()=>o});var r=e(1985);const o=new r.c(a=>a.complete());function c(a){return a?function s(a){return new r.c(i=>a.schedule(()=>i.complete()))}(a):o}},9724:(D,u,e)=>{e.d(u,{H:()=>c});var r=e(5894),o=e(8750);function c(s,a){return a?(0,r.c)(s,a):(0,o.Tg)(s)}},1807:(D,u,e)=>{e.d(u,{O:()=>a});var r=e(1985),o=e(3236),c=e(9470),s=e(8211);function a(i=0,n,t=o.b){let l=-1;return null!=n&&((0,c.m)(n)?t=n:l=n),new r.c(f=>{let m=(0,s.v)(i)?+i-t.now():i;m<0&&(m=0);let S=0;return t.schedule(function(){f.closed||(f.next(S++),0<=l?this.schedule(void 0,l):f.complete())},m)})}},9131:(D,u,e)=>{e.d(u,{K:()=>o});var r=e(6365);function o(){return(0,r.U)(1)}},3103:(D,u,e)=>{e.d(u,{c:()=>s});var r=e(3236),o=e(3183),c=e(1807);function s(a,i=r.E){const n=(0,c.O)(a,i);return(0,o.o)(()=>n)}},3183:(D,u,e)=>{e.d(u,{o:()=>n});var r=e(2688),o=e(6697),c=e(3557),s=e(3703),a=e(3028),i=e(8750);function n(t,l){return l?f=>(0,r.x)(l.pipe((0,o.s)(1),(0,c.w)()),f.pipe(n(t))):(0,a.Z)((f,m)=>(0,i.Tg)(t(f,m)).pipe((0,o.s)(1),(0,s.u)(f)))}},3557:(D,u,e)=>{e.d(u,{w:()=>s});var r=e(9974),o=e(4360),c=e(5343);function s(){return(0,r.N)((a,i)=>{a.subscribe((0,o._)(i,c.l))})}},6354:(D,u,e)=>{e.d(u,{T:()=>c});var r=e(9974),o=e(4360);function c(s,a){return(0,r.N)((i,n)=>{let t=0;i.subscribe((0,o._)(n,l=>{n.next(s.call(a,l,t++))}))})}},3703:(D,u,e)=>{e.d(u,{u:()=>o});var r=e(6354);function o(c){return(0,r.T)(()=>c)}},6365:(D,u,e)=>{e.d(u,{U:()=>c});var r=e(3028),o=e(3669);function c(s=1/0){return(0,r.Z)(o.D,s)}},5412:(D,u,e)=>{e.d(u,{h:()=>s});var r=e(8750),o=e(5225),c=e(4360);function s(a,i,n,t,l,f,m,S){const P=[];let _=0,C=0,d=!1;const h=()=>{d&&!P.length&&!_&&i.complete()},I=E=>_<t?v(E):P.push(E),v=E=>{f&&i.next(E),_++;let O=!1;(0,r.Tg)(n(E,C++)).subscribe((0,c._)(i,M=>{l?.(M),f?I(M):i.next(M)},()=>{O=!0},void 0,()=>{if(O)try{for(_--;P.length&&_<t;){const M=P.shift();m?(0,o.N)(i,m,()=>v(M)):v(M)}h()}catch(M){i.error(M)}}))};return a.subscribe((0,c._)(i,I,()=>{d=!0,h()})),()=>{S?.()}}},3028:(D,u,e)=>{e.d(u,{Z:()=>i});var r=e(6354),o=e(8750),c=e(9974),s=e(5412),a=e(8071);function i(n,t,l=1/0){return(0,a.T)(t)?i((f,m)=>(0,r.T)((S,P)=>t(f,S,m,P))((0,o.Tg)(n(f,m))),l):("number"==typeof t&&(l=t),(0,c.N)((f,m)=>(0,s.h)(f,m,n,l)))}},941:(D,u,e)=>{e.d(u,{Q:()=>s});var r=e(5225),o=e(9974),c=e(4360);function s(a,i=0){return(0,o.N)((n,t)=>{n.subscribe((0,c._)(t,l=>(0,r.N)(t,a,()=>t.next(l),i),()=>(0,r.N)(t,a,()=>t.complete(),i),l=>(0,r.N)(t,a,()=>t.error(l),i)))})}},6745:(D,u,e)=>{e.d(u,{_:()=>o});var r=e(9974);function o(c,s=0){return(0,r.N)((a,i)=>{i.add(c.schedule(()=>a.subscribe(i),s))})}},6697:(D,u,e)=>{e.d(u,{s:()=>s});var r=e(983),o=e(9974),c=e(4360);function s(a){return a<=0?()=>r.w:(0,o.N)((i,n)=>{let t=0;i.subscribe((0,c._)(n,l=>{++t<=a&&(n.next(l),a<=t&&n.complete())}))})}},7119:(D,u,e)=>{e.d(u,{S:()=>a});var r=e(1985),o=e(4761),c=e(8071),s=e(5225);function a(i,n){return new r.c(t=>{let l;return(0,s.N)(t,n,()=>{l=i[o.l](),(0,s.N)(t,n,()=>{let f,m;try{({value:f,done:m}=l.next())}catch(S){return void t.error(S)}m?t.complete():t.next(f)},0,!0)}),()=>(0,c.T)(l?.return)&&l.return()})}},5894:(D,u,e)=>{e.d(u,{c:()=>v});var r=e(8750),o=e(941),c=e(6745),i=e(1985),t=e(7119),l=e(5225);function f(E,O){if(!E)throw new Error("Iterable cannot be null");return new i.c(M=>{(0,l.N)(M,O,()=>{const A=E[Symbol.asyncIterator]();(0,l.N)(M,O,()=>{A.next().then(g=>{g.done?M.complete():M.next(g.value)})},0,!0)})})}var m=e(5055),S=e(9858),P=e(7441),_=e(5397),C=e(7953),d=e(591),h=e(5196);function v(E,O){if(null!=E){if((0,m.l)(E))return function s(E,O){return(0,r.Tg)(E).pipe((0,c._)(O),(0,o.Q)(O))}(E,O);if((0,P.X)(E))return function n(E,O){return new i.c(M=>{let A=0;return O.schedule(function(){A===E.length?M.complete():(M.next(E[A++]),M.closed||this.schedule())})})}(E,O);if((0,S.y)(E))return function a(E,O){return(0,r.Tg)(E).pipe((0,c._)(O),(0,o.Q)(O))}(E,O);if((0,C.T)(E))return f(E,O);if((0,_.x)(E))return(0,t.S)(E,O);if((0,h.U)(E))return function I(E,O){return f((0,h.C)(E),O)}(E,O)}throw(0,d.L)(E)}},6780:(D,u,e)=>{e.d(u,{R:()=>a});var r=e(3961);class o extends r.yU{constructor(n,t){super()}schedule(n,t=0){return this}}const c={setInterval(i,n,...t){const{delegate:l}=c;return l?.setInterval?l.setInterval(i,n,...t):setInterval(i,n,...t)},clearInterval(i){const{delegate:n}=c;return(n?.clearInterval||clearInterval)(i)},delegate:void 0};var s=e(7908);class a extends o{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var l;if(this.closed)return this;this.state=n;const f=this.id,m=this.scheduler;return null!=f&&(this.id=this.recycleAsyncId(m,f,t)),this.pending=!0,this.delay=t,this.id=null!==(l=this.id)&&void 0!==l?l:this.requestAsyncId(m,this.id,t),this}requestAsyncId(n,t,l=0){return c.setInterval(n.flush.bind(n,this),l)}recycleAsyncId(n,t,l=0){if(null!=l&&this.delay===l&&!1===this.pending)return t;null!=t&&c.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const l=this._execute(n,t);if(l)return l;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let f,l=!1;try{this.work(n)}catch(m){l=!0,f=m||new Error("Scheduled action threw falsy error")}if(l)return this.unsubscribe(),f}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:l}=t;this.work=this.state=this.scheduler=null,this.pending=!1,(0,s.o)(l,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}},707:(D,u,e)=>{e.d(u,{q:()=>o});var r=e(8399);class o extends r._{constructor(s,a=r._.now){super(s,a),this.actions=[],this._active=!1}flush(s){const{actions:a}=this;if(this._active)return void a.push(s);let i;this._active=!0;do{if(i=s.execute(s.state,s.delay))break}while(s=a.shift());if(this._active=!1,i){for(;s=a.shift();)s.unsubscribe();throw i}}}},3236:(D,u,e)=>{e.d(u,{E:()=>c,b:()=>s});var r=e(6780);const c=new(e(707).q)(r.R),s=c},6129:(D,u,e)=>{e.d(u,{U:()=>r});const r={now:()=>(r.delegate||Date).now(),delegate:void 0}},9326:(D,u,e)=>{e.d(u,{R0:()=>i,lI:()=>a,ms:()=>s});var r=e(8071),o=e(9470);function c(n){return n[n.length-1]}function s(n){return(0,r.T)(c(n))?n.pop():void 0}function a(n){return(0,o.m)(c(n))?n.pop():void 0}function i(n,t){return"number"==typeof c(n)?n.pop():t}},5225:(D,u,e)=>{function r(o,c,s,a=0,i=!1){const n=c.schedule(function(){s(),i?o.add(this.schedule(null,a)):this.unsubscribe()},a);if(o.add(n),!i)return n}e.d(u,{N:()=>r})},8211:(D,u,e)=>{function r(o){return o instanceof Date&&!isNaN(o)}e.d(u,{v:()=>r})},9470:(D,u,e)=>{e.d(u,{m:()=>o});var r=e(8071);function o(c){return c&&(0,r.T)(c.schedule)}},467:(D,u,e)=>{function r(c,s,a,i,n,t,l){try{var f=c[t](l),m=f.value}catch(S){return void a(S)}f.done?s(m):Promise.resolve(m).then(i,n)}function o(c){return function(){var s=this,a=arguments;return new Promise(function(i,n){var t=c.apply(s,a);function l(m){r(t,i,n,l,f,"next",m)}function f(m){r(t,i,n,l,f,"throw",m)}l(void 0)})}}e.d(u,{A:()=>o})}}]);