(self.webpackChunkmfe_MY_SALES=self.webpackChunkmfe_MY_SALES||[]).push([[588],{2588:(D,_,e)=>{e.r(_),e.d(_,{AuthService:()=>l,CoreServicesComponent:()=>s,CoreServicesService:()=>a,ProductCategory:()=>M,RoleService:()=>f,SalesDataService:()=>P,SalesStatus:()=>O,UserRole:()=>t});var n=e(4332);let a=(()=>{class E{constructor(){}static{this.\u0275fac=function(h){return new(h||E)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})();var d=e(467),r=e(3425),i=e(4230);let l=(()=>{class E{constructor(o){this.http=o,this.id="auth of pokemon",this.ISSUER_BASE_URL="https://topfix-wrczmn.us1.zitadel.cloud",this.CLIENT_ID="336777344075263315",this.REDIRECT_URI="https://opensourcekd.github.io/pokemon/#/auth-callback",this.SCOPE="openid profile email",this.TOKEN_KEY="bearer_token",this.userSubject=new r.BehaviorSubject(null),this.user$=this.userSubject.asObservable()}login(o){o&&console.log(`[AuthService] Logged in: ${o}`),this.redirectToZitadelLogin()}redirectToZitadelLogin(){const o=new URL(`${this.ISSUER_BASE_URL}/oauth/v2/authorize`),h=this.generateRandomState(),S=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",h),sessionStorage.setItem("code_verifier",S),o.searchParams.append("client_id",this.CLIENT_ID),o.searchParams.append("redirect_uri",this.REDIRECT_URI),o.searchParams.append("response_type","code"),o.searchParams.append("scope",this.SCOPE),o.searchParams.append("state",h),window.location.href=o.toString()}handleCallback(o,h){var S=this;return(0,d.A)(function*(){const u=sessionStorage.getItem("oauth_state");if(h!==u)return console.error("State mismatch - possible CSRF attack"),!1;try{const m=yield S.exchangeCodeForToken(o);return S.setToken(m.access_token),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(m){return console.error("Error exchanging code for token:",m),!1}})()}exchangeCodeForToken(o){var h=this;return(0,d.A)(function*(){const S=`${h.ISSUER_BASE_URL}/oauth/v2/token`,u=new URLSearchParams({grant_type:"authorization_code",code:o,redirect_uri:h.REDIRECT_URI,client_id:h.CLIENT_ID}),m=yield fetch(S,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u.toString()});if(!m.ok)throw new Error(`Token exchange failed: ${m.statusText}`);return m.json()})()}logout(){this.removeToken(),this.userSubject.next(null)}getToken(){return sessionStorage.getItem(this.TOKEN_KEY)}setToken(o){sessionStorage.setItem(this.TOKEN_KEY,o)}removeToken(){sessionStorage.removeItem(this.TOKEN_KEY)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}setUserInfo(o){this.userSubject.next(o)}generateRandomState(){const o=new Uint8Array(32);return crypto.getRandomValues(o),Array.from(o,h=>h.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const o=new Uint8Array(32);return crypto.getRandomValues(o),Array.from(o,h=>h.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(h){return new(h||E)(n.\u0275\u0275inject(i.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})(),s=(()=>{class E{static{this.\u0275fac=function(h){return new(h||E)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:E,selectors:[["org-core-services"]],standalone:!0,features:[n.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(h,S){1&h&&(n.\u0275\u0275elementStart(0,"p"),n.\u0275\u0275text(1," core-services works! "),n.\u0275\u0275elementEnd())}})}}return E})();var t=function(E){return E.SUPER_ADMIN="super-admin",E.ORG_ADMIN="org-admin",E.TEAM_LEAD="team-lead",E.SALES_EXECUTIVE="sales-executive",E}(t||{});let c=!1;try{c=globalThis.__DATA_CONFIG__?.useMockData??!1}catch{}let f=(()=>{class E{constructor(o){this.currentUserSubject=new r.BehaviorSubject(null),this.currentUser$=this.currentUserSubject.asObservable(),this.allUsersSubject=new r.BehaviorSubject([]),this.allUsers$=this.allUsersSubject.asObservable(),this.dataService=o,!this.dataService&&c&&(console.warn("[RoleService] No DataService found. Using minimal dummy data for testing."),this.loadDummyDataForTesting())}setCurrentUser(o){this.currentUserSubject.next(o)}getCurrentUser(){return this.currentUserSubject.value}setAllUsers(o){this.allUsersSubject.next(o)}getAllUsers(){return this.allUsersSubject.value}hasRole(o){return this.getCurrentUser()?.role===o}hasAnyRole(o){const h=this.getCurrentUser();return!!h&&o.includes(h.role)}isAdmin(){return this.hasAnyRole([t.SUPER_ADMIN,t.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([t.SUPER_ADMIN,t.ORG_ADMIN,t.TEAM_LEAD])}getViewableUsers(){const o=this.getCurrentUser();if(!o)return[];const h=this.getAllUsers();return this.isTeamLeadOrHigher()?h.filter(S=>S.role===t.SALES_EXECUTIVE||S.id===o.id):h.filter(S=>S.id===o.id)}loadDummyDataForTesting(){const o=[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:t.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:t.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:t.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:t.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:t.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:t.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}];this.setAllUsers(o),this.setCurrentUser(o[3])}static{this.\u0275fac=function(h){return new(h||E)(n.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})();var v=e(3103),O=function(E){return E.COMPLETED="completed",E.PENDING="pending",E.CANCELLED="cancelled",E}(O||{}),M=function(E){return E.ELECTRONICS="Electronics",E.SOFTWARE="Software",E.SERVICES="Services",E.HARDWARE="Hardware",E}(M||{});let P=(()=>{class E{constructor(o){this.dummySalesData=this.generateDummyData(),this.dataService=o}getSalesHistory(o,h,S){if(this.dataService)return this.dataService.getSalesHistory(o,h,S);let u=this.dummySalesData.filter(m=>m.salesExecutiveId===o);return h&&(u=u.filter(m=>m.date>=h)),S&&(u=u.filter(m=>m.date<=S)),(0,r.of)(u).pipe((0,v.c)(300))}getSalesSummary(o){if(this.dataService)return this.dataService.getSalesSummary(o);const h=this.dummySalesData.filter(u=>u.salesExecutiveId===o),S={totalSales:h.filter(u=>u.status===O.COMPLETED).reduce((u,m)=>u+m.amount,0),totalCommission:h.filter(u=>u.status===O.COMPLETED).reduce((u,m)=>u+m.commission,0),completedCount:h.filter(u=>u.status===O.COMPLETED).length,pendingCount:h.filter(u=>u.status===O.PENDING).length,cancelledCount:h.filter(u=>u.status===O.CANCELLED).length};return(0,r.of)(S).pipe((0,v.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,r.of)(this.dummySalesData).pipe((0,v.c)(300))}generateDummyData(){const o=[{name:"Enterprise Software License",category:M.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:M.SERVICES,basePrice:25e3},{name:"Server Hardware",category:M.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:M.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:M.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:M.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:M.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:M.HARDWARE,basePrice:6e4}],h=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],S=["North","South","East","West","Central"],u=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],m=[O.COMPLETED,O.COMPLETED,O.COMPLETED,O.PENDING,O.CANCELLED],I=[];let T=1;for(let A=0;A<50;A++){const g=u[A%u.length],R=o[Math.floor(Math.random()*o.length)],L=h[Math.floor(Math.random()*h.length)],p=S[Math.floor(Math.random()*S.length)],K=m[Math.floor(Math.random()*m.length)],y=R.basePrice+(1e4*Math.random()-5e3),W=.05*y,U=new Date;U.setDate(U.getDate()-Math.floor(180*Math.random())),I.push({id:"sale-"+T++,salesExecutiveId:g.id,salesExecutiveName:g.name,productName:R.name,productCategory:R.category,amount:Math.round(y),commission:Math.round(W),status:K,date:U,clientName:L,region:p})}return I.sort((A,g)=>g.date.getTime()-A.date.getTime())}static{this.\u0275fac=function(h){return new(h||E)(n.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()},8399:(D,_,e)=>{e.d(_,{_:()=>a});var n=e(6129);class a{constructor(r,i=a.now){this.schedulerActionCtor=r,this.now=i}schedule(r,i=0,l){return new this.schedulerActionCtor(this,r).schedule(l,i)}}a.now=n.U.now},2688:(D,_,e)=>{e.d(_,{x:()=>r});var n=e(9131),a=e(9326),d=e(9724);function r(...i){return(0,n.K)()((0,d.H)(i,(0,a.lI)(i)))}},983:(D,_,e)=>{e.d(_,{I:()=>d,w:()=>a});var n=e(1985);const a=new n.c(i=>i.complete());function d(i){return i?function r(i){return new n.c(l=>i.schedule(()=>l.complete()))}(i):a}},9724:(D,_,e)=>{e.d(_,{H:()=>d});var n=e(5894),a=e(8750);function d(r,i){return i?(0,n.c)(r,i):(0,a.Tg)(r)}},1807:(D,_,e)=>{e.d(_,{O:()=>i});var n=e(1985),a=e(3236),d=e(9470),r=e(8211);function i(l=0,s,t=a.b){let c=-1;return null!=s&&((0,d.m)(s)?t=s:c=s),new n.c(f=>{let v=(0,r.v)(l)?+l-t.now():l;v<0&&(v=0);let O=0;return t.schedule(function(){f.closed||(f.next(O++),0<=c?this.schedule(void 0,c):f.complete())},v)})}},9131:(D,_,e)=>{e.d(_,{K:()=>a});var n=e(6365);function a(){return(0,n.U)(1)}},3103:(D,_,e)=>{e.d(_,{c:()=>r});var n=e(3236),a=e(3183),d=e(1807);function r(i,l=n.E){const s=(0,d.O)(i,l);return(0,a.o)(()=>s)}},3183:(D,_,e)=>{e.d(_,{o:()=>s});var n=e(2688),a=e(6697),d=e(3557),r=e(3703),i=e(3028),l=e(8750);function s(t,c){return c?f=>(0,n.x)(c.pipe((0,a.s)(1),(0,d.w)()),f.pipe(s(t))):(0,i.Z)((f,v)=>(0,l.Tg)(t(f,v)).pipe((0,a.s)(1),(0,r.u)(f)))}},3557:(D,_,e)=>{e.d(_,{w:()=>r});var n=e(9974),a=e(4360),d=e(5343);function r(){return(0,n.N)((i,l)=>{i.subscribe((0,a._)(l,d.l))})}},6354:(D,_,e)=>{e.d(_,{T:()=>d});var n=e(9974),a=e(4360);function d(r,i){return(0,n.N)((l,s)=>{let t=0;l.subscribe((0,a._)(s,c=>{s.next(r.call(i,c,t++))}))})}},3703:(D,_,e)=>{e.d(_,{u:()=>a});var n=e(6354);function a(d){return(0,n.T)(()=>d)}},6365:(D,_,e)=>{e.d(_,{U:()=>d});var n=e(3028),a=e(3669);function d(r=1/0){return(0,n.Z)(a.D,r)}},5412:(D,_,e)=>{e.d(_,{h:()=>r});var n=e(8750),a=e(5225),d=e(4360);function r(i,l,s,t,c,f,v,O){const M=[];let P=0,E=0,C=!1;const o=()=>{C&&!M.length&&!P&&l.complete()},h=u=>P<t?S(u):M.push(u),S=u=>{f&&l.next(u),P++;let m=!1;(0,n.Tg)(s(u,E++)).subscribe((0,d._)(l,I=>{c?.(I),f?h(I):l.next(I)},()=>{m=!0},void 0,()=>{if(m)try{for(P--;M.length&&P<t;){const I=M.shift();v?(0,a.N)(l,v,()=>S(I)):S(I)}o()}catch(I){l.error(I)}}))};return i.subscribe((0,d._)(l,h,()=>{C=!0,o()})),()=>{O?.()}}},3028:(D,_,e)=>{e.d(_,{Z:()=>l});var n=e(6354),a=e(8750),d=e(9974),r=e(5412),i=e(8071);function l(s,t,c=1/0){return(0,i.T)(t)?l((f,v)=>(0,n.T)((O,M)=>t(f,O,v,M))((0,a.Tg)(s(f,v))),c):("number"==typeof t&&(c=t),(0,d.N)((f,v)=>(0,r.h)(f,v,s,c)))}},941:(D,_,e)=>{e.d(_,{Q:()=>r});var n=e(5225),a=e(9974),d=e(4360);function r(i,l=0){return(0,a.N)((s,t)=>{s.subscribe((0,d._)(t,c=>(0,n.N)(t,i,()=>t.next(c),l),()=>(0,n.N)(t,i,()=>t.complete(),l),c=>(0,n.N)(t,i,()=>t.error(c),l)))})}},6745:(D,_,e)=>{e.d(_,{_:()=>a});var n=e(9974);function a(d,r=0){return(0,n.N)((i,l)=>{l.add(d.schedule(()=>i.subscribe(l),r))})}},6697:(D,_,e)=>{e.d(_,{s:()=>r});var n=e(983),a=e(9974),d=e(4360);function r(i){return i<=0?()=>n.w:(0,a.N)((l,s)=>{let t=0;l.subscribe((0,d._)(s,c=>{++t<=i&&(s.next(c),i<=t&&s.complete())}))})}},7119:(D,_,e)=>{e.d(_,{S:()=>i});var n=e(1985),a=e(4761),d=e(8071),r=e(5225);function i(l,s){return new n.c(t=>{let c;return(0,r.N)(t,s,()=>{c=l[a.l](),(0,r.N)(t,s,()=>{let f,v;try{({value:f,done:v}=c.next())}catch(O){return void t.error(O)}v?t.complete():t.next(f)},0,!0)}),()=>(0,d.T)(c?.return)&&c.return()})}},5894:(D,_,e)=>{e.d(_,{c:()=>S});var n=e(8750),a=e(941),d=e(6745),l=e(1985),t=e(7119),c=e(5225);function f(u,m){if(!u)throw new Error("Iterable cannot be null");return new l.c(I=>{(0,c.N)(I,m,()=>{const T=u[Symbol.asyncIterator]();(0,c.N)(I,m,()=>{T.next().then(A=>{A.done?I.complete():I.next(A.value)})},0,!0)})})}var v=e(5055),O=e(9858),M=e(7441),P=e(5397),E=e(7953),C=e(591),o=e(5196);function S(u,m){if(null!=u){if((0,v.l)(u))return function r(u,m){return(0,n.Tg)(u).pipe((0,d._)(m),(0,a.Q)(m))}(u,m);if((0,M.X)(u))return function s(u,m){return new l.c(I=>{let T=0;return m.schedule(function(){T===u.length?I.complete():(I.next(u[T++]),I.closed||this.schedule())})})}(u,m);if((0,O.y)(u))return function i(u,m){return(0,n.Tg)(u).pipe((0,d._)(m),(0,a.Q)(m))}(u,m);if((0,E.T)(u))return f(u,m);if((0,P.x)(u))return(0,t.S)(u,m);if((0,o.U)(u))return function h(u,m){return f((0,o.C)(u),m)}(u,m)}throw(0,C.L)(u)}},6780:(D,_,e)=>{e.d(_,{R:()=>i});var n=e(3961);class a extends n.yU{constructor(s,t){super()}schedule(s,t=0){return this}}const d={setInterval(l,s,...t){const{delegate:c}=d;return c?.setInterval?c.setInterval(l,s,...t):setInterval(l,s,...t)},clearInterval(l){const{delegate:s}=d;return(s?.clearInterval||clearInterval)(l)},delegate:void 0};var r=e(7908);class i extends a{constructor(s,t){super(s,t),this.scheduler=s,this.work=t,this.pending=!1}schedule(s,t=0){var c;if(this.closed)return this;this.state=s;const f=this.id,v=this.scheduler;return null!=f&&(this.id=this.recycleAsyncId(v,f,t)),this.pending=!0,this.delay=t,this.id=null!==(c=this.id)&&void 0!==c?c:this.requestAsyncId(v,this.id,t),this}requestAsyncId(s,t,c=0){return d.setInterval(s.flush.bind(s,this),c)}recycleAsyncId(s,t,c=0){if(null!=c&&this.delay===c&&!1===this.pending)return t;null!=t&&d.clearInterval(t)}execute(s,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const c=this._execute(s,t);if(c)return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(s,t){let f,c=!1;try{this.work(s)}catch(v){c=!0,f=v||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),f}unsubscribe(){if(!this.closed){const{id:s,scheduler:t}=this,{actions:c}=t;this.work=this.state=this.scheduler=null,this.pending=!1,(0,r.o)(c,this),null!=s&&(this.id=this.recycleAsyncId(t,s,null)),this.delay=null,super.unsubscribe()}}}},707:(D,_,e)=>{e.d(_,{q:()=>a});var n=e(8399);class a extends n._{constructor(r,i=n._.now){super(r,i),this.actions=[],this._active=!1}flush(r){const{actions:i}=this;if(this._active)return void i.push(r);let l;this._active=!0;do{if(l=r.execute(r.state,r.delay))break}while(r=i.shift());if(this._active=!1,l){for(;r=i.shift();)r.unsubscribe();throw l}}}},3236:(D,_,e)=>{e.d(_,{E:()=>d,b:()=>r});var n=e(6780);const d=new(e(707).q)(n.R),r=d},6129:(D,_,e)=>{e.d(_,{U:()=>n});const n={now:()=>(n.delegate||Date).now(),delegate:void 0}},9326:(D,_,e)=>{e.d(_,{R0:()=>l,lI:()=>i,ms:()=>r});var n=e(8071),a=e(9470);function d(s){return s[s.length-1]}function r(s){return(0,n.T)(d(s))?s.pop():void 0}function i(s){return(0,a.m)(d(s))?s.pop():void 0}function l(s,t){return"number"==typeof d(s)?s.pop():t}},5225:(D,_,e)=>{function n(a,d,r,i=0,l=!1){const s=d.schedule(function(){r(),l?a.add(this.schedule(null,i)):this.unsubscribe()},i);if(a.add(s),!l)return s}e.d(_,{N:()=>n})},8211:(D,_,e)=>{function n(a){return a instanceof Date&&!isNaN(a)}e.d(_,{v:()=>n})},9470:(D,_,e)=>{e.d(_,{m:()=>a});var n=e(8071);function a(d){return d&&(0,n.T)(d.schedule)}},467:(D,_,e)=>{function n(d,r,i,l,s,t,c){try{var f=d[t](c),v=f.value}catch(O){return void i(O)}f.done?r(v):Promise.resolve(v).then(l,s)}function a(d){return function(){var r=this,i=arguments;return new Promise(function(l,s){var t=d.apply(r,i);function c(v){n(t,l,s,c,f,"next",v)}function f(v){n(t,l,s,c,f,"throw",v)}c(void 0)})}}e.d(_,{A:()=>a})}}]);