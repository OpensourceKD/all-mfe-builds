(self.webpackChunkmfe_MY_SALES=self.webpackChunkmfe_MY_SALES||[]).push([[588],{2588:(U,C,d)=>{d.r(C),d.d(C,{AuthService:()=>f,CoreServicesComponent:()=>g,CoreServicesService:()=>A,ProductCategory:()=>m,RoleService:()=>S,SalesDataService:()=>b,SalesStatus:()=>c,UserRole:()=>o});var i=d(4332);let A=(()=>{class t{constructor(){}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var E=d(467),l=d(3425),p=d(4230);let f=(()=>{class t{constructor(e){this.http=e,this.id="auth of pokemon",this.ISSUER_BASE_URL="https://topfix-wrczmn.us1.zitadel.cloud",this.CLIENT_ID="336777344075263315",this.REDIRECT_URI="https://opensourcekd.github.io/pokemon/#/auth-callback",this.SCOPE="openid profile email",this.TOKEN_KEY="bearer_token",this.userSubject=new l.BehaviorSubject(null),this.user$=this.userSubject.asObservable()}login(e){e&&console.log(`[AuthService] Logged in: ${e}`),this.redirectToZitadelLogin()}redirectToZitadelLogin(){const e=new URL(`${this.ISSUER_BASE_URL}/oauth/v2/authorize`),r=this.generateRandomState(),s=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",r),sessionStorage.setItem("code_verifier",s),e.searchParams.append("client_id",this.CLIENT_ID),e.searchParams.append("redirect_uri",this.REDIRECT_URI),e.searchParams.append("response_type","code"),e.searchParams.append("scope",this.SCOPE),e.searchParams.append("state",r),window.location.href=e.toString()}handleCallback(e,r){var s=this;return(0,E.A)(function*(){const a=sessionStorage.getItem("oauth_state");if(r!==a)return console.error("State mismatch - possible CSRF attack"),!1;try{const n=yield s.exchangeCodeForToken(e);return s.setToken(n.access_token),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(n){return console.error("Error exchanging code for token:",n),!1}})()}exchangeCodeForToken(e){var r=this;return(0,E.A)(function*(){const s=`${r.ISSUER_BASE_URL}/oauth/v2/token`,a=new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:r.REDIRECT_URI,client_id:r.CLIENT_ID}),n=yield fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});if(!n.ok)throw new Error(`Token exchange failed: ${n.statusText}`);return n.json()})()}logout(){this.removeToken(),this.userSubject.next(null)}getToken(){return sessionStorage.getItem(this.TOKEN_KEY)}setToken(e){sessionStorage.setItem(this.TOKEN_KEY,e)}removeToken(){sessionStorage.removeItem(this.TOKEN_KEY)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}setUserInfo(e){this.userSubject.next(e)}generateRandomState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(r){return new(r||t)(i.\u0275\u0275inject(p.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),g=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:t,selectors:[["org-core-services"]],standalone:!0,features:[i.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(r,s){1&r&&(i.\u0275\u0275elementStart(0,"p"),i.\u0275\u0275text(1," core-services works! "),i.\u0275\u0275elementEnd())}})}}return t})();var o=function(t){return t.SUPER_ADMIN="super-admin",t.ORG_ADMIN="org-admin",t.TEAM_LEAD="team-lead",t.SALES_EXECUTIVE="sales-executive",t}(o||{});let h=!1;try{h=globalThis.__DATA_CONFIG__?.useMockData??!1}catch{}let S=(()=>{class t{constructor(e){this.currentUserSubject=new l.BehaviorSubject(null),this.currentUser$=this.currentUserSubject.asObservable(),this.allUsersSubject=new l.BehaviorSubject([]),this.allUsers$=this.allUsersSubject.asObservable(),this.dataService=e,!this.dataService&&h&&(console.warn("[RoleService] No DataService found. Using minimal dummy data for testing."),this.loadDummyDataForTesting())}setCurrentUser(e){this.currentUserSubject.next(e)}getCurrentUser(){return this.currentUserSubject.value}setAllUsers(e){this.allUsersSubject.next(e)}getAllUsers(){return this.allUsersSubject.value}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){const r=this.getCurrentUser();return!!r&&e.includes(r.role)}isAdmin(){return this.hasAnyRole([o.SUPER_ADMIN,o.ORG_ADMIN])}isTeamLeadOrHigher(){return this.hasAnyRole([o.SUPER_ADMIN,o.ORG_ADMIN,o.TEAM_LEAD])}getViewableUsers(){const e=this.getCurrentUser();if(!e)return[];const r=this.getAllUsers();return this.isTeamLeadOrHigher()?r.filter(s=>s.role===o.SALES_EXECUTIVE||s.id===e.id):r.filter(s=>s.id===e.id)}loadDummyDataForTesting(){const e=[{id:"user-1",name:"John Admin",email:"john.admin@company.com",role:o.SUPER_ADMIN},{id:"user-2",name:"Sarah Manager",email:"sarah.manager@company.com",role:o.ORG_ADMIN},{id:"user-3",name:"Mike Lead",email:"mike.lead@company.com",role:o.TEAM_LEAD,teamId:"team-1"},{id:"user-4",name:"Alice Sales",email:"alice.sales@company.com",role:o.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-5",name:"Bob Sales",email:"bob.sales@company.com",role:o.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"},{id:"user-6",name:"Carol Sales",email:"carol.sales@company.com",role:o.SALES_EXECUTIVE,teamId:"team-1",managerId:"user-3"}];this.setAllUsers(e),this.setCurrentUser(e[3])}static{this.\u0275fac=function(r){return new(r||t)(i.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var u=d(3103),c=function(t){return t.COMPLETED="completed",t.PENDING="pending",t.CANCELLED="cancelled",t}(c||{}),m=function(t){return t.ELECTRONICS="Electronics",t.SOFTWARE="Software",t.SERVICES="Services",t.HARDWARE="Hardware",t}(m||{});let b=(()=>{class t{constructor(e){this.dummySalesData=this.generateDummyData(),this.dataService=e}getSalesHistory(e,r,s){if(this.dataService)return this.dataService.getSalesHistory(e,r,s);let a=this.dummySalesData.filter(n=>n.salesExecutiveId===e);return r&&(a=a.filter(n=>n.date>=r)),s&&(a=a.filter(n=>n.date<=s)),(0,l.of)(a).pipe((0,u.c)(300))}getSalesSummary(e){if(this.dataService)return this.dataService.getSalesSummary(e);const r=this.dummySalesData.filter(a=>a.salesExecutiveId===e),s={totalSales:r.filter(a=>a.status===c.COMPLETED).reduce((a,n)=>a+n.amount,0),totalCommission:r.filter(a=>a.status===c.COMPLETED).reduce((a,n)=>a+n.commission,0),completedCount:r.filter(a=>a.status===c.COMPLETED).length,pendingCount:r.filter(a=>a.status===c.PENDING).length,cancelledCount:r.filter(a=>a.status===c.CANCELLED).length};return(0,l.of)(s).pipe((0,u.c)(300))}getAllSales(){return this.dataService?this.dataService.getAllSales():(0,l.of)(this.dummySalesData).pipe((0,u.c)(300))}generateDummyData(){const e=[{name:"Enterprise Software License",category:m.SOFTWARE,basePrice:5e4},{name:"Cloud Storage Solution",category:m.SERVICES,basePrice:25e3},{name:"Server Hardware",category:m.HARDWARE,basePrice:35e3},{name:"IoT Device Package",category:m.ELECTRONICS,basePrice:15e3},{name:"Consulting Services",category:m.SERVICES,basePrice:2e4},{name:"Mobile App Development",category:m.SOFTWARE,basePrice:45e3},{name:"Security Suite",category:m.SOFTWARE,basePrice:3e4},{name:"Network Infrastructure",category:m.HARDWARE,basePrice:6e4}],r=["Acme Corporation","Tech Innovations Inc","Global Solutions Ltd","Digital Dynamics","Future Systems","Smart Technologies","Enterprise Solutions","Cloud Masters"],s=["North","South","East","West","Central"],a=[{id:"user-4",name:"Alice Sales"},{id:"user-5",name:"Bob Sales"},{id:"user-6",name:"Carol Sales"}],n=[c.COMPLETED,c.COMPLETED,c.COMPLETED,c.PENDING,c.CANCELLED],D=[];let L=1;for(let v=0;v<50;v++){const y=a[v%a.length],I=e[Math.floor(Math.random()*e.length)],M=r[Math.floor(Math.random()*r.length)],_=s[Math.floor(Math.random()*s.length)],N=n[Math.floor(Math.random()*n.length)],R=I.basePrice+(1e4*Math.random()-5e3),P=.05*R,T=new Date;T.setDate(T.getDate()-Math.floor(180*Math.random())),D.push({id:"sale-"+L++,salesExecutiveId:y.id,salesExecutiveName:y.name,productName:I.name,productCategory:I.category,amount:Math.round(R),commission:Math.round(P),status:N,date:T,clientName:M,region:_})}return D.sort((v,y)=>y.date.getTime()-v.date.getTime())}static{this.\u0275fac=function(r){return new(r||t)(i.\u0275\u0275inject("DataService",8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})()},467:(U,C,d)=>{function i(E,l,p,f,g,o,h){try{var S=E[o](h),u=S.value}catch(c){return void p(c)}S.done?l(u):Promise.resolve(u).then(f,g)}function A(E){return function(){var l=this,p=arguments;return new Promise(function(f,g){var o=E.apply(l,p);function h(u){i(o,f,g,h,S,"next",u)}function S(u){i(o,f,g,h,S,"throw",u)}h(void 0)})}}d.d(C,{A:()=>A})}}]);